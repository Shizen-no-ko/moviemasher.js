{"version":3,"file":"moviemasher.min.js","sources":["../src/Setup/Default.ts","../src/Setup/Errors.ts","../src/Utilities/Sort.js","../src/Setup/Types.ts","../src/Setup/Module.js","../src/Utilities/Is.js","../src/Setup/Property.js","../src/Utilities/Colors.js","../src/Utilities/Context.js","../src/Utilities/Id.js","../src/Utilities/Pixel.js","../src/Utilities/Throw.js","../src/Utilities/Time.js","../src/Factory/TimeFactory.ts","../src/Utilities/TimeRange.js","../src/Utilities/Utilities.js","../src/Base/Base.js","../src/Action/Action.js","../src/Action/AddTrackAction.js","../src/Action/ChangeAction.js","../src/Action/FreezeAction.js","../src/Action/ChangeFramesAction.js","../src/Action/ChangeTrimAction.js","../src/Action/AddEffectAction.js","../src/Action/AddClipToTrackAction.js","../src/Action/MoveClipsAction.js","../src/Clip/with/track.js","../src/Action/RemoveClipsAction.js","../src/Action/SplitAction.js","../src/Action/MoveEffectsAction.js","../src/Actions/Actions.js","../src/Base/with/id.js","../src/Factory/Factory.ts","../src/Media/with/label.js","../src/Base/with/object.js","../src/Media/with/sharedMedia.js","../src/Base/with/toJSONFromObject.js","../src/Loading/AudioProcessor.js","../src/Loading/Cache.js","../src/Loading/FontProcessor.js","../src/Loading/ImageProcessor.js","../src/Loading/ModuleProcessor.js","../src/Factory/ProcessorFactory.js","../src/Loading/Loader.js","../src/Loading/AudioLoader.js","../src/Loading/FontLoader.js","../src/Loading/ImageLoader.js","../src/Loading/ModuleLoader.js","../src/Factory/LoaderFactory.js","../src/Loading/UrlsByType.js","../src/Media/with/inaudible.js","../src/Media/with/visibleMedia.js","../src/Media/with/propertiesModular.js","../src/Media/with/modular.js","../src/CoreFilter/CoreFilter.js","../src/CoreFilter/BlendFilter.js","../src/CoreFilter/ChromaKeyFilter.js","../src/CoreFilter/ColorFilter.js","../src/CoreFilter/ColorChannelMixerFilter.js","../src/CoreFilter/ConvolutionFilter.js","../src/CoreFilter/CropFilter.js","../src/CoreFilter/DrawBoxFilter.js","../src/CoreFilter/DrawTextFilter.js","../src/CoreFilter/FadeFilter.js","../src/CoreFilter/OverlayFilter.js","../src/CoreFilter/ScaleFilter.js","../src/CoreFilter/SetSarFilter.js","../src/Factory/FilterFactory.js","../src/Media/with/drawFilters.js","../src/Media/Media.js","../src/Media/FilterMedia.js","../src/Media/with/parameters.js","../src/Media/with/filters.js","../src/Media/with/html.js","../src/Media/with/urlsFromFilters.js","../src/Media/with/transform.js","../src/Media/EffectMedia.js","../src/Media/ScalerMedia.js","../src/Media/MergerMedia.js","../src/Media/with/modularFalse.js","../src/Media/with/invisible.js","../src/Media/with/duration.js","../src/Media/with/propertiesTiming.js","../src/Media/with/audible.js","../src/Media/with/propertiesAudible.js","../src/Media/with/urlsAudible.js","../src/Media/AudioMedia.js","../src/Media/with/urlAudible.js","../src/Media/FontMedia.js","../src/Media/with/urlAudibleMute.js","../src/Media/with/urlsVisibleFrames.js","../src/Media/VideoMedia.js","../src/Media/with/urlVisible.js","../src/Media/with/urlsVisible.js","../src/Media/ImageMedia.js","../src/Media/ThemeMedia.js","../src/Media/with/urlsNone.js","../src/Media/TransitionMedia.js","../src/Factory/MediaFactory.js","../src/Factory/TimeRangeFactory.js","../src/Clip/with/toJSON.js","../src/Clip/with/id.js","../src/Clip/with/labelFromObjectOrMedia.js","../src/Clip/with/media.js","../src/Clip/with/propertyValues.js","../src/Clip/with/propertiesFromMedia.js","../src/Base/with/editable.js","../src/Clip/with/sharedClip.js","../src/Clip/with/copy.js","../src/Clip/with/load.js","../src/Clip/with/inaudible.js","../src/Clip/with/visibleClip.js","../src/Clip/with/urls.js","../src/Base/with/idMutable.js","../src/Clip/with/urlsFromMedia.js","../src/Transform/with/media.js","../src/Clip/Evaluator.js","../src/Clip/with/evaluator.js","../src/Transform/with/sharedTransform.js","../src/Base/with/copy.js","../src/Transform/with/toJSONTransform.js","../src/Transform/Transform.js","../src/Transform/Merger.js","../src/Transform/with/drawMerger.js","../src/Clip/with/drawMediaFilters.js","../src/Transform/Scaler.js","../src/Transform/Effect.js","../src/Clip/with/transform.js","../src/Clip/with/drawImage.js","../src/Clip/Clip.js","../src/Clip/with/mediaTime.js","../src/Clip/ImageClip.js","../src/Clip/with/invisible.js","../src/Clip/with/audible.js","../src/Clip/with/mediaTimeFromTrim.js","../src/Clip/AudioClip.js","../src/Clip/VideoClip.js","../src/Clip/ThemeClip.js","../src/Clip/with/speedOne.js","../src/Clip/TransitionClip.js","../src/Clip/FrameClip.js","../src/Factory/ClipFactory.js","../src/Track/Track.js","../src/Factory/TrackFactory.js","../src/Mash/Mash.js","../src/Events/Events.js","../src/Base/with/contexts.js","../src/Composition/Composition.js","../src/Factory/ActionFactory.js","../src/Masher/with/deprecated.js","../src/Masher/Masher.js","../src/Factory/MasherFactory.js","../src/index.umd.js"],"sourcesContent":["const Default = {\n  buffer: 10,\n  fps: 30,\n  loop: true,\n  volume: 0.75,\n  precision: 3,\n  autoplay: false,\n  mash: {\n    label: \"Untitled Mash\",\n    quantize: 10,\n    backcolor: \"rgb(0,0,0)\",\n  },\n  media: {\n    frame: { duration: 2 },\n    image: { duration: 2 },\n    theme: { duration: 3 },\n    transition: { duration: 1 },\n  }\n}\n\nexport { Default }\n","const $invalid = \"Invalid\"\nconst $unknown = \"Unknown\"\nconst $expected = \"Expected\"\nconst $invalidArgument = `${$invalid} argument`\nconst $invalidProperty = `${$invalid} property`\nconst $deprecated = \"deprecated in 4.1\"\nconst $internal = \"Internal Error \"\nconst Errors = {\n  mash: `${$expected} mash`,\n  action: `${$expected} Action`,\n  actions: `${$expected} Actions`,\n  internal: $internal,\n  argument: `${$invalidArgument} `,\n  type: `${$invalid} type `,\n  selection: `${$invalid} selection `,\n  unknown: {\n    type: `${$unknown} type `,\n    merger: `${$unknown} merger `,\n    effect: `${$unknown} effect `,\n    filter: `${$unknown} filter `,\n    font: `${$unknown} font `,\n    scaler: `${$unknown} scalar `,\n  },\n  uncached: \"Uncached URL \",\n  object: `${$invalidArgument} object `,\n  array: `${$invalidArgument} array `,\n  media: `${$invalidArgument} media `,\n  id: `${$invalidArgument} id `,\n  frame: `${$invalidArgument} frame `,\n  frames: `${$invalidProperty} frames `,\n  fps: `${$invalidArgument} fps `,\n  seconds: `${$invalidArgument} seconds `,\n  url: `${$invalidArgument} url `,\n  time: `${$invalidArgument} Time`,\n  timeRange: `${$invalidArgument} TimeRange`,\n  mainTrackOverlap: `${$internal}: main track clips overlap without transition`,\n  unknownMash: `${$unknown} Mash property `,\n  property: `${$invalidArgument} property `,\n  deprecation: {\n    property_types: `property_types ${$deprecated} - please get MovieMasher.Property.types instead`,\n    addModulesOfType: `addModulesOfType ${$deprecated} for unsupported type `,\n    configure: {\n      get: `configure ${$deprecated} - please get MovieMasher.defaults instead`,\n      set: `configure ${$deprecated} - please supply mash.quantize and media.duration instead`,\n    },\n    canvas_context: {\n      get: `canvas_context ${$deprecated} - please get videoContext instead`,\n      set: `canvas_context ${$deprecated} - please set videoContext instead`,\n    }\n  },\n  wrongClass: `${$expected} instance of `,\n}\n\nexport { Errors }\n","\n\nconst byFrame = (a, b) => a.frame - b.frame\nconst byTrack = (a, b) => a.track - b.track\nconst byLabel = (a, b) => {\n  if (a.label < b.label) return -1\n  if (a.label > b.label) return 1\n  return 0\n}\n\nconst Sort = {\n  byFrame,\n  byLabel,\n  byTrack,\n}\n\nexport { Sort, byFrame, byLabel, byTrack }\n","const $action = \"action\"\nconst $add = \"add\"\nconst $audio = \"audio\"\nconst $frame = \"frame\"\nconst $duration = \"duration\"\nconst $effect = \"effect\"\nconst $filter = \"filter\"\nconst $font = \"font\"\nconst $image = \"image\"\nconst $load = \"load\"\nconst $merger = \"merger\"\nconst $module = \"module\"\nconst $redo = \"redo\"\nconst $scaler = \"scaler\"\nconst $theme = \"theme\"\nconst $transition = \"transition\"\nconst $truncate = \"truncate\"\nconst $undo = \"undo\"\nconst $video = \"video\"\n\nconst map = (type:string) => [type, type]\n\nconst ClipTypes = [$audio, $video, $image, $theme, $transition, $frame]\nconst ClipType = Object.fromEntries(ClipTypes.map(map))\n\nconst EventTypes = [$action, $load, $duration, $truncate, $add, $undo, $redo]\nconst EventType = Object.fromEntries(EventTypes.map(map))\n\nconst MediaTypes = [\n  $audio, $image, $video,\n  $theme, $transition,\n  $scaler, $merger, $effect,\n  $font, $filter\n]\n\nconst MediaType = Object.fromEntries(MediaTypes.map(map))\n\nconst ModuleTypes = [$font, $effect, $scaler, $merger, $theme, $transition]\nconst ModuleType = Object.fromEntries(ModuleTypes.map(map))\n\nconst LoadTypes = [$font, $image, $audio, $module]\nconst LoadType = Object.fromEntries(LoadTypes.map(map))\n\nconst TrackTypes = [$audio, $video]\nconst TrackType = Object.fromEntries(TrackTypes.map(map))\n\nconst MoveTypes = [$effect, ...TrackTypes]\nconst MoveType = Object.fromEntries(MoveTypes.map(map))\n\nconst TransformTypes = [$merger, $scaler]\nconst TransformType = Object.fromEntries(TransformTypes.map(map))\n\nexport {\n  LoadType, LoadTypes,\n  ClipType, ClipTypes,\n  EventType, EventTypes,\n  MediaType, MediaTypes,\n  ModuleType, ModuleTypes,\n  MoveType, MoveTypes,\n  TrackType, TrackTypes,\n  TransformType, TransformTypes,\n}\n","import { byLabel } from \"../Utilities/Sort\"\nimport { ModuleType, ModuleTypes } from \"./Types\"\nimport { Errors } from \"./Errors\"\n\nimport fontDefaultJson from \"./modules/font/default.json\"\nimport effectBlurJson from \"./modules/effect/blur.json\"\nimport effectChromaKeyJson from \"./modules/effect/chromakey.json\"\nimport effectEmbossJson from \"./modules/effect/emboss.json\"\nimport effectGrayscaleJson from \"./modules/effect/grayscale.json\"\nimport effectSepiaJson from \"./modules/effect/sepia.json\"\nimport effectSharpenJson from \"./modules/effect/sharpen.json\"\nimport effectTextJson from \"./modules/effect/text.json\"\nimport mergerBlendJson from \"./modules/merger/blend.json\"\nimport mergerCenterJson from \"./modules/merger/center.json\"\nimport mergerConstrainedJson from \"./modules/merger/constrained.json\"\nimport mergerDefaultJson from \"./modules/merger/default.json\"\nimport mergerOverlayJson from \"./modules/merger/overlay.json\"\nimport scalerDefaultJson from \"./modules/scaler/default.json\"\nimport scalerPanJson from \"./modules/scaler/pan.json\"\nimport scalerScaleJson from \"./modules/scaler/scale.json\"\nimport themeColorJson from \"./modules/theme/color.json\"\nimport themeTextJson from \"./modules/theme/text.json\"\n\n// interface Defaults {\n//   font: Object\n//   merger: Object\n//   scaler: Object\n//   effect?: Object\n// }\n\n// TODO: rewrite as properties applied to class\nclass Module {\n  // defaults: Defaults\n  constructor() {\n    this.defaults = {\n      font: fontDefaultJson,\n      merger: mergerDefaultJson,\n      scaler: scalerDefaultJson,\n    }\n    this[ModuleType.theme] = [\n      themeColorJson,\n      themeTextJson,\n    ]\n    this[ModuleType.effect] = [\n      effectBlurJson,\n      effectChromaKeyJson,\n      effectEmbossJson,\n      effectGrayscaleJson,\n      effectSepiaJson,\n      effectSharpenJson,\n      effectTextJson\n    ]\n    this[ModuleType.font] = [this.defaults.font]\n    this[ModuleType.merger] = [\n      mergerBlendJson,\n      mergerCenterJson,\n      mergerConstrainedJson,\n      mergerOverlayJson,\n      this.defaults.merger,\n    ]\n    this[ModuleType.scaler] = [\n      scalerPanJson,\n      scalerScaleJson,\n      this.defaults.scaler,\n    ]\n    ModuleTypes.forEach(type => this[type] ||= [])\n  }\n\n  addModulesOfType(objects, type) {\n    if (! ModuleTypes.includes(type)) {\n      console.warn(Errors.deprecation.addModulesOfType + type)\n      return\n    }\n    const array = this[type]\n    let changed = false\n    objects.forEach(object => {\n      const { id } = object\n      const is_default = id === 'com.moviemasher.' + type + '.default'\n      const existing = this[type].find(object => object.id === id)\n      if (existing) array.splice(array.indexOf(existing), 1)\n      array.push(object)\n      if (is_default) this.defaults[type] = object\n      changed = true\n    })\n    if (changed) array.sort(byLabel)\n    return changed\n  }\n\n  fontById(id) { return this.ofType(id, ModuleType.font) }\n\n  scalerById(id) { return this.ofType(id, ModuleType.scaler) }\n\n  mergerById(id) { return this.ofType(id, ModuleType.merger) }\n\n\n  effectById(id) { return this.ofType(id, ModuleType.effect) }\n\n\n  themeById(id) { return this.ofType(id, ModuleType.theme) }\n\n  defaultOfType(type) { return { ...this.defaults[type], type } }\n\n  objectWithDefaultId(type) {\n    const module = this.defaultOfType(type)\n    if (module) return { id: module.id, type }\n  }\n\n  ofType(id, type) {\n    if (! ModuleTypes.includes(type)) {\n      console.warn(\"Module.ofType unsupported type\", type)\n      return\n    }\n    if (!this[type]) console.log(this.constructor.name, \"ofType\", type)\n    const module = this[type].find(object => object.id === id)\n    if (module) return { ...module, type }\n  }\n}\n\nconst ModuleInstance = new Module\nexport { ModuleInstance as Module }\n","const array = value => {\n  if (defined(Array.isArray)) return Array.isArray(value)\n\n  return instance(value, Array) \n}\nconst method = value => typeof value === 'function'\n\nconst object = value => typeof value === 'object'\nconst string = value => typeof value === 'string'\nconst undefined = value => typeof value === 'undefined'\nconst number = value => typeof value === 'number'\nconst boolean = value => typeof value === 'boolean'\nconst integer = value => Number.isInteger(value)\nconst length = value => !!value.length\nconst nil = value => value === null\nconst not = value => undefined(value) || nil(value)\n\nconst empty = value => {\n  if (not(value)) return true\n  if (array(value)) return emptyarray(value)\n  if (string(value)) return emptystring(value)\n  \n  return emptyobject(value)\n}\nconst emptystring = value => {\n  return not(value) || !string(value) || !length(value)\n}\nconst emptyarray = value => not(value) || !array(value) || !length(value)\n\nconst emptyobject = value => {\n  return not(value) || !object(value) || !length(Object.keys(value))\n}\nconst nonobject = value => value.constructor.name !== \"Object\"\n\nconst instanceOf = (value, klass) => Is.object(value) && value instanceof klass\nconst defined = value => !Is.undefined(value)\n\nconst objectStrict = value => object(value) && !(not(value) || array(value))\n\nconst float = value => number(value) && !integer(value)\nconst nan = value => number(value) && isNaN(value)\n\nconst positive = value => integer(value) && value >= 0\n\nconst Is = {\n  nonobject,\n  empty,\n  emptyarray,\n  emptyobject,\n  emptystring,\n  float,\n  object, \n  undefined,\n  boolean,\n  number,\n  integer,\n  string,\n  array,\n  instanceOf,\n  defined,\n  method,\n  nan,\n  nil,\n  not, \n  objectStrict,\n  positive,\n}\n\nexport { Is }","import { Errors } from \"./Errors\"\nimport { Is } from \"../Utilities/Is\"\n\nclass Property {}\n\nObject.defineProperties(Property.prototype, {\n  modularPropertyTypeIds: { \n    get: function() { \n      if (Is.undefined(this.__modularPropertyTypeIds)) {\n        const ids = Object.keys(this.propertyTypes)\n        this.__modularPropertyTypeIds = ids.filter(id => \n          this.propertyTypes[id].modular\n        )\n      }\n      return this.__modularPropertyTypeIds \n    }\n  },\n  orDefault: { value: function(property) {\n    const { value, type } = property\n    return Is.defined(value) ? value : this.propertyTypeDefault(value, type)\n  }},\n  property_types: { // deprecated \n    get: function() {\n      console.warn(Errors.deprecation.property_types)\n      return this.propertyTypes\n    }\n  },\n  propertyType: { value: function(type) { return this.propertyTypes[type] } },\n  propertyTypeDefault: {\n    value: function(type) {\n      if (!Is.string(type) || Is.empty(type)) return\n      \n      const property_type = this.propertyType(type)\n      if (!Is.object(property_type)) return\n      \n      if (Is.defined(property_type.value)) return property_type.value\n      if (property_type.type) return new property_type.type()\n    }\n  },\n  propertyTypes: { \n    value: {\n      number: {\n        type: Number,\n        value: 0,\n      },\n      integer: {\n        type: Number,\n        value: 0,\n      },\n      rgba: {\n        type: String,\n        value: '#000000FF',\n      },\n      rgb: {\n        type: String,\n        value: '#000000',\n      },\n      font: {\n        type: String,\n        value: 'com.moviemasher.font.default',\n        modular: true,\n      },\n      fontsize: {\n        type: Number,\n        value: 13,\n      },\n      direction4:{\n        type: Number,\n        values: [\n          { id: 0, identifier: 'top', label: 'Top'},\n          { id: 1, identifier: 'right', label: 'Right'},\n          { id: 2, identifier: 'bottom', label: 'Bottom'},\n          { id: 3, identifier: 'left', label: 'Left'},\n        ],\n        value: 0,\n      },\n      direction8:{\n        type: Number,\n        values: [\n          { id: 0, identifier: \"top\", label: \"Top\"},\n          { id: 1, identifier: \"right\", label: \"Right\"},\n          { id: 2, identifier: \"bottom\", label: \"Bottom\"},\n          { id: 3, identifier: \"left\", label: \"Left\"},\n          { id: 4, identifier: \"top_right\", label: \"Top Right\"},\n          { id: 5, identifier: \"bottom_right\", label: \"Bottom Right\"},\n          { id: 6, identifier: \"bottom_left\", label: \"Bottom Left\"},\n          { id: 7, identifier: \"top_left\", label: \"Top Left\"},\n        ],\n        value: 0,\n      },\n      string: {\n        type: String,\n        value: '',\n      },\n      pixel: {\n        type: Number,\n        value: 0.0,\n      },\n      mode: {\n        type: String,\n        value: 'normal',\n        values: [\n          {id: \"burn\", composite: \"color-burn\", label: \"Color Burn\"},\n          {id: \"dodge\", composite: \"color-dodge\", label: \"Color Dodge\"},\n          {id: \"darken\", composite: \"darken\", label: \"Darken\"},\n          {id: \"difference\", composite: \"difference\", label: \"Difference\"},\n          {id: \"exclusion\", composite: \"exclusion\", label: \"Exclusion\"},\n          {id: \"hardlight\", composite: \"hard-light\", label: \"Hard Light\"},\n          {id: \"lighten\", composite: \"lighter\", label: \"Lighten\"},\n          {id: \"multiply\", composite: \"multiply\", label: \"Multiply\"},\n          {id: \"normal\", composite: \"normal\", label: \"Normal\"},\n          {id: \"overlay\", composite: \"overlay\", label: \"Overlay\"},\n          {id: \"screen\", composite: \"screen\", label: \"Screen\"},\n          {id: \"softlight\", composite: \"soft-light\", label: \"Soft Light\"},\n          {id: \"xor\", composite: \"xor\", label: \"Xor\"},\n        ]\n      },\n      text: {\n        type: String,\n        value: '',\n      },\n    },\n  }\n})\n\nconst PropertyInstance = new Property\nexport { PropertyInstance as Property }","\n\nconst Colors = {\n  yuv2rgb: function(yuv) {\n    var k, rgb = {};\n    for(k in yuv) yuv[k] = parseInt(yuv[k]);\n    rgb.r = yuv.y + 1.4075 * (yuv.v - 128);\n    rgb.g = yuv.y - 0.3455 * (yuv.u - 128) - (0.7169 * (yuv.v - 128));\n    rgb.b = yuv.y + 1.7790 * (yuv.u - 128);\n    for (k in rgb) rgb[k] = Math.min(255, Math.max(0, Math.floor(rgb[k])));\n    return rgb;\n  },\n  rgb2hex: function(rgb){\n    var r, g, b;\n    r = rgb.r.toString(16);\n    g = rgb.g.toString(16);\n    b = rgb.b.toString(16);\n    if (r.length < 2) r = \"0\" + r;\n    if (g.length < 2) g = \"0\" + g;\n    if (b.length < 2) b = \"0\" + b;\n    return \"#\" + r + g + b;\n  },\n  yuv_blend: function(yuvs, yuv2, similarity, blend){\n    var du, dv, diff = 0.0, i, z = yuvs.length;\n    for (i = 0; i < z; i++){\n      du = (yuvs[i].u - yuv2.u);\n      dv = (yuvs[i].v - yuv2.v);\n      diff += Math.sqrt((du * du + dv * dv) / (255.0 * 255.0));\n    }\n    diff = (diff / Number(z));\n    if (blend > 0.0001) {\n      return Math.min(1.0, Math.max(0.0, (diff - similarity) / blend)) * 255.0;\n    }\n    return (diff > similarity) ? 255 : 0;\n  },\n  rgb2yuv: function(rgb) {\n    var k, yuv = {};\n    for(k in rgb) rgb[k] = parseInt(rgb[k]);\n    yuv.y = rgb.r * 0.299000 + rgb.g * 0.587000 + rgb.b * 0.114000;\n    yuv.u = rgb.r * -0.168736 + rgb.g * -0.331264 + rgb.b * 0.500000 + 128;\n    yuv.v = rgb.r * 0.500000 + rgb.g * -0.418688 + rgb.b * -0.081312 + 128;\n    for(k in yuv) yuv[k] = Math.floor(yuv[k]);\n    return yuv;\n  },\n}\nexport { Colors }","\nclass Context {\n  createDrawing(width, height) {\n    const context = this.createVideo()\n    if (1 <= width) context.canvas.width = width\n    if (1 <= height) context.canvas.height = height\n    return context\n  }\n\n  createDrawingLike(drawing) {\n    return this.createDrawing(drawing.canvas.width, drawing.canvas.height)\n  }\n\n  createAudio() { \n    const klass = window.AudioContext || window.webkitAudioContext\n    if (!klass) return\n    \n    return new klass\n  } \n\n  createCanvas() { \n    return document && document.createElement(\"canvas\") \n  }\n  \n  createVideo(canvas) { \n    const element = canvas || this.createCanvas()\n    return element && element.getContext(\"2d\") \n  }\n}\n\nconst ContextFactoryInstance = new Context\nexport { ContextFactoryInstance as Context }","function Id() {\n  return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c => {\n    const array = new Uint8Array(1)\n    return  (c ^ crypto.getRandomValues(array)[0] & 15 >> c / 4).toString(16)\n  })\n}\n\nexport { Id }","const fromPoint = (pt, width) => pt.y * width + pt.x\n\nconst toPoint = (index, width) => {\n  return { x: index % width, y: Math.floor(index / width) }\n}\n\nconst toIndex = pixel => pixel * 4\n\nconst rgbAtIndex = (index, pixels) => {\n  if (index < 0) return\n  if (index > pixels.length - 4) return\n\n  return {\n    r: pixels[index], g: pixels[index + 1],\n    b: pixels[index + 2], a: pixels[index + 3],\n  }\n}\n\nconst rgb = (pixel, data) => rgbAtIndex(toIndex(pixel), data)\n\nconst safePixel = (pixel, x_dif, y_dif, width, height) => {\n  const pt = toPoint(pixel, width)\n  pt.x = Math.max(0, Math.min(width - 1, pt.x + x_dif));\n  pt.y = Math.max(0, Math.min(height - 1, pt.y + y_dif));\n  return fromPoint(pt, width)\n}\n\nconst safePixels = (pixel, width, height, size = 3) => {\n  const pixels = []\n  const half_size = Math.floor(size / 2)\n  for (let y = 0; y < size; y++) {\n    for (let x = 0; x < size; x++) {\n      pixels.push(safePixel(pixel, x - half_size, y - half_size, width, height))\n    }\n  }\n  return pixels\n}\n\nconst rgbs = (pixel, data, width, height, size) => {\n  return safePixels(pixel, width, height, size).map(pixel => rgb(pixel, data))\n}\n\nconst color = (value) => {\n  const string = String(value)\n  if (string.slice(0, 2) === \"0x\") return \"#\" + string.slice(2)\n\n  return string\n}\n\nexport const Pixel = {\n  color,\n  rgbAtIndex,\n  rgbs,\n}\n","import { Errors } from \"../Setup\"\nimport { Is } from \"./Is\"\n\nconst unlessInstanceOf = (object, klass, error) => {\n  if (!Is.instanceOf(object, klass)) throw error || Errors.wrongClass + klass.name\n}\n\nconst Throw = {\n  unlessInstanceOf,\n}\n\nexport { Throw }","import { Errors } from \"../Setup\"\nimport { Is } from \"./Is\"\n\nconst greatestCommonDenominator = (a, b) => {\n    var t\n    while (b !== 0) {\n      t = b\n      b = a % b\n      a = t\n    }\n    return a\n}\n  \nconst lowestCommonMultiplier = (a, b) => { return (a * b / greatestCommonDenominator(a, b)) }\n\nclass Time {\n  static get zero() { return new Time }\n\n  static scaleTimes(time1, time2, rounding = \"round\") {\n    if (time1.fps === time2.fps) return [time1, time2]\n\n    var gcf = lowestCommonMultiplier(time1.fps, time2.fps)\n    return [\n      time1.scale(gcf, rounding),\n      time2.scale(gcf, rounding)\n    ]\n  }\n  \n  constructor(frame = 0, fps = 1) {\n    if (!Is.integer(frame) || frame < 0) throw(Errors.frame)\n    if (!Is.integer(fps) || fps < 1) throw(Errors.fps)\n    \n    this.frame = frame\n    this.fps = fps\n  }\n\n  add(time) {\n    const [time1, time2] = Time.scaleTimes(this, time)\n    return new Time(time1.frame + time2.frame, time1.fps)\n  }\n\n  addFrames(frames) {\n    const time = this.copy\n    time.frame += frames\n    return time \n  }\n\n  get copy() { return new Time(this.frame, this.fps) }\n\n  get description() { return `${this.frame}@${this.fps}` }\n\n  divide(number, rounding = \"round\") {\n    if (!Is.number(number)) throw(Errors.argument)\n    return new Time(Math[rounding](Number(this.frame) / number), this.fps)\n  }\n  \n  equalsTime(time) {\n    if (!(time instanceof Time)) throw(Errors.time)\n\n    const [time1, time2] = Time.scaleTimes(this, time)\n    return time1.frame === time2.frame\n  }\n\n  min(time) {\n    if (! time instanceof Time) throw(Errors.time)\n    \n    const [time1, time2] = Time.scaleTimes(this, time)\n    return new Time(Math.min(time1.frame, time2.frame), time1.fps)\n  } \n\n  scale(fps = 1, rounding = \"round\") {\n    if (this.fps === fps) return this\n    //const scale = Number(this.fps) / Number(fps)\n    const frame = Number(this.frame / this.fps) * Number(fps)\n    return new Time(Math[rounding](frame), fps)\n  }\n\n  get seconds() { return Number(this.frame) / Number(this.fps) }\n  \n  subtract(time) {\n    if (! time instanceof Time) throw(Errors.argument)\n    const [time1, time2] = Time.scaleTimes(this, time)\n  \n    var subtracted = time2.frame\n    if (subtracted > time1.frame) {\n      subtracted -= subtracted - time1.frame\n    }\n    return new Time(time1.frame - subtracted, time1.fps)\n  }\n\n  subtractFrames(frames) {\n    const time = this.copy\n    time.frame -= frames\n    return time \n  }\n\n  toString() { return `[${this.description}]` }\n\n  withFrame(frame) { \n    const time = this.copy\n    time.frame = frame\n    return time \n  }\n}\n\nexport { Time }","import { Errors } from \"../Setup\"\nimport { Is } from \"../Utilities/Is\"\nimport { Time } from \"../Utilities/Time\"\n\nclass TimeFactory {\n  static createFromFrame(frame:number, fps:number) : Time {\n    return new Time(frame, fps)\n  }\n\n  static createFromSeconds(seconds = 0, fps = 1, rounding = 'round') : Time {\n    if (!Is.number(seconds) || seconds < 0) throw Errors.seconds\n    if (!Is.integer(fps) || fps < 1) throw Errors.fps\n\n    const rounded = this.roundingFunction(rounding)(seconds * fps)\n    return this.createFromFrame(rounded, fps)\n  }\n\n  static roundingFunction(rounding:string = 'round') : Function {\n    switch (rounding) {\n      case 'ceil': return Math.ceil\n      case 'floor': return Math.floor\n      default: return Math.round\n    }\n  }\n}\n\nexport { TimeFactory }\n","import { Is } from \"./Is\"\nimport { Time } from \"./Time\"\nimport { Errors } from \"../Setup/Errors\"\nimport { TimeFactory } from \"../Factory/TimeFactory\"\n\nclass TimeRange extends Time {\n  constructor(frame = 0, fps = 1, frames = 1) {\n    if (!(Is.integer(frames) && frames >= 0)) {\n      throw(Errors.argument, frames)\n    }\n    super(frame, fps)\n    this.frames = frames\n  }\n\n  get description() { return `${this.frame}-${this.frames}@${this.fps}` }\n  get end() { return this.frame + this.frames }\n  get endTime() { return TimeFactory.createFromFrame(this.end, this.fps) }\n  get lengthSeconds() { return Number(this.frames) / Number(this.fps) }\n  get position() { return  Number(this.frame) / Number(this.frames) }\n  get startTime() { return TimeFactory.createFromFrame(this.frame, this.fps) }\n  get copy() {\n    return new TimeRange(this.frame, this.fps, this.frames)\n  }\n\n  scale(fps = 1, rounding = \"round\") {\n    if (this.fps === fps) return this.copy\n\n    const value = Number(this.frames) / (Number(this.fps) / Number(fps))\n    const time = super.scale(fps, rounding)\n    return new TimeRange(time.frame, time.fps, Math.max(1, Math[rounding](value)))\n  }\n\n  intersects(timeRange) {\n    const [range1, range2] = Time.scaleTimes(this, timeRange)\n\n    if (range1.frame >= range2.end) return false\n\n    return range1.end > range2.frame\n  }\n\n  minEndTime(endTime) {\n    const [range, time] = Time.scaleTimes(this, endTime)\n    range.frames = Math.min(range.frames, time.frame)\n    return range\n  }\n\n  withFrame(frame) {\n    const range = this.copy\n    range.frame = frame\n    return range\n  }\n\n  withFrames(frames) {\n    const range = this.copy\n    range.frames = frames\n    return range\n  }\n\n}\n\nexport { TimeRange }\n","import { Errors } from \"../Setup\"\nimport { Is } from \"./Is\"\n\nconst findBy = (array, object, key = 'id') => {\n  if (! Is.array(array)) throw(Errors.array)\n  if (Is.undefined(key)) throw(Errors.argument)\n\n  const value = Is.object(object) ? object[key] : object\n  if (Is.undefined(value)) throw(Errors.argument)\n  return array.find(item => item[key] === value)\n}\n\nconst deleteFromArray = (array, value) => {\n  const is_array = Is.array(array)\n  const include = is_array && array.includes(value)\n  if (include) array.splice(array.indexOf(value), 1)\n}\n\n\nconst keyShouldBeCopied = (key) => {\n  return key.substr(0,1) !== '$'\n}\nconst deepCopy = (ob1, ob2) => {\n  if (Is.object(ob1)){\n    if (Is.undefined(ob2)) ob2 = {}\n    for (var key in ob1) {\n      if (keyShouldBeCopied(key)){\n        const value1 = ob1[key]\n        if (Is.object(value1)) {\n          if (Is.array(value1)) ob2[key] = [...value1]\n          else ob2[key] = deepCopy(value1, ob2[key])\n        } else ob2[key] = value1\n      }\n    }\n  }\n  return ob2\n}\n\nconst capitalize = value => {\n  const string = Is.string(value) ? value : String(value)\n  if (Is.emptystring(string)) return string\n\n  return `${string[0].toUpperCase()}${string.substr(1)}`\n}\n\nconst Utilities = {\n  findBy,\n  deleteFromArray,\n  keyShouldBeCopied,\n  deepCopy,\n  capitalize,\n}\n\nexport { Utilities }\n","import { Errors } from \"../Setup\"\nimport { Is } from \"../Utilities\"\n\nclass Base {\n  constructor(object = {}) {\n    if (!Is.objectStrict(object)) throw Errors.object\n\n    this.object = object\n  }\n\n  toJSON() { return this.object }\n\n  toString() { return `[${this.constructor.name}]` }\n}\n\nexport { Base }\n","import { Errors } from \"../Setup\"\nimport { Is } from \"../Utilities\"\nimport { EventType } from \"../Setup\"\n\nclass Action {\n  constructor(object) {\n    if (!Is.objectStrict(object)) throw Errors.argument + object\n\n    const keys = Object.keys(object)\n    const entries = keys.map(key => [key, { value: object[key] }])\n    Object.defineProperties(this, Object.fromEntries(entries))\n  }\n\n  get events() { return this.mash.events }\n\n  get selectedClips() { \n    if (this.done) return this.redoSelectedClips\n\n    return this.undoSelectedClips\n  }\n\n  get selectedEffects() { \n    if (this.done) return this.redoSelectedEffects\n    \n    return this.undoSelectedEffects\n  }\n  \n  redo() {\n    this.redoAction()\n    this.done = true\n    this.events && this.events.emit(EventType.action, { action: this } )\n  }\n\n  redoAction() {} \n\n  undo() {\n    this.undoAction()\n    this.done = false\n    this.events && this.events.emit(EventType.action, { action: this } )\n  }\n\n  undoAction() {}\n}\n\nexport { Action }\n","import { Action } from \"./Action\"\n\nclass AddTrackAction extends Action {\n  redoAction(){\n    this.mash.addTrack(this.trackType)\n  }\n\n  undoAction() {\n    this.mash.removeTrack(this.trackType)\n  }\n}\n\nexport { AddTrackAction }\n","import { Action } from \"./Action\"\n\nclass ChangeAction extends Action {\n  constructor(object) {\n    const redoValue = object.redoValue\n    delete object.redoValue\n    super(object)\n    this.__redoValue = redoValue\n  }\n\n  get redoValue() { return this.__redoValue }\n\n  redoAction() {\n    this.target[this.property] = this.redoValue\n  }\n\n  undoAction() {\n    this.target[this.property] = this.undoValue\n  }\n\n  updateAction(redoValue) {\n    this.__redoValue = redoValue\n    this.redo()\n  }\n}\n\nexport { ChangeAction }\n","import { Action } from \"./Action\"\n\nclass FreezeAction extends Action {\n  redoAction() {\n    this.trackClips.splice(this.index, 0, this.insertClip, this.frozenClip)\n    this.freezeClip.frames -= this.frames\n  }\n\n  undoAction() {\n    this.freezeClip.frames += this.frames\n    this.trackClips.splice(this.index, 2)\n  }\n}\n\nexport { FreezeAction }\n","import { ChangeAction } from \"./ChangeAction\"\n\nclass ChangeFramesAction extends ChangeAction {\n  redoAction() {\n    this.mash.changeClipFrames(this.target, this.redoValue)\n  }\n\n  undoAction() {\n    this.mash.changeClipFrames(this.target, this.undoValue)\n  }\n}\n\nexport { ChangeFramesAction }\n","import { ChangeAction } from \"./ChangeAction\"\n\nclass ChangeTrimAction extends ChangeAction {\n  redoAction() {\n    this.mash.changeClipTrim(this.target, this.redoValue, this.frames + this.undoValue)\n  }\n\n  undoAction() {\n    this.mash.changeClipTrim(this.target, this.undoValue, this.frames + this.undoValue)\n  }\n}\n\nexport { ChangeTrimAction }\n","\nimport { Action } from \"./Action\"\nimport { Utilities } from \"../Utilities\"\n\nclass AddEffectAction extends Action {\n  redoAction() { this.effects.splice(this.index, 0, this.effect) }\n  \n  undoAction() { Utilities.deleteFromArray(this.effects, this.effect) }\n}\n\nexport { AddEffectAction }","import { AddTrackAction } from \"./AddTrackAction\"\n\nclass AddClipToTrackAction extends AddTrackAction {\n  get clips() { return this.track.clips }\n\n  get track() { return this.mash[this.trackType][this.trackIndex] }\n\n  redoAction() {\n    // create track if needed\n    for (let i = 0; i < this.createTracks; i++) { super.redoAction() } \n    this.mash.addClipsToTrack([this.clip], this.trackIndex, this.insertIndex)\n  }\n\n  undoAction() {\n    this.mash.removeClipsFromTrack([this.clip])\n    for (let i = 0; i < this.createTracks; i++) { super.undoAction() } \n  }\n}\n\nexport { AddClipToTrackAction }\n ","import { Action } from \"./Action\"\n\nclass MoveClipsAction extends Action {\n  addClips(trackIndex, insertIndex) {\n    this.mash.addClipsToTrack(this.clips, trackIndex, insertIndex)\n  }\n\n  redoAction() {\n    if (this.redoFrames) {\n      this.clips.forEach((clip, index) => clip.frame = this.redoFrames[index])\n    }\n    this.addClips(this.trackIndex, this.insertIndex)\n  }\n\n  undoAction() {\n    if (this.undoFrames) {\n      this.clips.forEach((clip, index) => clip.frame = this.undoFrames[index])\n    }\n    this.addClips(this.undoTrackIndex, this.undoInsertIndex)\n  }\n}\nexport { MoveClipsAction }\n","import { Is } from \"../../Utilities/Is\"\n\nexport const track = { \n  track: { \n    get: function() { \n      if (Is.undefined(this.__track)) {\n        const track = this.object.track \n        this.__track = Is.defined(track) ? track : -1\n      }\n      return this.__track \n    },\n    set: function(value) { this.__track = value }\n  }, \n}\n ","import { track } from \"../Clip/with/track\"\nimport { Action } from \"./Action\"\n\nclass RemoveClipsAction extends Action {\n  get trackIndex() { return track.index }\n\n  redoAction() {\n    this.mash.removeClipsFromTrack(this.clips)\n  }\n\n  undoAction() {\n    this.mash.addClipsToTrack(this.clips, this.trackIndex, this.index)\n  }\n}\n\nexport { RemoveClipsAction }\n ","import { Action } from \"./Action\"\n\nclass SplitAction extends Action {\n  redoAction() {\n    this.trackClips.splice(this.index, 0, this.insertClip)\n    this.splitClip.frames = this.redoFrames\n  }\n\n  undoAction() {\n    this.splitClip.frames = this.undoFrames\n    this.trackClips.splice(this.index, 1)\n  }\n}\n\nexport { SplitAction }","import { Action } from \"./Action\"\n\nclass MoveEffectsAction extends Action {\n  redoAction() {\n    this.effects.splice(0, this.effects.length, ...this.redoEffects)\n  }\n\n  undoAction() {\n    this.effects.splice(0, this.effects.length, ...this.undoEffects)\n  }\n}\n\nexport { MoveEffectsAction }","import { Action } from \"../Action\"\nimport { Base } from \"../Base\"\nimport { Errors } from \"../Setup\"\nimport { Is } from \"../Utilities\"\n\nclass Actions extends Base {\n  constructor(object) {\n    super(object)\n    \n    this.actions = []\n    this.index = -1\n  }\n\n  get canRedo() { return this.index < this.actions.length - 1 }\n\n  get canUndo() { return this.index > -1 }\n\n  get currentAction() { return this.actions[this.index] }\n\n  get currentActionLast() { return this.canUndo && !this.canRedo }\n\n  get mash() { return this.object.mash }\n\n  // TODO: remove\n  get masher() { return this.object.masher }\n\n  do(action) {\n    if (!Is.instanceOf(action, Action)) throw(Errors.action)\n\n    action.actions = this\n    const remove = this.actions.length - (this.index + 1)\n    const removed = remove ? this.actions.splice(this.index + 1, remove) : []\n    \n    this.actions.push(action)\n    this.redo()\n    return removed\n  }\n\n  redo() {\n    this.index ++\n    const action = this.currentAction\n    action.redo()\n    return action\n  }\n\n  undo(){\n    const action = this.currentAction\n    this.index--\n    action.undo()\n    return action\n  }\n}\n\nexport { Actions }","import { Id } from \"../../Utilities/Id\"\n\nexport const id = { \n  id: { get: function() { return this.__id ||= this.initializeId } },\n  initializeId: { get: function() { return this.object.id || Id() } },\n}\n","/* eslint-disable no-unused-vars */\nimport { Base } from \"../Base\"\nimport { Errors } from \"../Setup\"\nimport { Is } from \"../Utilities/Is\"\n\ninterface FactoryInterface {\n\n}\ninterface TypedObject {\n  type: string\n}\n\ninterface TypedObjectConstructor {\n  new (object : TypedObject) : FactoryInterface\n}\n\nclass Factory implements FactoryInterface {\n  classesByType: Map<string, TypedObjectConstructor>\n\n  baseClass: TypedObjectConstructor\n\n  constructor(baseClass:TypedObjectConstructor) {\n    this.baseClass = baseClass || Base\n    this.classesByType = new Map()\n  }\n\n  typeClass(type:string):TypedObjectConstructor {\n    const typedClass = this.classesByType.get(type)\n    if (!typedClass) return this.baseClass\n\n    return typedClass\n  }\n\n  create(type:string | TypedObject) : object {\n    if (typeof type === \"string\") return this.createFromType(type)\n\n    return this.createFromObject(type)\n  }\n\n  createFromObject(object:TypedObject) : object {\n    if (!Is.object(object)) throw Errors.object\n    const Klass = this.typeClass(object.type)\n    if (Is.instanceOf(object, Klass)) return object\n\n    return new Klass(object)\n  }\n\n  createFromType(type:string) : object {\n    const Klass = this.typeClass(type)\n\n    return new Klass({ type })\n  }\n\n  install(type:string, klass:TypedObjectConstructor) { this.classesByType.set(type, klass) }\n}\n\nexport { Factory }\n","export const label = { label: { get: function() { return this.object.label } } }\n","export const object = { \n  property: { value: function(key) { return this[key] || this.object[key] } },\n  \n}\n","import { Is } from \"../../Utilities\"\nimport { Property } from \"../../Setup\"\nimport { id } from \"../../Base/with/id\"\nimport { label } from \"./label\"\nimport { object } from \"../../Base/with/object\"\nimport { toJSONFromObject } from \"../../Base/with/toJSONFromObject\"\n\nexport const sharedMedia = {\n  ...object,\n  ...toJSONFromObject,\n  ...id,\n  ...label,\n  properties: { \n    get: function() { \n      if (Is.undefined(this.__properties)) this.__properties = this.propertiesInitialize \n      return this.__properties \n    }\n  },\n  propertyNames: { get: function() { return Object.keys(this.properties) } },\n  propertiesInitialize: { \n    get: function() {\n      const object = { label: { type: 'string' } }\n      if (this.propertiesTiming) Object.assign(object, this.propertiesTiming)\n      if (this.propertiesAudible) Object.assign(object, this.propertiesAudible)\n      if (this.propertiesModular) Object.assign(object, this.propertiesModular)\n      return object\n    }\n  },\n  source: { get: function() { return this.object.source } },\n  initializeInstance: { value: function(clip, object) {\n    const properties = this.properties \n    if (!Is.object(properties) || Is.empty(properties)) return\n\n    const names = this.propertyNames.filter(name => !Reflect.has(clip, name))\n    if (!Is.emptyarray(names)) {\n      const entries = names.map(name => [name, { \n        get: function() { \n          const key = `__${name}`\n          if (Is.undefined(this[key])) {\n            const property = properties[name]\n            this[key] = Property.orDefault(property)\n            //console.log(\"initialized\", key, this[key])\n          }\n          return this[key]\n        },\n        set: function(value) { this[`__${name}`] = value }\n      }])\n      Object.defineProperties(clip, Object.fromEntries(entries))\n      this.propertyNames.forEach(name => {\n        if (Is.defined(object[name])) clip[name] = object[name]\n      })\n    }\n  }},\n}","export const toJSONFromObject = {\n  toJSON: { value: function() { return this.object } },\n}","import { Base } from \"../Base\"\n\nclass AudioProcessor extends Base {\n  get audioContext() { return this.object.audioContext }\n  \n  process(url, buffer) {\n    return new Promise((resolve, reject) => {\n      return this.audioContext.decodeAudioData(\n        buffer, \n        audioData => resolve(audioData), \n        error => reject(error)\n      ) \n    })\n  }\n}\n\nexport { AudioProcessor }","import { Errors } from \"../Setup/Errors\"\nimport { Is } from \"../Utilities/Is\"\n\nclass Cache {\n  constructor() {\n    this.__cached_urls = {}\n    this.__urls_by_md5 = {}\n  }\n\n  add(url, value){\n    const key = this.key(url)\n    // console.log(\"Cache.add\", url, key)\n    this.__cached_urls[key] = value\n    this.__urls_by_md5[key] = url\n  }\n\n  cached(url) { return !!this.get(url) }\n\n  get(url) { \n    const key = this.key(url)\n    // console.log(\"Cache.get\", url, key)\n    return this.__cached_urls[key] \n  }\n\n  key(url) {\n    if(!(Is.string(url) && !Is.empty(url))) throw Errors.url + url\n    return url\n  }\n\n  remove(url) {\n    const key = this.key(url)\n    // console.log(\"Cache.get\", url, key)\n    delete this.__cached_urls[key]\n    delete this.__urls_by_md5[key]\n  }\n  urls() { return Object.values(this.__urls_by_md5) }\n}\n\nconst CacheInstance = new Cache\nexport { CacheInstance as Cache }","import { Cache } from \"../Loading/Cache\"\n\nclass FontProcessor {\n  process(url, buffer) {\n    const family = Cache.key(url)\n    const font_face = new FontFace(family, buffer)\n    const promise = font_face.load()\n    promise.then(() => {\n      document.fonts.add(font_face)\n      return { family }\n    })\n    return promise\n  }\n}\n\nexport { FontProcessor }\n","\nclass ImageProcessor {\n  process(url, buffer) {\n    console.log(\"ImageProcessor.process\", url)\n  }\n}\n\nexport { ImageProcessor }","\nclass ModuleProcessor {\n  process(url, buffer) {\n    \n  }\n}\n\nexport { ModuleProcessor }","import { Factory } from \"./Factory\"\nimport { LoadType } from \"../Setup/Types\"\nimport { AudioProcessor } from \"../Loading/AudioProcessor\"\nimport { FontProcessor } from \"../Loading/FontProcessor\"\nimport { ImageProcessor } from \"../Loading/ImageProcessor\"\nimport { ModuleProcessor } from \"../Loading/ModuleProcessor\"\n\nclass ProcessorFactory extends Factory {\n  constructor() {\n    super()\n    this.install(LoadType.audio, AudioProcessor)\n    this.install(LoadType.font, FontProcessor)\n    this.install(LoadType.image, ImageProcessor)\n    this.install(LoadType.module, ModuleProcessor)\n  }\n}\n\nconst ProcessorFactoryInstance = new ProcessorFactory\nexport { ProcessorFactoryInstance as ProcessorFactory }\n","import { Base } from \"../Base\"\nimport { Cache } from \"../Loading/Cache\"\n\nclass Loader extends Base {\n  constructor(object) {\n    super(object)\n    // console.log(\"Loader\", this.object)\n    this.promises = {}\n  }\n\n  get type() { return this.object.type }\n\n  loadedUrl(url) { return Cache.cached(url) }\n\n  loadedUrls(urls) { return urls.every(url => this.loadedUrl(url)) }\n\n  loadUrl(url) {\n    if (this.promises[url]) return this.promises[url]\n    if (Cache.cached(url)) return Promise.resolve(Cache.get(url))\n\n    const promise = this.requestUrl(url)\n    this.promises[url] = promise\n    return promise.then(processed => {\n      // console.log(this.constructor.name, \"loadUrl\", processed.constructor.name)\n      Cache.add(url, processed)\n      delete this.promises[url]\n      return processed\n    })\n  }\n\n  loadUrls(urls) {\n    return Promise.all(urls.map(url => this.loadUrl(url)))\n  }\n}\n\nexport { Loader }\n","\nimport { ProcessorFactory } from \"../Factory/ProcessorFactory\"\nimport { LoadType } from \"../Setup\"\nimport { Loader } from \"./Loader\"\n\nclass AudioLoader extends Loader {\n  constructor(object) {\n    super(object)\n    this.object.type ||= LoadType.audio\n  }\n\n  get audioContext() { return this.object.audioContext }\n  set audioContext(value) { this.object.audioContext = value }\n\n  async requestUrl(url) {\n    return fetch(url).then(response => {\n      console.log(\"AudioLoader.requestUrl fetch\", url, response.constructor.name)\n      return response.arrayBuffer()\n    }).then(loaded => {\n      console.log(\"AudioLoader.requestUrl arrayBuffer\", url, loaded.constructor.name)\n      const options = { type: this.type, audioContext: this.audioContext }\n      const processor = ProcessorFactory.createFromObject(options)\n      return processor.process(url, loaded)\n    })\n  }\n}\n\nexport { AudioLoader }","import { LoadType } from \"../Setup\"\nimport { ProcessorFactory } from \"../Factory/ProcessorFactory\"\nimport { Loader } from \"./Loader\"\n\nclass FontLoader extends Loader {\n  constructor(object) {\n    super(object)\n    this.object.type ||= LoadType.font\n  }\n\n  async requestUrl(url) {\n    // console.log(\"FontLoader.requestUrl\", url)\n    \n    return fetch(url).then(response => {\n      // console.log(\"FontLoader.requestUrl fetch\", url, response.constructor.name)\n      return response.arrayBuffer()\n    }).then(loaded => {\n      // console.log(\"FontLoader.requestUrl arrayBuffer\", url, loaded.constructor.name)\n      const processor = ProcessorFactory.create(this.type)\n      return processor.process(url, loaded)\n    })\n  }\n}\n\nexport { FontLoader }","import { LoadType } from \"../Setup\"\nimport { Loader } from \"./Loader\"\n\nclass ImageLoader extends Loader {\n  constructor(object) {\n    super(object)\n    this.object.type ||= LoadType.image\n  }\n  \n  requestUrl(url) {\n    // console.log(\"ImageLoader.requestUrl\", url)\n    return new Promise((resolve, reject) => {\n      const image = new Image()\n      image.onload = event => resolve(event.target)\n      image.onerror = event => reject(event)\n      image.crossOrigin = \"Anonymous\"\n      image.src = url  \n      return image\n    })\n  }\n}\n\nexport { ImageLoader }","import { LoadType } from \"../Setup\"\nimport { Loader } from \"./Loader\"\n\nclass ModuleLoader extends Loader {\n  constructor(object) {\n    super(object)\n    this.object.type ||= LoadType.module\n  }\n  requestUrl(url) { return import(url) }\n}\n\nexport { ModuleLoader }","import { Factory } from \"./Factory\"\nimport { LoadType } from \"../Setup/Types\"\n\nimport { AudioLoader } from \"../Loading/AudioLoader\"\nimport { FontLoader } from \"../Loading/FontLoader\"\nimport { ImageLoader } from \"../Loading/ImageLoader\"\nimport { ModuleLoader } from \"../Loading/ModuleLoader\"\n\n\nclass LoaderFactory extends Factory {\n  constructor() {\n    super()\n    this.install(LoadType.audio, AudioLoader)\n    this.install(LoadType.font, FontLoader)\n    this.install(LoadType.image, ImageLoader)\n    this.install(LoadType.module, ModuleLoader)\n  }\n}\n\nconst LoaderFactoryInstance = new LoaderFactory\nexport { LoaderFactoryInstance as LoaderFactory }\n","import { LoadTypes } from \"../Setup\"\nimport { LoaderFactory } from \"../Factory/LoaderFactory\"\nimport { Is } from \"../Utilities/Is\"\nimport { Cache } from \"./Cache\"\n\nclass UrlsByType {\n  static get none() { return UrlsByTypeNone }\n\n  constructor() { this.loaders = {} }\n\n  get loaded() { return this.urls.every(url => Cache.cached(url)) }\n\n  get urls() { return LoadTypes.flatMap(type => this[type]) }\n\n  get urlsUnloaded() { return this.urls.filter(url => !Cache.cached(url)) }\n\n  concat(object) {\n    if (!Is.instanceOf(object, UrlsByType)) {\n      console.warn(this.constructor.name, \"concat\", object)\n      return\n    }\n    LoadTypes.forEach(type => {\n      const urls = this[type]\n      urls.splice(0, urls.length, ...new Set([...urls, ...object[type]]))\n    })\n  }\n\n  load(audioContext) {\n    const promises = LoadTypes.flatMap(type => {\n      const urls = this[type]\n      if (urls.length === 0) return []\n\n      if (Is.undefined(this.loaders[type])) {\n        const options = { type: type, audioContext: audioContext }\n        this.loaders[type] = LoaderFactory.createFromObject(options)\n      }\n      return this.loaders[type].loadUrls(urls)\n    })\n    if (promises.length) {\n      // console.log(this.constructor.name, \"load\", promises.length)\n      return Promise.all(promises)\n    }\n\n    // console.log(this.constructor.name, \"load resolved\")\n\n    return Promise.resolve()\n  }\n\n}\n\nconst definition = Object.fromEntries(LoadTypes.map(type => [type, {\n  get: function() {\n    const key = `__${type}`\n    if (Is.undefined(this[key])) this[key] = []\n    return this[key]\n  }\n}]))\nObject.defineProperties(UrlsByType.prototype, definition)\nconst UrlsByTypeNone = new UrlsByType\nexport { UrlsByType }\n","import { UrlsByType } from \"../../Loading/UrlsByType\"\n\nexport const inaudible = {\n  audible: { value: false },\n  urlsAudibleInTimeRangeForClipByType: {\n    value: function() { return UrlsByType.none }\n  },\n}\n","import { TrackType } from \"../../Setup\"\n\nexport const visibleMedia = { \n  visible: { value: true },\n  trackType: { value: TrackType.video },\n}","import { Is } from \"../../Utilities\"\nimport { Property } from \"../../Setup\"\n\nexport const propertiesModular = { \n  propertiesModular: { \n    get: function() { \n      if (Is.undefined(this.__propertiesModular)) {\n        this.__propertiesModular = this.object.properties || {}\n      }\n      return this.__propertiesModular \n    }\n  }, \n  modularPropertiesByType: {\n    get: function() {\n      if (Is.undefined(this.__modularPropertiesByType)) {\n        this.__modularPropertiesByType = this.initializeModularPropertiesByType\n      }\n      return this.__modularPropertiesByType\n    }\n  },\n  initializeModularPropertiesByType: {\n    get: function() {\n      const object = {}\n      Property.modularPropertyTypeIds.forEach(type => {\n        Object.keys(this.propertiesModular).forEach(property => {\n          if (type === this.propertiesModular[property].type) {\n            object[type] ||= []\n            object[type].push(property)\n          }\n        })\n      })\n      return object\n    }\n  },\n} \n","import { propertiesModular } from \"./propertiesModular\"\n\nexport const modular = { \n  modular: { value: true },\n  ...propertiesModular,\n}\n","function CoreFilter() {}\n\nObject.defineProperties(CoreFilter.prototype, {\n  scopeSet: { value: function() {}},\n  draw: { value: function(evaluator) { return evaluator.context } },\n})\n\nexport { CoreFilter }\n","import { CoreFilter } from \"./CoreFilter\"\nimport { Property } from \"../Setup\"\nimport { Utilities } from \"../Utilities\"\n\nconst array_key = (array, value, key, id_key) => {\n  return Utilities.findBy(array, value, id_key)[key];\n}\n\nclass BlendFilter extends CoreFilter {\n  draw(evaluator, evaluated, outputContext) {\n    const context = evaluator.context\n    \n    const mode = array_key(Property.propertyTypes.mode.values, evaluated.all_mode, 'composite')\n    outputContext.globalCompositeOperation = mode\n    outputContext.drawImage(context.canvas, 0, 0)\n    outputContext.globalCompositeOperation = 'normal'\n    return outputContext\n  }\n}\nconst BlendFilterInstance = new BlendFilter\nexport { BlendFilterInstance as BlendFilter } \n","import { CoreFilter } from \"./CoreFilter\"\nimport { Colors } from \"../Utilities\"\nimport { Pixel } from \"../Utilities\"\n\nclass ChromaKeyFilter extends CoreFilter {\n  get parameters() { \n    return [\n      { name: \"color\", value: \"color\" },\n      { name: \"similarity\", value: \"similarity\" },\n      { name: \"blend\", value: \"blend\" }\n    ]\n  }\n\n  draw(evaluator, evaluated) {\n    const context = evaluator.context\n    const canvas = context.canvas\n    const { width, height } = canvas\n    const { blend, color, similarity, accurate } = evaluated\n    const components = color.substr(4, color.length - 5).split(',')\n    const colors = components.map(f => Number(f))\n    const rgb = { r: colors[0], g: colors[1], b: colors[2] }\n    const yuv = Colors.rgb2yuv(rgb)\n    const frame = context.getImageData(0, 0, width, height)\n    const pixels = frame.data\n    const yuvs = accurate ? (\n      this.yuvsFromPixelsAccurate(pixels, width, height)\n    ) : this.yuvsFromPixels(pixels)\n    \n    let offset = 0\n    yuvs.forEach(matrix => {\n      pixels[offset + 3] = Colors.yuv_blend(matrix, yuv, similarity, blend)\n      offset += 4\n    })\n    context.putImageData(frame, 0, 0)\n    return context\n  }\n\n  yuvsFromPixelsAccurate(pixels, width, height) {\n    let index = pixels.length / 4\n    const array = []\n    while(index--) {\n      const offset = index * 4\n      const rgbs = Pixel.rgbs(offset, pixels, width, height)\n      array.push(rgbs.map(rgb => Colors.rgb2yuv(rgb)))\n    }\n    return array\n  }\n\n  yuvsFromPixels(pixels) {\n    let index = pixels.length / 4\n    const array = []\n    while(index--) {\n      const offset = index * 4\n      array.push([Colors.rgb2yuv(Pixel.rgbAtIndex(offset, pixels))])\n    }\n    return array\n  }\n}\nconst ChromaKeyFilterInstance = new ChromaKeyFilter\nexport { ChromaKeyFilterInstance as ChromaKeyFilter } ","import { Is } from \"../Utilities\"\nimport { Pixel } from \"../Utilities\"\nimport { CoreFilter } from \"./CoreFilter\"\n\nclass ColorFilter extends CoreFilter {\n  draw(evaluator, evaluated) {\n    const { context } = evaluator\n    const { color } = evaluated\n    if (! Is.string(color)) return context\n\n    const { canvas } = context\n    const { width, height } = canvas\n\n    context.fillStyle = Pixel.color(color)\n    context.fillRect(0, 0, width, height)\n    return context\n  }\n\n  get parameters() { \n    return [\n      { name: \"color\", value: \"color\" },\n      { name: \"size\", value: \"mm_dimensions\" },\n      { name: \"duration\", value: \"mm_duration\" },\n      { name: \"rate\", value: \"mm_fps\" },\n    ]\n  }\n}\nconst ColorFilterInstance = new ColorFilter\nexport { ColorFilterInstance as ColorFilter }","\nimport { CoreFilter } from \"./CoreFilter\"\n\nclass ColorChannelMixerFilter extends CoreFilter {\n  draw(evaluator, evaluated) {\n    const context = evaluator.context\n    const rgbas = 'rgba'.split('');\n    var key, first, second, j, i, z = rgbas.length;\n    for (i = 0; i < z; i++) {\n      first = rgbas[i];\n      for (j = 0; j < z; j++) {\n        second = rgbas[j];\n        key = first + second;\n        if (null === evaluated[key]) evaluated[key] = ( first === second ? 1 : 0);\n      }\n    }\n    var red, green, blue, alpha, width, height, image_data, data;\n    width = context.canvas.width;\n    height = context.canvas.height;\n    image_data = context.getImageData(0, 0, width, height);\n    data = image_data.data;\n    z = data.length;\n    for (i = 0; i < z; i += 4) {\n      red = data[i];\n      green = data[i + 1];\n      blue = data[i + 2];\n      alpha = data[i + 3];\n      data[i] = red*evaluated.rr + green*evaluated.rg + blue*evaluated.rb + alpha*evaluated.ra;\n      data[i + 1] = red*evaluated.gr + green*evaluated.gg + blue*evaluated.gb + alpha*evaluated.ga;\n      data[i + 2] = red*evaluated.br + green*evaluated.bg + blue*evaluated.bb + alpha*evaluated.ba;\n      data[i + 3] = red*evaluated.ar + green*evaluated.ag + blue*evaluated.ab + alpha*evaluated.aa;\n    }\n    context.putImageData(image_data, 0, 0);\n    return context\n  }\n}\nconst ColorChannelMixerFilterInstance = new ColorChannelMixerFilter\nexport { ColorChannelMixerFilterInstance as ColorChannelMixerFilter } \n","import { Pixel } from \"../Utilities\"\nimport { CoreFilter } from \"./CoreFilter\"\n\nconst RBGA = 'rgba'\n\nconst parse = (evaluated) => {\n  const result = { bias: {}, rdiv: {}, matrix: {} }\n  RBGA.split('').forEach((channel, index) => {\n    const matrix = evaluated[`${index}m`].split(' ').map(i => parseInt(i))\n    result.matrix[channel] = matrix\n    result.rdiv[channel] = evaluated[`${index}rdiv`] || 1\n    if (String(result.rdiv[channel]).includes('/')) {\n      const array = result.rdiv[channel].split('/')\n      result.rdiv[channel] = parseFloat(array[0]) / parseFloat(array[1])\n    } else result.rdiv[channel] = parseFloat(result.rdiv[channel])\n    result.bias[channel] = evaluated[`${index}bias`] || 0\n  })\n  // console.log(ConvolutionFilter.name, \"parse\", evaluated, result)\n  return result\n  \n}\n\nconst matrix3 = (options, inputData, outputDdata, width, height) => {\n  const area = width * height;\n  for (let pixel = 0; pixel < area; pixel++) {\n    const rgbs = Pixel.rgbs(pixel, inputData, width, height)\n    RBGA.split('').forEach((channel, index) => {\n      const rdiv = options.rdiv[channel]\n      const matrix = options.matrix[channel]\n      const bias = options.bias[channel]\n      let sum = 0\n      for (let y = 0; y < 9; y++) sum += rgbs[y][channel] * matrix[y]\n      \n      sum = Math.floor(sum * rdiv + bias + 0.5)\n      outputDdata[pixel * 4 + index] = sum\n    })\n  }\n}\n\nclass ConvolutionFilter extends CoreFilter {\n draw(evaluator, evaluated) {\n    const options = parse(evaluated)\n    const context = evaluator.context\n    const canvas = context.canvas\n    const { width, height } = canvas\n    const input = context.getImageData(0, 0, width, height)\n    const output = context.createImageData(width, height)\n    matrix3(options, input.data, output.data, width, height)\n    context.putImageData(output, 0, 0)\n    return context\n  }\n}\n\nconst ConvolutionFilterInstance = new ConvolutionFilter\nexport { ConvolutionFilterInstance as ConvolutionFilter }","import { Is } from \"../Utilities\"\nimport { Context } from \"../Utilities\"\nimport { CoreFilter } from \"./CoreFilter\"\n\nclass CropFilter extends CoreFilter {\n  draw(evaluator, evaluated) {\n    const context = evaluator.context\n    const x = evaluated.x || 0\n    const y = evaluated.y || 0\n    const in_width = evaluator.get(\"mm_input_width\")\n    const in_height = evaluator.get(\"mm_input_height\")\n    let width = evaluated.w || evaluated.out_w\n    let height = evaluated.h || evaluated.out_h\n    if (2 > width + height) throw 'crop.draw invalid output dimensions'\n    if (!(in_width && in_height)) throw 'crop.draw invalid input dimensions'\n    \n    if (-1 === width) width = in_width * (height / in_height)\n    if (-1 === height) height = in_height * (width / in_width)\n\n    const drawing = Context.createDrawing(width, height)\n    drawing.drawImage(context.canvas, x, y, width, height, 0, 0, width, height)\n    return [drawing]\n  }\n  scopeSet(evaluator) {\n    const { width, height } = evaluator.context.canvas\n    evaluator.set(\"in_h\", height)\n    evaluator.set(\"mm_input_height\", height)\n    evaluator.set(\"in_w\", width)\n    evaluator.set(\"mm_input_width\", width)\n    if (Is.not(evaluator.get(\"x\"))) evaluator.set(\"x\", '((in_w - out_w) / 2)')\n    if (Is.not(evaluator.get(\"y\"))) evaluator.set(\"y\", '((in_h - out_h) / 2)')\n  }\n}\n\nconst CropFilterInstance = new CropFilter\nexport { CropFilterInstance as CropFilter }\n","import { CoreFilter } from \"./CoreFilter\"\nimport { Is } from \"../Utilities\"\nimport { Pixel } from \"../Utilities\"\n\nclass DrawBoxFilter extends CoreFilter {\n  draw(evaluator, evaluated) {\n    var context = evaluator.context\n    const color = (Is.undefined(evaluated.color) ? 'black' : evaluated.color)\n    const x = evaluated.x || 0\n    const y = evaluated.y || 0\n    const width = evaluated.width || context.canvas.width\n    const height = evaluated.height || context.canvas.height\n\n    context.fillStyle = Pixel.color(color)\n    context.fillRect(x, y, width, height)\n    return context\n  }\n}\n\nconst DrawBoxFilterInstance = new DrawBoxFilter\n\nexport { DrawBoxFilterInstance as DrawBoxFilter }","import { CoreFilter } from \"./CoreFilter\"\nimport { Cache } from \"../Loading\"\nimport { Module } from \"../Setup\"\nimport { Pixel } from \"../Utilities\"\n\nconst mm_fontfile = font_id => Module.fontById(font_id).source\nconst mm_textfile = text => text\nconst mm_fontfamily = font_id => Cache.key(mm_fontfile(font_id))\n\nclass DrawTextFilter extends CoreFilter {\n  get parameters() {\n    return [\n      {\n        \"name\": \"fontcolor\",\n        \"value\":\"#000000\"\n      },{\n        \"name\": \"shadowcolor\",\n        \"value\":\"#FFFFFF\"\n      },{\n        \"name\": \"fontsize\",\n        \"value\":\"mm_vert(20)\"\n      },{\n        \"name\": \"x\",\n        \"value\":\"0\"\n      },{\n        \"name\": \"y\",\n        \"value\":\"0\"\n      },{\n        \"name\": \"shadowx\",\n        \"value\":\"mm_horz(5)\"\n      },{\n        \"name\": \"shadowy\",\n        \"value\":\"mm_vert(5)\"\n      },{\n        \"name\": \"fontfile\",\n        \"value\":\"mm_fontfile('com.moviemasher.font.default')\"\n      },{\n        \"name\": \"textfile\",\n        \"value\":\"Hello World\"\n      }\n    ]\n  }\n\n  draw(evaluator, evaluated) {\n    // console.log(this.constructor.name, \"draw\", evaluator, evaluated)\n    const context = evaluator.context\n    const family = mm_fontfamily(evaluator.get(\"fontface\"))\n    const { x, y, fontsize, fontcolor, text, textfile, shadowcolor } = evaluated\n\n    if (shadowcolor) {\n      context.shadowColor = shadowcolor\n      const { shadowx, shadowy/*, shadowblur */ } = evaluated\n      // shadowblur not supported in ffmpeg\n      // context.shadowBlur = shadowblur\n      context.shadowOffsetX = shadowx || 0\n      context.shadowOffsetY = shadowy || 0\n    }\n\n    context.font = `${fontsize}px \"${family}\"`\n    context.fillStyle = Pixel.color(fontcolor)\n    context.fillText(text || textfile, x, Number(y) + Number(fontsize))\n\n    if (shadowcolor) {\n      context.shadowColor = null\n      context.shadowOffsetX = 0\n      context.shadowOffsetY = 0\n      // context.shadowBlur = 0\n    }\n    return context\n  }\n  scopeSet(evaluator) {\n    evaluator.set(\"text_w\", 0) // width of the text to draw\n    evaluator.set(\"text_h\", 0) // height of the text to draw\n    evaluator.set(\"mm_fontfamily\", mm_fontfamily)\n    evaluator.set(\"mm_textfile\", mm_textfile)\n    evaluator.set(\"mm_fontfile\", mm_fontfile)\n  }\n}\n\nconst DrawTextFilterInstance = new DrawTextFilter\nexport { DrawTextFilterInstance as DrawTextFilter }\n","import { Context } from \"../Utilities\"\nimport { CoreFilter } from \"./CoreFilter\"\n\nclass FadeFilter extends CoreFilter{\n  draw(evaluator) {\n    const context = evaluator.context\n    const drawing = Context.createDrawingLike(context)\n    drawing.globalAlpha = evaluator.get(\"mm_t\")\n    drawing.drawImage(context.canvas, 0, 0)\n    drawing.globalAlpha = 1\n    return drawing\n  }\n}\nconst FadeFilterInstance = new FadeFilter\nexport { FadeFilterInstance as FadeFilter }","import { Errors } from \"../Setup\"\nimport { Is } from \"../Utilities\"\nimport { CoreFilter } from \"./CoreFilter\"\n\nclass OverlayFilter extends CoreFilter {\n  draw(evaluator, evaluated, outputContext) {\n    if (Is.undefined(outputContext)) return\n\n    const { context } = evaluator    \n    const { canvas } = context\n    const { x, y } = evaluated\n    outputContext.drawImage(canvas, x, y)\n    return outputContext\n  }\n  scopeSet(evaluator) {\n    const { context } = evaluator\n    if (Is.undefined(context)) throw Errors.internal + evaluator.constructor.name\n    const { width, height } = context.canvas\n    evaluator.set(\"overlay_w\", width)\n    evaluator.set(\"overlay_h\", height)\n    \n  }\n}\nconst OverlayFilterInstance = new OverlayFilter\nexport { OverlayFilterInstance as OverlayFilter }","import { Context } from \"../Utilities\"\nimport { CoreFilter } from \"./CoreFilter\"\n\nclass ScaleFilter extends CoreFilter {\n  draw(evaluator, evaluated) {\n    const context = evaluator.context\n    let width = evaluated.w || evaluated.width\n    let height = evaluated.h || evaluated.height\n\n    if (2 > width + height) return context\n    \n    const in_width = evaluator.get(\"mm_input_width\")\n    const in_height = evaluator.get(\"mm_input_height\")\n    if (-1 === width) width = in_width * (height / in_height)\n    else if (-1 === height) height = in_height * (width / in_width)\n\n    const drawing = Context.createDrawing(width, height)\n    \n    drawing.drawImage(context.canvas, 0, 0, in_width, in_height, 0, 0, width, height)\n  \n    return drawing\n  }\n\n  scopeSet(evaluator) {\n    const { context } = evaluator\n    if (!context) throw 'context'\n    const { canvas } = context\n\n    if (!canvas) throw 'canvas'\n\n    const { width, height } = canvas\n    evaluator.set(\"in_h\", height)\n    evaluator.set(\"mm_input_height\", height)\n    evaluator.set(\"in_w\", width)\n    evaluator.set(\"mm_input_width\", width)\n  }\n}\nconst ScaleFilterInstance = new ScaleFilter\nexport { ScaleFilterInstance as ScaleFilter }\n","\nimport { CoreFilter } from \"./CoreFilter\"\n\nclass SetSarFilter extends CoreFilter {}\nconst SetSarFilterInstance = new SetSarFilter\nexport { SetSarFilterInstance as SetSarFilter }\n","import { Factory } from \"./Factory\"\nimport { BlendFilter } from \"../CoreFilter/BlendFilter\"\nimport { ChromaKeyFilter } from \"../CoreFilter/ChromaKeyFilter\"\nimport { ColorFilter } from \"../CoreFilter/ColorFilter\"\nimport { ColorChannelMixerFilter } from \"../CoreFilter/ColorChannelMixerFilter\"\nimport { ConvolutionFilter } from \"../CoreFilter/ConvolutionFilter\"\nimport { CropFilter } from \"../CoreFilter/CropFilter\"\nimport { DrawBoxFilter } from \"../CoreFilter/DrawBoxFilter\"\nimport { DrawTextFilter } from \"../CoreFilter/DrawTextFilter\"\nimport { FadeFilter } from \"../CoreFilter/FadeFilter\"\nimport { OverlayFilter } from \"../CoreFilter/OverlayFilter\"\nimport { ScaleFilter } from \"../CoreFilter/ScaleFilter\"\nimport { SetSarFilter } from \"../CoreFilter/SetSarFilter\"\n\n\nconst FilterTypes = [\n  \"blend\",\n  \"chromakey\",\n  \"colorchannelmixer\",\n  \"color\",\n  \"convolution\",\n  \"crop\",\n  \"drawbox\",\n  \"drawtext\",\n  \"fade\",\n  \"overlay\",\n  \"scale\",\n  \"setsar\",\n]\nconst FilterType = Object.fromEntries(FilterTypes.map(type => [type, type]))\n\nclass FilterFactory extends Factory {\n  constructor() {\n    super()\n    this.install(FilterType.blend, BlendFilter)\n    this.install(FilterType.chromakey, ChromaKeyFilter)\n    this.install(FilterType.colorchannelmixer, ColorChannelMixerFilter)\n    this.install(FilterType.color, ColorFilter)\n    this.install(FilterType.convolution, ConvolutionFilter)\n    this.install(FilterType.crop, CropFilter)\n    this.install(FilterType.drawbox, DrawBoxFilter)\n    this.install(FilterType.drawtext, DrawTextFilter)\n    this.install(FilterType.fade, FadeFilter)\n    this.install(FilterType.overlay, OverlayFilter)\n    this.install(FilterType.scale, ScaleFilter)\n    this.install(FilterType.setsar, SetSarFilter)\n  }\n\n  create(type) { return this.typeClass(type) }\n\n  createFromObject(object) { return this.create(object.id) }\n}\n\nObject.defineProperties(FilterFactory.prototype, {\n  type: { value: FilterType },\n  types: { value: FilterTypes },\n})\n\nconst FilterFactoryInstance = new FilterFactory\nexport { FilterFactoryInstance as FilterFactory }\n\n","export const drawFilters = {\n  drawFilters: { value: function(evaluator, context) {\n    // console.log(this.constructor.name, this.id, \"draw\", evaluator)\n    this.coreFilter.scopeSet(evaluator)\n    return this.coreFilter.draw(evaluator, this.evaluateScope(evaluator), context)\n  }}\n}","import { Base } from \"../Base\";\n\nclass Media extends Base {}\n\nexport { Media }\n","import { MediaType } from \"../Setup\"\nimport { sharedMedia } from \"./with/sharedMedia\"\nimport { modular } from \"./with/modular\"\nimport { parameters } from \"./with/parameters\"\nimport { Is, Throw } from \"../Utilities\"\nimport { FilterFactory } from \"../Factory/FilterFactory\"\nimport { CoreFilter } from \"../CoreFilter\"\nimport { drawFilters } from \"./with/drawFilters\"\nimport { Media } from \"./Media\"\n\nclass FilterMedia extends Media {}\n\nObject.defineProperties(FilterMedia.prototype, {\n  type: { value: MediaType.filter },\n  ...sharedMedia,\n  ...modular,\n  ...parameters,\n  coreFilter: {\n    get() {\n      if (Is.undefined(this.__coreFilter)) {\n        this.__coreFilter = FilterFactory.create(this.id)\n        Throw.unlessInstanceOf(this.__coreFilter, CoreFilter)\n      }\n      return this.__coreFilter\n    }\n  },\n  evaluateScope: {\n    value(evaluator) {\n      const evaluated = {}\n      const definitions = this.parameters || this.coreFilter.parameters\n      if (Is.not(definitions)) return evaluated\n\n      definitions.forEach(parameter => {\n        const { name } = parameter\n        if (Is.not(name)) return\n\n        evaluated[name] = evaluator.evaluate(parameter.value)\n        evaluator.set(name, evaluated[name])\n      })\n      return evaluated\n    }\n  },\n  ...drawFilters,\n})\n\nexport { FilterMedia }\n","\nexport const parameters = {\n  parameters: { get: function() { return this.object.parameters } },\n}","\nimport { FilterMedia } from \"../FilterMedia\"\n\nexport const filters = { \n  filters: { \n    get: function() { return this.__filters ||= this.filtersInitialize } \n  }, \n  filtersInitialize: { \n    get: function() { \n      const array = this.object.filters || []\n      return array.map(object => new FilterMedia(object))\n    }\n  }\n} \n","\n  export const html = { \n    html: { get: function() { return this.object.html } },\n    inspector: { get: function() { return this.object.inspector } },\n  }","import { Is } from \"../../Utilities\"\nimport { Module, Errors } from \"../../Setup\"\nimport { UrlsByType } from \"../../Loading\"\n\nexport const urlsFromFilters = {\n  urlsVisibleInTimeRangeForClipByType: {\n    value: function(timeRange, clip) {\n      const urls = new UrlsByType\n      const properties_by_type = this.modularPropertiesByType\n      Object.keys(properties_by_type).forEach(type => {\n        const modular_properties = properties_by_type[type]\n        modular_properties.forEach(property => {\n          const value = clip.property(property)\n          // console.log(clip)\n          if (Is.defined(value)) {\n            const module = Module.ofType(value, type)\n            if (Is.defined(module)) {\n              urls[type].push(module.source)\n            }\n          } else throw(Errors.unknown.type + type)\n        })\n      })\n\n      return urls\n    }\n  },\n}\n\n// we no longer load filters - they must be registered or defined in full\n// urlsVisibleInTimeRange(timeRange) {\n//   const urls = super.urlsVisibleInTimeRange(timeRange)\n//   if (Is.array(this.filters)) {\n//     this.filters.forEach(filter => {\n//       const filter_id = filter.id\n//       if (!FilterFactory.created(filter_id)) {\n//         // console.log(`!FilterFactory.created(${filter_id})`, filter)\n//         const source = filter_config.source\n//         if (source) urls.push(source)\n//       }\n//     })\n//   }\n//   return urls\n// }\n","import { filters } from \"./filters\"\nimport { html } from \"./html\"\nimport { modular } from \"./modular\"\nimport { urlsFromFilters } from \"./urlsFromFilters\"\n\nexport const transform = {\n  ...filters,\n  ...urlsFromFilters,\n  ...html,\n  ...modular,\n}","import { MediaType } from \"../Setup\"\nimport { sharedMedia } from \"./with/sharedMedia\"\nimport { inaudible } from \"./with/inaudible\"\nimport { visibleMedia } from \"./with/visibleMedia\"\nimport { transform } from \"./with/transform\"\nimport { Media } from \"./Media\"\n\nclass EffectMedia extends Media {}\n\nObject.defineProperties(EffectMedia.prototype, {\n  type: { value: MediaType.effect },\n  ...sharedMedia,\n  ...transform,\n  ...inaudible,\n  ...visibleMedia,\n})\n\nexport { EffectMedia }\n","import { MediaType } from \"../Setup\"\nimport { Media } from \"./Media\"\nimport { drawFilters } from \"./with/drawFilters\"\nimport { inaudible } from \"./with/inaudible\"\nimport { sharedMedia } from \"./with/sharedMedia\"\nimport { transform } from \"./with/transform\"\n\nclass ScalerMedia extends Media {}\n\nObject.defineProperties(ScalerMedia.prototype, {\n  type: { value: MediaType.scaler },\n  ...sharedMedia,\n  ...transform,\n  ...inaudible,\n  ...drawFilters,\n})\n\nexport { ScalerMedia }\n","\nimport { MediaType } from \"../Setup\"\nimport { sharedMedia } from \"./with/sharedMedia\"\nimport { inaudible } from \"./with/inaudible\"\nimport { transform } from \"./with/transform\"\nimport { drawFilters } from \"./with/drawFilters\"\nimport { Media } from \"./Media\"\n\nclass MergerMedia extends Media {}\n\nObject.defineProperties(MergerMedia.prototype, {\n  type: { value: MediaType.merger },\n  ...sharedMedia,\n  ...transform,\n  ...inaudible,\n  ...drawFilters,\n})\n\nexport { MergerMedia }\n","export const modularFalse = { modular: { value: false } }\n","import { UrlsByType } from \"../../Loading\"\n\nexport const invisible = {\n  visible: { value: false },\n  urlsVisibleInTimeRangeForClipByType: {\n    value: function() { return UrlsByType.none }\n  },\n}\n","import { Default } from \"../../Setup\"\nimport { Is } from \"../../Utilities\"\n\nexport const duration = { \n  duration: { \n    get: function() { \n      if (Is.undefined(this.__duration)) {\n        this.__duration = Number(this.object.duration)\n        this.__duration ||= Default.media[this.type].duration \n      }\n      return this.__duration \n    }\n  }, \n} \n","export const propertiesTiming = {\n  propertiesTiming: { value: {\n    frame: { type: \"number\", value: 0 },\n    frames: { type: \"number\", value: 0 },\n  }}\n}\n","import { propertiesAudible } from \"./propertiesAudible\"\nimport { urlsAudible } from \"./urlsAudible\"\n\nexport const audible = { \n  audible: { value: true },\n  ...propertiesAudible,\n  ...urlsAudible,\n}","export const propertiesAudible = {\n  propertiesAudible: { \n    value: {\n      gain: {\n        type: \"number\", value: 1.0,\n      },\n      trim: {\n        type: \"integer\", value: 0,\n      },\n    } \n  }\n}","import { UrlsByType } from \"../../Loading\"\n\nexport const urlsAudible = {\n  urlsAudibleInTimeRangeForClipByType: {\n    value: function() {\n      const urls = new UrlsByType\n      const url = this.urlAudible\n      if (url) urls.audio.push(url)\n      return urls\n    }\n  },\n}\n","import { MediaType, TrackType } from \"../Setup\"\nimport { modularFalse } from \"./with/modularFalse\"\nimport { invisible } from \"./with/invisible\"\nimport { duration } from \"./with/duration\"\nimport { urlAudible } from \"./with/urlAudible\"\nimport { sharedMedia } from \"./with/sharedMedia\"\nimport { propertiesTiming } from \"./with/propertiesTiming\"\nimport { audible } from \"./with/audible\"\nimport { Media } from \"./Media\"\n\nclass AudioMedia extends Media {}\n\nObject.defineProperties(AudioMedia.prototype, {\n  type: { value: MediaType.audio },\n  trackType: { value: TrackType.audio },\n  ...sharedMedia,\n  ...modularFalse,\n  ...invisible,\n  ...duration,\n  ...urlAudible,\n  ...audible,\n  ...propertiesTiming,\n})\n\nexport { AudioMedia }\n","export const urlAudible = { \n  urlAudible: { \n    get: function() { \n      return this.object.audio || this.object.url || this.object.source \n    } \n  },\n}\n","import { MediaType } from \"../Setup\"\nimport { filters } from \"./with/filters\"\nimport { urlsFromFilters } from \"./with/urlsFromFilters\"\nimport { inaudible } from \"./with/inaudible\"\nimport { sharedMedia } from \"./with/sharedMedia\"\nimport { Media } from \"./Media\"\n\nclass FontMedia extends Media {}\n\nObject.defineProperties(FontMedia.prototype, {\n  type: { value: MediaType.font },\n  ...sharedMedia,\n  ...filters,\n  ...urlsFromFilters,\n  ...inaudible,\n})\n\nexport { FontMedia }\n","export const urlAudibleMute = { \n  urlAudible: { \n    get: function() { \n      switch (this.object.audio) {\n        case undefined: return this.object.source\n        case 0: return\n      }\n      return this.object.audio\n    } \n  },\n}\n","import { LoadType } from \"../../Setup\"\nimport { TimeFactory } from \"../../Factory/TimeFactory\"\nimport { Is } from \"../../Utilities\"\nimport { UrlsByType } from \"../../Loading\"\n\nexport const urlsVisibleFrames = {\n  fps: { get: function() { return this.__fps ||= this.object.fps || 10 } },\n\n  framesMax: {\n    get: function() { return Math.floor(this.fps * this.duration) }\n  },\n\n  begin: { get: function() { return this.__begin ||= this.object.begin || 1 } },\n\n  pattern: {\n    get: function() { return this.__pattern ||= this.object.pattern || '%.jpg' }\n  },\n\n  increment: {\n    get: function() { return this.__increment ||= this.object.increment || 1 }\n  },\n\n  zeropadding: {\n    get: function() {\n      return this.__zeropadding ||= this.zeropaddingInitialize\n    }\n  },\n\n  zeropaddingInitialize: {\n    get: function() {\n      const value = this.object.zeropadding\n      if (Is.defined(value)) return value\n\n      const last_frame = this.begin + (this.increment * this.framesMax)\n      return String(last_frame).length\n    }\n  },\n\n  url: { get: function() { return this.__url ||= this.object.url || \"\" } },\n\n  limitedTimeRange: { value: function(timeRange) {\n    return timeRange.minEndTime(TimeFactory.createFromFrame(this.framesMax, this.fps))\n  } },\n\n  urlsVisibleInTimeRangeForClipByType: {\n    value: function(timeRange, clip) {\n      const urls = new UrlsByType\n      const max_frames = this.framesMax\n      const range = this.limitedTimeRange(timeRange)//.scale(this.fps)\n      //console.log(\"range\", range)\n\n      let last_frame\n      for (let frame = range.frame; frame < range.end; frame++) {\n\n        const time = TimeFactory.createFromFrame(frame, range.fps)\n        const media_time = time.scale(this.fps)\n\n        //console.log(time, media_time)\n        if ((frame !== range.frame) && (last_frame === media_time.frame)) {\n          continue\n        }\n        last_frame = media_time.frame;\n        last_frame = Math.min(last_frame, max_frames - 1)\n        let s = String((Math.min(last_frame, max_frames) * this.increment) + this.begin)\n        if (this.zeropadding) s = s.padStart(this.zeropadding, '0')\n        const url = (this.url + this.pattern).replaceAll('%', s)\n        urls[LoadType.image].push(url)\n      }\n      return urls\n    }\n  }\n}\n","import { MediaType } from \"../Setup\"\nimport { duration } from \"./with/duration\"\nimport { modularFalse } from \"./with/modularFalse\"\nimport { sharedMedia } from \"./with/sharedMedia\"\nimport { visibleMedia } from \"./with/visibleMedia\"\nimport { urlAudibleMute } from \"./with/urlAudibleMute\"\nimport { urlsVisibleFrames } from \"./with/urlsVisibleFrames\"\nimport { propertiesTiming } from \"./with/propertiesTiming\"\nimport { audible } from \"./with/audible\"\nimport { Media } from \"./Media\"\n\nclass VideoMedia extends Media {}\n\nObject.defineProperties(VideoMedia.prototype, {\n  type: { value: MediaType.video },\n  ...sharedMedia,\n  ...modularFalse,\n  ...visibleMedia,\n  ...duration,\n  ...urlAudibleMute,\n  ...urlsVisibleFrames,\n  ...audible,\n  ...propertiesTiming,\n})\n\nexport { VideoMedia }\n","export const urlVisible = { \n  urlVisible: { \n    get: function() { \n      return this.object.url\n    } \n  },\n}\n","import { LoadType } from \"../../Setup\"\nimport { UrlsByType } from \"../../Loading\"\n\nexport const urlsVisible = {\n  urlsVisibleInTimeRange: { value: function() { return [this.urlVisible] } },\n  urlsVisibleInTimeRangeForClipByType: { value: function(timeRange, clip) {\n    const urls = new UrlsByType\n    const url = this.urlVisible\n    if (url) urls[LoadType.image].push(url)\n    return urls\n  }},\n}\n","import { MediaType } from \"../Setup\"\nimport { modularFalse } from \"./with/modularFalse\"\nimport { inaudible } from \"./with/inaudible\"\nimport { visibleMedia } from \"./with/visibleMedia\"\nimport { duration } from \"./with/duration\"\nimport { urlVisible } from \"./with/urlVisible\"\nimport { urlsVisible } from \"./with/urlsVisible\"\nimport { sharedMedia } from \"./with/sharedMedia\"\nimport { propertiesTiming } from \"./with/propertiesTiming\"\nimport { Media } from \"./Media\"\n\nclass ImageMedia extends Media {}\n\nObject.defineProperties(ImageMedia.prototype, {\n  type: { value: MediaType.image },\n  ...sharedMedia,\n  ...modularFalse,\n  ...inaudible,\n  ...visibleMedia,\n  ...duration,\n  ...propertiesTiming,\n  ...urlVisible,\n  ...urlsVisible,\n})\n\nexport { ImageMedia }\n","import { MediaType } from \"../Setup\"\nimport { Media } from \"./Media\"\nimport { duration } from \"./with/duration\"\nimport { filters } from \"./with/filters\"\nimport { html } from \"./with/html\"\nimport { inaudible } from \"./with/inaudible\"\nimport { modular } from \"./with/modular\"\nimport { propertiesModular } from \"./with/propertiesModular\"\nimport { propertiesTiming } from \"./with/propertiesTiming\"\nimport { sharedMedia } from \"./with/sharedMedia\"\nimport { urlsFromFilters } from \"./with/urlsFromFilters\"\nimport { visibleMedia } from \"./with/visibleMedia\"\n\nclass ThemeMedia extends Media {}\n\nObject.defineProperties(ThemeMedia.prototype, {\n  type: { value: MediaType.theme },\n  ...sharedMedia,\n  ...modular,\n  ...inaudible,\n  ...visibleMedia,\n  ...duration,\n  ...filters,\n  ...propertiesModular,\n  ...propertiesTiming,\n  ...html,\n  ...urlsFromFilters,\n})\n\nexport { ThemeMedia }\n","import { UrlsByType } from \"../../Loading\"\n\nexport const urlsNone = {\n  urlsVisibleInTimeRangeForClipByType: {\n    value: function() { return UrlsByType.none }\n  },\n  urlsVisibleInTimeRangeForClipByType: {\n    value: function() { return UrlsByType.none }\n  },\n}\n","import { MediaType } from \"../Setup\"\nimport { Media } from \"./Media\"\nimport { duration } from \"./with/duration\"\nimport { inaudible } from \"./with/inaudible\"\nimport { modular } from \"./with/modular\"\nimport { propertiesTiming } from \"./with/propertiesTiming\"\nimport { sharedMedia } from \"./with/sharedMedia\"\nimport { urlsNone } from \"./with/urlsNone\"\nimport { visibleMedia } from \"./with/visibleMedia\"\n\nclass TransitionMedia extends Media {}\n\nObject.defineProperties(TransitionMedia.prototype, {\n  type: { value: MediaType.transition },\n  ...sharedMedia,\n  ...modular,\n  ...inaudible,\n  ...visibleMedia,\n  ...propertiesTiming,\n  ...duration,\n  ...urlsNone,\n})\n\nexport { TransitionMedia }\n","import { Factory } from \"./Factory\"\nimport { MediaType, Module, ModuleTypes } from \"../Setup\"\nimport { EffectMedia } from \"../Media/EffectMedia\"\nimport { ScalerMedia } from \"../Media/ScalerMedia\"\nimport { MergerMedia } from \"../Media/MergerMedia\"\nimport { AudioMedia } from \"../Media/AudioMedia\"\nimport { FontMedia } from \"../Media/FontMedia\"\nimport { VideoMedia } from \"../Media/VideoMedia\"\nimport { ImageMedia } from \"../Media/ImageMedia\"\nimport { ThemeMedia } from \"../Media/ThemeMedia\"\nimport { TransitionMedia } from \"../Media/TransitionMedia\"\nimport { Is } from \"../Utilities\"\nimport { Media } from \"../Media/Media\"\n\nclass MediaFactory extends Factory {\n  constructor() {\n    super(Media)\n    this.install(MediaType.audio, AudioMedia)\n    this.install(MediaType.video, VideoMedia)\n    this.install(MediaType.image, ImageMedia)\n    this.install(MediaType.theme, ThemeMedia)\n    this.install(MediaType.effect, EffectMedia)\n    this.install(MediaType.scaler, ScalerMedia)\n    this.install(MediaType.merger, MergerMedia)\n    this.install(MediaType.font, FontMedia)\n    this.install(MediaType.transition, TransitionMedia)\n  }\n\n  create(object) {\n    if (Is.instanceOf(object, Media)) return object\n\n    if (ModuleTypes.includes(object.type)) {\n      const module = Module.ofType(object.id, object.type)\n      if (module) return super.create(module)\n    }\n    return super.create(object)\n  }\n}\nconst MediaFactoryInstance = new MediaFactory()\nexport { MediaFactoryInstance as MediaFactory }\n","import { Errors } from \"../Setup\"\nimport { Is } from \"../Utilities\"\nimport { TimeRange } from \"../Utilities\"\nimport { Time } from \"../Utilities\"\n\nconst createFromArgs = (frame, fps, frames) => new TimeRange(frame, fps, frames)\n\nconst createFromSeconds = (start, duration) => createFromArgs(start, 1, duration)\n\nconst createFromTime = (time, frames) => (\n  createFromArgs(time.frame, time.fps, frames)\n)\n\nconst createFromTimes = (startTime, endTime) => {\n  const [time1, time2] = Time.scaleTimes(startTime, endTime)\n  if (time2.frame <= time1.frame) throw Errors.argument\n\n  return createFromArgs(time1.frame, time1.fps, time2.frame - time1.frame)\n}\n\nconst create = (object = {}) => { \n  if (Is.instanceOf(object, TimeRange)) return object\n  if (Is.instanceOf(object, Time)) return createFromTime(object)\n\n  const { frame, fps, frames } = object\n  return createFromArgs(frame, fps, frames) \n}\n\nconst TimeRangeFactory = {\n  create, createFromSeconds, createFromTime, createFromTimes\n}\n\nexport { TimeRangeFactory }\n","import { Is } from \"../../Utilities\"\n\nexport const toJSON = {\n  toJSON: { value: function() {\n    const object = { id: this.id, type: this.type, frame: this.frame  }\n    if (Is.array(this.effects)) object.effects = this.effects\n    return { ...this.propertyValues, ...object } \n  } }\n}\n","export const id = { \n  id: {  get: function() { return this.object.id || this.media.id } }\n}\n","export const labelFromObjectOrMedia = { \n  label: { \n    get: function() { return this.__label ||= this.labelInitialize },\n    set: function(value) { this.__label = value }\n  },\n  labelInitialize: { \n    get: function() { return this.object.label || this.media.label }\n  },\n}\n","import { MediaFactory } from \"../../Factory/MediaFactory\"\nimport { Is } from \"../../Utilities/Is\"\n\nexport const media = { \n  media: { \n    get: function() { \n      if (Is.undefined(this.__media)) {\n        this.__media = MediaFactory.create(this.object.media)\n      }\n      return this.__media \n    }\n  }, \n}\n","import { TransformTypes } from \"../../Setup\"\n\nexport const propertyValues = {\n  propertyValues: { get: function() {\n    // console.log(this.constructor.name, \"propertyValues\", this.properties)\n    return Object.fromEntries(Object.keys(this.properties).map(property => {\n      const valueOrTransform = this[property]\n      const transform = TransformTypes.includes(property)\n      const value = transform ? valueOrTransform.id : valueOrTransform\n      \n      return [property, value]\n    }))\n  }}\n}","export const propertiesFromMedia = { \n  properties: { get: function() { return this.media.properties } } \n}","import { object } from \"./object\"\n\n// clips and transforms\nexport const editable = {\n  ...object,\n  propertyNames: { get: function() { return Object.keys(this.properties)} },\n  properties: {\n    get: function() { return this.__properties ||= this.propertiesInitialize }\n  },\n  propertiesInitialize: {\n    get: function() { \n      const object = { ...this.media.properties }\n      if (this.propertiesTransform) Object.assign(object, this.propertiesTransform)\n      return object\n    }\n  },\n}","import { toJSON } from \"./toJSON\"\nimport { track } from \"./track\"\nimport { id } from \"./id\"\nimport { labelFromObjectOrMedia } from \"./labelFromObjectOrMedia\"\nimport { media } from \"./media\"\nimport { propertyValues } from \"./propertyValues\"\nimport { propertiesFromMedia } from \"./propertiesFromMedia\"\nimport { copy } from \"./copy\"\nimport { load } from \"./load\"\nimport { editable } from \"../../Base/with/editable\"\nimport { TimeFactory } from \"../../Factory/TimeFactory\"\nimport { TimeRangeFactory } from \"../../Factory/TimeRangeFactory\"\n\nexport const sharedClip = {\n  ...editable,\n  ...copy,\n  ...toJSON,\n  ...id,\n  ...labelFromObjectOrMedia,\n  ...track,\n  time: {\n    value: function(quantize) {\n      return TimeFactory.createFromFrame(this.frame, quantize)\n    }\n  },\n  timeRange: {\n    value: function(quantize) {\n      const options = { frame: this.frame, quantize, frames: this.frames }\n      return TimeRangeFactory.create(options)\n    }\n  },\n  timeRangeRelative: {\n    value: function(mashTime) {\n      const range = this.timeRange(mashTime.fps)\n      const frame = mashTime.frame - this.frame\n      if (frame < 0) {\n        console.log(this.constructor.name, \"timeRangeRelative\", mashTime, range)\n        return\n      }\n      return range.withFrame(frame)\n    }\n  },\n  ...media,\n  ...propertyValues,\n  ...propertiesFromMedia,\n  ...load,\n}\n","export const copy = {\n  copy: {\n    get: function() {\n      return new this.constructor({...this.toJSON(), media: this.media })\n    }\n  }\n}","export const load = {\n  load: { value: function(mashTimeRange) {\n    const urls = this.urlsVisibleInTimeRangeByType(mashTimeRange)\n    return urls.load()\n  }}\n}","import { UrlsByType } from \"../../Loading\"\n\nexport const inaudible = {\n  audible: { value: false },\n  urlsAudibleInTimeRangeByType: {\n    value: function() { return UrlsByType.none }\n  },\n}\n","import { Is } from \"../../Utilities\"\nimport { TrackType } from \"../../Setup/Types\"\n\nexport const visibleClip = { \n  visible: { value: true },\n\n  trackType: { value: TrackType.video },\n\n  scaledContextAtTimeForDimensions: {\n    value: function(mashTime, dimensions, ...rest) {\n      const context = this.contextAtTimeForDimensions(mashTime, dimensions, ...rest)\n      // console.log(\"scaledContextAtTimeForDimensions\", context)\n      if (!this.scaler) return context\n\n      const clipTimeRange = this.timeRangeRelative(mashTime)\n      if (Is.undefined(clipTimeRange)) return\n      \n      return this.scaler.drawMediaFilters(clipTimeRange, context, dimensions)\n    }\n  },\n\n  effectedContextAtTimeForDimensions: {\n    value: function(mashTime, dimensions, ...rest) {\n      let context = this.scaledContextAtTimeForDimensions(mashTime, dimensions, ...rest)\n      if (!this.effects) return context\n\n      const clipTimeRange = this.timeRangeRelative(mashTime)\n      if (Is.undefined(clipTimeRange)) return\n      \n      this.effects.reverse().forEach(effect => \n        context = effect.drawMediaFilters(clipTimeRange, context, dimensions)\n      )\n      return context\n    }\n  },\n  \n  mergeContextAtTime: { \n    value: function(mashTime, context, ...rest) { \n      \n      if (!this.merger) return context\n      const effected = this.effectedContextAtTimeForDimensions(mashTime, context.canvas, ...rest)\n      \n      const clipTimeRange = this.timeRangeRelative(mashTime)\n      if (Is.undefined(clipTimeRange)) return\n      \n      return this.merger.drawMerger(clipTimeRange, effected, context)\n    }\n  },\n}","\n\nexport const urls = {\n  urlsVisibleInTimeRangeByType: { \n    value: function(mashTimeRange) { \n      const range = this.mediaTimeRange(mashTimeRange)\n      const urls = this.media.urlsVisibleInTimeRangeForClipByType(range, this) \n      if (this.merger) {\n        urls.concat(this.merger.urlsVisibleInTimeRangeByType(range))\n      }\n      if (this.scaler) {\n        urls.concat(this.scaler.urlsVisibleInTimeRangeByType(range))\n      }\n      if (this.effects) this.effects.forEach(effect => \n        urls.concat(effect.urlsVisibleInTimeRangeByType(range))\n      )\n      return urls\n    }\n  },\n}\n\n\n","export const idMutable = {\n  id: { \n    get: function() { return this.__id ||= this.object.id },\n    set: function(value) { \n      this.__id = value \n      this.__media = null\n    }\n  }\n}","\n\nexport const urlsFromMedia = {\n  urlsVisibleInTimeRangeByType: { \n    value: function(timeRange) { \n      return this.media.urlsVisibleInTimeRangeForClipByType(timeRange, this) \n    }\n  },\n}\n\n\n","import { Errors, Module } from \"../../Setup\"\nimport { MediaFactory } from \"../../Factory/MediaFactory\"\n\nexport const media = {\n  media: { get: function() {\n    return this.__media ||= this.mediaInitialize }\n  },\n  mediaInitialize: {\n    get: function() {\n      if (this.object.media) return MediaFactory.create(this.object.media)\n\n      const module = Module.ofType(this.id, this.type)\n      if (! module) throw Errors.unknown[this.type] + this.type + ' ' + this.id\n\n      return MediaFactory.create(module)\n    }\n  }\n}\n","import { Errors } from \"../Setup\"\nimport { Is } from \"../Utilities/Is\"\nimport { TimeRange } from \"../Utilities/TimeRange\"\n\n\nconst KEYS_SIZED = ['mm_width', 'mm_height']\nconst KEYS_GETTERS = [\n  \"mm_dimensions\",\n  \"mm_duration\",\n  \"mm_fps\",\n  \"mm_height\",\n  \"mm_t\",\n  \"mm_width\",\n  \"t\",\n]\nconst KEYS = [\n  \"ceil\",\n  \"floor\",\n  \"mm_cmp\",\n  \"mm_horz\",\n  \"mm_max\",\n  \"mm_min\",\n  \"mm_vert\",\n  ...KEYS_GETTERS,\n  ...KEYS_SIZED\n] \n\nconst THIS = \"evaluator\"\n\nfunction Evaluator(timeRange, context, dimensions) { \n  if (!Is.instanceOf(timeRange, TimeRange)) throw Errors.argument + timeRange\n  if (!Is.object(timeRange)) throw Errors.argument + context\n  if (!Is.object(dimensions)) throw Errors.argument + dimensions\n\n  this.timeRange = timeRange\n  this.context = context\n  this.dimensions = dimensions \n  this.map = new Map\n}\n\nconst conditionalExpression = (conditional) => {\n  const condition = conditional.condition\n\n  // not strict equality, since we may have strings and numbers\n  if (Is.defined(conditional.is)) return `${condition}==${conditional.is}`\n  \n  const elements = conditional.in\n  if (Is.undefined(elements)) return condition\n\n  // support supplying values as array or comma-delimited string\n  const array = Is.string(elements) ? elements.split(',') : elements\n  const strings =Is.string(array[0])\n  const values = array.map(element => strings ? `\"${element}\"` : element)\n  const type = strings ? 'String' : 'Number'\n  const expression = `([${values.join(',')}].includes(${type}(${condition})))`\n  return expression\n}\n\nconst replaceOperators = (string) => { \n  return string.replaceAll(' or ', ' || ').replaceAll(' and ', ' && ')\n}\n\nObject.defineProperties(Evaluator.prototype, {\n  canvas: { get: function() { return this.context.canvas } },\n\n  ceil: { value: Math.ceil },\n\n  replaceKeys: {\n    value: function(expression) { \n      if (!Is.string(expression)) return expression\n\n      const expressions = Object.fromEntries(this.keys.map(key => ([\n        key, new RegExp(`\\\\b${key}\\\\b`, 'g')\n      ])))\n      Object.entries(expressions).forEach(([key, reg_exp]) => {\n        expression = expression.replaceAll(reg_exp, `${THIS}.get(\"${key}\")`) \n      })\n      return expression\n    }\n  },\n\n  conditionalValue: { \n    value: function(conditionals) {\n      if (!Is.array(conditionals)) return conditionals\n\n      let test_bool = false\n      for (let conditional of conditionals) {\n        const expression = replaceOperators(conditionalExpression(conditional))\n\n        test_bool = this.evaluateExpression(expression)\n        if (test_bool) return conditional.value\n      }\n      throw Errors.internal + 'no conditions were true'\n    }\n  },\n\n  evaluate: {\n    value: function(expressionOrConditions) {\n      const expression = this.conditionalValue(expressionOrConditions)\n      return this.evaluateExpression(expression)\n    }\n  },\n\n  evaluateExpression: {\n    value: function(expression) {\n      const script = `return ${this.replaceKeys(expression)}`\n      // console.log(\"evaluateScope\", script)\n      try {\n        const method = new Function(THIS, script)\n        return method(this) \n      } catch (exception) {\n        // console.warn(`Evaluation failed`, script, this, exception)\n        return expression\n      }\n    }\n  },\n\n  floor: { value: Math.floor },\n\n  get: { value: function(key) { \n    if (this.map.has(key)) return this.map.get(key)\n    const value = this[key]\n    if (KEYS_GETTERS.includes(key)) return value\n\n    if (Is.method(value)) return value.bind(this)\n\n    console.log(\"Evaluator.get\", key, value)\n    return value\n  } },\n  \n  keys: { \n    get: function() { return [...new Set([...this.map.keys(), ...KEYS])] } \n  },\n\n  mm_cmp: { value: function(a, b, x, y) { return ((a > b) ? x : y) } },\n  \n  mm_dimensions: { \n    get: function() { return `${this.mm_width}x${this.mm_height}` } \n  },\n\n  mm_duration: { get: function() { return this.timeRange.lengthSeconds } },\n\n  mm_fps: { get: function() { return this.timeRange.fps } },\n\n  mm_height: { get: function() { return this.dimensions.height } },\n\n  mm_horz: { \n    value: function(size, proud) { return this.sized(0, size, proud) } \n  },\n\n  mm_max: { value: Math.max },\n\n  mm_min: { value: Math.min },\n\n  mm_t: { get: function() { return this.timeRange.position } },\n\n  mm_vert: { \n    value: function(size, proud) { return this.sized(1, size, proud) } \n  },\n\n  mm_width: { get: function() { return this.dimensions.width } },\n\n  set: { value: function(key, value) { this.map.set(key, value) } },\n\n  sized: { value: function(vertical, size, proud) {\n    const scale = Is.float(size) ? size : parseFloat(size)\n    const value = parseFloat(this[KEYS_SIZED[vertical]])\n    const scaled = value * scale\n    if (! proud) return scaled\n\n    const other = parseFloat(this[KEYS_SIZED[Math.abs(vertical - 1)]])\n    if (other <= value) return scaled\n    \n    return value + (scale - 1.0) * other\n  }},\n\n  t: { get: function() { return this.mm_duration } },\n})\n\nexport { Evaluator }\n","import { Errors, Property } from \"../../Setup\"\nimport { Is } from \"../../Utilities/Is\"\nimport { Evaluator } from \"../../Clip/Evaluator\"\n\nexport const evaluator = {\n  evaluator: { \n    value: function(clipRange, context, dimensions){\n      const evaluator = new Evaluator(clipRange, context, dimensions)\n      if (this.media.properties) {\n        Object.keys(this.media.properties).forEach(key => {\n          let value = this[key]\n          if (Is.undefined(value)) {\n            console.log(\"this lacked property\", key, this)\n            const property = this.media.properties[key]\n            value = property.value\n            if (Is.undefined(value)) {\n              console.log(\"Transform.draw media lacked property value\", property)\n            \n              value = Property.propertyTypeDefault(property.type)\n\n              if (Is.undefined(value)) throw Errors.unknown.type + property.type\n            }\n          } \n          evaluator.set(key, value)\n        })\n      }\n      return evaluator\n    }\n  },\n}","\nimport { copy } from \"../../Base/with/copy\"\nimport { propertyValues } from \"../../Clip/with/propertyValues\"\nimport { urlsFromMedia } from \"../../Clip/with/urlsFromMedia\"\nimport { labelFromObjectOrMedia } from \"../../Clip/with/labelFromObjectOrMedia\"\nimport { media } from \"./media\"\nimport { evaluator } from \"../../Clip/with/evaluator\"\nimport { editable } from \"../../Base/with/editable\"\nimport { toJSONTransform } from \"./toJSONTransform\"\nimport { propertiesFromMedia } from \"../../Clip/with/propertiesFromMedia\"\n\nexport const sharedTransform = {\n  ...editable,\n  ...copy,\n  ...media,\n  ...labelFromObjectOrMedia,\n  ...propertyValues,\n  ...urlsFromMedia,\n  ...evaluator,\n  ...toJSONTransform,\n  ...propertiesFromMedia,\n}","export const copy = {\n  copy: { get: function() { return new this.constructor(this.toJSON()) } }\n}\n","export const toJSONTransform = {\n  toJSON: { value: function() {\n    const object = { id: this.id, type: this.type  }\n    return { ...this.propertyValues, ...object } \n  } }\n}\n","import { sharedTransform } from \"./with/sharedTransform\"\n\nclass Transform {\n  constructor(object) {\n    this.object = object\n    this.media.initializeInstance(this, object)\n  }\n}\n\nObject.defineProperties(Transform.prototype, {\n  ...sharedTransform,\n})\n\nexport { Transform }","\nimport { idMutable } from \"../Base/with/idMutable\"\n\nimport { ModuleType } from \"../Setup\"\nimport { drawMerger } from \"./with/drawMerger\"\nimport { Transform } from \"./Transform\"\n\nclass Merger extends Transform {}\n\nObject.defineProperties(Merger.prototype, {\n  type: { value: ModuleType.merger },\n  ...idMutable,\n  ...drawMerger,\n})\n\nexport { Merger }","export const drawMerger = {\n  drawMerger: { value: function(clipTimeRange, inputContext, outputContext) {\n    this.media.filters.forEach(filter => {\n      filter.drawFilters(this.evaluator(clipTimeRange, inputContext, outputContext.canvas), outputContext)\n    })\n    return outputContext\n  }}\n}","\nexport const drawMediaFilters = { \n  drawMediaFilters: { value: function(clipTimeRange, context, dimensions) { \n    // clipTimeRange's frame is offset of draw time within clip = frames is duration\n    this.media.filters.forEach(filter => {\n      context = filter.drawFilters(this.evaluator(clipTimeRange, context, dimensions))\n    })\n    return context\n  }},\n  \n}\n\n\n\n","import { idMutable } from \"../Base/with/idMutable\"\nimport { ModuleType } from \"../Setup\"\nimport { drawMediaFilters } from \"../Clip/with/drawMediaFilters\"\nimport { Transform } from \"./Transform\"\n\nclass Scaler extends Transform {}\n\nObject.defineProperties(Scaler.prototype, {\n  type: { value: ModuleType.scaler },\n  ...idMutable,\n  ...drawMediaFilters,\n})\n\nexport { Scaler }\n","import { id } from \"../Clip/with/id\"\n\nimport { ModuleType } from \"../Setup\"\nimport { drawMediaFilters } from \"../Clip/with/drawMediaFilters\"\nimport { Transform } from \"./Transform\"\n\nclass Effect extends Transform {}\n\nObject.defineProperties(Effect.prototype, {\n  type: { value: ModuleType.effect },\n  ...id,\n  ...drawMediaFilters,\n})\n\nexport { Effect }","import { ModuleType, Module } from \"../../Setup\"\nimport { Merger, Scaler, Effect } from \"../../Transform\"\nimport { Is } from \"../../Utilities\"\n\nexport const transform = {\n  effects: {\n    get: function() { return this.__effects ||= this.effectsInitialize }\n  },\n  effectsInitialize: {\n    get: function() {\n      const array = this.object.effects || []\n      return array.map(object => new Effect(object))\n    }\n  },\n  merger: {\n    get: function() { return this.__merger ||= this.mergerInitialize },\n    set: function(value) { this.__merger = new Merger({ id: value })}\n  },\n  mergerInitialize: {\n    get: function() {\n      const object = this.object.merger || Module.objectWithDefaultId(ModuleType.merger)\n      return new Merger(object)\n    }\n  },\n  scaler: {\n    get: function() { return this.__scaler ||= this.scalerInitialize },\n    set: function(value) { this.__scaler = new Scaler({ id: value })}\n  },\n  scalerInitialize: {\n    get: function() {\n      const object = this.object.scaler || Module.objectWithDefaultId(ModuleType.scaler)\n      return new Scaler(object)\n    }\n  },\n  coreFilters: {\n    get: function() {\n      const filters = []\n      if (Is.defined(this.media.filters)) filters.push(...this.media.filters)\n      if (Is.defined(this.merger)) filters.push(...this.merger.media.filters)\n      if (Is.defined(this.scaler)) filters.push(...this.scaler.media.filters)\n      if (Is.defined(this.effects)) {\n        filters.push(...this.effects.flatMap(effect => effect.media.filters))\n      }\n      return filters\n    }\n  },\n}\n","import { TimeRangeFactory } from \"../../Factory/TimeRangeFactory\"\nimport { Errors } from \"../../Setup\"\nimport { Is, Context } from \"../../Utilities\"\nimport { Cache } from \"../../Loading\"\n\nexport const drawImage = {\n  contextAtTimeForDimensions: {\n    value: function(mashTime, dimensions) {\n      const range = TimeRangeFactory.createFromTime(mashTime)\n      const urls = this.media.urlsVisibleInTimeRangeForClipByType(range, this)\n      const url = urls.image[0]\n\n      const resource = Cache.get(url)\n      if (!Is.object(resource)) throw Errors.uncached + url + \" contextAtTimeForDimensions\"\n\n      const { width, height } = resource\n      let context = Context.createDrawing(width, height)\n      context.drawImage(resource, 0, 0, width, height, 0, 0, width, height)\n      return context\n    }\n  },\n}\n","\nclass Clip {\n  constructor(object) { \n    this.object = object \n    this.media.initializeInstance(this, object)\n  }\n}\n\nexport { Clip }","export const mediaTime = {\n  mediaTime: { value: function(time) { return time } },\n  mediaTimeRange: { value: function(timeRange) { return timeRange } },\n}","import { ClipType } from \"../Setup\"\nimport { sharedClip } from \"./with/sharedClip\"\nimport { inaudible } from \"./with/inaudible\"\nimport { visibleClip } from \"./with/visibleClip\"\nimport { urls } from \"./with/urls\"\nimport { transform } from \"./with/transform\"\nimport { drawImage } from \"./with/drawImage\"\nimport { Clip } from \"./Clip\"\nimport { mediaTime } from \"./with/mediaTime\"\n\nclass ImageClip extends Clip {}\n\nObject.defineProperties(ImageClip.prototype, {\n  type: { value: ClipType.image },\n  ...sharedClip,\n  ...visibleClip,\n  ...inaudible,\n  ...urls,\n  ...transform,\n  ...drawImage,\n  ...mediaTime,\n})\n\nexport { ImageClip }\n","import { TrackType } from \"../../Setup\"\nimport { UrlsByType } from \"../../Loading\"\n\nexport const invisible = {\n  visible: { value: false },\n  trackType: { value: TrackType.audio },\n  urlsVisibleInTimeRangeByType: {\n    value: function() { return UrlsByType.none }\n  },\n}\n","import { TimeRangeFactory } from \"../../Factory/TimeRangeFactory\"\nimport { TimeFactory } from \"../../Factory/TimeFactory\"\n\nexport const audible = {\n  audible: { get: function() {\n    const audible = this.media.audible && !this.muted\n    if (!audible) console.log(this.constructor.name, \"audible false:\", this.media.audible, !this.muted)\n    return audible\n  } },\n  muted: {\n    get: function() {\n      switch(this.gain) {\n          case 0:\n          case '0':\n          case '0,0,1,0': return true\n      }\n      return false\n    }\n  },\n  urlsAudibleInTimeRangeByType: {\n    value: function(timeRange) {\n      const range = this.mediaTimeRange(timeRange)\n      return this.media.urlsAudibleInTimeRangeForClipByType(range)\n    }\n  },\n  mediaTime: {\n    value: function(time, add_one_frame = false) {\n      const end_time = TimeFactory.createFromFrame(this.frame + this.frames, time.quantize)\n      const limited_time = time.min(end_time)\n      const start_time = TimeFactory.createFromFrame(this.frame, time.quantize)\n      let media_time = limited_time.subtract(start_time)\n\n      if (add_one_frame) {\n        const frame_at_speed = this.speed ? Math.ceil(this.speed) : 1\n        media_time = media_time.add(TimeFactory.createFromFrame(frame_at_speed, this.quantize))\n      }\n      if (this.trim) {\n        media_time = media_time.add(TimeFactory.createFromFrame(this.trim, this.quantize))\n      }\n      if (this.speed) {\n        media_time = media_time.divide(this.speed, 'ceil')\n      }\n      return media_time\n    }\n  },\n  mediaTimeRange: {\n    value: function(timeRange) {\n      const add_one_frame = (timeRange.frames > 1)\n      return TimeRangeFactory.createFromTimes(\n        this.mediaTime(timeRange.startTime),\n        this.mediaTime(timeRange.endTime, add_one_frame)\n      )\n    }\n  },\n}\n","import { TimeRangeFactory } from \"../../Factory/TimeRangeFactory\"\nimport { TimeFactory } from \"../../Factory/TimeFactory\"\n\nexport const mediaTimeFromTrim = {\n  mediaTime: {\n    value: function(time, add_one_frame = false) {\n      const end_time = TimeFactory.createFromFrame(this.frame + this.frames, time.quantize)\n      const limited_time = time.min(end_time)\n      const start_time = TimeFactory.createFromFrame(this.frame, time.quantize)\n      let media_time = limited_time.subtract(start_time)\n\n      if (add_one_frame) {\n        const frame_at_speed = this.speed ? Math.ceil(this.speed) : 1\n        media_time = media_time.add(TimeFactory.createFromFrame(frame_at_speed, this.quantize))\n      }\n      if (this.trim) {\n        media_time = media_time.add(TimeFactory.createFromFrame(this.trim, this.quantize))\n      }\n      if (this.speed) {\n        media_time = media_time.divide(this.speed, 'ceil')\n      }\n      return media_time\n    }\n  },\n  mediaTimeRange: {\n    value: function(timeRange) {\n      const add_one_frame = (timeRange.frames > 1)\n      return TimeRangeFactory.createFromTimes(\n        this.mediaTime(timeRange.startTime),\n        this.mediaTime(timeRange.endTime, add_one_frame)\n      )\n    }\n  },\n}\n","import { ClipType } from \"../Setup\"\nimport { sharedClip } from \"./with/sharedClip\"\nimport { invisible } from \"./with/invisible\"\nimport { audible } from \"./with/audible\"\nimport { Clip } from \"./Clip\"\nimport { mediaTimeFromTrim } from \"./with/mediaTimeFromTrim\"\n\nclass AudioClip extends Clip {}\n\nObject.defineProperties(AudioClip.prototype, {\n  type: { value: ClipType.audio },\n  ...sharedClip,\n  ...invisible,\n  ...audible,\n  ...mediaTimeFromTrim,\n})\n\nexport { AudioClip }\n","import { ClipType } from \"../Setup\"\nimport { sharedClip } from \"./with/sharedClip\"\nimport { visibleClip } from \"./with/visibleClip\"\nimport { urls } from \"./with/urls\"\nimport { audible } from \"./with/audible\"\nimport { transform } from \"./with/transform\"\nimport { mediaTimeFromTrim } from \"./with/mediaTimeFromTrim\"\n\nfunction VideoClip(object) { this.object = object }\n\nObject.defineProperties(VideoClip.prototype, {\n  type: { value: ClipType.video },\n  ...sharedClip,\n  ...visibleClip,\n  ...audible,\n  ...urls,\n  ...transform,\n  ...mediaTimeFromTrim,\n})\n\nexport { VideoClip }\n","import { ClipType } from \"../Setup\"\nimport { sharedClip } from \"./with/sharedClip\"\nimport { inaudible } from \"./with/inaudible\"\nimport { visibleClip } from \"./with/visibleClip\"\nimport { speedOne } from \"./with/speedOne\"\nimport { urls } from \"./with/urls\"\nimport { transform } from \"./with/transform\"\nimport { evaluator } from \"./with/evaluator\"\nimport { Context } from \"../Utilities\"\nimport { drawMediaFilters } from \"./with/drawMediaFilters\"\nimport { mediaTime } from \"./with/mediaTime\"\nimport { Clip } from \"./Clip\"\nimport { Is } from \"../Utilities\"\n\nclass ThemeClip extends Clip {}\n\nObject.defineProperties(ThemeClip.prototype, {\n  type: { value: ClipType.theme },\n  ...sharedClip,\n  ...inaudible,\n  ...visibleClip,\n  ...speedOne,\n  ...urls,\n  ...inaudible,\n  ...transform,\n  ...evaluator,\n  ...drawMediaFilters,\n  ...mediaTime,\n  contextAtTimeForDimensions: {\n    value: function(mashTime, dimensions) {\n      const context = Context.createDrawing(dimensions.width, dimensions.height)\n      const clipTimeRange = this.timeRangeRelative(mashTime)\n      if (Is.undefined(clipTimeRange)) return\n      \n      return this.drawMediaFilters(clipTimeRange, context, dimensions)\n    }\n  },\n})\n\nexport { ThemeClip }","export const speedOne = { \n  speed: {  get: function() { return 1.0 } }\n}\n","import { ClipType, TransformType, TransformTypes } from \"../Setup\"\nimport { Merger, Scaler } from \"../Transform\"\nimport { Is, Context, byFrame, Utilities } from \"../Utilities\"\nimport { ColorFilter } from \"../CoreFilter\"\nimport { Clip } from \"./Clip\"\nimport { mediaTime } from \"./with/mediaTime\"\nimport { sharedClip } from \"./with/sharedClip\"\nimport { visibleClip } from \"./with/visibleClip\"\nimport { urlsFromMedia } from \"./with/urlsFromMedia\"\n\nconst ChildTypes = [\"to\", \"from\"]\nconst ChildType = Object.fromEntries(ChildTypes.map(type => [type, type]))\n\nclass TransitionClip extends Clip {\n  constructor(object) {\n    super(object)\n    this.children = Object.fromEntries(ChildTypes.map(type => [type, {}]))\n  }\n}\n\nconst definition = {\n  type: { value: ClipType.transition },\n  ...sharedClip,\n  ...visibleClip,\n  ...urlsFromMedia,\n  ...mediaTime,\n  contextAtTimeForDimensions: {\n    value: function(mashTime, dimensions, color, clips = []) {\n      const sorted = clips.sort(byFrame)\n\n      const context = Context.createDrawing(dimensions.width, dimensions.height)\n      ColorFilter.draw( { context }, { color } )\n\n      const [fromClip, toClip] = sorted\n      const defined = {\n        [ChildType.to]: Is.object(toClip) && toClip,\n        [ChildType.from]: Is.object(fromClip) && fromClip,\n      }\n      ChildTypes.forEach(childType => {\n        const clip = defined[childType]\n        if (!clip) return\n\n        const drawing = Context.createDrawing(dimensions.width, dimensions.height)\n        ColorFilter.draw( { drawing }, { color } )\n\n        clip.mergeContextAtTime(mashTime, drawing)\n\n\n        const merger = this.child(childType, TransformType.merger)\n        const scaler = this.child(childType, TransformType.scaler)\n\n\n        const clipTimeRange = this.timeRangeRelative(mashTime)\n        if (Is.undefined(clipTimeRange)) return\n\n        const scaled = scaler.drawMediaFilters(clipTimeRange, drawing, dimensions)\n        merger.drawMerger(clipTimeRange, scaled, context)\n      })\n\n      return context\n    }\n  },\n  // urlsVisibleInTimeRangeByType: {\n  //   value: function(timeRange) {\n  //     const urls = new UrlsByType\n\n  //     ChildTypes.forEach(type => {\n  //       urls.concat(this.child())\n  //     })\n\n  //     return this.media.urlsVisibleInTimeRangeForClipByType(timeRange, this)\n  //   }\n  // },\n  initializeChild: {\n    value: function(childType, transformType) {\n      const klass = transformType === TransformType.merger ? Merger : Scaler\n      return new klass(this.object[childType])\n    }\n  },\n  child: {\n    value: function(childType, transformType) {\n      return this[`${childType}${Utilities.capitalize(transformType)}`]\n    }\n  },\n}\n\nChildTypes.forEach(childType => {\n  definition[childType] = {\n    get: function() {\n      if (Is.undefined(this.children[childType])) this.children[childType] = {}\n      return this.children[childType]\n    }\n  }\n\n  TransformTypes.forEach(transformType => {\n    definition[`${childType}${Utilities.capitalize(transformType)}`] = {\n      get: function() {\n        if (Is.undefined(this.children[childType][transformType])) {\n          const child = this.initializeChild(childType, transformType)\n          this.children[childType][transformType] = child\n        }\n        return this.children[childType][transformType]\n      }\n    }\n  })\n})\n\nObject.defineProperties(TransitionClip.prototype, definition)\n\nexport { TransitionClip }\n","import { ClipType } from \"../Setup\"\nimport { sharedClip } from \"./with/sharedClip\"\nimport { visibleClip } from \"./with/visibleClip\"\nimport { urls } from \"./with/urls\"\nimport { mediaTime } from \"./with/mediaTime\"\n\nfunction FrameClip(object) { this.object = object }\n\nObject.defineProperties(FrameClip.prototype, {\n  type: { value: ClipType.frame },\n  ...sharedClip,\n  ...visibleClip,\n  ...urls,\n  ...mediaTime,\n})\n\n\nexport { FrameClip }","import { Factory } from \"./Factory\"\nimport { Errors, ClipType } from \"../Setup\"\nimport { Is } from \"../Utilities\"\nimport {\n  AudioClip,\n  VideoClip,\n  ImageClip,\n  ThemeClip,\n  TransitionClip,\n  FrameClip,\n  Clip\n} from \"../Clip\"\nimport { TimeFactory } from \"./TimeFactory\"\nimport { ClipTypes } from \"../Setup/Types\"\n\nclass ClipFactory extends Factory {\n  constructor() {\n    super(Clip)\n    this.install(ClipType.audio, AudioClip)\n    this.install(ClipType.frame, FrameClip)\n    this.install(ClipType.image, ImageClip)\n    this.install(ClipType.theme, ThemeClip)\n    this.install(ClipType.transition, TransitionClip)\n    this.install(ClipType.video, VideoClip)\n  }\n\n  createFromObjectMedia(object = {}, media = {}, mash = {}) {\n    if (!Is.object(object)) throw Errors.object\n    if (!Is.object(media)) throw Errors.media\n\n    if (!Is.integer(object.frames)) {\n      object.frames = TimeFactory.createFromSeconds(media.duration, mash.quantize, 'floor').frame\n    }\n    object.media ||= media\n    const type = object.type || media.type\n    media.type ||= type\n    object.type ||= type\n    if (!ClipTypes.includes(type)) throw Errors.unknown.type\n\n    return this.createFromObject(object)\n  }\n\n  createFromMedia(media, mash) {\n    const object = { id: media.id, type: media.type }\n    return this.createFromObjectMedia(object, media, mash)\n  }\n}\n\nconst ClipFactoryInstance = new ClipFactory()\nexport { ClipFactoryInstance as ClipFactory }\n","import { Base } from \"../Base\"\nimport { TrackType, Errors } from \"../Setup\"\nimport { ClipFactory } from \"../Factory/ClipFactory\"\nimport { byFrame } from \"../Utilities\"\n\nclass Track extends Base {\n    constructor(object, mash) {\n      super(object)\n      this.mash = mash\n\n      this.object.index ||= 0\n      this.object.type ||= TrackType.video\n    }\n\n    get clips() { return this.__clips ||= this.initializeClips }\n    get initializeClips() {\n      const array = this.object.clips || []\n      return array.map(object => {\n        const media = this.mash.searchMedia(object.id)\n        const clip = ClipFactory.createFromObjectMedia({ track: this.index, ...object }, media)\n\n        return clip\n      })\n    }\n\n    get frames() {\n      if (!this.clips.length) return 0\n\n      const clip = this.clips[this.clips.length - 1]\n      return clip.frame + clip.frames\n    }\n\n    get index() { return this.object.index }\n\n    get isMainVideo() { return !this.index && this.type == TrackType.video }\n\n    get type() { return this.object.type }\n\n    addClips(clips, insertIndex = 0) {\n      insertIndex ||= 0\n      if (!this.isMainVideo) insertIndex = 0 // ordered by clip.frame values\n\n      const clipIndex = insertIndex // note original, since it may decrease...\n      const movingClips = [] // build array of clips already in this.clips\n      // build array of my clips excluding the clips we're inserting\n      const spliceClips = this.clips.filter((clip, index) => {\n        const moving = clips.includes(clip)\n        if (moving) movingClips.push(clip)\n        // insert index should be decreased when clip is moving and comes before\n        if (clipIndex && moving && index < clipIndex) insertIndex--\n        return !moving\n      })\n      // insert the clips we're adding at the correct index, then sort properly\n      spliceClips.splice(insertIndex, 0, ...clips)\n      this.sortClips(spliceClips)\n\n      // set the track of clips we aren't moving\n      const newClips = clips.filter(clip => !movingClips.includes(clip))\n      newClips.forEach(clip => clip.track = this.index)\n\n      // remove all my current clips and replace with new ones in one step\n      this.clips.splice(0, this.clips.length, ...spliceClips)\n    }\n\n    frameForClipsNearFrame(clips, frame = 0) {\n      // TODO: make range that includes all clips\n\n      // find next stretch after frame that fits range\n\n      const others = this.clips.filter(clip => !clips.includes(clip))\n\n      return frame\n    }\n\n    removeClips(clips) {\n      const spliceClips = this.clips.filter(clip => !clips.includes(clip))\n      if (spliceClips.length === this.clips.length) {\n        console.log(\"removeClips\", this.type, this.index, this.clips)\n        throw Errors.internal + JSON.stringify(clips)\n      }\n      clips.forEach(clip => clip.track = -1)\n      this.sortClips(spliceClips)\n      this.clips.splice(0, this.clips.length, ...spliceClips)\n    }\n\n    sortClips(clips) {\n      clips ||= this.clips\n      if (this.isMainVideo) {\n        let frame = 0\n        clips.forEach((clip, i) => {\n          const is_transition = clip.type === TrackType.transition\n          if (i && is_transition) frame -= clip.frames\n          clip.frame = frame\n          if (!is_transition) frame += clip.frames\n        })\n      }\n      clips.sort(byFrame)\n    }\n\n    toJSON() {\n      return { type: this.type, index: this.index, clips: this.clips }\n    }\n}\n\nexport { Track }\n","import { Factory } from \"./Factory\"\nimport { Errors } from \"../Setup\"\nimport { Is } from \"../Utilities\"\nimport { Track } from \"../Track\"\n\nclass TrackFactoryClass extends Factory {\n  create(object, mash) {\n    if (!Is.object(object)) throw(Errors.object)\n    if (object instanceof Track) return object\n\n    //if (!Is.instanceOf(mash, Mash)) throw(Errors.mash)\n\n    return new Track(object, mash)\n  }\n}\n\nconst TrackFactory = new TrackFactoryClass\nexport { TrackFactory }\n","import { Base } from \"../Base\"\nimport { id } from \"../Base/with/id\"\nimport { MediaFactory } from \"../Factory/MediaFactory\"\nimport { TimeRangeFactory } from \"../Factory/TimeRangeFactory\"\nimport { FilterFactory } from \"../Factory/FilterFactory\"\nimport { TrackFactory } from \"../Factory/TrackFactory\"\nimport { UrlsByType } from \"../Loading\"\nimport { TimeFactory } from \"../Factory/TimeFactory\"\nimport { Clip } from \"../Clip\"\nimport { Is, byFrame } from \"../Utilities\"\nimport { Default, Module, Errors } from \"../Setup\"\nimport {\n  EventType,\n  MediaType,\n  TrackType,\n  TrackTypes\n} from \"../Setup\"\n\nconst MashProperty = {\n  label: \"label\",\n  backcolor: \"backcolor\",\n}\n\nclass Mash extends Base {\n  static get properties() { return Object.values(MashProperty) }\n\n  get audio() { return this.__audio ||= this.initializeAudio }\n\n  get backcolor() {\n    return this.__backcolor ||= this.object.backcolor || Default.mash.backcolor\n  }\n  set backcolor(value) { this.__backcolor = value }\n\n  get clips() { return this.tracks.map(track => track.clips).flat() }\n\n  get clipsAudible() { return this.clips.filter(clip => clip.audible) }\n\n  get clipsAudio() { return this.audio.map(track => track.clips).flat() }\n\n  get clipsVideo() { return this.video.flatMap(track => track.clips) }\n\n  get events() { return this.__events ||= this.object.events }\n  set events(value) { this.__events = value }\n\n  /** mash duration in frames */\n  get frames() {\n    return Math.max(0, ...this.tracks.map(track => track.frames))\n  }\n\n  get initializeAudio() {\n    const array = this.object.audio || [{ type: TrackType.audio }]\n    return array.map(track => TrackFactory.create(track, this))\n  }\n\n  get initializeMedia() {\n    const array = this.object.media || []\n    return array.map(media => MediaFactory.create(media))\n  }\n\n  get initializeVideo() {\n    const array = this.object.video || [{ type: TrackType.video }]\n    return array.map(track => TrackFactory.create(track, this))\n  }\n\n  get initialMedia() { return this.__initialMedia ||= this.initializeMedia }\n\n  get label() { return this.__label ||= this.object.label || Default.mash.label }\n  set label(value) { this.__label = value }\n\n  get media() {\n    return [...new Set(this.clips.flatMap(clip => this.mediaForClip(clip)))]\n  }\n\n  get propertyValues() {\n    return Object.fromEntries(Mash.properties.map(key => [key, this[key]]))\n  }\n\n  get quantize() { return this.__quantize ||= this.object.quantize || Default.mash.quantize }\n\n  /** combined audio and video tracks */\n  get tracks() { return TrackTypes.map(av => this[av]).flat() }\n\n  get type() { return \"mash\" }\n\n  get video() { return this.__video ||= this.initializeVideo }\n\n  addClipsToTrack(clips, trackIndex = 0, insertIndex = 0) {\n    trackIndex ||= 0\n    insertIndex ||= 0\n    const [clip] = clips\n    // console.log(\"addClipsToTrack trackIndex\", trackIndex, \"insertIndex:\", insertIndex)\n    const newTrack = this.clipTrackAtIndex(clip, trackIndex)\n    const oldTrack = this.clipTrack(clip)\n\n    this.emitIfFramesChange(() => {\n      if (oldTrack && oldTrack !== newTrack) {\n        // console.log(\"addClipsToTrack\", newTrack.index, oldTrack.index)\n        oldTrack.removeClips(clips)\n      }\n      newTrack.addClips(clips, insertIndex)\n    })\n  }\n\n  addTrack(trackType) {\n    const array = this[trackType]\n    const options = { type: trackType, index: array.length }\n    const track = TrackFactory.create(options, this)\n    array.push(track)\n    return track\n  }\n\n  changeClipFrames(clip, value) {\n    let limited_value = Math.max(1, value) // frames value must be > 0\n\n    if (TrackTypes.includes(clip.type)) {\n      const max = Math.floor(clip.media.duration * this.quantize) - clip.trim\n      limited_value = Math.min(max, limited_value)\n    }\n    const track = this.clipTrack(clip)\n    this.emitIfFramesChange((changeClipFrames) => {\n      clip.frames = limited_value\n      track.sortClips()\n    })\n  }\n\n  changeClipTrim(clip, value, frames) {\n    let limited_value = Math.max(0, value)\n\n    if (TrackTypes.includes(clip.type)) { // trim not remove last frame\n      const max = Math.floor(clip.media.duration * this.quantize) - 1\n      limited_value = Math.min(max, limited_value)\n    }\n    const new_frames = frames - limited_value\n    const track = this.clipTrack(clip)\n    this.emitIfFramesChange(() => {\n      clip.trim = limited_value\n      clip.frames = new_frames\n      track.sortClips()\n    })\n  }\n\n  clipIntersects(clip, range) {\n    return clip.timeRange(this.quantize).intersects(range)\n  }\n\n  clipTrack(clip) {\n    return this.clipTrackAtIndex(clip, clip.track)\n  }\n\n  clipTrackAtIndex(clip, index = 0) {\n    return this.trackOfTypeAtIndex(clip.trackType, index)\n  }\n\n  clipsAudibleAtTime(time) { return this.clipsWithin(time, true, false) }\n\n  clipsAudibleInTimeRange(timeRange) {\n    const range = timeRange.scale(this.quantize)\n    return this.clips.filter(clip =>\n      clip.audible && this.clipIntersects(clip, range)\n    )\n  }\n\n  clipsVisibleAtTime(time) { return this.clipsWithin(time, false) }\n\n  clipsVisibleInTimeRange(timeRange) {\n    const range = timeRange.scale(this.quantize)\n    return this.clipsVideo.filter(clip => this.clipIntersects(clip, range))\n  }\n\n  clipsWithin(time, includeAudible = true, includeVisible = true) {\n    const range = TimeRangeFactory.create(time)\n    if (!includeAudible) return this.clipsVisibleInTimeRange(range)\n    if (!includeVisible) return this.clipsAudibleInTimeRange(range)\n\n    return this.clips.filter(clip => this.clipIntersects(clip, range))\n  }\n\n  emitDuration() {\n    const info = {\n      value: TimeFactory.createFromFrame(this.frames, this.quantize).seconds\n    }\n    // console.log(this.constructor.name, \"emitDuration\", info)\n    this.events.emit(EventType.duration, info)\n  }\n\n  emitIfFramesChange(method) {\n    const frames = this.events ? this.frames : null\n    // console.log(this.constructor.name, \"emitIfFramesChange\", frames)\n    method()\n    if (this.events && frames !== this.frames) this.emitDuration()\n    // else console.log(this.constructor.name, \"emitIfFramesChange\", !!this.events, frames, this.frames)\n  }\n\n  findInitialMedia(mediaId) {\n    return this.initialMedia.find(media => media.id === mediaId)\n  }\n\n  findClipMedia(mediaId) {\n    return this.media.find(media => media.id === mediaId)\n  }\n\n  findMedia(mediaId) {\n    if (!(Is.string(mediaId) && mediaId.length)) return\n    const found = this.findInitialMedia(mediaId)\n    if (found) return found\n\n    return this.findClipMedia(mediaId)\n  }\n\n  filterClipSelection(value) {\n    const array = Is.array(value) ? value : [value]\n    const clips = array.filter(clip => Is.instanceOf(clip, Clip))\n    const [firstClip] = clips\n    // console.log(\"filterClipSelection\", clips)\n    if (!firstClip) return []\n\n    const { trackType, track } = firstClip\n\n    // selected clips must all be on same track\n    const trackClips = clips.filter(clip =>\n      clip.track === track && clip.trackType === trackType\n    ).sort(byFrame)\n\n    if (track || trackType === TrackType.audio) return trackClips\n\n    // selected clips on main track must be abutting each other\n    let abutting = true\n    return trackClips.filter((clip, index) => {\n      if (!abutting) return\n\n      if (index === trackClips.length - 1) return true\n\n      abutting = clip.frame + clip.frames === trackClips[index + 1].frame\n      if (!abutting) console.log(this.constructor.name, \"filterClipSelection\", clip.frame + clip.frames, \"!==\", trackClips[index + 1].frame)\n      return true\n    })\n  }\n  mediaForClip(clip) {\n    const medias = []\n    const media = clip.media\n    if (!Is.object(media)) throw \"CLIP HAS NO MEDIA \" + clip\n    medias.push(media)\n    if (clip.scaler) medias.push(clip.scaler.media)\n    if (clip.merger) medias.push(clip.merger.media)\n\n    if (media.modular) {\n      const properties_by_type = media.modularPropertiesByType\n      Object.keys(properties_by_type).forEach(type => {\n        const modular_properties = properties_by_type[type]\n        modular_properties.forEach(key => {\n          const found = this.searchMedia(clip[key], type)\n          if (found) medias.push(found)\n        })\n      })\n    }\n    switch(media.type){\n      case MediaType.transition: {\n        medias.push(...this.mediaForClipTransform(clip.to))\n        medias.push(...this.mediaForClipTransform(clip.from))\n        break\n      }\n      case MediaType.effect:\n      case MediaType.audio: break\n      default: {\n        medias.push(...this.mediaForClipTransform(clip))\n        const effects = clip.effects\n        if (!effects) break\n        effects.forEach(effect => {\n          medias.push(...this.mediaForClip(effect))\n        })\n      }\n    }\n    return medias\n  }\n\n  mediaForClipTransform(object){\n    const medias = []\n    if (Is.object(object)) {\n      [MediaType.merger, MediaType.scaler].forEach(key => {\n        const merger_or_scaler = object[key]\n        if (Is.object(merger_or_scaler)) {\n          const found = this.searchMedia(merger_or_scaler.id, key)\n          if (found) medias.push(found)\n        }\n      })\n    }\n    return medias\n  }\n\n  mediaReferences() {\n    const references = {}\n    this.clips.forEach(clip => {\n      this.mediaForClip(clip).forEach(media => {\n        references[media.id] ||= 0\n        references[media.id]++\n      })\n    })\n    return references\n  }\n\n  removeClipsFromTrack(clips) {\n    const [clip] = clips\n    const track = this.clipTrack(clip)\n    this.emitIfFramesChange(() => track.removeClips(clips))\n  }\n\n  removeTrack(trackType) {\n    const array = this[trackType]\n    this.emitIfFramesChange(() => array.pop())\n  }\n\n  searchMedia(mediaId, moduleType) {\n    const found = this.findInitialMedia(mediaId)\n    if (found) return found\n\n    switch (moduleType) {\n      case MediaType.filter:\n        return FilterFactory.created(mediaId) ? FilterFactory.create(mediaId) : Module.defaultOfType(moduleType)\n    }\n    const module = Module.defaultOfType(moduleType)\n    if (module) return module\n\n    return this.findClipMedia(mediaId)\n  }\n\n  toJSON() {\n    return {\n      label: this.label,\n      quantize: this.quantize,\n      backcolor: this.backcolor,\n      id: this.id,\n      media: this.media,\n      audio: this.audio,\n      video: this.video,\n    }\n  }\n\n  trackOfTypeAtIndex(trackType, index = 0) {\n    if (index < 0) return\n    // console.log(this.constructor.name, \"trackOfTypeAtIndex\", trackType, index)\n    if (Is.not(trackType)) throw Errors.type\n\n    return this[trackType][index]\n  }\n\n  urlsAudibleInTimeRangeForClipsByType(timeRange, clips) {\n    const range = timeRange.scale(this.quantize)\n    const urls = new UrlsByType\n    clips.forEach(clip => urls.concat(clip.urlsAudibleInTimeRangeByType(range)))\n    return urls\n  }\n\n  urlsForClipsWithin(clips, time, includeAudible = true, includeVisible = true) {\n    const range = TimeRangeFactory.create(time)\n    const urls = new UrlsByType\n\n    if (!includeAudible) urls.concat(this.urlsVisibleInTimeRangeForClipsByType(range, clips))\n    if (!includeVisible) urls.concat(this.urlsAudibleInTimeRangeForClipsByType(range, clips))\n\n    return urls\n  }\n\n  urlsVisibleInTimeRangeForClipsByType(timeRange, clips) {\n    const range = timeRange.scale(this.quantize)\n    const urls = new UrlsByType\n    clips.forEach(clip => urls.concat(clip.urlsVisibleInTimeRangeByType(range)))\n    return urls\n  }\n\n  urlsWithin(time, includeAudible = true, includeVisible = true) {\n    const clips = this.clipsWithin(time, includeAudible, includeVisible)\n    return this.urlsForClipsWithin(clips, time, includeAudible, includeVisible)\n  }\n}\n\nObject.defineProperties(Mash.prototype, {\n  ...id,\n})\n\nexport { Mash }\n","import { Base } from \"../Base\"\nimport { Errors } from \"../Setup\"\nimport { Is } from \"../Utilities\"\n\nclass Events extends Base {\n  constructor(object) {\n    super(object)\n    this.methods = new Set\n  }\n\n  get target() { return this.object.target }\n  set target(value) { \n    if (this.object.target !== value) {\n      if (!Is.instanceOf(value, EventTarget)) throw Errors.object\n\n      const methods = new Set(this.methods)\n\n      methods.forEach(this.removeListener, this)\n      this.object.target = value\n      methods.forEach(this.addListener, this)      \n    }\n  }\n\n  addListener(method) { \n    if (this.methods.add(method)) {\n      this.target && this.target.addEventListener(Events.type, method) \n    }\n  }\n\n  emit(type, info = {}) {\n    const detail = { type, ...info }\n    const event = { detail }\n    this.target && this.target.dispatchEvent(new CustomEvent(Events.type, event))\n  }\n\n  removeListener(method) { \n    if (this.methods.delete(method)) {\n      this.target && this.target.removeEventListener(Events.type, method) \n    }\n  }\n}\n\nObject.defineProperties(Events, { type: { value: \"masher\" } })\n\nexport { Events }","import { Context } from \"../../Utilities\"\n\nexport const contexts = {\n  videoContext: { \n    get: function() { \n      this.__videoContext ||= this.object.videoContext || Context.createVideo()\n      return this.__videoContext\n    },\n    set: function(value) { \n      this.__videoContext = value \n      if (this.composition) this.composition.videoContext = value\n    }\n  },\n  audioContext: { \n    get: function() { \n      this.__audioContext ||= this.object.audioContext || Context.createAudio()\n      return this.__audioContext\n    },\n    set: function(value) { \n      this.__audioContext = value \n      if (this.composition) this.composition.audioContext = value\n    }\n  },\n}\n","import { Base } from \"../Base\"\nimport { Cache } from \"../Loading\"\nimport { contexts } from \"../Base/with/contexts\"\nimport { Default, Errors, ClipType } from \"../Setup\"\nimport { Pixel, byTrack, Is, Time } from \"../Utilities\"\nimport { TimeFactory } from \"../Factory/TimeFactory\"\nimport { TimeRangeFactory } from \"../Factory/TimeRangeFactory\"\n\nconst throwUnlessClipsDrawable = (clips) => {\n  clips.forEach(clip => {\n    if (!clip.frames) throw Errors.frames + JSON.stringify(clip)\n  })\n}\n\nclass Composition extends Base {\n  constructor(object) {\n    // console.log(\"Composition\", object)\n    super(object)\n    this.object.bufferSeconds ||= Default.bufferSeconds\n    this.paused = true\n    this.playing = false\n    this.sourcesByClip = new Map\n    this.__mashSeconds = 0\n    this.__contextSeconds = 0\n  }\n\n  get audible() { return !this.paused && !!this.audioContext }\n\n  get bufferedTime() { return this.urlsAtTime.loaded }\n\n  get bufferedTimeRange() {\n    return this.urlsInTimeRange.loaded\n  }\n\n  get bufferSeconds() { return this.object.bufferSeconds }\n  set bufferSeconds(value) { this.object.bufferSeconds = value }\n\n  get clipsAtTime() {\n    return this.mash.clipsWithin(this.time, this.audible, this.visible)\n  }\n\n  get clipsInTimeRange() {\n    return this.mash.clipsWithin(this.timeRange, this.audible, this.visible)\n  }\n\n  get configured() { return this.time && this.mash && (this.videoContext || this.audioContext) }\n\n  get gain() {\n    if (Is.undefined(this.__gain)) this.__gain = this.__gainInitialize\n    return this.__gain\n  }\n  get __gainInitialize() {\n    return Is.defined(this.object.gain) ? this.object.gain : Default.volume\n  }\n  set gain(value) {\n    if (this.__gain !== value) {\n      this.__gain = value\n      if (!this.playing) return\n\n      this.clipsAtTime.forEach(this.adjustSourceGain)\n    }\n  }\n\n\n  get mash() { return this.object.mash }\n  set mash(value) { this.object.mash = value }\n\n  get quantize() { return this.mash ? this.mash.quantize : 1 }\n\n  get seconds() {\n    const ellapsed = this.audioContext.currentTime - this.__contextSeconds\n    return ellapsed + this.__mashSeconds\n  }\n\n  get time() { return this.__time }\n  set time(value) {\n    if (!Is.instanceOf(value, Time)) throw(Errors.time)\n\n    this.__time = value\n  }\n\n  get timeRange() {\n    const buffer_time = TimeFactory.createFromSeconds(this.bufferSeconds)\n    const end_time = this.time.add(buffer_time)\n    return TimeRangeFactory.createFromTimes(this.time, end_time)\n  }\n\n  get timeRangeAtTime() { return TimeRangeFactory.createFromTime(this.time) }\n\n\n  get urlsAtTime() {\n    return this.urlsInTimeRangeByType(this.timeRangeAtTime)\n  }\n\n  get urlsInTimeRange() {\n    return this.urlsInTimeRangeByType(this.timeRange)\n  }\n\n  get visible() { return !!this.videoContext }\n\n  adjustSourceGain(clip) {\n    const source = this.sourcesByClip.get(clip)\n    if (Is.undefined(source)) return\n\n    const { gainNode } = source\n    if (this.gain === 0.0) return gainNode.gain.value = 0.0\n\n    const { gain } = clip\n    if (!Is.array(gain)) return gainNode.gain.value = gain * this.gain\n\n    // time/gain pairs...\n    const times = this.clipTiming(clip)\n    const { start, duration } = times\n    gainNode.cancelScheduledValues(0)\n    const gains = gain.split(',')\n    const z = gains.length / 2\n    for (let i = 0; i < z; i++) {\n      const position = gains[i * 2]\n      const value = this.gain * gains[i * 2 + 1]\n      const seconds = start + position * duration\n      gainNode.gain.linearRampToValueAtTime(value, seconds)\n    }\n  }\n\n  clipsToDraw(throwIfUncached) {\n    const clips = this.clipsAtTime\n    throwUnlessClipsDrawable(clips)\n    const urls = this.urlsInTimeRangeByType(this.timeRangeAtTime)\n    if (!urls.loaded) {\n      if (!throwIfUncached) return\n\n      throw Errors.uncached + urls.urlsUnloaded[0]\n    }\n    return clips\n  }\n\n  clipTiming(clip) {\n    const result = { offset: 0 }\n    const range = clip.timeRange(this.quantize)\n    const zero_seconds = this.__contextSeconds - this.__mashSeconds\n    result.start = zero_seconds + range.seconds\n\n    result.duration = range.lengthSeconds\n    if (clip.trim) {\n      range.frame = clip.trim\n      result.offset = range.seconds\n    }\n    const now = this.audioContext.currentTime\n    if (now > result.start) {\n      const dif = now - result.start\n      result.start = now\n      result.offset += dif\n      result.duration -= dif\n    }\n    return result\n  }\n\n  createSources() {\n    const clips = this.clipsInTimeRange\n    const filtered_clips = clips.filter(clip => !this.sourcesByClip.has(clip))\n    filtered_clips.forEach(clip => {\n      const media = clip.media\n      const url = media.urlAudible\n      if (url && Cache.cached(url)) {\n        const times = this.clipTiming(clip)\n        const { start, duration, offset } = times\n        if (Is.positive(start) && Is.positive(duration) && duration > 0) {\n          const gainSource = this.audioContext.createBufferSource()\n          gainSource.buffer = Cache.get(url)\n\n          const gainNode = this.audioContext.createGain()\n          gainSource.connect(gainNode)\n          gainNode.connect(this.audioContext.destination)\n          gainSource.start(start, offset, duration)\n\n          this.sourcesByClip.set(clip, { gainSource, gainNode })\n\n          this.adjustSourceGain(clip)\n\n        }\n      }\n    })\n  }\n\n  destroySources(clipsToKeep = []) {\n    this.sourcesByClip.forEach((source, clip) => {\n      if (clipsToKeep.includes(clip)) return\n\n      const { gainSource, gainNode } = source\n      gainNode.disconnect(this.audioContext.destination)\n      gainSource.disconnect(gainNode)\n      this.sourcesByClip.delete(clip)\n    })\n  }\n\n  draw() {\n    // console.log(this.constructor.name, \"draw\")\n    if (!this.configured) return\n\n    this.drawClips(this.time, this.clipsToDraw(true))\n  }\n\n  drawBackground(context) {\n    if (!Is.objectStrict(context)) throw Errors.internal\n\n    context.clearRect(0, 0, context.canvas.width, context.canvas.height)\n    context.fillStyle = Pixel.color(this.mash.backcolor)\n    context.fillRect(0, 0, context.canvas.width, context.canvas.height)\n  }\n\n  drawClips(time, clips) {\n    // console.log(this.constructor.name, \"drawClips\", time, clips)\n    const main = clips.filter(clip => clip.visible && clip.track === 0)\n    this.drawBackground(this.videoContext) // fill canvas with mash background color\n    if (main.length > 1) {\n      const transition = main.find(clip => clip.type === ClipType.transition)\n      if (!transition) throw Errors.mainTrackOverlap\n\n      const transitioned = main.filter(clip => clip.type !== ClipType.transition)\n      transition.mergeContextAtTime(time, this.videoContext, this.mash.backcolor, transitioned)\n    } else {\n      const [mainClip] = main\n      if (mainClip) mainClip.mergeContextAtTime(time, this.videoContext)\n    }\n    const tracked = clips.filter(clip => !main.includes(clip)).sort(byTrack)\n    tracked.forEach(clip => {\n      clip.mergeContextAtTime(time, this.videoContext)\n    })\n  }\n\n  drawFrame() {\n    // console.log(this.constructor.name, \"drawFrame\")\n    if (!this.configured) return\n\n    const clips = this.clipsToDraw()\n    if (Is.undefined(clips)) {\n      this.loadTimeRange()\n      return\n    }\n\n    requestAnimationFrame(() => this.drawClips(this.time, clips))\n    return true\n  }\n\n  loadTimeRange() {\n    if (this.audible) {\n      this.createSources()\n      this.destroySources(this.clipsInTimeRange)\n    }\n    const urls = this.urlsInTimeRangeByType(this.timeRange)\n    return urls.load(this.audioContext)\n  }\n\n  urlsInTimeRangeByType(timeRange) {\n    return this.mash.urlsWithin(timeRange, this.audible, this.visible)\n  }\n\n  loadTime() {\n    const urls = this.urlsInTimeRangeByType(this.time)\n    return urls.load(this.audioContext)\n  }\n\n  startPlaying() {\n    console.log(this.constructor.name, \"startPlaying\")\n    if (this.__bufferSource) throw Errors.internal\n    if (this.playing) throw Errors.internal\n    this.playing = true\n\n    this.__bufferSource = this.audioContext.createBufferSource()\n    this.__bufferSource.loop = true\n    this.__bufferSource.buffer = this.audioContext.createBuffer(2, 44100, 44100)\n    this.__bufferSource.connect(this.audioContext.destination)\n\n    this.__mashSeconds = this.time.seconds\n    this.__contextSeconds = this.audioContext.currentTime\n\n    console.log(\"__mashSeconds\", this.__mashSeconds)\n    console.log(\"__contextSeconds\", this.__contextSeconds)\n\n    this.createSources()\n\n    this.__bufferSource.start(0)\n  }\n\n  stopPlaying() {\n    console.log(this.constructor.name, \"stopPlaying\")\n\n    if (!this.playing) return\n\n    this.playing = false\n    if (this.__bufferSource) this.__bufferSource.stop()\n\n    this.destroySources()\n    this.__mashSeconds = 0\n    this.__contextSeconds = 0\n\n    if (!this.__bufferSource) return\n\n    this.__bufferSource.disconnect(this.audioContext.destination)\n    this.__bufferSource = null\n  }\n\n}\n\nObject.defineProperties(Composition.prototype, {\n  ...contexts,\n})\n\nexport { Composition }\n","import { Factory } from \"./Factory\"\n\nimport {\n  AddTrackAction,\n  MoveClipsAction,\n  AddClipToTrackAction,\n  AddEffectAction,\n  ChangeAction,\n  ChangeFramesAction,\n  ChangeTrimAction,\n  SplitAction,\n  FreezeAction,\n  MoveEffectsAction,\n  RemoveClipsAction,\n  Action,\n} from \"../Action\"\nimport { Is } from \"../Utilities\"\n\nconst ActionTypes = [\n  'addTrack',\n  'addClipsToTrack',\n  'moveClips',\n  'addEffect',\n  'change',\n  'changeFrames',\n  'changeTrim',\n  'changeGain',\n  'moveEffects',\n  'split',\n  'freeze',\n  'removeClips',\n]\nconst ActionType = Object.fromEntries(ActionTypes.map(type => [type, type]))\n\nclass ActionFactory extends Factory {\n  constructor() {\n    super(Action)\n    this.install(ActionType.addTrack, AddTrackAction)\n    this.install(ActionType.addClipsToTrack, AddClipToTrackAction)\n    this.install(ActionType.moveClips, MoveClipsAction)\n    this.install(ActionType.addEffect, AddEffectAction)\n    this.install(ActionType.change, ChangeAction)\n    this.install(ActionType.changeFrames, ChangeFramesAction)\n    this.install(ActionType.changeTrim, ChangeTrimAction)\n    this.install(ActionType.split, SplitAction)\n    this.install(ActionType.freeze, FreezeAction)\n    this.install(ActionType.moveEffects, MoveEffectsAction)\n    this.install(ActionType.removeClips, RemoveClipsAction)\n  }\n\n  createFromObjectMasher(object, masher) {\n    const defaults = {\n      mash: \"\",\n      undoSelectedClips: \"selectedClips\",\n      undoSelectedEffects: \"selectedEffects\",\n      redoSelectedClips: \"selectedClips\",\n      redoSelectedEffects: \"selectedEffects\",\n    }\n    const clone = { ...object }\n    Object.entries(defaults).forEach(entry => {\n      const [key, value] = entry\n      if (Is.defined(object[key])) return\n\n      if (Is.emptystring(value)) clone[key] = masher[key]\n      else clone[key] = [...masher[value]]\n    })\n\n    return this.createFromObject(clone)\n  }\n}\n\nObject.defineProperties(ActionFactory.prototype, {\n  type: { value: ActionType },\n  types: { value: ActionTypes },\n})\n\nconst ActionFactoryInstance = new ActionFactory\nexport { ActionFactoryInstance as ActionFactory }\n","import { Errors } from \"../../Setup/Errors\"\nimport { Id } from \"../../Utilities/Id\"\n\nexport const deprecated = {\n  uuid: { value: function() { return Id() } },\n  canvas_context: {\n    get: function() { \n      console.warn(Errors.deprecation.canvas_context.get)\n      return this.videoContext\n    },\n    set: function(value) { \n      console.warn(Errors.deprecation.canvas_context.set)\n      this.videoContext = value \n    }\n  },\n  buffertime: {\n    get: function() { return this.buffer },\n    set: function(value) { this.buffer = value }\n  },\n  minbuffertime: {\n    get: function() { return this.buffer },\n    set: function(value) { this.buffer = value }\n  },\n}\n","import { Base } from \"../Base\"\nimport { Errors } from \"../Setup\"\nimport { Is } from \"../Utilities\"\nimport { ChangeAction } from \"../Action\"\nimport { Actions } from \"../Actions\"\nimport { Mash } from \"../Mash\"\nimport { ClipFactory } from \"../Factory/ClipFactory\"\nimport { MediaFactory } from \"../Factory/MediaFactory\"\nimport { TimeFactory } from \"../Factory/TimeFactory\"\nimport { TimeRangeFactory } from \"../Factory/TimeRangeFactory\"\nimport { Context } from \"../Utilities\"\nimport { Throw } from \"../Utilities\"\nimport { Events } from \"../Events\"\nimport { Default } from \"../Setup\"\nimport { Composition } from \"../Composition\"\nimport { Clip } from \"../Clip\"\nimport { ActionFactory } from \"../Factory/ActionFactory\"\nimport { Effect } from \"../Transform\"\nimport {\n  TrackType,\n  MediaType,\n  EventType,\n  TransformTypes,\n  MoveType,\n  TrackTypes\n} from \"../Setup\"\n\nimport { deprecated } from \"./with/deprecated\"\nimport { contexts } from \"../Base/with/contexts\"\n\n\nconst MasherProperty = {\n  autoplay: \"autoplay\",\n  precision: \"precision\",\n  loop: \"loop\",\n  fps: \"fps\",\n  volume: \"volume\",\n  buffer: \"buffer\",\n}\n\n\nconst clipCanBeSplit = (clip, time, quantize) => {\n  if (!Is.object(clip)) return\n\n  // true if now intersects clip time, but is not start or end frame\n  let range = TimeRangeFactory.createFromTime(time)\n  const clip_range = clip.timeRange(quantize)\n\n  // ranges must intersect\n  if (!clip_range.intersects(range)) return\n\n  const scaled = range.scale(clip_range.fps)\n  if (scaled.frame === clip_range.frame) return\n  if (scaled.end === clip_range.end) return\n\n  return true\n}\n\n// TODO: support Layers, made up of Rolls (a, b)\nclass Masher extends Base {\n\n  constructor(object = {}) {\n    super(object)\n\n    this.object.canvas ||= Context.createCanvas()\n\n    this.events = new Events({ target: this.canvas })\n    this.events.addListener(this.handleMasher.bind(this))\n\n    // console.log(\"events:\", this.events)\n    this.__load_timer = false\n    this.__moving = false\n    this.__muted = false\n    this.__paused = true\n    this.__mashFrames = 0\n    this.__time = TimeFactory.createFromFrame(0, this.fps)\n    this.__drawnTime = TimeFactory.createFromFrame(0, this.fps)\n\n    const mash = this.object.mash || {}\n    this.object.mash = false\n    this.mash = mash\n  }\n\n  get action_index() { return this.__actions.index }\n\n\n  get autoplay() {\n    if (Is.undefined(this.__autoplay)) {\n      this.__autoplay = this.initializeProperty(MasherProperty.autoplay)\n    }\n    return this.__autoplay\n  }\n  set autoplay(value) { this.__autoplay = value }\n\n  // TODO: move me to Mash\n  get composition() {\n    if (!this.__composition) {\n      const options = {\n        bufferSeconds: this.buffer,\n        gain: this.gain,\n        mash: this.mash,\n        audioContext: this.audioContext,\n        videoContext: this.videoContext,\n      }\n      this.__composition = new Composition(options)\n      this.__composition.time = this.time\n    }\n    return this.__composition\n  }\n\n  get buffer() {\n    if (Is.undefined(this.__buffer)) {\n      // deprecated buffer properties\n      const properties = [MasherProperty.buffer, 'buffertime', 'minbuffertime']\n      this.__buffer = this.initializeProperty(...properties)\n    }\n    return this.__buffer\n  }\n  set buffer(value) {\n    if (this.__buffer !== value) {\n      this.__buffer = value\n      this.composition.bufferSeconds = value\n    }\n  }\n\n  get bufferedTimeRange() { return this.composition.bufferedTimeRange }\n\n  get canvas() { return this.videoContext.canvas }\n  set canvas(value) {\n    this.videoContext = Context.createVideo(value)\n    this.events.target = value\n  }\n\n  get configured() {\n    return this.mash && this.canvas\n  }\n\n  // time, but in seconds\n  get currentTime() { return this.time.seconds }\n  set currentTime(seconds) { this.time = TimeFactory.createFromSeconds(seconds, this.fps) }\n\n  get duration() { return TimeFactory.createFromFrame(this.__mashFrames, this.mash.quantize).seconds }\n\n  get endTime() { return this.mashEndTime.scale(this.fps, 'floor') }\n\n  get fps() {\n    if (Is.undefined(this.__fps)) {\n      this.__fps = this.initializeProperty(MasherProperty.fps)\n    }\n    return this.__fps\n  }\n  set fps(value) {\n    if (!Is.integer(value) || value < 1) throw(Errors.fps)\n\n    if (this.__fps !== value) {\n      this.__fps = value\n      this.__time = this.__time.scale(value)\n      this.__drawnTime = this.__drawnTime.scale(value)\n    }\n  }\n\n  get frame() { return this.time.frame }\n  set frame(value) {\n    // called from ruler to change position\n    //console.log('frame=', value, this.fps)\n\n    this.time = TimeFactory.createFromFrame(value, this.fps)\n    //console.log(\"time\", this.time)\n  }\n  // Math.round(Number(this.__mashFrames) / Number(this.mash.quantize) * Number(this.fps));}\n  get frames() { return this.mashEndTime.scale(this.fps).frame }\n\n  get gain() { return this.muted ? 0.0 : this.volume }\n\n  get loop() {\n    if (Is.undefined(this.__loop)) {\n      this.__loop = this.initializeProperty(MasherProperty.loop)\n    }\n    return this.__loop\n  }\n  set loop(value) { this.__loop = value }\n\n  get mash() { return this.__mash ||= this.object.mash }\n  set mash(object) {\n    // console.log(\"set mash\", object)\n\n    if (this.__mash === object) return\n\n    this.paused = true\n\n    this.__selectedEffects = []\n\n\n    this.__mash = new Mash(object)\n    this.__mash.events = this.events\n\n    this.__actions = new Actions({ mash: this.__mash, masher: this })\n\n    // console.log(\"set mash setting selectedClips\")\n    this.selectedClips = [] // so mash gets copied into __pristine\n\n    this.handleChangeMashFrames()\n\n    this.composition.mash = this.mash\n    this.time = TimeFactory.createFromSeconds(0, this.fps)\n\n    this.rebuffer()\n    this.redraw()\n    if (this.autoplay) this.paused = false\n  }\n\n  get mashEndTime() { return TimeFactory.createFromFrame(this.__mashFrames, this.mash.quantize) }\n\n  get muted() { return this.__muted }\n  set muted(value = false) {\n    this.__muted = value\n    this.handleGainChange()\n  }\n\n  get paused() { return this.__paused }\n  set paused(value) {\n    if (!this.__mashFrames) value = true\n    if (this.__paused !== value) {\n      this.__paused = value\n      this.composition.paused = value\n      if (this.__paused) {\n        this.__set_moving(false)\n        if (this.__buffer_timer) {\n          clearInterval(this.__buffer_timer)\n          this.__buffer_timer = 0\n        }\n      } else {\n        if (! this.__buffer_timer) {\n          this.__buffer_timer = setInterval(this.rebuffer, 2000)\n        }\n        this.rebuffer()\n        this.redraw()\n      }\n    }\n  }\n\n  get position() {\n    let per = 0\n    if (this.__time.frame) {\n      per = this.__time.seconds / this.duration\n      if (per !== 1) per = parseFloat(per.toFixed(this.precision))\n    }\n    return per\n  }\n  set position(value = 0) { this.time = TimeFactory.createFromSeconds(this.duration * value, this.fps) }\n\n  get position_step() {\n    const zeros = \"0\".repeat(this.precision - 1)\n    return parseFloat(`0.${zeros}1`)\n  }\n\n  get precision() {\n    if (Is.undefined(this.__precision)) {\n      this.__precision = this.initializeProperty(MasherProperty.precision)\n    }\n    return this.__precision\n\n  }\n  set precision(value) { this.__precision = value }\n\n  get selectedClip() {\n    if (this.__selectedClips.length === 1) return this.__selectedClips[0]\n  }\n  set selectedClip(value) { this.selectedClips = value }\n\n  get selectedClipOrMash() { return this.selectedClip || this.__mash }\n\n  get selectedClips() { return this.__selectedClips }\n\n  set selectedClips(value) {\n    this.__selectedClips = this.mash.filterClipSelection(value)\n    this.__pristine = this.selectedClipOrMash.propertyValues\n    this.selectedEffects = []\n  }\n\n  get selectedEffect() {\n    if (this.__selectedEffects.length === 1) return this.__selectedEffects[0]\n  }\n  set selectedEffect(value){\n    this.selectedEffects = Is.object(value)  && !Is.empty(value) ? [value] : []\n  }\n\n  get selectedEffects() { return this.__selectedEffects }\n  set selectedEffects(value) {\n    const effects = this.selectedClipOrMash.effects\n    if (!effects) { // mash or multiple clips selected, or no effects\n      this.__selectedEffects = []\n      this.__pristineEffect = {}\n      return\n    }\n\n    const array = Is.array(value) ? value : []\n    this.__selectedEffects = array.filter(effect => effects.includes(effect))\n    this.__pristineEffect = (this.selectedEffect && this.selectedEffect.propertyValues) || {}\n  }\n\n  get silenced() { return this.__paused || this.muted || !this.gain }\n\n  get stalling() { return !this.__moving && !this.paused }\n\n  get time() { return this.__time }\n  set time(value) {\n    const limited_time = this.__limit_time(value)\n    const equal = this.__time.equalsTime(limited_time)\n    this.__time = limited_time\n    this.composition.time = this.__time\n\n    if (!equal) this.handleChangeMash()\n  }\n\n  get urlsCached() { return this.composition.urlsInTimeRange }\n\n  get volume() {\n    if (Is.undefined(this.__volume)) {\n      this.__volume = this.initializeProperty(MasherProperty.volume)\n    }\n    return this.__volume\n  }\n  set volume(value) {\n    if (! Is.number(value)) throw(Errors.argument)\n\n    this.__volume = value\n    this.handleGainChange()\n  }\n\n  /**\n   * type - String audio|video|effect\n   */\n  add(object, addType, frameOrIndex, trackIndex) {\n    // console.log(\"add\", object, addType)\n    if (!Is.object(object)) throw Errors.argument + object\n    const type = Is.defined(addType) ? addType : object.type\n\n    if (type === MoveType.effect) {\n      return this.addEffect(new Effect(object), frameOrIndex)\n    }\n\n    const media = MediaFactory.create({ type, ...object })\n\n    const clip = ClipFactory.createFromObjectMedia(object, media, this.mash)\n    return this.addClip(clip, frameOrIndex, trackIndex)\n  }\n\n  addClip(clip, frameOrIndex, trackIndex) {\n    // console.log(\"addClip frameOrIndex\", clip, frameOrIndex)\n    Throw.unlessInstanceOf(clip, Clip)\n\n    const { trackType } = clip\n\n    const clips = [clip]\n    const options = {\n      clip,\n      type: ActionFactory.type.addClipsToTrack,\n      redoSelectedClips: clips,\n      trackType,\n    }\n    const track = this.mash.trackOfTypeAtIndex(trackType, trackIndex)\n    const trackCount = this.mash[trackType].length\n    if (trackIndex || trackType === TrackType.audio) {\n      options.trackIndex = trackIndex\n      clip.frame = track.frameForClipsNearFrame(clips, frameOrIndex)\n      options.createTracks = Math.max(0, trackIndex + 1 - trackCount)\n    } else {\n      options.insertIndex = frameOrIndex\n      options.createTracks = Math.min(1, Math.max(0, 1 - trackCount))\n    }\n    this.actionCreate(options)\n    return this.loadVisual().then(() => Promise.resolve(clip))\n  }\n\n  addEffect(effect, index) {\n    // console.log(this.constructor.name, \"addEffect\", object, index)\n    Throw.unlessInstanceOf(effect, Effect)\n\n    const effects = this.selectedClipOrMash.effects\n    Throw.unlessInstanceOf(effects, Array, Errors.selection)\n\n    const insertIndex = Is.integer(index) && index > 0 ? index : 0\n    const undoEffects = [...effects]\n    const redoEffects = [...effects]\n    redoEffects.splice(insertIndex, 0, effect)\n    const options = {\n      effects, undoEffects, redoEffects,\n      type: ActionFactory.type.moveEffects\n    }\n    this.actionCreate(options)\n    return this.loadVisual().then(() => Promise.resolve(effect))\n  }\n  /**\n   *\n   * @param {String} type audio or video\n   */\n  addTrack(trackType = TrackType.video) {\n    if (!TrackTypes.includes(trackType)) throw Errors.type + trackType\n\n    return this.actionCreate({ trackType, type: ActionFactory.type.addTrack })\n  }\n\n  can(method){\n    var should_be_enabled = false;\n    var z = this.__selectedClips.length;\n    switch(method){\n      case 'undo':{\n        should_be_enabled = this.__actions.canUndo\n        break;\n      }\n      case 'redo':{\n        should_be_enabled = this.__actions.canRedo\n        break;\n      }\n      case 'adjust':{\n        should_be_enabled = (z > 0);\n        if (should_be_enabled) should_be_enabled = (this.__selectedClips[0].track > 0);\n        break;\n      }\n      case 'copy':{\n        should_be_enabled = (z > 0);\n        break;\n      }\n      case 'cut':\n      case 'remove':{\n        should_be_enabled = (this.__selectedClips.length);\n        if (should_be_enabled) {\n          // TODO: test that removing won't create transition problem\n        }\n        break;\n      }\n      case 'split':{\n        should_be_enabled = clipCanBeSplit(this.selectedClip, this.time, this.mash.quantize)\n        break\n      }\n      case 'freeze':{\n        should_be_enabled = (z === 1)\n        should_be_enabled &&= MediaType.video === this.selectedClip.type\n        should_be_enabled &&= clipCanBeSplit(this.selectedClip, this.time, this.mash.quantize)\n        break;\n      }\n    }\n    return should_be_enabled;\n  }\n\n  currentActionReusable(target, property) {\n    if (!this.__actions.currentActionLast) return\n\n    const action = this.__actions.currentAction\n    if (!Is.instanceOf(action, ChangeAction)) return\n\n    if (!(action.target === target && action.property === property)) return\n\n    return action\n  }\n\n  change(property) {\n    if (!this.selectedClip) return this.changeMash(property)\n\n    return this.changeClip(property)\n  }\n\n  changeClip(property) {\n    if (!Is.string(property) || Is.empty(property)) throw Errors.property + property\n\n    const options = { property, target: this.selectedClip }\n    const [transform, transformProperty] = property.split(\".\")\n\n    if (transformProperty) {\n      // make sure first component is merger or scaler\n      if (!TransformTypes.includes(transform)) throw Errors.property + transform\n\n      if (transformProperty === 'id') {\n        options.property = transform\n        options.redoValue = options.target[options.property].id\n      }\n      else {\n        // we'll call merger/scaler set property\n        options.target = options.target[transform]\n        options.property = transformProperty\n        options.redoValue = options.target[options.property]\n      }\n      console.log(this.constructor.name, \"changeClip\", transform, transformProperty, this.__pristine)\n\n      options.undoValue = this.__pristine[transform][transformProperty]\n    } else {\n      options.undoValue = this.__pristine[property]\n      options.redoValue = options.target[options.property]\n    }\n\n    const action = this.currentActionReusable(options.target, options.property)\n    if (action) return action.updateAction(options.redoValue)\n\n    switch(options.property) {\n      case 'frames': {\n        options.type = ActionFactory.type.changeFrames\n        break\n      }\n      case 'trim': {\n        options.type = ActionFactory.type.changeTrim\n        break\n      }\n      default: options.type = ActionFactory.type.change\n    }\n    return this.actionCreate(options)\n  }\n\n  changeEffect(property) {\n    if (!Is.string(property) || Is.empty(property)) throw Errors.property\n\n    const target = this.selectedEffect\n    if (Is.undefined(target)) throw Errors.selection\n\n    const redoValue = target[property]\n    const action = this.currentActionReusable(target, property)\n    if (action) return action.updateAction(redoValue)\n\n    const undoValue = this.__pristineEffect[property]\n    const options = {\n      type: ActionFactory.type.change,\n      target, property, redoValue, undoValue\n    }\n    return this.actionCreate(options)\n  }\n\n  changeMash(property) {\n    if (!Mash.properties.includes(property)) throw Errors.unknownMash + property\n\n    const target = this.mash\n    const redoValue = this.mash[property]\n    const action = this.currentActionReusable(target, property)\n    if (action) return action.updateAction(redoValue)\n\n    const options = {\n      target,\n      property,\n      redoValue,\n      undoValue: this.__pristine[property],\n      type: ActionFactory.type.change,\n    }\n    // console.log(\"changeMash\", options)\n\n    return this.actionCreate(options)\n  }\n\n  delayedDraw() {\n    // console.log(\"Masher.delayedDraw\")\n    // called when assets are cached\n    if (!this.delayed_timer) {\n      this.delayed_timer = setTimeout(() => {\n        // console.log(this.constructor.name, \"delayedDraw timeout\", )\n        this.delayed_timer = null\n        this.redraw()\n      }, 50)\n    }\n  }\n\n  // call when player removed from DOM\n  destroy() { Mashers.delete(this) }\n\n  handleAction(type, action) {\n    this.events.emit(type, { action: action })\n  }\n\n  handleGainChange() { this.composition.gain = this.gain }\n\n  handleChangeMash(){\n    this.paused = true // make sure we are not playing\n    this.rebuffer()\n    this.redraw()\n  }\n\n  handleChangeMashFrames(){\n    // console.log(\"handleChangeMashFrames\")\n    const mash_frames = this.mash.frames\n    if (this.__mashFrames !== mash_frames) {\n      this.__mashFrames = mash_frames\n      // move back if we were positioned at a time later than new duration\n      const max_frame = Math.max(0, this.endTime.frame - 1)\n      if (max_frame < this.time.frame) this.frame = max_frame\n      else this.delayedDraw()\n    }\n  }\n\n  handleMasher(event) {\n    if (event.type !== Events.type) return console.warn(\"handleMasher\", event)\n    // console.log(\"handleMasher\", event.detail)\n\n    switch(event.detail.type) {\n      case EventType.duration: {\n        this.handleChangeMashFrames()\n        break\n      }\n      case EventType.action: {\n        const action = event.detail.action\n\n        this.selectedClips = action.selectedClips\n        this.selectedEffects = action.selectedEffects\n        switch (action.type) {\n          case ActionFactory.type.changeAction: {\n            if (action.property === \"gain\"){\n              if (this.__moving && !this.silenced) {\n                this.composition.adjustSourceGain(action.target)\n              }\n            }\n            break\n          }\n          default: this.delayedDraw()\n        }\n        break\n      }\n      default: {\n        this.delayedDraw()\n      }\n    }\n  }\n\n  handleRemoveActions(removedActions = []) {\n    const type = removedActions.length ? EventType.truncate : EventType.add\n    this.handleAction(type, this.__actions.currentAction)\n    this.handleChangeMash()\n    // TODO: deprecated - stop calling and remove did method\n    if (removedActions.length) this.did(removedActions.length)\n  }\n\n  initializeProperty(...properties) {\n    for (let property of properties) {\n      if (Is.defined(this.object[property])) return this.object[property]\n    }\n    return Default[properties[0]]\n  }\n\n  loadVisual() {\n    return this.composition.loadTime()\n  }\n  media(clip) { return clip.media }\n\n  move(objectOrArray, moveType, frameOrIndex, trackIndex) {\n    if (!Is.object(objectOrArray)) throw Errors.argument + objectOrArray\n\n    if (moveType === MoveType.effect) {\n      return this.moveEffects(objectOrArray, frameOrIndex)\n    }\n\n    return this.moveClips(objectOrArray, frameOrIndex, trackIndex)\n  }\n\n  moveEffects(effectOrArray, index = 0) {\n    // console.log(this.constructor.name, \"moveEffects\", effectOrArray, index)\n    if (!Is.positive(index)) throw Errors.argument + index\n\n    // Coerce.instanceArray?\n\n    const array = Is.array(effectOrArray) ? effectOrArray : [effectOrArray]\n    const moveEffects = array.filter(effect => Is.instanceOf(effect, Effect))\n    if (Is.emptyarray(moveEffects)) throw Errors.argument + effectOrArray\n\n    const effects = this.selectedClip.effects\n    const undoEffects = [...effects]\n\n    const redoEffects = []\n    undoEffects.forEach((effect, i) => {\n      if (i === index) redoEffects.push(...moveEffects)\n      if (moveEffects.includes(effect)) return\n\n      redoEffects.push(effect)\n    })\n\n    const options = {\n      effects, undoEffects, redoEffects,\n      type: ActionFactory.type.moveEffects\n    }\n    // console.log(this.constructor.name, \"moveEffects\", options)\n    return this.actionCreate(options)\n  }\n\n  moveClips(clipOrArray, frameOrIndex = 0, trackIndex = 0) {\n    // console.log(\"moveClips\", \"frameOrIndex\", frameOrIndex, \"trackIndex\", trackIndex)\n    if (!Is.positive(frameOrIndex)) throw Errors.argument + frameOrIndex\n    if (!Is.positive(trackIndex)) throw Errors.argument + trackIndex\n\n    const clips = this.mash.filterClipSelection(clipOrArray)\n    if (Is.emptyarray(clips)) throw Errors.argument + clipOrArray\n\n    const [firstClip] = clips\n    const { trackType, track: undoTrackIndex } = firstClip\n    const options = {\n      clips, trackType, trackIndex, undoTrackIndex,\n      type: ActionFactory.type.moveClips\n    }\n\n    const redoTrack = this.mash.trackOfTypeAtIndex(trackType, trackIndex)\n    const undoTrack = this.mash.trackOfTypeAtIndex(trackType, undoTrackIndex)\n    const currentIndex = redoTrack.clips.indexOf(firstClip)\n\n    if (redoTrack.isMainVideo) options.insertIndex = frameOrIndex\n    if (undoTrack.isMainVideo) {\n      options.undoInsertIndex = currentIndex\n      if (frameOrIndex < currentIndex) options.undoInsertIndex += clips.length\n    }\n\n    if (!(redoTrack.isMainVideo && undoTrack.isMainVideo)) {\n      const frames = clips.map(clip => clip.frame)\n      const insertFrame =  redoTrack.frameForClipsNearFrame(clips, frameOrIndex)\n      const offset = insertFrame - firstClip.frame\n      if (!offset) return // because there would be no change\n\n      options.undoFrames = frames\n      options.redoFrames = frames.map(frame => frame + offset)\n    }\n    return this.actionCreate(options)\n  }\n\n  pause() {\n    this.paused = true;\n  }\n\n  play() {\n    this.paused = false;\n  }\n\n  rebuffer() {\n    if (this.paused) return this.composition.loadTime()\n\n    return this.composition.loadTimeRange()\n  }\n\n  redo(){\n    if (this.__actions.canRedo) {\n      const action = this.__actions.redo()\n      this.handleChangeMash()\n    }\n  }\n\n  redraw() {\n    if (! this.configured) return\n\n    const video_buffered = this.composition.drawFrame()\n    const no_audio = !this.__moving || this.silenced\n    const audio_buffered = no_audio || this.composition.bufferedTime\n    // console.log(this.constructor.name, \"redraw audio_buffered:\", audio_buffered)\n    const all_buffered = video_buffered && audio_buffered\n\n    if (this.__moving !== all_buffered) {\n      if (this.__moving) this.__set_moving(false)\n      else if (!this.__paused && this.bufferedTimeRange) this.__set_moving(true)\n    }\n  }\n\n  draw() { return this.composition.draw() }\n\n  remove(objectOrArray, moveType) {\n    if (!Is.object(objectOrArray)) throw Errors.argument + objectOrArray\n\n    if (moveType === MoveType.effect) return this.removeEffects(objectOrArray)\n\n    return this.removeClips(objectOrArray)\n  }\n\n  removeClips(clipOrArray) {\n    const clips = this.mash.filterClipSelection(clipOrArray)\n    if (Is.emptyarray(clips)) throw Errors.argument + clipOrArray\n\n    const [firstClip] = clips\n    const track = this.mash.clipTrack(firstClip)\n    const options = {\n      clips, track, index: track.clips.indexOf(firstClip),\n      type: ActionFactory.type.removeClips\n    }\n    return this.actionCreate(options)\n  }\n\n  removeEffects(effectOrArray) {\n    const array = Is.array(effectOrArray) ? effectOrArray : [effectOrArray]\n    const removeEffects = array.filter(effect => Is.instanceOf(effect, Effect))\n    if (Is.emptyarray(removeEffects)) throw Errors.argument + effectOrArray\n\n    const effects = this.selectedClip.effects\n    const undoEffects = [...effects]\n    const redoEffects = effects.filter(effect => !removeEffects.includes(effect))\n\n    const options = {\n      redoSelectedEffects: [],\n      effects, undoEffects, redoEffects,\n      type: ActionFactory.type.moveEffects\n    }\n    return this.actionCreate(options)\n  }\n\n  select(object, toggle_selected) {\n    if (!object) {\n      // console.log(\"Masher.select FALSE\", object, toggle_selected)\n      this.selectedClip = false\n      return\n    }\n    // console.log('Masher.select TRUE', object, toggle_selected);\n    var media, i, array = [], key_array = '__selectedClips', key_prop = 'selectedClips';\n    media = this.mash.findMedia(object.id)\n    if (media){\n      if (MediaType.effect === media.type){\n        key_array = '__selectedEffects';\n        key_prop = 'selectedEffects';\n      }\n      if (toggle_selected) {\n        i = this[key_array].indexOf(object);\n        switch(this[key_array].length){\n          case 0: {\n            array.push(object);\n            break;\n          }\n          case 1: {\n            if (i > -1) break;\n          } // potential intentional fall through to default\n          default: {\n            if (i < 0) {\n              array.push(object);\n              array = array.concat(this[key_array]);\n            } else {\n              if (i) array = array.concat(this[key_array].slice(0, i));\n              if (i < (this[key_array].length - 1)) array = array.concat(this[key_array].slice(i + 1));\n            }\n          }\n\n        }\n      }\n      else {\n        if (-1 < this[key_array].indexOf(object)) return;\n        array.push(object);\n      }\n    }\n    // console.log('select', key_prop, array);\n    this[key_prop] = array;\n  }\n\n  selected(object) {\n    if (Is.instanceOf(object, Effect)) return this.selectedEffects.includes(object)\n\n    return this.selectedClips.includes(object)\n  }\n\n  selectEffect(effect, toggle_selected){\n    if (Is.object(effect)) return this.select(effect, toggle_selected);\n    else if (! toggle_selected) this.selectedEffect = effect;\n  }\n\n  split() {\n    const splitClip = this.selectedClip\n    if (!clipCanBeSplit(splitClip, this.time, this.mash.quantize)) return\n\n    const scaled = this.time.scale(this.mash.quantize)\n    const undoFrames = splitClip.frames\n    const redoFrames = scaled.frame - splitClip.frame\n    const insertClip = splitClip.copy\n    insertClip.frames = undoFrames - redoFrames\n    insertClip.frame = scaled.frame\n    if (splitClip.properties.includes(\"trim\")) insertClip.trim += redoFrames\n\n    const trackClips = this.mash.clipTrack(splitClip).clips\n    const options = {\n      type: ActionFactory.type.split,\n      splitClip,\n      insertClip,\n      trackClips,\n      redoFrames,\n      undoFrames,\n      index: 1 + trackClips.indexOf(splitClip),\n      redoSelectedClips: [insertClip],\n      undoSelectedClips: [splitClip],\n    }\n    return this.actionCreate(options)\n  }\n\n  freeze() {\n    const freezeClip = this.selectedClip\n    if (!clipCanBeSplit(freezeClip, this.time, this.mash.quantize)) return\n    if (MediaType.video !== freezeClip.type) return\n\n    const scaled = this.time.scale(this.mash.quantize)\n    const trackClips = this.mash.clipTrack(freezeClip).clips\n    const insertClip = freezeClip.copy\n    const frozenClip = freezeClip.copy\n\n    const options = {\n      frames: freezeClip.frames - (scaled.frame - freezeClip.frame),\n      freezeClip, frozenClip, insertClip, trackClips,\n      redoSelectedClips: [frozenClip],\n      index: 1 + trackClips.indexOf(freezeClip),\n      type: ActionFactory.type.freeze,\n    }\n\n    frozenClip.frame = scaled.frame\n    frozenClip.frames = 1\n    frozenClip.trim = freezeClip.trim + (scaled.frame - freezeClip.frame)\n    insertClip.frame = scaled.frame + 1\n    insertClip.frames = options.frames - 1\n    insertClip.trim = frozenClip.trim + 1\n\n    return this.actionCreate(options)\n  }\n\n  undo() {\n    if (this.__actions.canUndo) {\n      const action = this.__actions.undo()\n      this.handleChangeMash()\n    }\n  }\n\n\n  __limit_time(time) {\n    const scaled = time.scale(this.fps)\n    const end_time = this.mashEndTime.scale(this.fps)\n    if (scaled.frame > end_time.frame) return end_time\n\n    return scaled\n    // console.log(\"__limit_time\", time)\n    // var start_time = time.copy;\n    // var limit_time = this.mashEndTime\n    // limit_time.frame = Math.max(0, limit_time.frame - 1);\n    // start_time = start_time.min(limit_time);\n    // start_time = start_time.scale(this.fps, 'floor');\n    // return start_time;\n  }\n\n  __load_timed(){\n    // console.log(this.constructor.name, \"__load_timed moving: \", this.__moving)\n    if (this.__moving){\n      // hopefully runs twice a frame\n      var now = TimeFactory.createFromSeconds(this.composition.seconds, this.fps, 'ceil');\n      if (now.frame !== this.__limit_time(now).frame) {\n        // loop back to start or pause\n        if (! this.loop) {\n          this.paused = true;\n        } else {\n          this.frame = 0;\n          this.paused = false;\n        }\n      } else {\n        if (! now.equalsTime(this.__drawnTime)) {\n          this.__time = now.scale(this.fps)\n          this.redraw();\n        }\n      }\n    }\n  }\n\n  __set_moving(tf) {\n    // console.log(\"__set_moving\", tf)\n    if (this.__moving !== tf) {\n      this.__moving = tf;\n      if (this.__moving) {\n        var $this = this;\n        this.__load_timer = setInterval(() => {$this.__load_timed();}, 500 / this.fps);\n        // start up the sound buffer with our current time, rather than displayed\n        this.composition.startPlaying()\n        this.rebuffer() // get sounds buffering now, rather than next timer execution\n      } else {\n        this.composition.stopPlaying()\n        clearInterval(this.__load_timer)\n        this.__load_timer = false\n      }\n    }\n  }\n\n  actionCreate(object) {\n    const action = ActionFactory.createFromObjectMasher(object, this)\n    const removed = this.__actions.do(action)\n    this.handleRemoveActions(removed)\n  }\n}\n\n\n\n\nObject.defineProperties(Masher, {\n  type: { value: \"masher\" },\n  properties: { get: function() { return Object.values(MasherProperty) }}\n\n})\nObject.defineProperties(Masher.prototype, {\n  ...contexts,\n  ...deprecated,\n})\n\nexport { Masher }\n","import { Masher } from \"../Masher\";\nimport { Is } from \"../Utilities\";\nimport { Factory } from \"./Factory\";\nimport { UrlsByType, Cache } from \"../Loading\";\n\nconst MasherTypes = [\"masher\"]\nconst MasherType = Object.fromEntries(MasherTypes.map(type => [type, type]))\nconst INTERVAL_TICS = 10 * 1000\n\nclass MasherFactory extends Factory {\n  constructor() {\n    super()\n    this.install(MasherType.masher, Masher)\n  }\n\n  /**\n   *\n   * @param {Object} object containing options\n   * @returns Masher\n   */\n  create(object = MasherType.masher) {\n    const masher = super.create(object)\n    if (!this.mashers.length) this.start()\n    this.mashers.push(masher)\n    return masher\n  }\n}\n\nObject.defineProperties(MasherFactory.prototype, {\n  destroy: {\n    value: function(masher) {\n      const index = this.mashers.indexOf(masher)\n      if (index < 0) return\n\n      this.mashers.splice(index, 1)\n      if (!this.mashers.length) this.stop()\n    }\n  },\n  handleInterval: {\n    value: function() {\n      // console.log(this.constructor.name, \"handleInterval\")\n      const urls = new UrlsByType\n      this.mashers.forEach(masher => urls.concat(masher.urlsCached))\n      const array = urls.urls\n      Cache.urls().forEach(url => array.includes(url) || Cache.remove(url))\n    }\n  },\n  mashers: {\n    get: function() {\n      if (Is.undefined(this.__mashers)) this.__mashers = []\n      return this.__mashers\n    }\n  },\n\n  start: {\n    value: function() {\n      // console.log(this.constructor.name, \"start\")\n      if (this.interval) return\n\n      this.interval = setInterval(this.handleInterval.bind(this), INTERVAL_TICS)\n    }\n  },\n  stop: {\n    value: function() {\n      // console.log(this.constructor.name, \"stop\")\n      if (!this.interval) return\n\n      clearInterval(this.interval)\n      this.interval = null\n    }\n  },\n  type: { value: MasherType },\n  types: { value: MasherTypes },\n})\n\nconst MasherFactoryInstance = new MasherFactory\n\nexport { MasherFactoryInstance as MasherFactory }\n","import { Module, Property, ModuleType, ModuleTypes } from \"./Setup\"\nimport { MasherFactory } from \"./Factory/MasherFactory\"\n\nexport default {\n  Property,\n  Module,\n  ModuleType,\n  ModuleTypes,\n  MasherFactory,\n}\n"],"names":["Default","buffer","fps","loop","volume","precision","autoplay","mash","label","quantize","backcolor","media","frame","duration","image","theme","transition","$deprecated","$internal","Errors","action","actions","internal","argument","type","selection","unknown","merger","effect","filter","font","scaler","uncached","object","array","id","frames","seconds","url","time","timeRange","mainTrackOverlap","unknownMash","property","deprecation","property_types","addModulesOfType","configure","get","set","canvas_context","wrongClass","byFrame","a","b","byTrack","track","byLabel","$audio","$effect","$font","$image","$merger","$scaler","$theme","$transition","$video","map","ClipTypes","ClipType","Object","fromEntries","EventTypes","EventType","MediaTypes","MediaType","ModuleTypes","ModuleType","LoadTypes","LoadType","TrackTypes","TrackType","MoveTypes","MoveType","TransformTypes","TransformType","ModuleInstance","[object Object]","this","defaults","fontDefaultJson","mergerDefaultJson","scalerDefaultJson","themeColorJson","themeTextJson","effectBlurJson","effectChromaKeyJson","effectEmbossJson","effectGrayscaleJson","effectSepiaJson","effectSharpenJson","effectTextJson","mergerBlendJson","mergerCenterJson","mergerConstrainedJson","mergerOverlayJson","scalerPanJson","scalerScaleJson","forEach","objects","includes","console","warn","changed","is_default","existing","find","splice","indexOf","push","sort","ofType","module","defaultOfType","log","constructor","name","value","defined","Array","isArray","instance","string","undefined","number","integer","Number","isInteger","length","nil","not","emptystring","emptyarray","emptyobject","keys","Is","nonobject","empty","float","boolean","instanceOf","klass","method","nan","isNaN","objectStrict","positive","Property","defineProperties","prototype","modularPropertyTypeIds","__modularPropertyTypeIds","ids","propertyTypes","modular","orDefault","propertyTypeDefault","propertyType","property_type","rgba","String","rgb","fontsize","direction4","values","identifier","direction8","pixel","mode","composite","text","PropertyInstance","Colors","yuvs","yuv2","similarity","blend","du","dv","i","diff","z","u","v","Math","sqrt","min","max","k","yuv","parseInt","y","r","g","floor","ContextFactoryInstance","width","height","context","createVideo","canvas","drawing","createDrawing","window","AudioContext","webkitAudioContext","document","createElement","element","createCanvas","getContext","Id","replace","c","Uint8Array","crypto","getRandomValues","toString","rgbAtIndex","index","pixels","safePixel","x_dif","y_dif","pt","x","toPoint","fromPoint","Pixel","slice","data","size","half_size","safePixels","toIndex","Throw","error","Time","zero","time1","time2","rounding","gcf","t","greatestCommonDenominator","scale","scaleTimes","copy","description","subtracted","TimeFactory","rounded","roundingFunction","createFromFrame","ceil","round","TimeRange","super","end","endTime","lengthSeconds","position","startTime","range1","range2","range","Utilities","key","item","toUpperCase","substr","Base","Action","entries","events","selectedClips","done","redoSelectedClips","undoSelectedClips","selectedEffects","redoSelectedEffects","undoSelectedEffects","redoAction","emit","undoAction","AddTrackAction","addTrack","trackType","removeTrack","ChangeAction","redoValue","__redoValue","target","undoValue","redo","FreezeAction","trackClips","insertClip","frozenClip","freezeClip","ChangeFramesAction","changeClipFrames","ChangeTrimAction","changeClipTrim","AddEffectAction","effects","AddClipToTrackAction","clips","trackIndex","createTracks","addClipsToTrack","clip","insertIndex","removeClipsFromTrack","MoveClipsAction","redoFrames","addClips","undoFrames","undoTrackIndex","undoInsertIndex","__track","RemoveClipsAction","SplitAction","splitClip","MoveEffectsAction","redoEffects","undoEffects","Actions","canRedo","canUndo","currentAction","currentActionLast","masher","remove","removed","undo","__id","initializeId","Factory","baseClass","classesByType","Map","typedClass","createFromType","createFromObject","Klass","typeClass","sharedMedia","toJSON","properties","__properties","propertiesInitialize","propertyNames","propertiesTiming","assign","propertiesAudible","propertiesModular","source","initializeInstance","names","Reflect","has","AudioProcessor","audioContext","Promise","resolve","reject","decodeAudioData","audioData","CacheInstance","__cached_urls","__urls_by_md5","FontProcessor","family","Cache","font_face","FontFace","promise","load","then","fonts","add","ImageProcessor","ModuleProcessor","ProcessorFactoryInstance","install","audio","Loader","promises","cached","urls","every","loadedUrl","requestUrl","processed","all","loadUrl","AudioLoader","fetch","response","arrayBuffer","loaded","options","ProcessorFactory","process","FontLoader","create","ImageLoader","Image","onload","event","onerror","crossOrigin","src","ModuleLoader","import","LoaderFactoryInstance","UrlsByType","none","UrlsByTypeNone","loaders","flatMap","urlsUnloaded","Set","LoaderFactory","loadUrls","definition","inaudible","audible","urlsAudibleInTimeRangeForClipByType","visibleMedia","visible","video","__propertiesModular","modularPropertiesByType","__modularPropertiesByType","initializeModularPropertiesByType","CoreFilter","scopeSet","draw","evaluator","BlendFilterInstance","evaluated","outputContext","id_key","array_key","all_mode","globalCompositeOperation","drawImage","ChromaKeyFilterInstance","parameters","color","accurate","colors","split","f","getImageData","yuvsFromPixelsAccurate","yuvsFromPixels","offset","matrix","putImageData","rgbs","ColorFilterInstance","fillStyle","fillRect","ColorChannelMixerFilterInstance","rgbas","first","second","j","red","green","blue","alpha","image_data","rr","rg","rb","ra","gr","gg","gb","ga","br","bg","bb","ba","ar","ag","ab","aa","RBGA","ConvolutionFilterInstance","result","bias","rdiv","channel","parseFloat","parse","input","output","createImageData","inputData","outputDdata","area","sum","matrix3","CropFilterInstance","in_width","in_height","w","out_w","h","out_h","Context","DrawBoxFilterInstance","mm_fontfile","font_id","Module","fontById","mm_textfile","mm_fontfamily","DrawTextFilterInstance","fontcolor","textfile","shadowcolor","shadowColor","shadowx","shadowy","shadowOffsetX","shadowOffsetY","fillText","FadeFilterInstance","createDrawingLike","globalAlpha","OverlayFilterInstance","ScaleFilterInstance","SetSarFilterInstance","FilterTypes","FilterType","FilterFactory","BlendFilter","chromakey","ChromaKeyFilter","colorchannelmixer","ColorChannelMixerFilter","ColorFilter","convolution","ConvolutionFilter","crop","CropFilter","drawbox","DrawBoxFilter","drawtext","DrawTextFilter","fade","FadeFilter","overlay","OverlayFilter","ScaleFilter","setsar","SetSarFilter","types","FilterFactoryInstance","drawFilters","coreFilter","evaluateScope","Media","FilterMedia","__coreFilter","definitions","parameter","evaluate","filters","__filters","filtersInitialize","html","inspector","urlsFromFilters","urlsVisibleInTimeRangeForClipByType","properties_by_type","transform","EffectMedia","ScalerMedia","MergerMedia","modularFalse","invisible","__duration","gain","trim","urlAudible","AudioMedia","FontMedia","urlAudibleMute","urlsVisibleFrames","__fps","framesMax","begin","__begin","pattern","__pattern","increment","__increment","zeropadding","__zeropadding","zeropaddingInitialize","last_frame","__url","limitedTimeRange","minEndTime","max_frames","media_time","s","padStart","replaceAll","VideoMedia","urlsVisible","urlsVisibleInTimeRange","urlVisible","ImageMedia","ThemeMedia","urlsNone","TransitionMedia","MediaFactoryInstance","createFromArgs","createFromTime","TimeRangeFactory","propertyValues","labelFromObjectOrMedia","__label","labelInitialize","__media","MediaFactory","valueOrTransform","propertiesFromMedia","editable","propertiesTransform","sharedClip","timeRangeRelative","mashTime","withFrame","mashTimeRange","urlsVisibleInTimeRangeByType","urlsAudibleInTimeRangeByType","visibleClip","scaledContextAtTimeForDimensions","dimensions","rest","contextAtTimeForDimensions","clipTimeRange","drawMediaFilters","effectedContextAtTimeForDimensions","reverse","mergeContextAtTime","effected","drawMerger","mediaTimeRange","concat","idMutable","urlsFromMedia","mediaInitialize","KEYS_SIZED","KEYS_GETTERS","KEYS","THIS","Evaluator","conditionalExpression","conditional","condition","is","elements","in","strings","join","replaceOperators","replaceKeys","expression","expressions","RegExp","reg_exp","conditionalValue","conditionals","test_bool","evaluateExpression","expressionOrConditions","script","Function","exception","bind","mm_cmp","mm_dimensions","mm_width","mm_height","mm_duration","mm_fps","mm_horz","proud","sized","mm_max","mm_min","mm_t","mm_vert","vertical","scaled","other","abs","clipRange","sharedTransform","Transform","Merger","inputContext","Scaler","Effect","__effects","effectsInitialize","__merger","mergerInitialize","objectWithDefaultId","__scaler","scalerInitialize","coreFilters","resource","Clip","mediaTime","ImageClip","muted","add_one_frame","end_time","limited_time","start_time","subtract","frame_at_speed","speed","divide","mediaTimeFromTrim","AudioClip","VideoClip","ThemeClip","ChildTypes","ChildType","TransitionClip","children","sorted","fromClip","toClip","to","from","childType","child","initializeChild","transformType","FrameClip","ClipFactoryInstance","createFromSeconds","createFromObjectMedia","Track","__clips","initializeClips","searchMedia","ClipFactory","isMainVideo","clipIndex","movingClips","spliceClips","moving","sortClips","JSON","stringify","is_transition","TrackFactory","MashProperty","Mash","__audio","initializeAudio","__backcolor","tracks","flat","clipsAudible","clipsAudio","clipsVideo","__events","initializeMedia","initializeVideo","initialMedia","__initialMedia","mediaForClip","__quantize","av","__video","newTrack","clipTrackAtIndex","oldTrack","clipTrack","emitIfFramesChange","removeClips","limited_value","new_frames","intersects","trackOfTypeAtIndex","clipsWithin","clipIntersects","includeAudible","includeVisible","clipsAudibleInTimeRange","clipsVisibleInTimeRange","info","emitDuration","mediaId","found","findInitialMedia","findClipMedia","firstClip","abutting","medias","mediaForClipTransform","merger_or_scaler","references","pop","moduleType","created","urlsVisibleInTimeRangeForClipsByType","urlsAudibleInTimeRangeForClipsByType","urlsForClipsWithin","Events","methods","EventTarget","removeListener","addListener","addEventListener","detail","dispatchEvent","CustomEvent","delete","removeEventListener","contexts","videoContext","__videoContext","composition","__audioContext","createAudio","Composition","bufferSeconds","paused","playing","sourcesByClip","__mashSeconds","__contextSeconds","bufferedTime","urlsAtTime","bufferedTimeRange","urlsInTimeRange","clipsAtTime","clipsInTimeRange","configured","__gain","__gainInitialize","adjustSourceGain","currentTime","__time","buffer_time","timeRangeAtTime","urlsInTimeRangeByType","gainNode","times","clipTiming","start","cancelScheduledValues","gains","linearRampToValueAtTime","throwIfUncached","throwUnlessClipsDrawable","zero_seconds","now","dif","gainSource","createBufferSource","createGain","connect","destination","clipsToKeep","disconnect","drawClips","clipsToDraw","clearRect","main","drawBackground","transitioned","mainClip","requestAnimationFrame","loadTimeRange","createSources","destroySources","urlsWithin","__bufferSource","createBuffer","stop","ActionTypes","ActionType","ActionFactory","moveClips","addEffect","change","changeFrames","changeTrim","freeze","moveEffects","clone","entry","ActionFactoryInstance","deprecated","uuid","buffertime","minbuffertime","MasherProperty","clipCanBeSplit","clip_range","Masher","handleMasher","__load_timer","__moving","__muted","__paused","__mashFrames","__drawnTime","action_index","__actions","__autoplay","initializeProperty","__composition","__buffer","mashEndTime","__loop","__mash","__selectedEffects","handleChangeMashFrames","rebuffer","redraw","handleGainChange","__set_moving","__buffer_timer","clearInterval","setInterval","per","toFixed","position_step","zeros","repeat","__precision","selectedClip","__selectedClips","selectedClipOrMash","filterClipSelection","__pristine","selectedEffect","__pristineEffect","silenced","stalling","__limit_time","equal","equalsTime","handleChangeMash","urlsCached","__volume","addType","frameOrIndex","addClip","trackCount","frameForClipsNearFrame","actionCreate","loadVisual","should_be_enabled","changeClip","changeMash","transformProperty","currentActionReusable","updateAction","delayed_timer","setTimeout","Mashers","mash_frames","max_frame","delayedDraw","changeAction","removedActions","truncate","handleAction","did","loadTime","objectOrArray","moveType","effectOrArray","clipOrArray","redoTrack","undoTrack","currentIndex","video_buffered","drawFrame","audio_buffered","all_buffered","removeEffects","toggle_selected","key_array","key_prop","findMedia","select","tf","$this","__load_timed","startPlaying","stopPlaying","createFromObjectMasher","do","handleRemoveActions","MasherTypes","MasherType","MasherFactory","mashers","destroy","handleInterval","__mashers","interval","MasherFactoryInstance"],"mappings":"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"}