{"version":3,"file":"moviemasher.min.js","sources":["../src/Setup/Errors.ts","../src/Utilities/Is.ts","../src/Utilities/Id.ts","../src/Setup/Enums.ts","../src/Setup/TypeValue.ts","../src/Utilities/Color.ts","../src/Definitions/Definitions.ts","../src/Setup/Type.ts","../src/Setup/Types.ts","../src/Setup/Property.ts","../src/Base/Instance.ts","../src/Base/Definition.ts","../src/Definitions/Factories.ts","../src/Playing/AudibleContext.ts","../src/Playing/VisibleContext.ts","../src/Playing/ContextFactory.ts","../src/Utilities/Sort.ts","../src/Mash/Track/TrackInstance.ts","../src/Mash/Track/TrackFactory.ts","../src/Definitions/Factory/Factory.ts","../src/Editing/Action/Action.ts","../src/Utilities/Capitalize.ts","../src/Editing/Action/AddTrackAction.ts","../src/Editing/Action/AddClipToTrackAction.ts","../src/Editing/Action/MoveClipsAction.ts","../src/Editing/Action/AddEffectAction.ts","../src/Editing/Action/ChangeAction.ts","../src/Editing/Action/ChangeFramesAction.ts","../src/Editing/Action/ChangeTrimAction.ts","../src/Editing/Action/SplitAction.ts","../src/Editing/Action/FreezeAction.ts","../src/Editing/Action/MoveEffectsAction.ts","../src/Editing/Action/RemoveClipsAction.ts","../src/Editing/Action/ActionFactory.ts","../src/Utilities/Element.ts","../src/Utilities/Emitter.ts","../src/Utilities/Evaluator.ts","../src/Utilities/Round.ts","../src/Utilities/Pixel.ts","../src/Utilities/Time.ts","../src/Utilities/TimeRange.ts","../src/Utilities/Url.ts","../src/Editing/Actions.ts","../src/Loading/Cache.ts","../src/Loading/Loader.ts","../src/Mash/Audio/AudioLoader.ts","../src/Mash/Font/FontLoader.ts","../src/Mash/Image/ImageLoader.ts","../src/Mash/Video/VideoLoader.ts","../src/Loading/LoaderFactory.ts","../src/Setup/Default.ts","../src/Mixin/Audible/AudibleMixin.ts","../src/Mixin/Clip/ClipMixin.ts","../src/Mixin/AudibleFile/AudibleFileMixin.ts","../src/Mash/Audio/AudioInstance.ts","../src/Mixin/Clip/ClipDefinitionMixin.ts","../src/Mixin/Audible/AudibleDefinitionMixin.ts","../src/Mixin/AudibleFile/AudibleFileDefinitionMixin.ts","../src/Mash/Audio/AudioDefinition.ts","../src/Mash/Audio/AudioFactory.ts","../src/Setup/Parameter.ts","../src/Mash/Filter/FilterInstance.ts","../src/Mash/Filter/FilterDefinition.ts","../src/Mash/Filter/Definitions/BlendFilter.ts","../src/Mash/Filter/Definitions/ChromaKeyFilter.ts","../src/Mash/Filter/Definitions/ColorFilter.ts","../src/Mash/Filter/Definitions/ColorChannelMixerFilter.ts","../src/Mash/Filter/Definitions/ConvolutionFilter.ts","../src/Mash/Filter/Definitions/CropFilter.ts","../src/Mash/Filter/Definitions/DrawBoxFilter.ts","../src/Mash/Font/FontInstance.ts","../src/Mash/Font/FontDefinition.ts","../src/Mash/Font/FontFactory.ts","../src/Mash/Filter/Definitions/DrawTextFilter.ts","../src/Mash/Filter/Definitions/FadeFilter.ts","../src/Mash/Filter/Definitions/OverlayFilter.ts","../src/Mash/Filter/Definitions/ScaleFilter.ts","../src/Mash/Filter/Definitions/SetSarFilter.ts","../src/Mash/Filter/FilterFactory.ts","../src/Mixin/Modular/ModularDefinitionMixin.ts","../src/Mixin/Modular/ModularMixin.ts","../src/Mash/Effect/EffectInstance.ts","../src/Mash/Effect/EffectDefinition.ts","../src/Mash/Effect/EffectFactory.ts","../src/Mash/Merger/MergerInstance.ts","../src/Mash/Merger/MergerDefinition.ts","../src/Mash/Merger/MergerFactory.ts","../src/Mash/Scaler/ScalerInstance.ts","../src/Mash/Scaler/ScalerDefinition.ts","../src/Mash/Scaler/ScalerFactory.ts","../src/Mixin/Transformable/TransformableMixin.ts","../src/Mixin/Visible/VisibleMixin.ts","../src/Mash/Image/ImageInstance.ts","../src/Mixin/Visible/VisibleDefinitionMixin.ts","../src/Mash/Image/ImageDefinition.ts","../src/Mash/Image/ImageFactory.ts","../src/Playing/Composition.ts","../src/Mash/Mash/MashInstance.ts","../src/Mash/Mash/MashFactory.ts","../src/Mash/Theme/ThemeInstance.ts","../src/Mixin/Transformable/TransformableDefintiionMixin.ts","../src/Mash/Theme/ThemeDefinition.ts","../src/Mash/Theme/ThemeFactory.ts","../src/Mash/Transition/TransitionInstance.ts","../src/Mash/Transition/TransitionDefinition.ts","../src/Mash/Transition/TransitionFactory.ts","../src/Mash/Video/VideoInstance.ts","../src/Mash/Video/VideoDefinition.ts","../src/Mash/Video/VideoFactory.ts","../src/Mixin/Streamable/StreamableMixin.ts","../src/Mash/VideoStream/VideoStreamInstance.ts","../src/Mixin/Streamable/StreamableDefinitionMixin.ts","../src/Mash/VideoStream/VideoStreamDefinition.ts","../src/Mash/VideoStream/VideoStreamFactory.ts","../src/Mash/VideoSequence/VideoSequenceInstance.ts","../src/Mash/VideoSequence/VideoSequenceDefinition.ts","../src/Mash/VideoSequence/VideoSequenceFactory.ts","../src/Masher/MasherInstance.ts","../src/Masher/MasherFactory.ts","../src/Initialize/index.ts","../src/Utilities/Seconds.ts"],"sourcesContent":["const $invalid = \"Invalid\"\nconst $unknown = \"Unknown\"\nconst $expected = \"Expected\"\nconst $invalidArgument = `${$invalid} argument`\nconst $invalidProperty = `${$invalid} property`\nconst $invalidDefinitionProperty = `${$invalid} definition property`\nconst $internal = \"Internal Error \"\nconst Errors = {\n  eval: {\n    sourceRect: `${$invalid} evaluation of source rect `,\n    outputSize: `${$invalid} evaluation of output size `,\n    conditionTruth: `${$expected} at least one condition to evaluate to true `,\n    conditionValue: `${$expected} condition to have a value `,\n    number: `${$expected} evaluated value to be a number `,\n    get: `${$expected} to get evaluated value `,\n  },\n  composition: { mashUndefined: `${$internal}composition.mash undefined` },\n  audibleContext: `${$expected} AudioContext`,\n  mash: `${$expected} mash`,\n  action: `${$expected} Action`,\n  actions: `${$expected} Actions`,\n  internal: $internal,\n  argument: `${$invalidArgument} `,\n  invalid: {\n    canvas: `${$invalidProperty} canvas `,\n    context: `${$invalidProperty} context `,\n    definition: {\n      duration: `${$invalidDefinitionProperty} duration`,\n      audio: `${$invalidDefinitionProperty} audio|url`,\n      url: `${$invalidDefinitionProperty} url`,\n      source: `${$invalidDefinitionProperty} source`,\n      id: `${$invalidDefinitionProperty} id`,\n      object: `${$invalidProperty} definition`,\n    },\n    size: `${$invalid} size `,\n    track: `${$invalid} track `,\n    trackType: `${$invalidProperty} trackType `,\n    action: `${$invalid} action `,\n    name: `${$invalidProperty} name `,\n    value: `${$invalidProperty} value `,\n    type: `${$invalidProperty} type `,\n    url: `${$invalidProperty} url `,\n    property: $invalidProperty,\n    argument: $invalidArgument,\n    object: `${$invalidArgument} object `,\n    factory: `${$invalid} factory `,\n    volume: `${$invalidArgument} volume`,\n  },\n  type: `${$unknown} type `,\n  selection: `${$invalid} selection `,\n  unknown: {\n    type: `${$unknown} type `,\n    merger: `${$unknown} merger `,\n    effect: `${$unknown} effect `,\n    filter: `${$unknown} filter `,\n    font: `${$unknown} font `,\n    scaler: `${$unknown} scalar `,\n    mode: `${$unknown} mode `,\n    definition: `${$unknown} definition `,\n  },\n  uncached: \"Uncached URL \",\n  object: `${$invalidArgument} object `,\n  array: `${$invalidArgument} array `,\n  media: `${$invalidArgument} media `,\n  id: `${$invalidArgument} id `,\n  frame: `${$invalidArgument} frame `,\n  frames: `${$invalidProperty} frames `,\n  fps: `${$invalidArgument} fps `,\n  seconds: `${$invalidArgument} seconds `,\n  url: `${$invalidArgument} url `,\n  time: `${$invalidArgument} Time`,\n  timeRange: `${$invalidArgument} TimeRange`,\n  mainTrackOverlap: `${$internal}: main track clips overlap without transition`,\n  unknownMash: `${$unknown} Mash property `,\n  unimplemented: `${$expected} method to be overridden`,\n  property: `${$invalidArgument} property `,\n  wrongClass: `${$expected} instance of `,\n}\n\nexport { Errors }\n","import { ScalarArray, UnknownObject } from \"../declarations\"\n\nconst objectType = (value : unknown) : boolean => typeof value === 'object'\n\nconst stringType = (value : unknown) : boolean => (\n  typeof value === 'string'\n)\n\nconst undefinedType = (value : unknown) : boolean => typeof value === 'undefined'\n\nconst numberType = (value : unknown) : boolean => typeof value === 'number'\n\nconst booleanType = (value : unknown) : boolean => typeof value === 'boolean'\n\nconst methodType = (value : unknown) : boolean => typeof value === 'function'\n\nconst isDefined = (value : unknown) : boolean => !undefinedType(value)\n\nconst isNan = (value : unknown) : boolean => numberType(value) && Number.isNaN(value)\n\nconst isNumber = (value : unknown) : boolean => numberType(value) && !Number.isNaN(value)\n\nconst isInteger = (value : unknown) : boolean => Number.isInteger(value)\n\nconst isFloat = (value : unknown) : boolean => numberType(value) && !isInteger(value)\n\nconst isPositive = (value : unknown) : boolean => numberType(value) && Number(value) >= 0\n\nconst isAboveZero = (value : unknown) : boolean => isNumber(value) && Number(value) > 0\n\nconst isArray = (value : unknown) : boolean => (\n  isDefined(Array.isArray) ? Array.isArray(value) : value instanceof Array\n)\n\nconst length = (value : string | ScalarArray) : boolean => !!value.length\n\nconst isPopulatedString = (value : unknown) : boolean => stringType(value) && length(String(value))\n\nconst isPopulatedObject = (value : unknown) : boolean => (\n  objectType(value) && length(Object.keys(<UnknownObject> value))\n)\n\nconst isPopulatedArray = (value : unknown) : boolean => isArray(value) && length(<ScalarArray> value)\n\nconst Is = {\n  aboveZero: isAboveZero,\n  array: isArray,\n  boolean: booleanType,\n  defined: isDefined,\n  float: isFloat,\n  integer: isInteger,\n  method: methodType,\n  nan: isNan,\n  number: numberType,\n  object: objectType,\n  populatedArray: isPopulatedArray,\n  populatedObject: isPopulatedObject,\n  populatedString: isPopulatedString,\n  positive: isPositive,\n  string: stringType,\n  undefined: undefinedType,\n}\n\nexport {\n  Is,\n  isAboveZero,\n  isArray,\n  booleanType as isBoolean,\n  isDefined,\n  isFloat,\n  isInteger,\n  methodType as isMethod,\n  isNan,\n  numberType as isNumber,\n  objectType as isObject,\n  isPopulatedArray,\n  isPopulatedObject,\n  isPopulatedString,\n  isPositive,\n  stringType as isString,\n  undefinedType as isUndefined,\n}\n","\n// eslint-disable-next-line prefer-const\nlet idPrefix = ''\n\nconst idGenerate = (): string => {\n  const components = []\n  if (idPrefix) components.push(idPrefix)\n  components.push(Date.now().toString(36))\n  components.push(Math.random().toString(36).substr(2))\n  return components.join('-')\n}\n\nconst idPrefixSet = (prefix: string): void => { idPrefix = prefix }\n\nconst Id = {\n  generate: idGenerate,\n  prefix: idPrefix,\n  prefixSet: idPrefixSet\n}\n\nexport { Id, idGenerate, idPrefix, idPrefixSet }\n","\n\nenum ActionType {\n  AddTrack = 'addTrack',\n  AddClipsToTrack = 'addClipsToTrack',\n  MoveClips = 'moveClips',\n  AddEffect = 'addEffect',\n  Change = 'change',\n  ChangeFrames = 'changeFrames',\n  ChangeTrim = 'changeTrim',\n  ChangeGain = 'changeGain',\n  MoveEffects = 'moveEffects',\n  Split = 'split',\n  Freeze ='freeze',\n  RemoveClips = 'removeClips',\n}\n\nenum TrackType {\n  Audio = 'audio',\n  Transition = 'transition',\n  Video = 'video',\n}\nconst TrackTypes = Object.values(TrackType)\n\nenum ClipType {\n  Audio = 'audio',\n  Frame = 'frame',\n  Image = 'image',\n  Theme = 'theme',\n  Transition = 'transition',\n  Video = 'video',\n  VideoSequence = 'videosequence',\n  VideoStream = 'videostream',\n  // AudioStream = 'audiostream',\n}\n\nconst ClipTypes = Object.values(ClipType)\n\n// NOTE: order important here - determines initialization\nenum DefinitionType {\n  Filter = 'filter',\n  Merger = 'merger',\n  Scaler = 'scaler',\n  Effect = 'effect',\n  Font = 'font',\n  Theme = 'theme',\n  Transition = 'transition',\n  Image = 'image',\n  Video = 'video',\n  Audio = 'audio',\n  VideoStream = 'videostream',\n  VideoSequence = 'videosequence',\n  // Track = 'track',\n  // AudioStream = 'audiostream',\n}\nconst DefinitionTypes = Object.values(DefinitionType)\n\nenum EventType {\n  Action = 'action',\n  Duration = 'durationchange',\n  Draw = 'draw',\n  Ended = 'ended',\n  Fps = 'ratechange',\n  Loaded = 'loadeddata',\n  Mash = 'mashchange',\n  Pause = 'pause',\n  Play = 'play',\n  Playing = 'playing',\n  Seeked = 'seeked',\n  Seeking = 'seeking',\n  Selection = 'selection',\n  Time = 'timeupdate',\n  Track = 'track',\n  Volume = 'volumechange',\n  Waiting = 'waiting',\n}\n\nenum ModuleType {\n  Effect ='effect',\n  Font = 'font',\n  Merger = 'merger',\n  Scaler = 'scaler',\n  Theme = 'theme',\n  Transition = 'transition',\n}\nconst ModuleTypes = Object.values(ModuleType)\n\nenum LoadType {\n  Audio = 'audio',\n  Font = 'font',\n  Image = 'image',\n  Module = 'module',\n  Video = 'video',\n}\n\nenum MoveType {\n  Audio = 'audio',\n  Effect = 'effect',\n  Video = 'video',\n}\n\nenum DataType {\n  Boolean = 'boolean',\n  Direction4 = 'direction4',\n  Direction8 = 'direction8',\n  Font = 'font',\n  Fontsize = 'fontsize',\n  Integer = 'integer',\n  Mode = 'mode',\n  Number = 'number',\n  Pixel = 'pixel',\n  Rgb = 'rgb',\n  Rgba = 'rgba',\n  String = 'string',\n  Text = 'text',\n}\nconst DataTypes = Object.values(DataType)\n\nenum TransformType {\n  Merger = 'merger',\n  Scaler = 'scaler',\n}\n\nconst TransformTypes = Object.values(TransformType)\n\nenum MasherAction {\n  Freeze = 'freeze',\n  Redo = 'redo',\n  Remove = 'remove',\n  Save = 'save',\n  Split = 'split',\n  Undo = 'undo',\n}\n\nconst MasherActions = Object.values(MasherAction)\n\nenum CommandType {\n  File = 'file',\n  Stream = 'stream',\n}\n\nconst CommandTypes = Object.values(CommandType)\n\nenum OutputFormat {\n  Flv = 'flv',\n  Hls = 'hls',\n  Mdash = 'mdash',\n  Rtmp = 'rtmp',\n  Rtmps = 'rtmps',\n}\n\nconst OutputFormats = Object.values(OutputFormat)\n\nexport {\n  ActionType,\n  ClipType,\n  ClipTypes,\n  CommandType,\n  CommandTypes,\n  DataType,\n  DataTypes,\n  DefinitionType,\n  DefinitionTypes,\n  EventType,\n  LoadType,\n  MasherAction,\n  MasherActions,\n  ModuleType,\n  ModuleTypes,\n  MoveType,\n  OutputFormat,\n  OutputFormats,\n  TrackType,\n  TrackTypes,\n  TransformType,\n  TransformTypes,\n}\n","import { ScalarValue } from \"../declarations\";\n\ninterface TypeValueObject {\n  id : ScalarValue\n  identifier : string\n  label : string\n}\n\nclass TypeValue {\n  constructor(object : TypeValueObject) {\n    const { id, identifier, label } = object\n    this.id = id\n    this.identifier = identifier\n    this.label = label\n  }\n\n  id : ScalarValue\n\n  identifier : string\n\n  label : string\n}\n\nexport { TypeValue, TypeValueObject }\n","import { Rgb, RgbObject, Yuv, YuvObject } from \"../declarations\"\n\nconst rgbValue = (value : string | number) : number => (\n  Math.min(255, Math.max(0, Math.floor(Number(value))))\n)\n\nconst rgbNumeric = (rgb : RgbObject) : Rgb => ({\n  r: rgbValue(rgb.r), g: rgbValue(rgb.g), b: rgbValue(rgb.b)\n})\n\nconst yuvNumeric = (rgb : YuvObject) : Yuv => ({\n  y: rgbValue(rgb.y), u: rgbValue(rgb.u), v: rgbValue(rgb.v)\n})\n\nconst colorYuv2rgb = (yuv : YuvObject) : Rgb => {\n  const floats = yuvNumeric(yuv)\n  return rgbNumeric({\n    r: floats.y + 1.4075 * (floats.v - 128),\n    g: floats.y - 0.3455 * (floats.u - 128) - (0.7169 * (floats.v - 128)),\n    b: floats.y + 1.7790 * (floats.u - 128)\n  })\n}\n\nconst colorRgb2hex = (rgb: RgbObject): string => {\n  // unused after 5.0 refactor, but perhaps needed?\n  let r = rgb.r.toString(16);\n  let g = rgb.g.toString(16);\n  let b = rgb.b.toString(16);\n  if (r.length < 2) r = `0${r}`;\n  if (g.length < 2) g = `0${g}`;\n  if (b.length < 2) b = `0${b}`;\n  return `#${r}${g}${b}`;\n}\n\nconst colorYuvBlend = (yuvs : YuvObject[], yuv : YuvObject, match : number, blend : number) : number => {\n  let diff = 0.0\n  const blendYuv = yuvNumeric(yuv)\n  yuvs.forEach(yuvObject => {\n    const numericYuv = yuvNumeric(yuvObject)\n    const du = numericYuv.u - blendYuv.u\n    const dv = numericYuv.v - blendYuv.v\n    diff += Math.sqrt((du * du + dv * dv) / (255.0 * 255.0))\n  })\n  diff /= yuvs.length\n\n  if (blend > 0.0001) {\n    return Math.min(1.0, Math.max(0.0, (diff - match) / blend)) * 255.0\n  }\n  return (diff > match) ? 255 : 0\n}\n\nconst colorRgb2yuv = (rgb : RgbObject) : Yuv => {\n  const ints = rgbNumeric(rgb)\n  return {\n    y: ints.r * 0.299000 + ints.g * 0.587000 + ints.b * 0.114000,\n    u: ints.r * -0.168736 + ints.g * -0.331264 + ints.b * 0.500000 + 128,\n    v: ints.r * 0.500000 + ints.g * -0.418688 + ints.b * -0.081312 + 128\n  }\n}\n\nconst colorStrip = (color: string): string => color.toLowerCase().replaceAll(/[\\s]/g, '')\n\n\nconst colorValid = (color: string): boolean => {\n  const colorStripped = colorStrip(color)\n  const style = new Option().style\n  style.color = color\n  const styleStripped = colorStrip(style.color)\n  if (!styleStripped) return false\n\n  if (styleStripped.startsWith('rgb')) return true\n\n  return styleStripped === colorStripped\n}\n\nconst colorTransparent = '#00000000'\n\nconst Color = {\n  valid: colorValid,\n  yuvBlend: colorYuvBlend,\n  rgb2yuv: colorRgb2yuv,\n  yuv2rgb: colorYuv2rgb,\n  rgb2hex: colorRgb2hex,\n  transparent: colorTransparent,\n  strip: colorStrip,\n}\nexport {\n  Color,\n  colorStrip,\n  colorValid,\n  colorRgb2hex,\n  colorYuv2rgb,\n  colorRgb2yuv,\n  colorYuvBlend,\n  colorTransparent,\n}\n","import { DefinitionType } from \"../Setup/Enums\"\nimport { Errors } from \"../Setup/Errors\"\nimport { Definition } from \"../Base/Definition\"\n\ntype DefinitionsList = Definition[]\nconst DefinitionsMap = new Map<string, Definition>()\nconst DefinitionsByType = new Map <DefinitionType, DefinitionsList>()\n\nconst definitionsByType = (type : DefinitionType) : DefinitionsList => {\n  const list = DefinitionsByType.get(type)\n  if (list) return list\n\n  const definitionsList : DefinitionsList = []\n  DefinitionsByType.set(type, definitionsList)\n  return definitionsList\n}\nconst definitionsClear = (): void => {\n  DefinitionsMap.clear()\n  DefinitionsByType.clear()\n}\n\nconst definitionsFont = definitionsByType(DefinitionType.Font)\n\nconst definitionsFromId = (id : string) : Definition => {\n  if (!definitionsInstalled(id)) {\n    console.trace(\"definitionsFromId !definitionsInstalled\", id)\n    throw Errors.unknown.definition + id\n  }\n\n  const definition = DefinitionsMap.get(id)\n  if (!definition) throw Errors.internal + id\n\n  return definition\n}\n\nconst definitionsInstall = (definition : Definition) : void => {\n  const { type, id } = definition\n  DefinitionsMap.set(id, definition)\n  definitionsByType(type).push(definition)\n}\n\nconst definitionsInstalled = (id : string) : boolean => DefinitionsMap.has(id)\n\nconst definitionsMerger = definitionsByType(DefinitionType.Merger)\n\nconst definitionsScaler = definitionsByType(DefinitionType.Scaler)\n\nconst definitionsUninstall = (id : string) : void => {\n  if (!definitionsInstalled(id)) return\n\n  const definition = definitionsFromId(id)\n  DefinitionsMap.delete(id)\n  const { type } = definition\n  const definitions = definitionsByType(type)\n  const index = definitions.indexOf(definition)\n  if (index < 0) throw Errors.internal\n\n  definitions.splice(index, 1)\n}\n\nconst Definitions = {\n  byType: definitionsByType,\n  clear: definitionsClear,\n  font: definitionsFont,\n  fromId: definitionsFromId,\n  install: definitionsInstall,\n  installed: definitionsInstalled,\n  map: DefinitionsMap,\n  merger: definitionsMerger,\n  scaler: definitionsScaler,\n  uninstall: definitionsUninstall,\n}\n\nexport {\n  Definitions,\n  definitionsByType,\n  definitionsClear,\n  definitionsFont,\n  definitionsFromId,\n  definitionsInstall,\n  definitionsInstalled,\n  DefinitionsMap,\n  definitionsMerger,\n  definitionsScaler,\n  definitionsUninstall,\n}\n","import { ScalarRaw, SelectionValue } from \"../declarations\"\nimport { DataType } from \"./Enums\"\nimport { Errors } from \"./Errors\"\nimport { TypeValue, TypeValueObject } from \"./TypeValue\"\nimport { colorValid } from \"../Utilities/Color\"\nimport { Definitions } from \"../Definitions/Definitions\"\nimport { isNan } from \"../Utilities/Is\"\n\ninterface TypeObject {\n  id? : DataType\n  value? : ScalarRaw\n  values? : TypeValueObject[]\n  modular? : boolean\n}\n\nclass Type {\n  constructor(object : TypeObject) {\n    const { value, values, modular, id } = object\n    if (!id) throw Errors.id + JSON.stringify(object)\n    if (typeof value === \"undefined\") throw Errors.invalid.value + JSON.stringify(object)\n\n    this.value = value\n    this.id = id\n    if (modular) this.modular = modular\n    if (values) this.values.push(...values.map(value => new TypeValue(value)))\n  }\n\n  coerce(value: SelectionValue): ScalarRaw | undefined {\n    const string = String(value)\n    const number = Number(value)\n\n    if (this.modular && !Definitions.fromId(string)) return\n\n    switch (this.id) {\n      case DataType.Boolean: return !!value\n      case DataType.Number:\n      case DataType.Fontsize:\n      case DataType.Pixel: {\n        if (isNan(number)) return\n\n        return number\n      }\n      case DataType.Integer: {\n        if (isNan(number)) return\n\n        return Math.round(number)\n      }\n      case DataType.Rgb:\n      case DataType.Rgba: {\n        if (!colorValid(string)) return\n\n        break\n      }\n      case DataType.Direction4:\n      case DataType.Direction8:\n      case DataType.Mode: {\n        if (!this.values?.find(object => { object.id === string })) return\n\n        break\n      }\n    }\n    return string\n  }\n\n  id : DataType\n\n  modular = false\n\n  value : ScalarRaw\n\n  values : TypeValueObject[] = []\n}\n\nexport { Type, TypeObject }\n","import { ScalarRaw } from \"../declarations\"\nimport { DataType, DataTypes } from \"./Enums\"\nimport { Errors } from \"./Errors\"\nimport { isObject, isPopulatedString } from \"../Utilities/Is\"\nimport { Type, TypeObject } from \"./Type\"\n\nimport dataTypesJson from \"./dataTypes.json\"\n\ninterface TypesJson {\n  [index : string] : TypeObject\n}\n\nclass TypesClass {\n  constructor(object : TypesJson) {\n    Object.entries(object).forEach(entry => {\n      const [key, value] = entry\n      const dataType = <DataType> key\n      if (!DataTypes.includes(dataType)) throw Errors.type + 'DataTypes ' + key\n\n      this.propertyTypes.set(dataType, new Type({...value, id: dataType }))\n    })\n  }\n\n  propertyType(type : DataType) : Type {\n    const instance = this.propertyTypes.get(type)\n    if (!instance) throw Errors.type + 'propertyType ' + type\n\n    return instance\n  }\n\n  propertyTypeDefault(type : DataType) : ScalarRaw {\n    if (!(isPopulatedString(type) && DataTypes.includes(type))) throw Errors.type + 'propertyTypeDefault ' + type\n\n    const propertyType = this.propertyType(type)\n    if (!isObject(propertyType)) return \"\"\n\n    return propertyType.value\n  }\n\n  propertyTypes = new Map<DataType, Type>()\n}\n\nconst Types = new TypesClass(dataTypesJson)\n\nexport { Types }\n","import { Any, JsonObject, ScalarRaw, SelectionValue } from \"../declarations\"\nimport { Errors } from \"./Errors\"\nimport { DataType } from \"./Enums\"\nimport { Type } from \"./Type\"\nimport { Types } from \"./Types\"\n\ninterface PropertyObject {\n  type? : DataType\n  name? : string\n  value? : ScalarRaw\n  custom? : boolean\n}\n\n\nclass Property {\n  constructor(object: PropertyObject) {\n    const { type, name, value, custom } = object\n    if (!type) throw Errors.invalid.type\n    if (!name) throw Errors.invalid.name\n    if (typeof value === \"undefined\") throw Errors.invalid.value + JSON.stringify(object)\n\n    this.type = Types.propertyType(type)\n    this.name = name\n    this.value = value\n    this.custom = !!custom\n  }\n\n  custom: boolean\n\n  name : string\n\n  toJSON() : JsonObject {\n    return { value: this.value, type: this.type.id }\n  }\n\n  type : Type\n\n  value : ScalarRaw\n}\n\n\ninterface Propertied {\n  property(key: string): Property | undefined\n  value(key: string): SelectionValue\n  setValue(key: string, value: SelectionValue): boolean\n  properties: Property[]\n}\n\nclass PropertiedClass implements Propertied {\n  [index: string]: unknown\n\n  constructor(..._args: Any[]) {\n  }\n\n  property(name : string) : Property | undefined {\n    return this.properties.find(property => property.name === name)\n  }\n  private _properties: Property[] = []\n  public get properties(): Property[] {\n    return this._properties\n  }\n  public set properties(value: Property[]) {\n    this._properties = value\n  }\n\n\n  setValue(key: string, value: SelectionValue): boolean {\n    const property = this.property(key)\n    if (!property) throw Errors.property + key\n\n    const { type } = property\n    const coerced = type.coerce(value)\n    if (typeof coerced === 'undefined') {\n      console.error(this.constructor.name, \"setValue\", key, value)\n      return false\n    }\n\n    this[key] = coerced\n    return true\n  }\n\n  value(key : string) : SelectionValue {\n    const value = this[key]\n    if (typeof value === \"undefined\") throw Errors.property + key\n\n    // console.trace(this.constructor.name, \"value\", key, value)\n    return <SelectionValue> value\n  }\n}\n\nexport { Property, PropertyObject, Propertied, PropertiedClass }\n","import {\n  Any, Constrained, JsonObject, SelectionObject, UnknownObject\n} from \"../declarations\"\nimport { DefinitionType } from \"../Setup/Enums\"\nimport { Errors } from \"../Setup/Errors\"\nimport { Is } from \"../Utilities/Is\"\nimport { Definition } from \"./Definition\"\nimport { Time } from \"../Utilities/Time\"\nimport { idGenerate } from \"../Utilities/Id\"\nimport { PropertiedClass, Property } from \"../Setup/Property\"\nimport { Definitions } from \"../Definitions/Definitions\"\n\ninterface InstanceObject extends UnknownObject {\n  definition?: Definition\n  definitionId?: string\n  id?: string\n  label?: string\n}\n\nclass InstanceBase extends PropertiedClass {\n  constructor(...args: Any[]) {\n    super(...args)\n    const [object] = args\n    if (!Is.populatedObject(object)) throw Errors.invalid.object + 'InstanceBase'\n\n    const { definitionId = '', definition, id, label } = <InstanceObject>object\n    const definitionObject = definition || Definitions.fromId(definitionId)\n    if (!definitionObject) throw Errors.invalid.definition.object\n\n    this.definition = definitionObject\n    if (id) this._id = id\n    if (label && label !== this.definition.label) this._label = label\n  }\n\n  get copy() : Instance {\n    return this.definition.instanceFromObject(this.toJSON())\n  }\n\n  definition : Definition\n\n  get definitionId(): string { return this.definition.id }\n\n  get definitions() : Definition[] { return [this.definition] }\n\n  definitionTime(quantize : number, time : Time) : Time {\n    return time.scaleToFps(quantize) // may have fps higher than quantize and time.fps\n  }\n\n  private _id? : string\n\n  get id() : string { return this._id ||= idGenerate() }\n\n  protected _label? : string\n\n  get label() : string { return this._label || this.definition.label || this.id }\n\n  set label(value : string) { this._label = value }\n\n  get properties(): Property[] { return this.definition.properties }\n\n  property(key: string): Property | undefined { return this.definition.property(key) }\n\n  get propertyNames() : string[] {\n    return this.properties.map(property => property.name)\n  }\n\n  get propertyValues() : SelectionObject {\n    return Object.fromEntries(this.properties.map(property => {\n      return [property.name, this.value(property.name)]\n    }))\n  }\n\n  toJSON(): JsonObject {\n    // console.debug(this.constructor.name, \"toJSON\")\n    const object = {\n      definitionId: this.definitionId,\n      id: this.id,\n      type: this.type,\n      ...this.propertyValues\n    }\n    return object\n  }\n\n  get type() : DefinitionType { return this.definition.type }\n}\n\ninterface Instance extends InstanceBase {}\n\ntype InstanceClass = Constrained<InstanceBase>\n\nexport { Instance, InstanceClass, InstanceBase, InstanceObject }\n","import {\n  Any, Constrained, JsonObject, LoadPromise, SelectionValue, UnknownObject\n} from \"../declarations\"\nimport { DefinitionType } from \"../Setup/Enums\"\nimport { Errors } from \"../Setup/Errors\"\nimport { Property } from \"../Setup/Property\"\nimport { Time, Times } from \"../Utilities/Time\"\nimport { Is } from \"../Utilities/Is\"\nimport { Instance, InstanceBase, InstanceObject } from \"./Instance\"\n\ninterface DefinitionObject extends UnknownObject{\n  id? : string\n  type? : string\n  label? : string\n  icon? : string\n}\n\nclass DefinitionBase {\n  constructor(...args : Any[]) {\n    const [object] = args\n    const { id, label, icon } = <DefinitionObject> object\n    if (!(id && Is.populatedString(id))) throw Errors.invalid.definition.id + JSON.stringify(object)\n    this.id = id\n\n    this.label = label || id\n    if (icon) this.icon = icon\n\n  }\n\n  icon? : string\n\n  id : string\n\n  get instance() : Instance {\n    return this.instanceFromObject(this.instanceObject)\n  }\n\n  instanceFromObject(object : InstanceObject) : Instance {\n    const instance = new InstanceBase({ ...this.instanceObject, ...object })\n    return instance\n  }\n\n  get instanceObject() : InstanceObject {\n    const object : UnknownObject = {}\n    object.definition = this\n    this.properties.forEach(property => { object[property.name] = property.value })\n    return object\n  }\n\n  label : string\n\n  loadDefinition(_quantize: number, _start : Time, _end? : Time) : LoadPromise | void { }\n\n  definitionUrls(_start: Time, _end?: Time): string[] { return [] }\n\n  properties : Property[] = []\n\n  get propertiesModular() : Property[] { return this.properties.filter(property => property.type.modular) }\n\n  property(name : string) : Property | undefined {\n    return this.properties.find(property => property.name === name)\n  }\n\n  retain = false\n\n  toJSON() : JsonObject {\n    const object : JsonObject = { id: this.id, type: this.type }\n    if (this.icon) object.icon = this.icon\n    if (this.label !== this.id) object.label = this.label\n    return object\n  }\n\n  type! : DefinitionType\n\n  unload(_times : Times[] = []) : void {}\n\n  value(name : string) : SelectionValue | undefined {\n    const property = this.property(name)\n    if (!property) return\n\n    return property.value\n  }\n}\n\ninterface Definition extends DefinitionBase {}\n\ntype DefinitionTimes = Map<Definition, Times[]>\n\ntype DefinitionClass = Constrained<DefinitionBase>\n\nexport { Definition, DefinitionClass, DefinitionBase, DefinitionObject, DefinitionTimes }\n","import { DefinitionType } from \"../Setup/Enums\"\nimport { AudioFactory } from \"../Mash/Audio/Audio\"\nimport { EffectFactory } from \"../Mash/Effect/Effect\"\nimport { FilterFactory } from \"../Mash/Filter/Filter\"\nimport { FontFactory } from \"../Mash/Font/Font\"\nimport { ImageFactory } from \"../Mash/Image/Image\"\nimport { MergerFactory } from \"../Mash/Merger/Merger\"\nimport { ScalerFactory } from \"../Mash/Scaler/Scaler\"\nimport { ThemeFactory } from \"../Mash/Theme/Theme\"\nimport { TransitionFactory } from \"../Mash/Transition/Transition\"\nimport { VideoFactory } from \"../Mash/Video/Video\"\nimport { VideoStreamFactory } from \"../Mash/VideoStream/VideoStream\"\nimport { VideoSequenceFactory } from \"../Mash/VideoSequence/VideoSequence\"\n\ntype FactoryObject = {\n  [DefinitionType.Filter]?: FilterFactory\n  [DefinitionType.Audio]?: AudioFactory\n  [DefinitionType.Effect]?: EffectFactory\n  [DefinitionType.Font]?: FontFactory\n  [DefinitionType.Image]?: ImageFactory\n  [DefinitionType.Merger]?: MergerFactory\n  [DefinitionType.Scaler]?: ScalerFactory\n  [DefinitionType.Theme]?: ThemeFactory\n  [DefinitionType.Transition]?: TransitionFactory\n  [DefinitionType.Video]?: VideoFactory\n  [DefinitionType.VideoSequence]?: VideoSequenceFactory\n  [DefinitionType.VideoStream]?: VideoStreamFactory\n}\n\nconst Factories : FactoryObject = {}\n\nexport { Factories, FactoryObject }\n","import { AudibleSource } from \"../declarations\"\nimport { Errors } from \"../Setup/Errors\"\n\nconst AudibleSampleRate = 44100\nconst AudibleChannels = 2\n\ninterface AudibleContextSource {\n  gainNode: GainNode\n  gainSource: AudibleSource\n}\n\n// singleton owned by Cache\nclass AudibleContext {\n  addSource(id: string, source: AudibleContextSource): void {\n    // console.log(\"addSource\", id)\n    this.sourcesByClipId.set(id, source)\n  }\n\n  private _context? : AudioContext\n\n  get context() : AudioContext {\n    if (!this._context) {\n      const Klass = AudioContext || window.webkitAudioContext\n      if (!Klass) throw Errors.audibleContext\n\n      this._context = new Klass()\n    }\n    return this._context\n  }\n\n  createBuffer(seconds : number) : AudioBuffer {\n    const length = AudibleSampleRate * seconds\n    return this.context.createBuffer(AudibleChannels, length, AudibleSampleRate)\n  }\n\n  createBufferSource(buffer?: AudioBuffer): AudibleSource {\n    // console.trace(this.constructor.name, \"createBufferSource\")\n    const sourceNode = this.context.createBufferSource()\n    if (buffer) sourceNode.buffer = buffer\n    return sourceNode\n  }\n\n  createGain() : GainNode { return this.context.createGain() }\n\n  get currentTime() : number { return this.context.currentTime }\n\n  decode(buffer : ArrayBuffer) : Promise<AudioBuffer> {\n    return new Promise((resolve, reject) => (\n      this.context.decodeAudioData(\n        buffer,\n        audioData => resolve(audioData),\n        error => reject(error)\n      )\n    ))\n  }\n\n  deleteSource(id: string): void {\n    // console.log(\"deleteSource\", id)\n    const source = this.getSource(id)\n    if (!source) return\n\n    this.sourcesByClipId.delete(id)\n    const { gainSource, gainNode } = source\n    gainNode.disconnect(this.destination)\n    gainSource.disconnect(gainNode)\n    gainSource.stop()\n  }\n\n  get destination() : AudioDestinationNode { return this.context.destination }\n\n  getSource(id: string): AudibleContextSource | undefined {\n    return this.sourcesByClipId.get(id)\n  }\n\n  hasSource(id: string): boolean { return this.sourcesByClipId.has(id) }\n\n  private sourcesByClipId = new Map<string, AudibleContextSource>()\n\n  startAt(clipId: string, source: AudibleSource, start: number, duration: number, offset?: number, loops = false):void {\n    const gainNode = this.createGain()\n    source.loop = loops\n    source.connect(gainNode)\n    gainNode.connect(this.destination)\n    source.start(this.currentTime + start, offset, duration)\n    this.addSource(clipId, { gainSource: source, gainNode })\n  }\n}\n\nexport { AudibleContext }\n","import {\n  Context2D,\n  ContextData,\n  VisibleContextElement,\n  VisibleSource,\n  Point,\n  Rect,\n  Size,\n  TextStyle,\n} from \"../declarations\"\nimport { Errors } from \"../Setup/Errors\"\nimport { Is } from \"../Utilities/Is\"\nimport { Action } from \"../Editing/Action/Action\"\n\nconst $canvas = 'canvas'\nconst $2d = '2d'\nconst Point0 = { x: 0, y: 0 }\n\nclass VisibleContext {\n  constructor(object : { context2d? : Context2D } = {}) {\n    const { context2d } = object\n    // console.trace(\"VisibleContext\", \"constructor\", context2d)\n    if (context2d) this._context2d = context2d\n  }\n\n  get alpha() : number { return this.context2d.globalAlpha }\n\n  set alpha(value : number) { this.context2d.globalAlpha = value }\n\n  get canvas() : VisibleContextElement { return this.context2d.canvas }\n\n  set canvas(value: VisibleContextElement) {\n    const context2d = value.getContext(\"2d\")\n    if (!context2d) throw Errors.invalid.canvas\n    this.context2d = context2d\n  }\n\n  clear() : VisibleContext {\n    return this.clearSize(this.size)\n  }\n\n  clearSize(size : Size) : VisibleContext {\n    return this.clearRect({ ...Point0, ...size })\n  }\n\n  clearRect(rect : Rect) : VisibleContext {\n    const { x, y, width, height } = rect\n    this.context2d.clearRect(x, y, width, height)\n    return this\n  }\n\n  get composite() : string { return this.context2d.globalCompositeOperation }\n\n  set composite(value : string) { this.context2d.globalCompositeOperation = value }\n\n  private get context2d() : Context2D {\n    if (!this._context2d) {\n      // console.trace(this.constructor.name, \"get context2d creating canvas\")\n      const canvas = globalThis.document.createElement($canvas)\n      const context = canvas.getContext($2d)\n      if (!context) throw Errors.internal\n\n      this._context2d = context\n    }\n    return this._context2d\n  }\n\n  private set context2d(value : Context2D) {\n    // console.log(this.constructor.name, \"set context2d\", value)\n    this._context2d = value\n  }\n\n  get dataUrl() : string { return this.canvas.toDataURL() }\n\n  draw(source : VisibleSource) : VisibleContext {\n    return this.drawAtPoint(source, Point0)\n  }\n\n  drawAtPoint(source : VisibleSource, point: Point) : VisibleContext {\n    const { x, y } = point\n    this.context2d.drawImage(source, x, y)\n    return this\n  }\n\n  drawFill(fill : string) : VisibleContext {\n    return this.drawFillToSize(fill, this.size)\n  }\n\n  drawFillInRect(fill : string, rect : Rect) : VisibleContext {\n    const { x, y, width, height } = rect\n    const fillOriginal = this.fill\n    this.fill = fill\n    this.context2d.fillRect(x, y, width, height)\n    this.fill = fillOriginal\n    return this\n  }\n\n  drawFillToSize(fill : string, size : Size) : VisibleContext {\n    return this.drawFillInRect(fill, { ...Point0, ...size })\n  }\n\n  drawImageData(data : ImageData) : VisibleContext {\n    return this.drawImageDataAtPoint(data, Point0)\n  }\n\n  drawImageDataAtPoint(data : ImageData, point : Point) : VisibleContext {\n    const { x, y } = point\n    this.context2d.putImageData(data, x, y)\n    return this\n  }\n\n  drawInRect(source : VisibleSource, rect: Rect) : VisibleContext {\n    const { x, y, width, height } = rect\n    this.context2d.drawImage(source, x, y, width, height)\n    return this\n  }\n\n  drawInRectFromRect(source : VisibleSource, inRect: Rect, fromRect: Rect) : VisibleContext {\n    const { x: xIn, y: yIn, width: wIn, height: hIn } = inRect\n    const { x, y, width: w, height: h } = fromRect\n    const { width: sourceWidth, height: sourceHeight } = source\n    if (xIn + wIn > sourceWidth || yIn + hIn > sourceHeight) throw Errors.eval.sourceRect + JSON.stringify(inRect) + ' ' + sourceWidth + 'x' + sourceHeight\n\n    this.context2d.drawImage(source, xIn, yIn, wIn, hIn, x, y, w, h)\n    return this\n  }\n\n  drawInRectFromSize(source : VisibleSource, rect: Rect, size: Size) : VisibleContext {\n    return this.drawInRectFromRect(source, rect, { ...Point0, ...size })\n  }\n\n  drawInSizeFromSize(source : VisibleSource, inSize : Size, fromSize : Size) : VisibleContext {\n    const inRect = { ...Point0, ...inSize }\n    const fromRect = { ...Point0, ...fromSize }\n    return this.drawInRectFromRect(source, inRect, fromRect)\n  }\n\n  drawText(text: string, style : TextStyle) : VisibleContext {\n    return this.drawTextAtPoint(text, style, Point0)\n  }\n\n  drawTextAtPoint(text: string, style : TextStyle, point : Point) : VisibleContext {\n    const { x, y } = point\n    const { height, family, color, shadow, shadowPoint } = style\n\n    const fillOriginal = this.fill\n    const fontOriginal = this.font\n    const shadowOriginal = this.shadow\n    const shadowPointOriginal = this.shadowPoint\n\n    if (shadow) {\n      this.shadow = shadow\n      if (shadowPoint) this.shadowPoint = shadowPoint\n    }\n\n    this.font = `${height}px \"${family}\"`\n    this.fill = color\n    this.context2d.fillText(text, x, y + height)\n\n    this.font = fontOriginal\n    this.fill = fillOriginal\n    if (shadow) {\n      this.shadow = shadowOriginal\n      if (shadowPoint) this.shadowPoint = shadowPointOriginal\n    }\n    return this\n  }\n\n  drawToSize(source : VisibleSource, size: Size) : VisibleContext {\n    return this.drawInRect(source, { ...Point0, ...size })\n  }\n\n  drawWithAlpha(source : VisibleSource, alpha: number) : VisibleContext {\n    const original = this.alpha\n    this.alpha = alpha\n    const result = this.draw(source)\n    this.alpha = original\n    return result\n  }\n\n  drawWithComposite(source : VisibleSource, composite: string) : VisibleContext {\n    const original = this.composite\n    this.composite = composite\n    const result = this.draw(source)\n    this.composite = original\n    return result\n  }\n\n\n  get fill() : string { return String(this.context2d.fillStyle) }\n\n  set fill(value : string) { this.context2d.fillStyle = value }\n\n  get font() : string { return this.context2d.font }\n\n  set font(value : string) { this.context2d.font = value }\n\n  get imageData() : ContextData { return this.imageDataFromSize(this.size) }\n\n  get imageDataFresh() : ContextData {\n    const { width, height } = this.size\n    return this.context2d.createImageData(width, height)\n  }\n\n  imageDataFromRect(rect : Rect) : ContextData {\n    const { x, y, width, height } = rect\n    return this.context2d.getImageData(x, y, width, height)\n  }\n\n  imageDataFromSize(size : Size) : ContextData {\n    return this.imageDataFromRect({ ...Point0, ...size })\n  }\n\n  get drawingSource() : VisibleSource { return this.canvas }\n\n  get shadow() : string { return this.context2d.shadowColor }\n\n  set shadow(value : string) { this.context2d.shadowColor = value }\n\n  get shadowPoint() : Point {\n    return { x: this.context2d.shadowOffsetX, y: this.context2d.shadowOffsetY }\n  }\n\n  set shadowPoint(point : Point) {\n    this.context2d.shadowOffsetX = point.x\n    this.context2d.shadowOffsetY = point.y\n  }\n\n  get size() : Size { return { width: this.canvas.width, height: this.canvas.height } }\n\n  set size(value : Size) {\n    const { width, height } = value\n    if (Is.aboveZero(width)) this.canvas.width = width\n    if (Is.aboveZero(height)) this.canvas.height = height\n  }\n\n  private _context2d? : Context2D\n}\n\ninterface EventsDetail {\n  action? : Action\n}\ntype EventsType = CustomEvent<EventsDetail>\n\nexport { VisibleContext, EventsType, EventsDetail}\n","import { Size, Context2D, VisibleContextElement } from \"../declarations\"\nimport { AudibleContext } from \"./AudibleContext\"\nimport { VisibleContext } from \"./VisibleContext\"\n\nconst ContextTypes = [\"audible\", \"visible\"]\nconst ContextType = Object.fromEntries(ContextTypes.map(type => [type, type]))\n\nclass ContextFactoryImplementation {\n  audible() : AudibleContext { return new AudibleContext() }\n\n  fromCanvas(canvas : VisibleContextElement) : VisibleContext {\n    const context = this.visible()\n    context.canvas = canvas\n    return context\n  }\n\n  fromContext2D(context2d : Context2D) : VisibleContext {\n    return new VisibleContext({ context2d })\n  }\n\n  toSize(size: Size) {\n    const context = this.visible()\n    context.size = size\n    return context\n  }\n\n  get type() { return ContextType }\n\n  get types() { return ContextTypes }\n\n  visible() { return new VisibleContext() }\n}\n\nconst ContextFactory = new ContextFactoryImplementation()\n\nexport { ContextFactory }\n","import { WithFrame, WithLabel, WithTrack, WithLayer } from \"../declarations\"\n\nconst sortByFrame = (a : WithFrame, b : WithFrame) : number => a.frame - b.frame\nconst sortByLayer = (a : WithLayer, b : WithLayer) : number => a.layer - b.layer\nconst sortByTrack = (a : WithTrack, b : WithTrack) : number => a.track - b.track\nconst sortByLabel = (a : WithLabel, b : WithLabel) : number => {\n  if (a.label < b.label) return -1\n  if (a.label > b.label) return 1\n  return 0\n}\n\nconst Sort = {\n  byFrame: sortByFrame, byLabel: sortByLabel, byTrack: sortByTrack, byLayer: sortByLayer\n}\n\nexport { Sort, sortByFrame, sortByLabel, sortByTrack, sortByLayer }\n","import { Any, JsonObject } from \"../../declarations\"\nimport { DataType, DefinitionType, TrackType } from \"../../Setup/Enums\"\nimport { Errors } from \"../../Setup/Errors\"\nimport { PropertiedClass, Property } from \"../../Setup/Property\"\nimport { idGenerate } from \"../../Utilities/Id\"\n\nimport { sortByFrame } from \"../../Utilities/Sort\"\nimport { Definitions } from \"../../Definitions/Definitions\"\nimport { Clip } from \"../../Mixin/Clip/Clip\"\nimport { TrackObject } from \"./Track\"\n\nclass TrackClass extends PropertiedClass {\n  constructor(...args : Any[]) {\n    super(...args)\n    const [object] = args\n    const { id, clips, layer, trackType, dense } = <TrackObject> object\n    if (id) this._id = id\n    if (layer) this.layer = layer\n    if (trackType) this.trackType = trackType\n    if (clips) this.clips.push(...clips.map(clip => {\n      const { definitionId } = clip\n      if (!definitionId) throw Errors.id + JSON.stringify(clip)\n\n      const definition = Definitions.fromId(definitionId)\n      const clipWithTrack = { track: this.layer, ...clip }\n      return <Clip> definition.instanceFromObject(clipWithTrack)\n    }))\n\n    if (typeof dense === 'undefined') {\n      this.dense = !this.layer && this.trackType === TrackType.Video\n      // console.log(this.constructor.name, \"dense\", this.dense, \"=\", !this.layer, \"&&\", this.trackType === TrackType.Video)\n    } else {\n      this.dense = !!dense\n      // console.log(this.constructor.name, \"dense\", this.dense, \"=\", dense)\n    }\n\n    this.properties.push(\n      new Property({ name: \"dense\", type: DataType.Boolean, value: false })\n    )\n  }\n\n  addClips(clips : Clip[], insertIndex = 0) : void {\n    // console.log(\"addClips\", clips.length, insertIndex, this.layer)\n    let clipIndex = insertIndex || 0\n    if (!this.dense) clipIndex = 0 // ordered by clip.frame values\n\n    const origIndex = clipIndex // note original, since it may decrease...\n    const movingClips : Clip[] = [] // build array of clips already in this.clips\n    // build array of my clips excluding the clips we're inserting\n    const spliceClips = this.clips.filter((clip, index) => {\n      const moving = clips.includes(clip)\n      if (moving) movingClips.push(clip)\n      // insert index should be decreased when clip is moving and comes before\n      if (origIndex && moving && index < origIndex) clipIndex -= 1\n      return !moving\n    })\n    // insert the clips we're adding at the correct index, then sort properly\n    spliceClips.splice(clipIndex, 0, ...clips)\n    this.sortClips(spliceClips)\n\n    // set the track of clips we aren't moving\n    const newClips = clips.filter(clip => !movingClips.includes(clip))\n    newClips.forEach(clip => {\n      // console.log(this.constructor.name, \"addClips\", this.layer)\n      clip.track = this.layer\n    })\n\n    // remove all my current clips and replace with new ones in one step\n    this.clips.splice(0, this.clips.length, ...spliceClips)\n  }\n\n  clips: Clip[] = []\n\n  dense = false\n\n  frameForClipsNearFrame(clips : Clip[], frame = 0) : number {\n    if (this.dense) return frame\n\n    const others = this.clips.filter(clip => !clips.includes(clip) && clip.endFrame > frame)\n    if (!others.length) return frame\n\n    const startFrame = Math.min(...clips.map(clip => clip.frame))\n    const endFrame = Math.max(...clips.map(clip => clip.endFrame))\n    const frames = endFrame - startFrame\n\n    let lastFrame = frame\n    others.find(clip => {\n      if (clip.frame >= lastFrame + frames) return true\n\n      lastFrame = clip.endFrame\n    })\n    return lastFrame\n  }\n\n  get frames() : number {\n    if (!this.clips.length) return 0\n\n    const clip = this.clips[this.clips.length - 1]\n    return clip.frame + clip.frames\n  }\n\n  private _id? : string\n\n  get id() : string { return this._id ||= idGenerate() }\n\n  layer = 0\n\n  removeClips(clips : Clip[]) : void {\n    const spliceClips = this.clips.filter(clip => !clips.includes(clip))\n    if (spliceClips.length === this.clips.length) {\n      // console.trace(\"removeClips\", this.trackType, this.layer, this.clips)\n      throw Errors.internal + 'removeClips'\n    }\n    clips.forEach(clip => { clip.track = -1 })\n    this.sortClips(spliceClips)\n    this.clips.splice(0, this.clips.length, ...spliceClips)\n  }\n\n  sortClips(clips : Clip[]) : void {\n    if (this.dense) {\n      let frame = 0\n      clips.forEach((clip, i) => {\n        const isTransition = clip.type === DefinitionType.Transition\n        if (i && isTransition) frame -= clip.frames\n        clip.frame = frame\n        if (!isTransition) frame += clip.frames\n      })\n    }\n    clips.sort(sortByFrame)\n  }\n\n  toJSON() : JsonObject {\n    return {\n      id: this.id,\n      dense: this.dense,\n      trackType: this.trackType,\n      layer: this.layer,\n      clips: this.clips,\n    }\n  }\n\n  trackType = TrackType.Video\n}\n\nexport { TrackClass }\n","import { Track, TrackObject } from \"./Track\"\nimport { TrackClass } from \"./TrackInstance\"\n\nconst trackInstance = (object : TrackObject) : Track => {\n  return new TrackClass(object)\n}\n\nconst TrackFactory = {\n  instance: trackInstance,\n}\n\nexport { TrackFactory }\n","import { DefinitionType } from \"../../Setup/Enums\"\nimport { Factories } from \"../../Definitions/Factories\"\nimport { Errors } from \"../../Setup/Errors\"\nimport { AudioFactory } from \"../../Mash/Audio/Audio\"\nimport { EffectFactory } from \"../../Mash/Effect/Effect\"\nimport { FilterFactory } from \"../../Mash/Filter/Filter\"\nimport { FontFactory } from \"../../Mash/Font/Font\"\nimport { ImageFactory } from \"../../Mash/Image/Image\"\nimport { MergerFactory } from \"../../Mash/Merger/Merger\"\nimport { ScalerFactory } from \"../../Mash/Scaler/Scaler\"\nimport { ThemeFactory } from \"../../Mash/Theme/Theme\"\nimport { TransitionFactory } from \"../../Mash/Transition/Transition\"\nimport { VideoFactory } from \"../../Mash/Video/Video\"\nimport { VideoStreamFactory } from \"../../Mash/VideoStream/VideoStream\"\nimport { VideoSequenceFactory } from \"../../Mash/VideoSequence/VideoSequence\"\nimport { ContextFactory } from \"../../Playing/ContextFactory\"\nimport { TrackFactory } from \"../../Mash/Track/TrackFactory\"\n\nclass Factory {\n  static get [DefinitionType.Audio]() : AudioFactory {\n    const factory = Factories[DefinitionType.Audio]\n    if (!factory) throw Errors.invalid.factory + DefinitionType.Audio\n\n    return factory\n  }\n\n  static get context(): typeof ContextFactory { return ContextFactory }\n\n  static get [DefinitionType.Effect]() : EffectFactory {\n    const factory = Factories[DefinitionType.Effect]\n    if (!factory) throw Errors.invalid.factory + DefinitionType.Effect\n\n    return factory\n  }\n\n  static get [DefinitionType.Filter]() : FilterFactory {\n    const factory = Factories[DefinitionType.Filter]\n    if (!factory) throw Errors.invalid.factory + DefinitionType.Filter\n\n    return factory\n  }\n\n  static get [DefinitionType.Font]() : FontFactory {\n    const factory = Factories[DefinitionType.Font]\n    if (!factory) throw Errors.invalid.factory + DefinitionType.Font\n\n    return factory\n  }\n\n  static get [DefinitionType.Image]() : ImageFactory {\n    const factory = Factories[DefinitionType.Image]\n    if (!factory) throw Errors.invalid.factory + DefinitionType.Image\n\n    return factory\n  }\n\n  static get [DefinitionType.Merger]() : MergerFactory {\n    const factory = Factories[DefinitionType.Merger]\n    if (!factory) throw Errors.invalid.factory + DefinitionType.Merger\n\n    return factory\n  }\n\n  static get [DefinitionType.Scaler]() : ScalerFactory {\n    const factory = Factories[DefinitionType.Scaler]\n    if (!factory) throw Errors.invalid.factory + DefinitionType.Scaler\n\n    return factory\n  }\n\n  static get [DefinitionType.Theme]() : ThemeFactory {\n    const factory = Factories[DefinitionType.Theme]\n    if (!factory) throw Errors.invalid.factory + DefinitionType.Theme\n\n    return factory\n  }\n\n  static get [DefinitionType.Transition]() : TransitionFactory {\n    const factory = Factories[DefinitionType.Transition]\n    if (!factory) throw Errors.invalid.factory + DefinitionType.Transition\n\n    return factory\n  }\n\n  static get track(): typeof TrackFactory { return TrackFactory }\n\n  static get [DefinitionType.Video]() : VideoFactory {\n    const factory = Factories[DefinitionType.Video]\n    if (!factory) throw Errors.invalid.factory + DefinitionType.Video\n\n    return factory\n  }\n\n  static get [DefinitionType.VideoSequence]() : VideoSequenceFactory {\n    const factory = Factories[DefinitionType.VideoSequence]\n    if (!factory) throw Errors.invalid.factory + DefinitionType.VideoSequence\n\n    return factory\n  }\n\n  static get [DefinitionType.VideoStream]() : VideoStreamFactory {\n    const factory = Factories[DefinitionType.VideoStream]\n    if (!factory) throw Errors.invalid.factory + DefinitionType.VideoStream\n\n    return factory\n  }\n  private constructor() {}\n}\n\nexport { Factory }\n","import { Errors } from \"../../Setup/Errors\"\nimport { Actions } from \"../Actions\"\nimport { Mash } from \"../../Mash/Mash/Mash\"\nimport { Selection } from \"../../Masher/Masher\"\n\ninterface ActionObject {\n  actions : Actions\n  mash : Mash\n  redoAction() : void\n  redoSelection: Selection\n  type : string\n  undoAction(): void\n  undoSelection: Selection\n}\n\nclass Action {\n  constructor(object : ActionObject) {\n    const { actions, mash, redoSelection, type, undoSelection } = object\n    this.actions = actions\n    this.mash = mash\n    this.redoSelection = redoSelection\n    this.type = type\n    this.undoSelection = undoSelection\n  }\n\n  actions : Actions\n\n  done =  false\n\n  mash : Mash\n\n  redo() : void {\n    this.redoAction()\n    this.done = true\n  }\n\n  redoAction() : void { throw Errors.unimplemented }\n\n  redoSelection: Selection\n\n  get selection(): Selection {\n    if (this.done) return this.redoSelection\n\n    return this.undoSelection\n  }\n\n  type : string\n\n  undo() : void {\n    this.undoAction()\n    this.done = false\n  }\n\n  undoAction() : void { throw Errors.unimplemented }\n\n  undoSelection: Selection\n}\n\nexport { Action, ActionObject }\n","import { isPopulatedString } from \"./Is\"\n\nexport const Capitalize = (value : string) : string => {\n  if (!isPopulatedString(value)) return value\n\n  return `${value[0].toUpperCase()}${value.substr(1)}`\n};\n","import { TrackType } from \"../../Setup/Enums\"\nimport { Action, ActionObject } from \"./Action\"\n\ninterface AddTrackActionObject extends ActionObject {\n  trackType : TrackType\n}\nclass AddTrackAction extends Action {\n  constructor(object : AddTrackActionObject) {\n    super(object)\n    const { trackType } = object\n    this.trackType = trackType\n  }\n\n  trackType : TrackType\n\n  redoAction() : void { this.mash.addTrack(this.trackType) }\n\n  undoAction() : void { this.mash.removeTrack(this.trackType) }\n}\n\nexport { AddTrackAction, AddTrackActionObject }\n","\nimport { Track } from \"../../Mash\"\nimport { Clip } from \"../../Mixin/Clip/Clip\"\nimport { AddTrackAction, AddTrackActionObject } from \"./AddTrackAction\"\n\ninterface AddClipToTrackActionObject extends AddTrackActionObject {\n  clip : Clip\n  createTracks : number\n  insertIndex : number\n  trackIndex : number\n}\n\nclass AddClipToTrackAction extends AddTrackAction {\n  constructor(object : AddClipToTrackActionObject) {\n    super(object)\n    const { clip, createTracks, insertIndex, trackIndex } = object\n    this.clip = clip\n    this.createTracks = createTracks\n    this.insertIndex = insertIndex\n    this.trackIndex = trackIndex\n  }\n\n  clip : Clip\n\n  createTracks : number\n\n  insertIndex : number\n\n  trackIndex : number\n\n  get clips() : Clip[] { return this.track.clips }\n\n  get track() : Track { return this.mash.trackOfTypeAtIndex(this.trackType, this.trackIndex) }\n\n  redoAction() : void {\n    for (let i = 0; i < this.createTracks; i += 1) { super.redoAction() }\n    this.mash.addClipsToTrack([this.clip], this.trackIndex, this.insertIndex)\n  }\n\n  undoAction() : void {\n    this.mash.removeClipsFromTrack([this.clip])\n    for (let i = 0; i < this.createTracks; i += 1) { super.undoAction() }\n  }\n}\n\nexport { AddClipToTrackAction }\n","import { Clip } from \"../../Mixin/Clip/Clip\"\nimport { Action, ActionObject } from \"./Action\"\n\ninterface MoveClipsActionObject extends ActionObject {\n  clips : Clip[]\n  insertIndex : number\n  redoFrames? : number[]\n  trackIndex : number\n  undoFrames? : number[]\n  undoInsertIndex : number\n  undoTrackIndex : number\n}\nclass MoveClipsAction extends Action {\n  constructor(object : MoveClipsActionObject) {\n    super(object)\n    const {\n      clips,\n      insertIndex,\n      redoFrames,\n      trackIndex,\n      undoFrames,\n      undoInsertIndex,\n      undoTrackIndex\n    } = object\n    this.clips = clips\n    this.insertIndex = insertIndex\n    this.redoFrames = redoFrames\n    this.trackIndex = trackIndex\n    this.undoFrames = undoFrames\n    this.undoInsertIndex = undoInsertIndex\n    this.undoTrackIndex = undoTrackIndex\n  }\n\n  clips : Clip[]\n\n  insertIndex : number\n\n  trackIndex : number\n\n  undoTrackIndex : number\n\n  undoInsertIndex : number\n\n  undoFrames? : number[]\n\n  redoFrames? : number[]\n\n  addClips(trackIndex : number, insertIndex : number, frames?: number[]) : void {\n    this.mash.addClipsToTrack(this.clips, trackIndex, insertIndex, frames)\n  }\n\n  redoAction() : void {\n    this.addClips(this.trackIndex, this.insertIndex, this.redoFrames)\n  }\n\n  undoAction() : void {\n    this.addClips(this.undoTrackIndex, this.undoInsertIndex, this.undoFrames)\n  }\n}\nexport { MoveClipsAction }\n","import { Effect } from \"../../Mash/Effect/Effect\"\nimport { Action, ActionObject } from \"./Action\"\n\ninterface AddEffectActionObject extends ActionObject {\n  effect : Effect\n\n  effects : Effect[]\n\n  index : number\n}\nclass AddEffectAction extends Action {\n  constructor(object : AddEffectActionObject) {\n    super(object)\n    const { effect, effects, index } = object\n    this.effect = effect\n    this.effects = effects\n    this.index = index\n  }\n  effect : Effect\n\n  effects : Effect[]\n\n  index : number\n\n  redoAction() : void { this.effects.splice(this.index, 0, this.effect) }\n\n  undoAction() : void { this.effects.splice(this.index, 1) }\n}\n\nexport { AddEffectAction, AddEffectActionObject }\n","import { Effect } from \"../../Mash/Effect/Effect\"\nimport { Clip } from \"../../Mixin/Clip/Clip\"\nimport { SelectionValue } from \"../../declarations\"\nimport { Action, ActionObject } from \"./Action\"\n\ninterface ChangeActionObject extends ActionObject {\n  property : string\n  redoValue : SelectionValue\n  target : Clip | Effect\n  undoValue : SelectionValue\n}\n\nclass ChangeAction extends Action {\n  constructor(object : ChangeActionObject) {\n    super(object)\n    const { property, redoValue, target, undoValue } = object\n    this.property = property\n    this.redoValue = redoValue\n    this.target = target\n    this.undoValue = undoValue\n  }\n\n  property : string\n\n  redoValue : SelectionValue\n\n  target : Clip | Effect\n\n  undoValue : SelectionValue\n\n  get redoValueNumeric() : number { return Number(this.redoValue) }\n\n  get undoValueNumeric() : number { return Number(this.undoValue) }\n\n  redoAction() : void {\n    this.target.setValue(this.property, this.redoValue)\n  }\n\n  undoAction() : void {\n    this.target.setValue(this.property, this.undoValue)\n  }\n\n  updateAction(value : SelectionValue) : void {\n    this.redoValue = value\n    this.redo()\n  }\n}\n\nexport { ChangeAction, ChangeActionObject }\n","import { Clip } from \"../../Mixin/Clip/Clip\"\nimport { ChangeAction, ChangeActionObject } from \"./ChangeAction\"\n\nclass ChangeFramesAction extends ChangeAction {\n  constructor(object : ChangeActionObject) {\n    super(object)\n    this.clip = <Clip> this.target\n  }\n\n  clip : Clip\n\n  redoAction() : void {\n    this.mash.changeClipFrames(this.clip, this.redoValueNumeric)\n  }\n\n  undoAction() : void {\n    this.mash.changeClipFrames(this.clip, this.undoValueNumeric)\n  }\n}\n\nexport { ChangeFramesAction }\n","import { Audible } from \"../../Mixin/Audible/Audible\"\nimport { ChangeAction, ChangeActionObject } from \"./ChangeAction\"\n\ninterface ChangeTrimActionObject extends ChangeActionObject {\n  frames : number\n}\nclass ChangeTrimAction extends ChangeAction {\n  constructor(object : ChangeTrimActionObject) {\n    super(object)\n    const { frames, target } = object\n    this.frames = frames\n    this.audibleClip = <Audible> target\n  }\n  audibleClip : Audible\n\n  frames : number\n\n  redoAction() : void {\n    this.mash.changeClipTrimAndFrames(this.audibleClip, this.redoValueNumeric, this.frames)\n  }\n\n  undoAction() : void {\n    this.mash.changeClipTrimAndFrames(this.audibleClip, this.undoValueNumeric, this.frames)\n  }\n}\n\nexport { ChangeTrimAction }\n","import { Clip } from \"../../Mixin/Clip/Clip\"\nimport { Action, ActionObject } from \"./Action\"\n\ninterface SplitActionObject extends ActionObject {\n  index : number\n  insertClip : Clip\n  redoFrames : number\n  splitClip : Clip\n  trackClips : Clip[]\n  undoFrames : number\n}\n\nclass SplitAction extends Action {\n  constructor(object : SplitActionObject) {\n    super(object)\n    const { index, insertClip, redoFrames, splitClip, trackClips, undoFrames } = object\n    this.index = index\n    this.insertClip = insertClip\n    this.redoFrames = redoFrames\n    this.splitClip = splitClip\n    this.trackClips = trackClips\n    this.undoFrames = undoFrames\n  }\n\n  index : number\n\n  insertClip : Clip\n\n  redoFrames : number\n\n  splitClip : Clip\n\n  trackClips : Clip[]\n\n  undoFrames : number\n\n  redoAction() : void {\n    this.trackClips.splice(this.index, 0, this.insertClip)\n    this.splitClip.frames = this.redoFrames\n  }\n\n  undoAction() : void {\n    this.splitClip.frames = this.undoFrames\n    this.trackClips.splice(this.index, 1)\n  }\n}\n\nexport { SplitAction }\n","import { Clip } from \"../../Mixin/Clip/Clip\"\nimport { Action, ActionObject } from \"./Action\"\n\ninterface FreezeActionObject extends ActionObject {\n  frames : number\n  freezeClip : Clip\n  frozenClip : Clip\n  index : number\n  insertClip : Clip\n  trackClips : Clip[]\n}\n\nclass FreezeAction extends Action {\n  constructor(object : FreezeActionObject) {\n    super(object)\n    const { frames,freezeClip, frozenClip, index, insertClip, trackClips } = object\n    this.frames = frames\n    this.freezeClip = freezeClip\n    this.frozenClip = frozenClip\n    this.index = index\n    this.insertClip = insertClip\n    this.trackClips = trackClips\n\n  }\n  frames : number\n\n  index : number\n\n  trackClips : Clip[]\n\n  insertClip : Clip\n\n  freezeClip : Clip\n\n  frozenClip : Clip\n\n  redoAction() : void {\n    this.trackClips.splice(this.index, 0, this.insertClip, this.frozenClip)\n    this.freezeClip.frames -= this.frames\n  }\n\n  undoAction() : void {\n    this.freezeClip.frames += this.frames\n    this.trackClips.splice(this.index, 2)\n  }\n}\n\nexport { FreezeAction }\n","import { Effect } from \"../../Mash/Effect/Effect\"\nimport { Action, ActionObject } from \"./Action\"\n\ninterface MoveEffectsActionObject extends ActionObject {\n  effects : Effect[]\n  redoEffects : Effect[]\n  undoEffects : Effect[]\n}\nclass MoveEffectsAction extends Action {\n  constructor(object : MoveEffectsActionObject) {\n    super(object)\n    const { effects, redoEffects, undoEffects } = object\n    this.effects = effects\n    this.redoEffects = redoEffects\n    this.undoEffects = undoEffects\n  }\n\n  effects : Effect[]\n\n  redoEffects : Effect[]\n\n  undoEffects : Effect[]\n\n  redoAction() : void {\n    this.effects.splice(0, this.effects.length, ...this.redoEffects)\n  }\n\n  undoAction() : void {\n    this.effects.splice(0, this.effects.length, ...this.undoEffects)\n  }\n}\n\nexport { MoveEffectsAction }\n","import { Track } from \"../../Mash\"\nimport { Clip } from \"../../Mixin/Clip/Clip\"\nimport { Action, ActionObject } from \"./Action\"\n\ninterface RemoveClipsActionObject extends ActionObject {\n  clips : Clip[]\n  index : number\n  track : Track\n}\nclass RemoveClipsAction extends Action {\n  constructor(object : RemoveClipsActionObject) {\n    super(object)\n    const { clips, index, track } = object\n    this.clips = clips\n    this.index = index\n    this.track = track\n  }\n\n  track : Track\n\n  clips : Clip[]\n\n  index : number\n\n  get trackIndex() : number { return this.track.layer }\n\n  redoAction() : void {\n    this.mash.removeClipsFromTrack(this.clips)\n  }\n\n  undoAction() : void {\n    this.mash.addClipsToTrack(this.clips, this.trackIndex, this.index)\n  }\n}\n\nexport { RemoveClipsAction }\n","import { UnknownObject } from \"../../declarations\"\nimport { Errors } from \"../../Setup/Errors\"\nimport { Capitalize } from \"../../Utilities/Capitalize\"\nimport { Action, ActionObject } from \"./Action\"\nimport { AddTrackAction } from \"./AddTrackAction\"\nimport { AddClipToTrackAction } from \"./AddClipToTrackAction\"\nimport { MoveClipsAction } from \"./MoveClipsAction\"\nimport { AddEffectAction } from \"./AddEffectAction\"\nimport { ChangeAction } from \"./ChangeAction\"\nimport { ChangeFramesAction } from \"./ChangeFramesAction\"\nimport { ChangeTrimAction } from \"./ChangeTrimAction\"\nimport { SplitAction } from \"./SplitAction\"\nimport { FreezeAction } from \"./FreezeAction\"\nimport { MoveEffectsAction } from \"./MoveEffectsAction\"\nimport { RemoveClipsAction } from \"./RemoveClipsAction\"\n\n\nconst classes : { [index: string] : typeof Action}= {\n  AddTrack: AddTrackAction,\n  AddClipsToTrack: AddClipToTrackAction,\n  MoveClips: MoveClipsAction,\n  AddEffect: AddEffectAction,\n  Change: ChangeAction,\n  ChangeFrames: ChangeFramesAction,\n  ChangeTrim: ChangeTrimAction,\n  Split: SplitAction,\n  Freeze: FreezeAction,\n  MoveEffects: MoveEffectsAction,\n  RemoveClips: RemoveClipsAction,\n}\n\nclass ActionFactoryClass {\n  createFromObject(object : UnknownObject) : Action {\n    const { type } = object\n    if (typeof type !== \"string\") throw Errors.type + JSON.stringify(object)\n\n    return new classes[Capitalize(type)](<ActionObject><unknown> object)\n  }\n}\n\nconst ActionFactory = new ActionFactoryClass()\n\nexport { ActionFactory }\n","import { ScrollMetrics } from '../declarations'\n\n\nconst ElementScrollProps = [\n  'scrollPaddingleft',\n  'scrollPaddingRight',\n  'scrollPaddingTop',\n  'scrollPaddingBottom',\n]\nconst elementScrollMetrics = (element?: Element | null): ScrollMetrics | undefined => {\n  if (!element) return\n\n  const style: CSSStyleDeclaration = getComputedStyle(element)\n  const entries = ElementScrollProps.map(key => {\n    const value = style.getPropertyValue(key) || '0px'\n    const number = Number(value.slice(0, -2))\n    return [key, isNaN(number) ? 0 : number]\n  })\n  const { scrollLeft, scrollTop } = element\n  const { x, y, width, height } = element.getBoundingClientRect()\n  entries.push(['scrollLeft', scrollLeft])\n  entries.push(['scrollTop', scrollTop])\n  entries.push(['x', x])\n  entries.push(['y', y])\n  entries.push(['width', width])\n  entries.push(['height', height])\n  return Object.fromEntries(entries)\n}\n\nconst Element = {\n  scrollMetrics: elementScrollMetrics,\n}\n\nexport { Element, elementScrollMetrics }\n","import { EventType } from \"../Setup/Enums\"\n\nclass Emitter extends EventTarget {\n  emit(type: EventType): void { this.dispatchEvent(new CustomEvent(type)) }\n}\n\nexport { Emitter }\n","import {\n  EvaluatorValue,\n  Scalar,\n  UnknownObject,\n  ScalarRaw,\n  ScalarValue,\n  Size,\n  ValueObject\n} from \"../declarations\"\nimport { Errors } from \"../Setup/Errors\"\nimport { Is } from \"./Is\"\nimport { TimeRange } from \"./TimeRange\"\nimport { VisibleContext } from \"../Playing\"\n\nconst KEYS_SIZED = ['mm_width', 'mm_height']\n\nconst KEYS_GETTERS = [\n  \"mm_dimensions\",\n  \"mm_duration\",\n  \"mm_fps\",\n  \"mm_height\",\n  \"mm_t\",\n  \"mm_width\",\n  \"t\",\n]\n\nconst KEYS = [\n  \"ceil\",\n  \"floor\",\n  \"mm_cmp\",\n  \"mm_horz\",\n  \"mm_max\",\n  \"mm_min\",\n  \"mm_vert\",\n  ...KEYS_GETTERS,\n  ...KEYS_SIZED\n]\n\nconst $evaluator = \"evaluator\"\n\nconst arrayFromElements = (elements : Scalar) : ScalarValue[] => {\n  if (typeof elements === \"string\") return String(elements).split(',')\n\n  return <ScalarValue[]> elements\n}\n\nconst conditionalExpression = (conditional : UnknownObject) : string => {\n  const { condition } = conditional\n\n  // not strict equality, since we may have strings and numbers\n  if (Is.defined(conditional.is)) return `${condition}==${conditional.is}`\n\n  const elements = conditional.in\n  if (Is.undefined(elements)) return String(condition)\n\n  // support supplying values as array or comma-delimited string\n  const array = arrayFromElements(<Scalar> elements)\n\n  const strings = Is.string(array[0])\n  const values = array.map(element => (strings ? `\"${element}\"` : element))\n  const type = strings ? 'String' : 'Number'\n  const expression = `([${values.join(',')}].includes(${type}(${condition})))`\n  return expression\n}\n\nconst replaceOperators = (string : string) : string => (\n  string.replaceAll(' or ', ' || ').replaceAll(' and ', ' && ')\n)\n\nclass Evaluator {\n  [index: string] : unknown\n\n  constructor(timeRange : TimeRange, size : Size, context? : VisibleContext, mergeContext? : VisibleContext) {\n    this.timeRange = timeRange\n    this.context = context\n    this.mergeContext = mergeContext\n    this.size = size\n    this.setInputSize(this.size)\n  }\n\n  ceil = Math.ceil\n\n  conditionalValue(conditionals : ValueObject[]) : ScalarValue {\n    // console.log(this.constructor.name, \"conditionalValue\", conditionals)\n    const trueConditional = conditionals.find((conditional) => {\n      const expression = replaceOperators(conditionalExpression(conditional))\n      const result = this.evaluateExpression(expression)\n      // console.log(this.constructor.name, \"conditionalValue\", expression, \"=\", result)\n      return result\n    })\n    if (typeof trueConditional === \"undefined\") throw Errors.eval.conditionTruth\n\n    const { value } = trueConditional\n    if (typeof value === \"undefined\") throw Errors.eval.conditionValue\n\n    // console.log(this.constructor.name, \"conditionalValue\", value.constructor.name, value)\n    return value\n  }\n\n  context? : VisibleContext\n\n  get duration() : number { return this.timeRange.lengthSeconds }\n\n  evaluate(value : ScalarValue | ValueObject[]) : ScalarValue {\n    // console.log(this.constructor.name, \"evaluate\", value)\n    if (typeof value === \"number\") return value\n\n    const expression = (typeof value === \"string\") ? String(value) : this.conditionalValue(value)\n    if (typeof expression === \"number\") return expression\n\n    const result = this.evaluateExpression(expression)\n    // console.log(this.constructor.name, \"evaluate\", expression, \"=\", result)\n    return result\n  }\n\n  private evaluateExpression(expression : string) : ScalarValue {\n    const script = `return ${this.replaceKeys(expression)}`\n    try {\n      // eslint-disable-next-line no-new-func\n      const method = new Function($evaluator, script)\n      const result = method(this)\n      // console.log(this.constructor.name, \"evaluateExpression\", expression, result)\n      return result\n    } catch (exception) {\n      //console.warn(`Evaluator.evaluateExpression`, exception, expression, this.map)\n      return expression\n    }\n  }\n\n  floor = Math.floor\n\n  get(key : string) : EvaluatorValue | undefined {\n    if (this.map.has(key)) {\n      // console.log(\"Evaluator.get returning value from map\", key, this.map.get(key))\n      return this.map.get(key)\n    }\n\n    if (!KEYS.includes(key)) throw Errors.eval.get + key\n\n    const value = this[key]\n    if (KEYS_GETTERS.includes(key)) return <EvaluatorValue> value\n\n    if (typeof value === \"function\") {\n      // console.log(\"Evaluator.get returning method\", key)\n      return value.bind(this)\n    }\n\n    throw Errors.eval.get + key\n\n    // return // unknown key\n  }\n\n  has(key : string) : boolean { return KEYS.includes(key) || this.map.has(key) }\n\n  initialize(key : string, value : EvaluatorValue) : boolean {\n    if (this.has(key)) return false\n\n    this.set(key, value)\n    return true\n  }\n\n  get inputSize() : Size {\n    return {\n      width: Number(this.get(\"mm_input_width\")),\n      height: Number(this.get(\"mm_input_height\"))\n    }\n  }\n\n  get keys() : string[] { return [...new Set([...this.map.keys(), ...KEYS])] }\n\n  private map = new Map<string, EvaluatorValue>()\n\n  mergeContext? : VisibleContext\n\n  mm_cmp(a : number, b : number, x : number, y : number) : number {\n    return ((a > b) ? x : y)\n  }\n\n  get mm_dimensions() : string { return `${this.mm_width}x${this.mm_height}` }\n\n  get mm_duration() : number { return this.duration }\n\n  get mm_fps() : number { return this.timeRange.fps }\n\n  get mm_height() : number { return this.size.height }\n\n  mm_horz(size : ScalarValue, proud : ScalarRaw) : number {\n    return this.sized(0, size, proud)\n  }\n\n  mm_max = Math.max\n\n  mm_min = Math.min\n\n  get mm_t() : number { return this.position }\n\n  mm_vert(size : ScalarValue, proud : ScalarRaw) : number {\n    return this.sized(1, size, proud)\n  }\n\n  get mm_width() : number { return this.size.width }\n\n  get position() : number { return this.timeRange.position }\n\n  replaceKeys(value : string) : string {\n    let expression = value\n    const expressions = Object.fromEntries(this.keys.map(key => ([\n      key, new RegExp(`\\\\b${key}\\\\b`, 'g')\n    ])))\n    Object.entries(expressions).forEach(([key, regExp]) => {\n      expression = expression.replaceAll(regExp, `${$evaluator}.get(\"${key}\")`)\n    })\n    return expression\n  }\n\n  set(key : string, value : EvaluatorValue) : void { this.map.set(key, value) }\n\n  setInputSize({ width, height } : Size) : void {\n    this.set(\"in_h\", height)\n    this.set(\"mm_input_height\", height)\n    this.set(\"in_w\", width)\n    this.set(\"mm_input_width\", width)\n  }\n\n  size : Size\n\n  sized(vertical : number, size : ScalarValue, proud : ScalarRaw) : number {\n    const scale : number = Is.float(size) ? Number(size) : parseFloat(String(size))\n    if (Is.nan(scale)) throw Errors.eval.number + 'scale'\n\n    const sizedKey = KEYS_SIZED[vertical]\n    const sizedValue = this.get(sizedKey)\n    const value = parseFloat(String(sizedValue))\n    if (Is.nan(value)) throw Errors.eval.number + `value ${sizedKey}=>${sizedValue}`\n\n    const scaled = value * scale\n    if (!proud) return scaled\n    const otherSizedKey = KEYS_SIZED[Math.abs(vertical - 1)]\n    const otherValue = this.get(otherSizedKey)\n    if (typeof otherValue === \"undefined\") throw Errors.internal + 'otherValue'\n\n    const other = parseFloat(String(otherValue))\n    if (Is.nan(other)) throw Errors.eval.number + 'other'\n\n    if (other <= value) return scaled\n\n    return value + (scale - 1.0) * other\n  }\n\n  get t() : number { return this.mm_t }\n\n  timeRange : TimeRange\n}\n\nexport { Evaluator }\n","import { NumberConverter } from \"../declarations\"\n\nconst roundMethod = (rounding = '') : NumberConverter => {\n  switch (rounding) {\n    case 'ceil': return Math.ceil\n    case 'floor': return Math.floor\n    default: return Math.round\n  }\n}\n\nconst roundWithMethod = (number: number, method = ''): number => {\n  const func = roundMethod(method)\n  return func(number)\n}\n\nconst Round = {\n  method: roundMethod,\n  withMethod: roundWithMethod,\n}\n\nexport { Round, roundMethod, roundWithMethod }\n","import { Point, Rgba, ScalarValue, Size, Pixels } from \"../declarations\"\nimport { roundWithMethod } from \"./Round\"\n\nconst pixelFromPoint = (pt : Point, width : number) => pt.y * width + pt.x\n\nconst pixelToPoint = (index : number, width : number) : Point => (\n  { x: index % width, y: Math.floor(index / width) }\n)\n\nconst pixelToIndex = (pixel : number) => pixel * 4\n\nconst pixelRgbaAtIndex = (index : number, pixels : Pixels) : Rgba => (\n  {\n    r: pixels[index],\n    g: pixels[index + 1],\n    b: pixels[index + 2],\n    a: pixels[index + 3],\n  }\n)\n\nconst pixelRgba = (pixel : number, data : Pixels) => pixelRgbaAtIndex(pixelToIndex(pixel), data)\n\nconst pixelSafe = (pixel : number, offsetPoint: Point, size : Size) => {\n  const { x, y } = offsetPoint\n  const { width, height } = size\n  const pt = pixelToPoint(pixel, width)\n  pt.x = Math.max(0, Math.min(width - 1, pt.x + x))\n  pt.y = Math.max(0, Math.min(height - 1, pt.y + y))\n  return pixelFromPoint(pt, width)\n}\n\nconst pixelNeighboringPixels = (pixel : number, size : Size) : number[] => {\n  const depth = 3 // should be 4, no?\n  const pixels = []\n  const halfSize = Math.floor(depth / 2)\n  for (let y = 0; y < depth; y += 1) {\n    for (let x = 0; x < depth; x += 1) {\n      const offsetPoint = { x: x - halfSize, y: y - halfSize }\n      pixels.push(pixelSafe(pixel, offsetPoint, size))\n    }\n  }\n  return pixels\n}\n\nconst pixelNeighboringRgbas = (pixel : number, data : Pixels, size : Size) : Rgba[] => (\n  pixelNeighboringPixels(pixel, size).map(p => pixelRgba(p, data))\n)\n\nconst pixelColor = (value : ScalarValue) : string => {\n  const string = String(value)\n  if (string.slice(0, 2) === \"0x\") return `#${string.slice(2)}`\n\n  return string\n}\n\nconst pixelPerFrame = (frames: number, width: number, zoom: number): number => {\n  if (!(frames && width)) return 0\n\n  const widthFrames = width / frames\n\n  const min = Math.min(1, widthFrames)\n  const max = Math.max(1, widthFrames)\n  if (zoom === 1) return max\n  if (!zoom) return min\n\n  return min + ((max - min) * zoom)\n}\n\nconst pixelFromFrame = (frame: number, perFrame : number, rounding = 'ceil'): number => {\n  if (!(frame && perFrame)) return 0\n\n  const pixels = frame * perFrame\n  return roundWithMethod(pixels, rounding)\n}\n\nconst pixelToFrame = (pixels: number, perFrame : number, rounding = 'round'): number => {\n  if (!(pixels && perFrame)) return 0\n\n  return roundWithMethod(pixels / perFrame, rounding)\n}\n\nconst Pixel = {\n  color: pixelColor,\n  fromFrame: pixelFromFrame,\n  neighboringRgbas: pixelNeighboringRgbas,\n  perFrame: pixelPerFrame,\n  rgbaAtIndex: pixelRgbaAtIndex,\n  toFrame: pixelToFrame,\n}\n\nexport {\n  Pixel,\n  pixelColor,\n  pixelFromFrame,\n  pixelNeighboringRgbas,\n  pixelPerFrame,\n  pixelRgbaAtIndex,\n  pixelToFrame,\n}\n","import { Errors } from \"../Setup/Errors\"\nimport { Is } from \"./Is\"\nimport { roundWithMethod } from \"./Round\"\n\nconst greatestCommonDenominator = (fps1 : number, fps2 : number) : number => {\n  let a = fps1\n  let b = fps2\n  let t = 0\n  while (b !== 0) {\n    t = b\n    b = a % b\n    a = t\n  }\n  return a\n}\n\nconst lowestCommonMultiplier = (a : number, b : number) : number => (\n  (a * b) / greatestCommonDenominator(a, b)\n)\n\nconst timeEqualizeRates = (time1 : Time, time2 : Time, rounding = '') : Time[] => {\n  if (time1.fps === time2.fps) return [time1, time2]\n\n  const gcf = lowestCommonMultiplier(time1.fps, time2.fps)\n  return [\n    time1.scale(gcf, rounding),\n    time2.scale(gcf, rounding)\n  ]\n}\n\nclass Time implements Time {\n  frame : number\n\n  fps : number\n\n  constructor(frame = 0, fps = 1) {\n    if (!Is.integer(frame) || frame < 0) throw Errors.frame\n    if (!Is.integer(fps) || fps < 1) throw Errors.fps\n\n    this.frame = frame\n    this.fps = fps\n  }\n\n  add(time : Time) : Time {\n    const [time1, time2] = timeEqualizeRates(this, time)\n    return new Time(time1.frame + time2.frame, time1.fps)\n  }\n\n  addFrame(frames : number) : Time {\n    const time = this.copy\n    time.frame += frames\n    return time\n  }\n\n  get copy() : Time { return new Time(this.frame, this.fps) }\n\n  get description() : string { return `${this.frame}@${this.fps}` }\n\n  divide(number : number, rounding = '') : Time {\n    if (!Is.number(number)) throw Errors.argument + 'divide'\n    return new Time(roundWithMethod(Number(this.frame) / number, rounding), this.fps)\n  }\n\n  equalsTime(time : Time) : boolean {\n    const [time1, time2] = timeEqualizeRates(this, time)\n    return time1.frame === time2.frame\n  }\n\n  min(time : Time) : Time {\n    const [time1, time2] = timeEqualizeRates(this, time)\n    return new Time(Math.min(time1.frame, time2.frame), time1.fps)\n  }\n\n  scale(fps : number, rounding = '') : Time {\n    if (this.fps === fps) return this\n\n    const frame = (Number(this.frame) / Number(this.fps)) * Number(fps)\n    // console.debug(this.constructor.name, \"scale\", frame, \"=\", this.frame, \"/\", this.fps, \"*\", fps)\n    return new Time(roundWithMethod(frame, rounding), fps)\n  }\n\n  scaleToFps(fps : number) : Time { return this.scaleToTime(new Time(0, fps)) }\n\n  scaleToTime(time : Time) : Time {\n    return timeEqualizeRates(this, time)[0]\n  }\n  get seconds() : number { return Number(this.frame) / Number(this.fps) }\n\n  subtract(time : Time) : Time {\n    const [time1, time2] = timeEqualizeRates(this, time)\n\n    let subtracted = time2.frame\n    if (subtracted > time1.frame) {\n      subtracted -= subtracted - time1.frame\n    }\n    return new Time(time1.frame - subtracted, time1.fps)\n  }\n\n  subtractFrames(frames : number) : Time {\n    const time = this.copy\n    time.frame -= frames\n    return time\n  }\n\n  toString() : string { return `[${this.description}]` }\n\n  withFrame(frame : number) : Time {\n    const time = this.copy\n    time.frame = frame\n    return time\n  }\n\n  static fromArgs(frame = 0, fps = 1) : Time {\n    return new Time(frame, fps)\n  }\n\n  static fromSeconds(seconds = 0, fps = 1, rounding = '') : Time {\n    if (!Is.number(seconds) || seconds < 0) throw Errors.seconds\n    if (!Is.integer(fps) || fps < 1) throw Errors.fps\n\n    const rounded = roundWithMethod(seconds * fps, rounding)\n    return this.fromArgs(rounded, fps)\n  }\n}\ntype Times = Time[]\n\nexport { Time, Times, timeEqualizeRates }\n","import { Is } from \"./Is\"\nimport { Time, timeEqualizeRates } from \"./Time\"\nimport { roundWithMethod } from \"./Round\"\nimport { Errors } from \"../Setup/Errors\"\n\nclass TimeRange extends Time {\n  frames : number\n\n  constructor(frame = 0, fps = 1, frames = 1) {\n    if (!(Is.integer(frames) && frames >= 0)) {\n      console.trace(\"TimeRange with frames\", frames, frames.constructor.name)\n      throw Errors.argument + 'frames'\n    }\n    super(frame, fps)\n    this.frames = frames\n  }\n\n  addFrames(frames : number) : TimeRange {\n    const time = this.copy\n    time.frames += frames\n    return time\n  }\n\n  get description() : string { return `${this.frame}-${this.frames}@${this.fps}` }\n\n  get end() : number { return this.frame + this.frames }\n\n  get endTime() : Time { return Time.fromArgs(this.end, this.fps) }\n\n  equalsTimeRange(timeRange : TimeRange) : boolean {\n    const [range1, range2] = <TimeRange[]> timeEqualizeRates(this, timeRange)\n    return range1.frame === range2.frame && range1.frames === range2.frames\n  }\n\n  get lengthSeconds() : number { return Number(this.frames) / Number(this.fps) }\n\n  get position() : number { return Number(this.frame) / Number(this.frames) }\n\n  get startTime() : Time { return Time.fromArgs(this.frame, this.fps) }\n\n  get copy() : TimeRange {\n    return new TimeRange(this.frame, this.fps, this.frames)\n  }\n\n  scale(fps = 1, rounding = \"\") : TimeRange {\n    if (this.fps === fps) return this.copy\n\n    const value = Number(this.frames) / (Number(this.fps) / Number(fps))\n    const time = super.scale(fps, rounding)\n    const frames = Math.max(1, roundWithMethod(value, rounding))\n    return new TimeRange(time.frame, time.fps, frames)\n  }\n\n  intersects(timeRange : TimeRange) : boolean {\n    const [range1, range2] = <TimeRange[]> timeEqualizeRates(this, timeRange)\n\n    if (range1.frame >= range2.end) return false\n\n    return range1.end > range2.frame\n  }\n\n  intersectsTime(time : Time) : boolean {\n    const [time1, scaledTime] = timeEqualizeRates(this, time)\n    const scaledRange = <TimeRange> time1\n    return scaledTime.frame >= scaledRange.frame && scaledTime.frame < scaledRange.end\n\n  }\n\n  minEndTime(endTime : Time) : TimeRange {\n    const [range, time] = <TimeRange[]> timeEqualizeRates(this, endTime)\n    range.frames = Math.min(range.frames, time.frame)\n    return range\n  }\n\n  get times(): Time[] {\n    const { frames, frame, fps } = this\n    return Array.from({ length: frames + 1 }, (_, i) => Time.fromArgs(frame + i, fps))\n  }\n\n  withFrame(frame : number) : TimeRange {\n    const range = this.copy\n    range.frame = frame\n    return range\n  }\n\n  withFrames(frames : number) : TimeRange {\n    const range = this.copy\n    range.frames = frames\n    return range\n  }\n\n  static fromArgs(frame = 0, fps = 1, frames = 1) : TimeRange {\n    return new TimeRange(frame, fps, frames)\n  }\n\n  static fromSeconds(start = 0, duration = 1) : TimeRange {\n    return this.fromArgs(start, 1, duration)\n  }\n\n  static fromTime(time : Time, frames = 1) : TimeRange {\n    return this.fromArgs(time.frame, time.fps, frames)\n  }\n\n  static fromTimes(startTime : Time, endTime : Time) : TimeRange {\n    const [time1, time2] = <TimeRange[]> timeEqualizeRates(startTime, endTime)\n    if (time2.frame <= time1.frame) throw Errors.argument\n\n    const frames = time2.frame - time1.frame\n    return this.fromArgs(time1.frame, time1.fps, frames)\n  }\n}\n\nexport { TimeRange }\n","import { RemoteServer } from \"../declarations\"\n\nconst urlRemoteServer = (): RemoteServer => {\n  const url = new URL(document.baseURI)\n  const { protocol, host, pathname, port } = url\n  return {\n    protocol, host, prefix: pathname, port\n  }\n}\n\nconst urlAbsolute = (url: string): string => (new URL(url, document.baseURI)).href\nconst urlForRemoteServer = (remoteServer?: RemoteServer, suffix? : string):string => {\n  const bits: string[] = []\n  if (remoteServer) {\n    const { host, port, protocol, prefix } = remoteServer\n    if (host) {\n      bits.push(protocol || 'http')\n      bits.push('://')\n      bits.push(host)\n      if (port) {\n        bits.push(':')\n        bits.push(String(port))\n      }\n    }\n    if (prefix) bits.push(prefix)\n  }\n  if (suffix) bits.push(suffix)\n  return urlAbsolute(bits.join(''))\n}\nconst Url = {\n  absolute: urlAbsolute,\n  forRemoteServer: urlForRemoteServer,\n  remoteServer: urlRemoteServer\n}\n\nexport { Url, urlAbsolute, urlForRemoteServer, urlRemoteServer }\n","import { Mash } from \"../Mash\"\nimport { Action } from \"./Action\"\nimport { Is } from \"../Utilities\";\n\ninterface ActionsObject {\n  mash : Mash\n}\n\nclass Actions  {\n\n  constructor(object : ActionsObject) {\n    const { mash } = object\n    this.mash = mash\n  }\n\n  get canRedo() : boolean { return this.index < this.instances.length - 1 }\n\n  get canSave() : boolean { return this.canUndo }\n\n  get canUndo() : boolean { return this.index > -1 }\n\n  get currentAction() : Action { return this.instances[this.index] }\n\n  get currentActionLast() : boolean { return this.canUndo && !this.canRedo }\n\n  destroy() : void {\n    this.index = -1\n    this.instances.splice(0, this.instances.length)\n  }\n\n  add(action : Action) : void {\n    const remove = this.instances.length - (this.index + 1)\n    if (Is.positive(remove)) this.instances.splice(this.index + 1, remove)\n\n    this.instances.push(action)\n  }\n\n  index = -1\n\n  instances : Action[] = []\n\n  mash : Mash\n\n  redo() : Action {\n    this.index += 1\n    const action = this.currentAction\n    action.redo()\n\n    return action\n  }\n\n  save() : void {\n    this.instances.splice(0, this.index + 1)\n    this.index = -1\n  }\n\n  undo() : Action {\n    const action = this.currentAction\n    this.index -= 1\n    action.undo()\n    return action\n  }\n}\n\nexport { Actions }\n","\nimport { Any } from \"../declarations\"\nimport { ContextFactory } from \"../Playing/ContextFactory\"\nimport { Errors } from \"../Setup/Errors\"\nimport { Is } from \"../Utilities/Is\"\n\nconst CacheKeyPrefix = 'cachekey'\n\nclass CacheClass {\n\n  add(url : string, value : Any) : void {\n    // console.log(this.constructor.name, \"add\", url, value.constructor.name)\n    const key = this.key(url)\n    this.cachedByKey.set(key, value)\n    this.urlsByKey.set(key, url)\n  }\n\n  audibleContext = ContextFactory.audible()\n\n  cached(url: string): boolean {\n    const object = this.getObject(url)\n    return object && ! (object instanceof Promise)\n  }\n\n  caching(url: string): boolean {\n    const object = this.getObject(url)\n    return object && object instanceof Promise\n  }\n\n  private cachedByKey = new Map<string, Any>()\n\n  flush(retainUrls: string[]) {\n    const keys = [...this.urlsByKey.keys()]\n    const retainKeys = retainUrls.map(url => this.key(url))\n    const removeKeys = keys.filter(key => !retainKeys.includes(key))\n    removeKeys.forEach(key => {\n      const url = this.urlsByKey.get(key)\n      if (url) this.remove(url)\n    })\n  }\n\n  get(url : string) : Any {\n    return this.cachedByKey.get(this.key(url))\n  }\n\n  getObject(url: string): Any {\n     if (!Is.populatedString(url)) throw Errors.argument + 'url'\n\n    const key = this.key(url)\n    if (!this.cachedByKey.has(key)) return\n\n     return this.cachedByKey.get(key)\n  }\n\n  key(url : string) : string {\n    if (!Is.populatedString(url)) throw Errors.argument + 'url'\n\n    return CacheKeyPrefix + url.replaceAll(/[^a-z0-9]/gi, '')\n  }\n\n  remove(url : string) : void {\n    // console.trace(this.constructor.name, \"remove\", url)\n    const key = this.key(url)\n    this.cachedByKey.delete(key)\n    this.urlsByKey.delete(key)\n  }\n\n  private urlsByKey = new Map<string, string>()\n\n  visibleContext = ContextFactory.visible()\n}\n\nconst Cache = new CacheClass()\nexport { Cache }\n","import { Any, LoadPromise } from \"../declarations\"\nimport { Cache } from \"./Cache\"\n\nclass Loader {\n  arrayBufferPromiseFromUrl(url: string): Promise<ArrayBuffer> {\n    return fetch(url).then(response => response.arrayBuffer())\n  }\n\n  arrayBufferPromiseFromBlob(blob: Blob):Promise<ArrayBuffer> {\n    return new Promise<ArrayBuffer>((resolve, reject) => {\n      const reader = new FileReader()\n      reader.onload = () => { resolve(<ArrayBuffer> reader.result) }\n      reader.onerror = reject\n      reader.readAsArrayBuffer(blob)\n    })\n  }\n\n  audioBufferPromiseFromArrayBuffer(arrayBuffer: ArrayBuffer): Promise<AudioBuffer> {\n    return Cache.audibleContext.decode(arrayBuffer)\n  }\n\n  async loadUrl(url : string) : LoadPromise {\n    if (Cache.cached(url)) {\n      const promiseOrCached = Cache.get(url)\n      if (promiseOrCached instanceof Promise) return promiseOrCached\n      return Promise.resolve()\n    }\n\n    const promise = this.requestUrl(url)\n    Cache.add(url, promise)\n    const processed = await promise\n    Cache.add(url, processed)\n    return processed\n  }\n\n  requestUrl(_url : string) : Promise<Any> { return Promise.resolve() }\n}\n\nexport { Loader }\n","import { LoadAudioPromise } from \"../../declarations\"\nimport { LoadType} from \"../../Setup/Enums\"\nimport { Loader } from \"../../Loading/Loader\"\n\nclass AudioLoader extends Loader {\n  async requestUrl(url: string): LoadAudioPromise {\n    const promise: LoadAudioPromise = new Promise((resolve, reject) => {\n      this.arrayBufferPromiseFromUrl(url)\n        .then(arrayBuffer => this.audioBufferPromiseFromArrayBuffer(arrayBuffer))\n        .then(resolve)\n        .catch(reject)\n    })\n    return promise\n  }\n\n  type = LoadType.Audio\n}\n\nexport { AudioLoader }\n","import { LoadFontPromise } from \"../../declarations\"\nimport { LoadType } from \"../../Setup/Enums\"\nimport { Loader } from \"../../Loading/Loader\"\nimport { Cache } from \"../../Loading/Cache\"\n\nclass FontLoader extends Loader {\n  type = LoadType.Font\n\n  requestUrl(url: string): LoadFontPromise {\n    const promise : LoadFontPromise = new Promise((resolve, reject) => {\n      const family = Cache.key(url)\n      this.arrayBufferPromiseFromUrl(url)\n        .then(buffer => {\n          const face = new FontFace(family, buffer)\n          return face.load()\n        }).then(face => {\n          document.fonts.add(face)\n          resolve(face)\n        }).catch(reason => reject(reason))\n    })\n    return promise\n  }\n}\n\nexport { FontLoader }\n","import { LoadImagePromise } from \"../../declarations\"\nimport { LoadType } from \"../../Setup/Enums\"\nimport { Loader } from \"../../Loading/Loader\"\n\nclass ImageLoader extends Loader {\n  type = LoadType.Image\n\n  requestUrl(url : string) : LoadImagePromise {\n    const image = new Image()\n    image.crossOrigin = \"Anonymous\"\n    image.src = url\n    return image.decode().then(() => Promise.resolve(image))\n  }\n}\n\nexport { ImageLoader }\n","import { LoadedVideo, LoadVideoPromise } from \"../../declarations\"\nimport { LoadType } from \"../../Setup/Enums\"\nimport { Loader } from \"../../Loading/Loader\"\n\nclass VideoLoader extends Loader {\n  requestUrl(url: string): LoadVideoPromise {\n    const promise: LoadVideoPromise = new Promise((resolve, reject) => {\n      return this.videoPromiseFromUrl(url).then(video => {\n        return this.arrayBufferPromiseFromUrl(url).then(arrayBuffer => {\n          return this.audioBufferPromiseFromArrayBuffer(arrayBuffer).then(audioBuffer => {\n            resolve({ video, audio: audioBuffer, sequence: [] })\n          })\n        })\n      })\n      .catch(reject)\n    })\n    return promise\n  }\n\n  type = LoadType.Video\n\n  videoPromiseFromUrl(url: string): Promise<LoadedVideo> {\n    return new Promise<LoadedVideo>((resolve, reject) => {\n      const video = this.videoFromUrl(url)\n\n      video.ondurationchange = () => {\n        video.ondurationchange = null\n        video.width = video.videoWidth\n        video.height = video.videoHeight\n        // console.debug(this.constructor.name, \"videoPromiseFromUrl\", 'ondurationchange', video.width, video.height)\n        resolve(video)\n      }\n      video.onerror = reject\n      video.load()\n    })\n  }\n\n  videoFromUrl(url: string): HTMLVideoElement {\n    const video = document.createElement('video')\n    video.crossOrigin = 'anonymous'\n    video.src = url\n    return video\n  }\n}\n\nexport { VideoLoader }\n","import { Loader } from \"./Loader\"\nimport { AudioLoader } from \"../Mash/Audio/AudioLoader\"\nimport { FontLoader } from \"../Mash/Font/FontLoader\"\nimport { ImageLoader } from \"../Mash/Image/ImageLoader\"\nimport { VideoLoader } from \"../Mash/Video/VideoLoader\"\nimport { Capitalize } from \"../Utilities/Capitalize\"\n\ntype LoaderClassType = typeof Loader\n\nconst classes : {[index : string] : LoaderClassType } = {\n  Audio: AudioLoader,\n  Font: FontLoader,\n  Image: ImageLoader,\n  Video: VideoLoader,\n}\n\nclass LoaderClass {\n  audio() { return new classes.Audio() }\n\n  font() { return new classes.Font() }\n\n  image() { return new classes.Image() }\n\n  install(type : string, loader : LoaderClassType) {\n    classes[Capitalize(type)] = loader\n  }\n\n  video() { return new classes.Video()}\n}\n\nconst LoaderFactory = new LoaderClass()\n\nexport { LoaderFactory }\n","import { colorTransparent } from \"../Utilities/Color\"\n\nconst Default = {\n  label: \"Unlabeled\",\n  masher: {\n    buffer: 10,\n    fps: 0,\n    loop: true,\n    volume: 0.75,\n    precision: 3,\n    autoplay: false,\n  },\n  mash: {\n    label: \"Unlabeled Mash\",\n    quantize: 10,\n    backcolor: colorTransparent,\n    gain: 0.75,\n    buffer: 10,\n    output: {\n      width: 320,\n      height: 240,\n      fps: 30,\n      videoBitrate: 2000,\n      audioBitrate: 160,\n      audioCodec: 'aac',\n      videoCodec: 'libx264',\n      audioChannels: 2,\n      audioFrequency: 44100,\n    }\n  },\n  instance: {\n    audio: { gain: 1.0, trim: 0, loop: 1 },\n    video: { speed: 1.0 }\n  },\n  definition: {\n    frame: { duration: 2 },\n    image: { duration: 2 },\n    theme: { duration: 3 },\n    transition: { duration: 1 },\n    video: { fps: 0 },\n    videosequence: { pattern: '%.jpg', fps: 10, increment: 1, begin: 1, padding: 0 },\n    videostream: { duration: 10 },\n  },\n}\n\nexport { Default }\n","import { Is } from \"../../Utilities/Is\"\nimport { Any, AudibleSource, JsonObject, StartOptions } from \"../../declarations\"\nimport { ClipClass } from \"../Clip/Clip\"\nimport { AudibleClass, AudibleDefinition, AudibleObject } from \"./Audible\"\nimport { Default } from \"../../Setup/Default\"\n\nconst AudibleGainDelimiter = ','\n\nfunction AudibleMixin<T extends ClipClass>(Base: T) : AudibleClass & T {\n  return class extends Base {\n    constructor(...args : Any[]) {\n      super(...args)\n      const [object] = args\n      const { gain } = <AudibleObject> object\n\n      if (typeof gain !== \"undefined\") {\n        if (typeof gain === \"string\") {\n          if (gain.includes(AudibleGainDelimiter)){\n            const floats = gain.split(AudibleGainDelimiter).map(string => parseFloat(string))\n            const z = floats.length / 2\n            for (let i = 0; i < z; i += 1) {\n              this.gainPairs.push([floats[i * 2], floats[i * 2 + 1]])\n            }\n            this.gain = -1\n          } else this.gain = Number(gain)\n        } else this.gain = gain\n      }\n    }\n\n    audible = true\n\n    declare definition : AudibleDefinition\n\n    gain = Default.instance.audio.gain\n\n    gainPairs : number[][] = []\n\n\n    loadedAudible():AudibleSource | undefined {\n      return this.definition.loadedAudible()\n    }\n\n    get muted() : boolean {\n      if (this.gain === 0) return true\n      if (Is.positive(this.gain)) return false\n\n      return this.gainPairs === [[0, 0], [1, 0]]\n    }\n\n    startOptions(seconds: number, quantize: number): StartOptions {\n      const range = this.timeRange(quantize)\n      let offset = 0\n      let start = range.seconds - seconds\n      let duration = range.lengthSeconds\n\n      if (start < 0) {\n        offset -= start\n        duration += start\n        start = 0\n      }\n      return { start, offset, duration }\n    }\n\n    toJSON() : JsonObject {\n      const object = super.toJSON()\n      if (this.gain !== Default.instance.audio.gain) object.gain = this.gain\n      return object\n    }\n  }\n}\n\nexport { AudibleMixin }\n","import { Any, ClipState, InputCommand, LoadPromise, Size } from \"../../declarations\"\nimport { TrackType } from \"../../Setup/Enums\"\nimport { Time  } from \"../../Utilities/Time\"\nimport { Is } from \"../../Utilities/Is\"\nimport { TimeRange } from \"../../Utilities/TimeRange\"\nimport { InstanceClass } from \"../../Base/Instance\"\nimport { ClipClass, ClipObject, ClipDefinition } from \"./Clip\"\nimport { Errors } from \"../../Setup/Errors\"\n\n\n\nfunction ClipMixin<T extends InstanceClass>(Base: T): ClipClass & T {\n  return class extends Base {\n    constructor(...args : Any[]) {\n      super(...args)\n      const [object] = args\n      const { frame, frames, track } = <ClipObject> object\n\n      if (typeof frame !== \"undefined\" && Is.positive(frame)) this.frame = frame\n      if (frames && Is.aboveZero(frames)) this.frames = frames\n      if (typeof track !== \"undefined\") this.track = track\n    }\n\n    audible = false\n\n    clipState(quantize: number, time: Time, dimensions: Size): ClipState {\n      const clipState = this.inputCommandAtTimeToSize(time, quantize, dimensions)\n      if (!clipState) throw Errors.internal\n\n      return clipState\n    }\n    commandAtTimeToSize(mashTime: Time, quantize: number, dimensions: Size): InputCommand | undefined {\n      const source = this.definition.inputSource\n      const inputCommand: InputCommand = { sources: { source }, filters: []}\n      return inputCommand\n    }\n\n    declare definition: ClipDefinition\n\n    definitionTime(quantize : number, time : Time) : Time {\n      const scaledTime = super.definitionTime(quantize, time)\n      const startTime = this.time(quantize).scale(scaledTime.fps)\n      const endTime = this.endTime(quantize).scale(scaledTime.fps)\n\n      const frame = Math.max(Math.min(scaledTime.frame, endTime.frame), startTime.frame)\n      return scaledTime.withFrame(frame - startTime.frame)\n    }\n\n    get endFrame() { return this.frame + this.frames }\n\n    endTime(quantize : number) : Time {\n      return Time.fromArgs(this.endFrame, quantize)\n    }\n\n    frame = 0\n\n    frames = -1\n\n    inputCommandAtTimeToSize(mashTime: Time, quantize: number, dimensions: Size): InputCommand | undefined {\n      return\n    }\n\n    loadClip(quantize : number, start : Time, end? : Time) : LoadPromise | void {\n      const startTime = this.definitionTime(quantize, start)\n      const endTime = end ? this.definitionTime(quantize, end) : end\n      return this.definition.loadDefinition(quantize, startTime, endTime)\n    }\n\n    clipUrls(quantize : number, start : Time, end? : Time) : string[] {\n      const startTime = this.definitionTime(quantize, start)\n      const endTime = end ? this.definitionTime(quantize, end) : end\n      return this.definition.definitionUrls(startTime, endTime)\n    }\n\n    maxFrames(_quantize : number, _trim? : number) : number { return 0 }\n\n    time(quantize : number) : Time { return Time.fromArgs(this.frame, quantize) }\n\n    timeRange(quantize : number) : TimeRange {\n      return TimeRange.fromArgs(this.frame, quantize, this.frames)\n    }\n\n    timeRangeRelative(time : Time, quantize : number) : TimeRange {\n      const range = this.timeRange(quantize).scale(time.fps)\n      const frame = Math.max(0, time.frame - range.frame)\n      return range.withFrame(frame)\n    }\n\n    // toJSON() : JsonObject {\n    //   const object = super.toJSON()\n    //   object.id = this.id\n    //   return object\n    // }\n\n    track = -1\n\n    trackType = TrackType.Video\n\n    visible = false\n  }\n}\n\nexport { ClipMixin }\n","import { Any, JsonObject, StartOptions } from \"../../declarations\"\nimport { Default } from \"../../Setup/Default\"\nimport { Is } from \"../../Utilities/Is\"\nimport { Time } from \"../../Utilities/Time\"\nimport { AudibleClass } from \"../Audible/Audible\"\nimport { AudibleFileClass, AudibleFileDefinition, AudibleFileObject } from \"./AudibleFile\"\n\nimport { Cache } from \"../../Loading/Cache\"\n\nfunction AudibleFileMixin<T extends AudibleClass>(Base: T): AudibleFileClass & T {\n  return class extends Base {\n    constructor(...args: Any[]) {\n      super(...args)\n      const [object] = args\n      const { loop, trim } = <AudibleFileObject>object\n\n      if (typeof trim !== \"undefined\" && Is.integer(trim)) this.trim = trim\n      if (typeof loop !== \"undefined\" && Is.integer(loop)) this.loop = loop\n    }\n\n    declare definition : AudibleFileDefinition\n\n    definitionTime(quantize : number, time : Time) : Time {\n      const scaledTime = super.definitionTime(quantize, time)\n      if (!Is.aboveZero(this.trim)) return scaledTime\n\n      const trimTime = this.trimTime(quantize).scale(scaledTime.fps)\n      return scaledTime.withFrame(scaledTime.frame + trimTime.frame)\n    }\n\n    loop = Default.instance.audio.loop\n\n    maxFrames(quantize : number, trim? : number) : number {\n      const space = trim ? trim : this.trim\n      return Math.floor(this.definition.duration * quantize) - space\n    }\n\n    startOptions(seconds: number, quantize: number): StartOptions {\n\n      const range = this.timeRange(quantize)\n      let offset = 0\n      let start = range.seconds - seconds\n      let duration = range.lengthSeconds\n\n      if (this.trim) { offset = Time.fromArgs(this.trim, quantize).seconds }\n\n      if (start < 0) {\n        offset -= start\n        duration += start\n        start = 0\n      }\n\n      const result = { start, offset, duration }\n      // console.log(\"startOptions\", seconds, quantize, result)\n      return result\n    }\n\n    trim = Default.instance.audio.trim\n\n    trimTime(quantize: number): Time { return Time.fromArgs(this.trim, quantize) }\n\n    toJSON() : JsonObject {\n      const object = super.toJSON()\n      if (this.trim !== Default.instance.audio.trim) object.trim = this.trim\n      if (this.loop !== Default.instance.audio.loop) object.loop = this.loop\n      return object\n    }\n  }\n}\nexport { AudibleFileMixin }\n","import { TrackType } from \"../../Setup/Enums\"\nimport { AudioDefinition } from \"./Audio\"\nimport { InstanceBase } from \"../../Base/Instance\"\nimport { AudibleMixin } from \"../../Mixin/Audible/AudibleMixin\"\nimport { ClipMixin } from \"../../Mixin/Clip/ClipMixin\"\nimport { AudibleFileMixin } from \"../../Mixin/AudibleFile/AudibleFileMixin\"\n\nconst AudioWithClip = ClipMixin(InstanceBase)\nconst AudioWithAudible = AudibleMixin(AudioWithClip)\nconst AudioWithAudibleFile = AudibleFileMixin(AudioWithAudible)\nclass AudioClass extends AudioWithAudibleFile {\n  declare definition : AudioDefinition\n\n  trackType = TrackType.Audio\n}\n\n\nexport { AudioClass }\n","\nimport { Property } from \"../../Setup/Property\"\nimport { Any, ObjectUnknown } from \"../../declarations\"\nimport { DataType } from \"../../Setup/Enums\"\nimport { DefinitionClass } from \"../../Base/Definition\"\nimport { Default } from \"../../Setup/Default\"\nimport { ClipDefinitionClass } from \"./Clip\"\nimport { Time } from \"../../Utilities/Time\"\n\nconst ClipPropertyObjects = [\n  { name: \"frame\", type: DataType.Integer, value: 0 },\n  { name: \"frames\", type: DataType.Integer, value: -1 },\n  { name: \"label\", type: DataType.String, value: \"\" },\n  // { name: \"track\", type: DataType.Integer, value: -1 },\n]\n\nfunction ClipDefinitionMixin<T extends DefinitionClass>(Base: T) : ClipDefinitionClass & T {\n  return class extends Base {\n    constructor(...args : Any[]) {\n      super(...args)\n      const properties = ClipPropertyObjects.map(object => new Property(object))\n      this.properties.push(...properties)\n    }\n\n    audible = false\n\n    // TODO: determine if this is needed!\n    // used by theme, image, frame, transition\n    private _duration? : number\n\n    get duration() : number {\n      if (!this._duration) {\n        const object = <ObjectUnknown> Default.definition\n        this._duration = Number(object[this.type].duration)\n      }\n      return this._duration\n    }\n\n    set duration(value : number) { this._duration = value }\n\n    frames(quantize: number): number {\n      return Time.fromSeconds(this.duration, quantize, 'floor').frame\n    }\n\n    get inputSource(): string { return '' }\n\n    streamable = false\n\n    visible = false\n  }\n}\n\nexport { ClipDefinitionMixin }\n","import { Any, JsonObject, LoadPromise, AudibleSource, LoadedAudio } from \"../../declarations\"\nimport { DataType } from \"../../Setup/Enums\"\nimport { Errors } from \"../../Setup/Errors\"\nimport { AudibleDefinitionClass, AudibleDefinitionObject } from \"./Audible\"\nimport { ClipDefinitionClass } from \"../Clip/Clip\"\nimport { Property } from \"../../Setup/Property\"\nimport { Time, Times } from \"../../Utilities/Time\"\nimport { Cache } from \"../../Loading/Cache\"\nimport { LoaderFactory } from \"../../Loading/LoaderFactory\"\nimport { urlAbsolute } from \"../../Utilities/Url\"\n\nfunction AudibleDefinitionMixin<T extends ClipDefinitionClass>(Base: T) : AudibleDefinitionClass & T {\n  return class extends Base {\n    constructor(...args: Any[]) {\n      super(...args)\n      const [object] = args\n      const { stream, url, audio, source, waveform } = <AudibleDefinitionObject>object\n\n      const urlAudible = audio || url || source || \"\"\n      if (!urlAudible) throw Errors.invalid.definition.audio\n\n      this.urlAudible = urlAudible\n\n      if (stream) this.stream = true\n      this.source = source || urlAudible\n      if (waveform) this.waveform = waveform\n\n      this.properties.push(new Property({ name: \"gain\", type: DataType.Number, value: 1.0 }))\n    }\n\n    get absoluteUrl(): string { return urlAbsolute(this.urlAudible) }\n\n    audible = true\n\n    get inputSource(): string { return urlAbsolute(this.source) }\n\n    loadDefinition(_quantize: number, _start: Time, end?: Time): LoadPromise | void {\n      if (!end) return\n\n      const url = this.absoluteUrl\n      if (Cache.cached(url)) return\n\n      if (Cache.caching(url)) return Cache.get(url)\n\n      return LoaderFactory.audio().loadUrl(url)\n    }\n\n    definitionUrls() : string[] { return [this.absoluteUrl] }\n\n    loadedAudible(): AudibleSource | undefined {\n\n      const cached: LoadPromise | LoadedAudio | undefined = Cache.get(this.absoluteUrl)\n      if (!cached || cached instanceof Promise) return\n\n      // console.debug(this.constructor.name, \"loadedAudible\", cached.constructor.name)\n      return Cache.audibleContext.createBufferSource(cached)\n    }\n\n    loops = false\n\n    source : string\n\n    stream = false\n\n    toJSON() : JsonObject {\n      const object = super.toJSON()\n      object.audio = this.urlAudible\n      if (this.source) object.source = this.source\n      if (this.waveform) object.waveform = this.waveform\n      return object\n    }\n\n    unload(times : Times[] = []) : void {\n      super.unload(times)\n      if (times.length && times.some(maybePair => maybePair.length === 2)) {\n        return // don't unload if any times indicate audio needed\n      }\n      if (!Cache.cached(this.absoluteUrl)) return\n\n      Cache.remove(this.absoluteUrl)\n    }\n\n    urlAudible : string\n\n    waveform? : string\n  }\n}\n\nexport { AudibleDefinitionMixin }\n","import { DataType } from \"../../Setup/Enums\"\nimport { Any, JsonObject } from \"../../declarations\"\nimport { Errors } from \"../../Setup/Errors\"\nimport { AudibleFileDefinitionClass, AudibleFileDefinitionObject } from \"./AudibleFile\"\nimport { Property } from \"../../Setup/Property\"\nimport { AudibleDefinitionClass } from \"../Audible/Audible\"\n\nfunction AudibleFileDefinitionMixin<T extends AudibleDefinitionClass>(Base: T) : AudibleFileDefinitionClass & T {\n  return class extends Base {\n    constructor(...args : Any[]) {\n      super(...args)\n      const [object] = args\n      const { loops, duration } = <AudibleFileDefinitionObject> object\n      if (!duration) throw Errors.invalid.definition.duration\n\n      this.duration = Number(duration)\n      if (loops) {\n        this.properties.push(new Property({ name: \"loop\", type: DataType.Integer, value: 1 }))\n        this.loops = true\n      }\n      this.properties.push(new Property({ name: \"trim\", type: DataType.Integer, value: 0 }))\n    }\n\n    duration : number\n\n    loops = false\n\n    toJSON() : JsonObject {\n      const object = super.toJSON()\n      object.duration = this.duration\n      if (this.loops) object.loops = true\n      return object\n    }\n  }\n}\n\nexport { AudibleFileDefinitionMixin }\n","import { Any } from \"../../declarations\"\nimport { DefinitionType, TrackType } from \"../../Setup/Enums\"\nimport { DefinitionBase } from \"../../Base/Definition\"\nimport { AudioClass } from \"./AudioInstance\"\nimport { Audio, AudioObject } from \"./Audio\"\nimport { ClipDefinitionMixin } from \"../../Mixin/Clip/ClipDefinitionMixin\"\nimport { AudibleDefinitionMixin } from \"../../Mixin/Audible/AudibleDefinitionMixin\"\nimport { Definitions } from \"../../Definitions/Definitions\"\nimport { AudibleFileDefinitionMixin } from \"../../Mixin/AudibleFile/AudibleFileDefinitionMixin\"\n\nconst AudioDefinitionWithClip = ClipDefinitionMixin(DefinitionBase)\nconst AudioDefinitionWithAudible = AudibleDefinitionMixin(AudioDefinitionWithClip)\nconst AudioDefinitionWithAudibleFile = AudibleFileDefinitionMixin(AudioDefinitionWithAudible)\nclass AudioDefinitionClass extends AudioDefinitionWithAudibleFile {\n  constructor(...args : Any[]) {\n    super(...args)\n    Definitions.install(this)\n  }\n\n  get instance() : Audio { return this.instanceFromObject(this.instanceObject) }\n\n  instanceFromObject(object : AudioObject) : Audio {\n    // console.log(\"instanceFromObject\", object)\n    const audioObject = { ...this.instanceObject, ...object }\n    // console.log(\"instanceFromObject\", typeof audioObject.gain, audioObject.gain, object)\n    return new AudioClass(audioObject)\n  }\n\n  trackType = TrackType.Audio\n\n  type = DefinitionType.Audio\n}\n\nexport { AudioDefinitionClass }\n","import { Errors } from \"../../Setup/Errors\"\nimport { Definitions } from \"../../Definitions/Definitions\"\nimport { AudioDefinitionClass } from \"./AudioDefinition\"\nimport { AudioDefinition, AudioDefinitionObject, Audio, AudioObject } from \"./Audio\"\nimport { Factories } from \"../../Definitions/Factories\"\nimport { Is } from \"../../Utilities/Is\"\nimport { DefinitionType } from \"../../Setup/Enums\"\n\n/**\n * @internal\n */\nconst audioDefinition = (object : AudioDefinitionObject) : AudioDefinition => {\n  const { id } = object\n  if (!id) throw Errors.id\n\n  if (Definitions.installed(id)) return <AudioDefinition> Definitions.fromId(id)\n\n  return new AudioDefinitionClass(object)\n}\n\n/**\n * @internal\n */\nconst audioDefinitionFromId = (id : string) : AudioDefinition => {\n  return audioDefinition({ id })\n}\n\n/**\n * @internal\n */\nconst audioInstance = (object : AudioObject) : Audio => {\n  const definition = audioDefinition(object)\n  const instance = definition.instanceFromObject(object)\n  return instance\n}\n\n/**\n * @internal\n */\nconst audioFromId = (id : string) : Audio => {\n  return audioInstance({ id })\n}\n\n/**\n * @internal\n */\nconst audioInitialize = () : void => {}\n\n/**\n * @internal\n */\nconst audioDefine = (object : AudioDefinitionObject) : AudioDefinition => {\n  const { id } = object\n  if (!(id && Is.populatedString(id))) throw Errors.id\n\n  Definitions.uninstall(id)\n  return audioDefinition(object)\n}\n\n/**\n * @internal\n */\nconst audioInstall = (object: AudioDefinitionObject): AudioDefinition => {\n  const instance = audioDefine(object)\n  instance.retain = true\n  return instance\n}\n\nconst AudioFactoryImplementation = {\n  define: audioDefine,\n  definition: audioDefinition,\n  definitionFromId: audioDefinitionFromId,\n  fromId: audioFromId,\n  initialize: audioInitialize,\n  install: audioInstall,\n  instance: audioInstance,\n}\n\nFactories[DefinitionType.Audio] = AudioFactoryImplementation\n\n\nexport {\n  audioDefine,\n  audioDefinition,\n  audioDefinitionFromId,\n  AudioFactoryImplementation,\n  audioFromId,\n  audioInstall,\n  audioInitialize,\n  audioInstance,\n}\n","import { JsonObject, ScalarValue, ValueObject } from \"../declarations\"\nimport { Errors } from \"./Errors\"\n\ninterface ParameterObject {\n  name? : string\n  value? : ScalarValue | ValueObject[]\n}\n\nclass Parameter {\n  constructor({ name, value } : ParameterObject) {\n    if (!name) throw Errors.invalid.name\n    if (typeof value === \"undefined\") throw Errors.invalid.value\n\n    this.name = String(name)\n    this.value = value\n  }\n\n  name : string\n\n  toJSON() : JsonObject {\n    return { name: this.name, value: this.value }\n  }\n\n  value : ScalarValue | ValueObject[]\n}\n\nexport { Parameter, ParameterObject }\n","import { InstanceBase } from \"../../Base/Instance\"\nimport { VisibleContext } from \"../../Playing\"\nimport { Any, InputFilter, JsonObject, ValueObject } from \"../../declarations\"\nimport { Errors } from \"../../Setup/Errors\"\nimport { Evaluator, Is } from \"../../Utilities\"\nimport { FilterDefinition } from \"./Filter\"\nimport { Parameter } from \"../../Setup/Parameter\"\nimport { FilterObject } from \"./Filter\"\n\nclass FilterClass extends InstanceBase {\n  constructor(...args : Any[]) {\n    super(...args)\n    const [object] = args\n    if (!Is.populatedObject(object)) throw Errors.invalid.object + 'filter'\n\n    const { parameters } = <FilterObject> object\n    if (parameters) {\n      this.parameters.push(...parameters.map(parameter => new Parameter(parameter)))\n    }\n  }\n\n  declare definition : FilterDefinition\n\n  drawFilter(evaluator : Evaluator) : VisibleContext {\n    this.definition.scopeSet(evaluator)\n    const evaluated = this.evaluated(evaluator)\n    return this.definition.draw(evaluator, evaluated)\n  }\n\n  evaluated(evaluator : Evaluator) : ValueObject {\n    const evaluated : ValueObject = {}\n    const parameters = [...this.parameters]\n    // console.log(this.constructor.name, \"evaluated\", this.id, parameters.map(p => p.name))\n    this.definition.parameters.forEach(parameter => {\n      if (parameters.find(p => p.name === parameter.name)) return\n\n      // console.log(this.constructor.name, \"evaluated\", this.id, \"adding\", parameter.name)\n      parameters.push(parameter)\n    })\n\n    if (!Is.populatedArray(parameters)) return evaluated\n\n    parameters.forEach(parameter => {\n      const { name, value } = parameter\n      if (!Is.populatedString(name)) return\n\n      const evaluatedValue = evaluator.evaluate(value)\n      evaluated[name] = evaluatedValue\n      evaluator.set(name, evaluatedValue)\n      return `${name}=>${evaluatedValue}`\n    })\n    return evaluated\n  }\n\n\n  inputFilter(evaluator: Evaluator): InputFilter {\n    this.definition.scopeSet(evaluator)\n    const evaluated = this.evaluated(evaluator)\n    const input = this.definition.input(evaluator, evaluated)\n\n    // console.log(this.constructor.name, \"inputFilter\", input)\n    return input\n  }\n\n  parameters : Parameter[] = []\n\n  toJSON() : JsonObject {\n    const object : JsonObject = { id: this.id }\n    if (this.parameters.length) object.parameters = this.parameters\n    return object\n  }\n}\n\nexport { FilterClass }\n","import { Any, InputFilter, ValueObject } from \"../../declarations\"\nimport { Parameter } from \"../../Setup/Parameter\"\nimport { Evaluator } from \"../../Utilities/Evaluator\"\nimport { DefinitionBase } from \"../../Base/Definition\"\nimport { VisibleContext } from \"../../Playing\"\nimport { Filter, FilterObject } from \"./Filter\"\nimport { FilterClass } from \"./FilterInstance\"\nimport { DefinitionType } from \"../../Setup/Enums\"\nimport { Errors } from \"../../Setup/Errors\"\nimport { Definitions } from \"../../Definitions/Definitions\"\n\n\nclass FilterDefinitionClass extends DefinitionBase {\n  constructor(...args : Any[]) {\n    super(...args)\n    Definitions.install(this)\n  }\n\n  draw(_evaluator : Evaluator, _evaluated : ValueObject) : VisibleContext {\n    throw Errors.unimplemented + this.id\n  }\n\n  input(_evaluator: Evaluator, _evaluated: ValueObject): InputFilter {\n    throw Errors.unimplemented + this.id\n  }\n\n  get instance() : Filter {\n    return this.instanceFromObject(this.instanceObject)\n  }\n\n  instanceFromObject(object : FilterObject) : Filter {\n    const instance = new FilterClass({ ...this.instanceObject, ...object })\n    return instance\n  }\n\n  parameters : Parameter[] = []\n\n  retain = true\n\n  scopeSet(_evaluator : Evaluator) : void {}\n\n  type = DefinitionType.Filter\n}\n\nexport { FilterDefinitionClass }\n","import { Evaluator } from \"../../../Utilities/Evaluator\"\nimport { Errors } from \"../../../Setup/Errors\"\nimport { DataType } from \"../../../Setup/Enums\"\nimport { FilterDefinitionClass } from \"../FilterDefinition\"\nimport { VisibleContext } from \"../../../Playing/VisibleContext\"\nimport { Types } from \"../../../Setup/Types\"\n\nclass BlendFilter extends FilterDefinitionClass {\n\n  // eslint-disable-next-line camelcase\n  draw(evaluator : Evaluator, evaluated : { all_mode : string }) : VisibleContext {\n    const { context, mergeContext } = evaluator\n    if (!(context && mergeContext)) throw Errors.invalid.context\n\n    const modes = Types.propertyType(DataType.Mode).values\n    if (typeof modes === \"undefined\") throw Errors.unknown.mode\n\n    const mode = modes.find(object => object.id === evaluated.all_mode)\n    if (typeof mode === \"undefined\") throw Errors.unknown.mode\n\n    const { identifier } = mode\n\n    mergeContext.drawWithComposite(context.drawingSource, identifier)\n    return mergeContext\n  }\n}\n\nexport { BlendFilter }\n","import { Pixels, ValueObject, Yuv } from \"../../../declarations\"\nimport { Errors } from \"../../../Setup/Errors\"\nimport { Parameter } from \"../../../Setup/Parameter\"\nimport { Evaluator } from \"../../../Utilities/Evaluator\"\nimport { Color } from \"../../../Utilities/Color\"\nimport { Pixel } from \"../../../Utilities/Pixel\"\nimport { FilterDefinitionClass } from \"../FilterDefinition\"\nimport { VisibleContext } from \"../../../Playing/VisibleContext\"\n\nclass ChromaKeyFilter extends FilterDefinitionClass {\n  draw(evaluator : Evaluator, evaluated : ValueObject) : VisibleContext {\n    const { context } = evaluator\n    if (!context) throw Errors.invalid.context\n\n    const { width, height } = context.size\n    const { accurate } = evaluated\n    const similarity = Number(evaluated.similarity)\n    const blend = Number(evaluated.blend)\n\n    const color = String(evaluated.color)\n    const components = color.substr(4, color.length - 5).split(',')\n    const colors = components.map(f => Number(f))\n    const rgb = { r: colors[0], g: colors[1], b: colors[2] }\n    const yuv = Color.rgb2yuv(rgb)\n    const frame = context.imageData\n    const pixelsRgb = frame.data\n    const pixelsYuv = accurate ? (\n      this.yuvsFromPixelsAccurate(pixelsRgb, width, height) // slow!\n    ) : this.yuvsFromPixels(pixelsRgb)\n\n    let offset = 0\n\n    pixelsYuv.reverse().forEach(matrix => {\n      pixelsRgb[offset + 3] = Color.yuvBlend(matrix, yuv, similarity, blend)\n      offset += 4\n    })\n    context.drawImageData(frame)\n    return context\n  }\n\n  // id = 'chromakey'\n\n  parameters = [\n    new Parameter({ name: \"color\", value: \"color\" }),\n    new Parameter({ name: \"similarity\", value: \"similarity\" }),\n    new Parameter({ name: \"blend\", value: \"blend\" }),\n  ]\n\n  yuvsFromPixels(pixels : Pixels) : Yuv[][] {\n    const array = []\n    for (let index = pixels.length / 4 - 1; index > 0; index -= 1) {\n      array.push([Color.rgb2yuv(Pixel.rgbaAtIndex(index * 4, pixels))])\n    }\n    return array\n  }\n\n  yuvsFromPixelsAccurate(pixels : Pixels, width : number, height : number) : Yuv[][] {\n    const array = []\n    for (let index = pixels.length / 4 - 1; index > 0; index -= 1) {\n      const size = { width, height }\n      array.push(Pixel.neighboringRgbas(index * 4, pixels, size).map(rgb => Color.rgb2yuv(rgb)))\n    }\n    return array\n  }\n}\n\nexport { ChromaKeyFilter }\n","import { InputFilter, ValueObject } from \"../../../declarations\"\nimport { Errors } from \"../../../Setup/Errors\"\nimport { Parameter } from \"../../../Setup/Parameter\"\nimport { Evaluator } from \"../../../Utilities/Evaluator\"\nimport { isPopulatedString } from \"../../../Utilities/Is\"\nimport { pixelColor } from \"../../../Utilities/Pixel\"\nimport { FilterDefinitionClass } from \"../FilterDefinition\"\nimport { VisibleContext } from \"../../../Playing/VisibleContext\"\n\nclass ColorFilter extends FilterDefinitionClass {\n  draw(evaluator : Evaluator, evaluated : ValueObject) : VisibleContext {\n    const { context } = evaluator\n    if (!context) throw Errors.invalid.context\n\n    const { color } = evaluated\n    if (!isPopulatedString(color)) return context\n\n    context.drawFill(pixelColor(color))\n    return context\n  }\n\n  input(evaluator: Evaluator, evaluated: ValueObject): InputFilter {\n    const inputFilter: InputFilter = {\n      filter: this.id,\n      options: Object.fromEntries(this.parameters.map(parameter => [\n        parameter.name,\n        evaluated[parameter.name] || String(evaluator.get(parameter.name) || '')\n      ]))\n    }\n    // inputFilter.options.loop = 1\n    return inputFilter\n   }\n\n  parameters = [\n    new Parameter({ name: \"color\", value: \"color\" }),\n    new Parameter({ name: \"size\", value: \"mm_dimensions\" }),\n    // new Parameter({ name: \"duration\", value: \"mm_duration\" }),\n    new Parameter({ name: \"rate\", value: \"mm_fps\" }),\n  ]\n}\n\nexport { ColorFilter }\n","import { VisibleContext } from \"../../../Playing/VisibleContext\"\nimport { ValueObject } from \"../../../declarations\"\nimport { Evaluator } from \"../../../Utilities/Evaluator\"\nimport { FilterDefinitionClass } from \"../FilterDefinition\"\nimport { Errors } from \"../../../Setup/Errors\"\n\nclass ColorChannelMixerFilter extends FilterDefinitionClass {\n  draw(evaluator : Evaluator, evaluated : ValueObject) : VisibleContext {\n    const map = Object.fromEntries(Object.entries(evaluated).map(entry => {\n      const [key, value] = entry\n      return [key, Number(value)]\n    }))\n    const { context } = evaluator\n    if (!context) throw Errors.invalid.context\n\n    const rgbas = 'rgba'.split('')\n    rgbas.forEach(first => {\n      rgbas.forEach(second => {\n        const key = `${first}${second}`\n        if (map[key] === null) map[key] = first === second ? 1.0 : 0.0\n      })\n    })\n    const { imageData } = context\n    const { data } = imageData\n    data.forEach((r, i) => {\n      const g = data[i + 1]\n      const b = data[i + 2]\n      const a = data[i + 3]\n      data[i] = r * map.rr + g * map.rg + b * map.rb + a * map.ra\n      data[i + 1] = r * map.gr + g * map.gg + b * map.gb + a * map.ga\n      data[i + 2] = r * map.br + g * map.bg + b * map.bb + a * map.ba\n      data[i + 3] = r * map.ar + g * map.ag + b * map.ab + a * map.aa\n    })\n    context.drawImageData(imageData)\n    return context\n  }\n}\n\nexport { ColorChannelMixerFilter }\n","import { VisibleContext } from \"../../../Playing\"\nimport { UnknownObject, ValueObject } from \"../../../declarations\"\nimport { Evaluator } from \"../../../Utilities/Evaluator\"\nimport { pixelNeighboringRgbas } from \"../../../Utilities/Pixel\"\nimport { FilterDefinitionClass } from \"../FilterDefinition\"\nimport { Errors } from \"../../../Setup/Errors\"\n\nconst RBGA = 'rgba'\n\nconst parse = (evaluated : ValueObject) => {\n  const result : Record<string, UnknownObject> = { bias: {}, rdiv: {}, matrix: {} }\n  RBGA.split('').forEach((channel, index) => {\n    const matrixString = <string> evaluated[`${index}m`]\n    const matrix = matrixString.split(' ').map((i : string) => parseInt(i))\n    result.matrix[channel] = matrix\n    result.rdiv[channel] = evaluated[`${index}rdiv`] || 1\n    if (String(result.rdiv[channel]).includes('/')) {\n      const array = String(result.rdiv[channel]).split('/')\n      result.rdiv[channel] = parseFloat(array[0]) / parseFloat(array[1])\n    } else result.rdiv[channel] = parseFloat(String(result.rdiv[channel]))\n    result.bias[channel] = evaluated[`${index}bias`] || 0\n  })\n  // console.log(ConvolutionFilter.name, \"parse\", evaluated, result)\n  return result\n}\n\nclass ConvolutionFilter extends FilterDefinitionClass {\n  draw(evaluator : Evaluator, evaluated : ValueObject) : VisibleContext {\n    const options = parse(evaluated)\n    const { context } = evaluator\n    if (!context) throw Errors.invalid.context\n\n    const { size } = context\n    const { width, height } = size\n    const input = context.imageData\n    // TODO: figure out if we actually need fresh data??\n    const output = context.imageDataFresh\n    const inputData = input.data\n    const outputData = output.data\n    const area = width * height\n    for (let pixel = 0; pixel < area; pixel += 1) {\n      const rgbas = pixelNeighboringRgbas(pixel, inputData, size)\n      RBGA.split('').forEach((channel, index) => {\n        const rdiv = <number> options.rdiv[channel]\n        const matrix = <number[]> options.matrix[channel]\n        const bias = <number> options.bias[channel]\n        let sum = 0\n        for (let y = 0; y < 9; y += 1) sum += rgbas[y][channel] * matrix[y]\n\n        sum = Math.floor(sum * rdiv + bias + 0.5)\n        outputData[pixel * 4 + index] = sum\n      })\n    }\n    context.drawImageData(output)\n    return context\n  }\n\n  // id = 'convolution'\n\n}\n\nexport { ConvolutionFilter }\n","import { VisibleContext } from \"../../../Playing/VisibleContext\"\nimport { ContextFactory } from \"../../../Playing/ContextFactory\"\nimport { EvaluatedRect } from \"../../../declarations\"\nimport { Errors } from \"../../../Setup/Errors\"\nimport { Evaluator } from \"../../../Utilities/Evaluator\"\nimport { FilterDefinitionClass } from \"../FilterDefinition\"\n\nclass CropFilter extends FilterDefinitionClass {\n  draw(evaluator : Evaluator, evaluated : EvaluatedRect) : VisibleContext {\n    const { context } = evaluator\n    if (!context) throw Errors.invalid.context\n\n    const x = evaluated.x || 0\n    const y = evaluated.y || 0\n    const inSize = evaluator.inputSize\n    let width = evaluated.w || evaluated.out_w || 0\n    let height = evaluated.h || evaluated.out_h || 0\n    // console.log(this.constructor.name, width, height, evaluated)\n\n    if (width + height < 2) throw Errors.eval.outputSize\n\n    if (width === -1) width = inSize.width * (height / inSize.height)\n    if (height === -1) height = inSize.height * (width / inSize.width)\n\n    const fromSize = { width, height }\n    const inRect = { x, y, ...fromSize }\n    const drawing = ContextFactory.toSize(fromSize)\n    // console.log(this.constructor.name, \"draw\", inRect, fromSize)\n\n    drawing.drawInRectFromSize(context.drawingSource, inRect, fromSize)\n    return drawing\n  }\n\n  // id = 'crop'\n\n  scopeSet(evaluator: Evaluator): void {\n    const { context } = evaluator\n    if (!context) return\n\n    evaluator.setInputSize(context.size)\n    evaluator.initialize(\"x\", '((in_w - out_w) / 2)')\n    evaluator.initialize(\"y\", '((in_h - out_h) / 2)')\n  }\n}\n\nexport { CropFilter }\n","import { VisibleContext } from \"../../../Playing\"\nimport { Errors } from \"../../../Setup/Errors\"\nimport { Evaluator } from \"../../../Utilities/Evaluator\"\nimport { isPopulatedString } from \"../../../Utilities/Is\"\nimport { pixelColor } from \"../../../Utilities/Pixel\"\nimport { FilterDefinitionClass } from \"../FilterDefinition\"\n\ninterface EvaluatedBox {\n  x? : number\n  y? : number\n  color? : string\n  width? : number\n  height? : number\n}\n\nclass DrawBoxFilter extends FilterDefinitionClass {\n  draw(evaluator : Evaluator, evaluated : EvaluatedBox) : VisibleContext {\n    const { context } = evaluator\n    if (!context) throw Errors.invalid.context\n\n    const color = isPopulatedString(evaluated.color) ? <string> evaluated.color : 'black'\n    const x = evaluated.x || 0\n    const y = evaluated.y || 0\n    const width = evaluated.width || context.size.width\n    const height = evaluated.height || context.size.height\n\n    context.drawFillInRect(pixelColor(color), { x, y, width, height })\n    return context\n  }\n}\n\nexport { DrawBoxFilter }\n","import { InstanceBase } from \"../../Base/Instance\"\nimport { FontDefinition } from \"./Font\"\n\nclass FontClass extends InstanceBase {\n  declare definition : FontDefinition\n}\n\nexport { FontClass }\n","import { Any, JsonObject, LoadPromise } from \"../../declarations\"\nimport { Errors } from \"../../Setup/Errors\"\nimport { DefinitionType } from \"../../Setup/Enums\"\nimport { DefinitionBase } from \"../../Base/Definition\"\nimport { Font, FontDefinitionObject, FontObject } from \"./Font\"\nimport { FontClass } from \"./FontInstance\"\nimport { Definitions } from \"../../Definitions/Definitions\"\nimport { Time } from \"../../Utilities/Time\"\nimport { LoaderFactory } from \"../../Loading/LoaderFactory\"\nimport { Cache } from \"../../Loading/Cache\"\nimport { urlAbsolute } from \"../../Utilities/Url\"\n\nclass FontDefinitionClass extends DefinitionBase {\n  constructor(...args : Any[]) {\n    super(...args)\n    const [object] = args\n    const { source, url } = <FontDefinitionObject> object\n    if (!(source || url)) throw Errors.invalid.definition.source\n\n    this.source = source || url || ''\n    Definitions.install(this)\n  }\n  get absoluteUrl(): string { return urlAbsolute(this.source) }\n\n  get instance() : Font {\n    return this.instanceFromObject(this.instanceObject)\n  }\n\n  instanceFromObject(object : FontObject) : Font {\n    return new FontClass({ ...this.instanceObject, ...object })\n  }\n\n  loadDefinition(): LoadPromise | void {\n    const url = this.absoluteUrl\n    if (Cache.cached(url)) return\n\n    if (Cache.caching(url)) return Cache.get(url)\n\n    return LoaderFactory.font().loadUrl(url)\n  }\n\n  definitionUrls(_start : Time, _end? : Time) : string[] {\n    return [urlAbsolute(this.source)]\n  }\n\n  loadedVisible() : Any { return Cache.get(urlAbsolute(this.source)) }\n\n  retain = true\n\n  source : string\n\n  toJSON() : JsonObject {\n    return { ...super.toJSON(), source: this.source }\n  }\n\n  type = DefinitionType.Font\n}\n\nexport { FontDefinitionClass }\n","import { Definitions } from \"../../Definitions\"\nimport { DefinitionType } from \"../../Setup/Enums\"\nimport { FontDefinitionClass } from \"./FontDefinition\"\nimport { Font, FontDefinition, FontDefinitionObject, FontObject } from \"./Font\"\nimport { Factories } from \"../../Definitions/Factories\"\nimport { Is } from \"../../Utilities/Is\"\nimport fontDefaultJson from \"../../Definitions/DefinitionObjects/font/default.json\"\n\nconst fontDefaultId = \"com.moviemasher.font.default\"\n\nconst fontDefinition = (object : FontDefinitionObject) : FontDefinition => {\n  const { id } = object\n  const idString = id && Is.populatedString(id) ? id : fontDefaultId\n  if (!Definitions.installed(idString)) {\n    new FontDefinitionClass({ ...object, type: DefinitionType.Font, id: idString })\n  }\n  return <FontDefinition> Definitions.fromId(idString)\n}\nconst fontDefinitionFromId = (id : string) : FontDefinition => {\n  return fontDefinition({ id })\n}\n\nconst fontInstance = (object : FontObject) : Font => {\n  return fontDefinition(object).instanceFromObject(object)\n}\n\nconst fontFromId = (id : string) : Font => {\n  return fontInstance({ id })\n}\n\nconst fontInitialize = () : void => {\n  fontDefinition(fontDefaultJson)\n}\nconst fontDefine = (object : FontDefinitionObject) : FontDefinition => {\n  const { id } = object\n  const idString = id && Is.populatedString(id) ? id : fontDefaultId\n  Definitions.uninstall(idString)\n  return fontDefinition(object)\n}\n\nconst FontFactoryImplementation = {\n  define: fontDefine,\n  install: fontDefine,\n  definition: fontDefinition,\n  definitionFromId: fontDefinitionFromId,\n  fromId: fontFromId,\n  initialize: fontInitialize,\n  instance: fontInstance,\n}\n\nFactories[DefinitionType.Font] = FontFactoryImplementation\n\nexport {\n  fontDefine,\n  fontDefine as fontInstall,\n  fontDefinition,\n  fontDefinitionFromId,\n  FontFactoryImplementation,\n  fontFromId,\n  fontInitialize,\n  fontInstance,\n}\n","import { Cache } from \"../../../Loading\"\nimport { Evaluator, Is } from \"../../../Utilities\"\nimport { Parameter } from \"../../../Setup/Parameter\"\nimport { InputFilter, ScalarValue, TextStyle, ValueObject } from \"../../../declarations\"\nimport { Errors } from \"../../../Setup/Errors\"\nimport { FilterDefinitionClass } from \"../FilterDefinition\"\nimport { VisibleContext } from \"../../../Playing\"\nimport { fontDefinitionFromId } from \"../../Font/FontFactory\"\n\nconst mmFontFile = (id? : ScalarValue) : string => {\n  if (!Is.populatedString(id)) throw Errors.id + id\n\n  return fontDefinitionFromId(<string> id).absoluteUrl\n}\n\nconst mmTextFile = (text? : ScalarValue) : string => String(text)\n\nconst mmFontFamily = (id? : ScalarValue) : string => Cache.key(mmFontFile(id))\n\nclass DrawTextFilter extends FilterDefinitionClass {\n  draw(evaluator : Evaluator, evaluated : ValueObject) : VisibleContext {\n    const { context } = evaluator\n    if (!context) throw Errors.invalid.context\n\n    const fontface = String(evaluator.get(\"fontface\"))\n    const family = mmFontFamily(fontface)\n    const {\n      x, y, fontsize, fontcolor, text, textfile, shadowcolor, shadowx, shadowy\n    } = evaluated\n    if (!(fontsize && Is.aboveZero(fontsize))) throw Errors.eval.number + \" fontsize\"\n\n    const height = Number(fontsize)\n    const textStyle : TextStyle =  {\n      height,\n      family,\n      color: String(fontcolor || 'black'),\n      shadow: String(shadowcolor || \"\"),\n      shadowPoint: { x: Number(shadowx || 0), y: Number(shadowy || 0) },\n    }\n    const point = { x: Number(x || 0), y: Number(y || 0) }\n    const string = String(text || textfile)\n    context.drawTextAtPoint(string, textStyle, point)\n\n    return context\n  }\n\n  input(_evaluator: Evaluator, evaluated: ValueObject): InputFilter {\n    const outWidth = evaluated.w || evaluated.width || 0\n    const outHeight = evaluated.h || evaluated.height || 0\n    const inputFilter: InputFilter = {\n      filter: this.id,\n      options: { width: outWidth, height: outHeight }\n    }\n\n    return inputFilter\n  }\n\n  parameters = [\n    new Parameter({ name: \"fontcolor\", value: \"#000000\" }),\n    new Parameter({ name: \"shadowcolor\", value: \"#FFFFFF\" }),\n    new Parameter({ name: \"fontsize\", value: \"mm_vert(20)\" }),\n    new Parameter({ name: \"x\", value: \"0\" }),\n    new Parameter({ name: \"y\", value: \"0\" }),\n    new Parameter({ name: \"shadowx\", value: \"mm_horz(5)\" }),\n    new Parameter({ name: \"shadowy\", value: \"mm_vert(5)\" }),\n    new Parameter({ name: \"fontfile\", value: \"mmFontFile('com.moviemasher.font.default')\" }),\n    new Parameter({ name: \"textfile\", value: \"Hello World\" }),\n  ]\n\n  scopeSet(evaluator : Evaluator) : void {\n    evaluator.set(\"text_w\", 0) // width of the text to draw\n    evaluator.set(\"text_h\", 0) // height of the text to draw\n    evaluator.set(\"mmFontFamily\", mmFontFamily)\n    evaluator.set(\"mmTextFile\", mmTextFile)\n    evaluator.set(\"mmFontFile\", mmFontFile)\n\n    // support deprecated snake case\n    evaluator.set(\"mm_fontfamily\", mmFontFamily)\n    evaluator.set(\"mm_textfile\", mmTextFile)\n    evaluator.set(\"mm_fontfile\", mmFontFile)\n  }\n}\n\nexport { DrawTextFilter }\n","\nimport { ContextFactory } from \"../../../Playing/ContextFactory\"\nimport { VisibleContext } from \"../../../Playing/VisibleContext\"\nimport { Errors } from \"../../../Setup/Errors\"\nimport { Evaluator } from \"../../../Utilities/Evaluator\"\nimport { FilterDefinitionClass } from \"../FilterDefinition\"\n\nclass FadeFilter extends FilterDefinitionClass {\n  draw(evaluator : Evaluator) : VisibleContext {\n    const { context } = evaluator\n    if (!context) throw Errors.invalid.context\n\n    const drawing = ContextFactory.toSize(context.size)\n    const alpha = Number(evaluator.get('alpha') || evaluator.position)\n    const type = String(evaluator.get('type') || 'in')\n    const typedAlpha = type === 'in' ? alpha : 1.0 - alpha\n    drawing.drawWithAlpha(context.drawingSource, typedAlpha)\n    return drawing\n  }\n}\n\nexport { FadeFilter }\n","\nimport { VisibleContext } from \"../../../Playing/VisibleContext\"\nimport { EvaluatedPoint, InputFilter, ValueObject } from \"../../../declarations\"\nimport { Errors } from \"../../../Setup/Errors\"\nimport { Evaluator } from \"../../../Utilities/Evaluator\"\nimport { FilterDefinitionClass } from \"../FilterDefinition\"\n\nclass OverlayFilter extends FilterDefinitionClass {\n  draw(evaluator : Evaluator, evaluated : EvaluatedPoint) : VisibleContext {\n    const { x, y } = evaluated\n    const { context, mergeContext } = evaluator\n    if (!(context && mergeContext)) throw Errors.invalid.context\n\n    mergeContext.drawAtPoint(context.drawingSource, { x: x || 0, y: y || 0 })\n    return mergeContext\n  }\n\n  input(_evaluator: Evaluator, evaluated: ValueObject): InputFilter {\n    const { x, y } = evaluated\n    return {\n      filter: this.id,\n      options: { x, y }\n    }\n  }\n\n  scopeSet(evaluator: Evaluator): void {\n    const { context } = evaluator\n    if (!context) return\n\n    const { width, height } = context.size\n    evaluator.set(\"overlay_w\", width)\n    evaluator.set(\"overlay_h\", height)\n  }\n}\n\nexport { OverlayFilter }\n","\nimport { EvaluatedSize, InputFilter, Size, ValueObject } from \"../../../declarations\"\nimport { Errors } from \"../../../Setup/Errors\"\nimport { Evaluator } from \"../../../Utilities/Evaluator\"\nimport { VisibleContext } from \"../../../Playing/VisibleContext\"\nimport { ContextFactory } from \"../../../Playing/ContextFactory\"\nimport { FilterDefinitionClass } from \"../FilterDefinition\"\n\nclass ScaleFilter extends FilterDefinitionClass {\n  draw(evaluator : Evaluator, evaluated : EvaluatedSize) : VisibleContext {\n    const { context } = evaluator\n    if (!context) throw Errors.invalid.context\n\n    let outWidth = evaluated.w || evaluated.width || 0\n    let outHeight = evaluated.h || evaluated.height || 0\n    if (outWidth + outHeight < 2) return context\n\n\n    const inSize : Size = {\n      width: Number(evaluator.get(\"mm_in_w\")), height: Number(evaluator.get(\"mm_in_h\"))\n    }\n    if (outWidth === -1) outWidth = inSize.width * (outHeight / inSize.height)\n    else if (outHeight === -1) outHeight = inSize.height * (outWidth / inSize.width)\n\n    const fromSize = { width: outWidth, height: outHeight }\n    const drawing = ContextFactory.toSize(fromSize)\n    // console.log(this.constructor.name, \"draw\", inSize, fromSize)\n\n    drawing.drawInSizeFromSize(context.drawingSource, inSize, fromSize)\n    return drawing\n  }\n\n  input(_evaluator: Evaluator, evaluated: ValueObject): InputFilter {\n    const outWidth = evaluated.w || evaluated.width || 0\n    const outHeight = evaluated.h || evaluated.height || 0\n    const inputFilter: InputFilter = {\n      filter: this.id,\n      options: { width: outWidth, height: outHeight }\n    }\n\n    return inputFilter\n  }\n\n  scopeSet(evaluator: Evaluator): void {\n    const { context } = evaluator\n    if (!context) return\n\n    const { width, height } = context.size\n    evaluator.set(\"in_h\", height)\n    evaluator.set(\"mm_in_h\", height)\n    evaluator.set(\"in_w\", width)\n    evaluator.set(\"mm_in_w\", width)\n  }\n}\n\nexport { ScaleFilter }\n","import { InputFilter, ValueObject } from \"../../../declarations\"\nimport { Errors } from \"../../../Setup/Errors\"\nimport { VisibleContext } from \"../../../Playing/VisibleContext\"\nimport { Evaluator } from \"../../../Utilities/Evaluator\"\nimport { FilterDefinitionClass } from \"../FilterDefinition\"\n\nclass SetSarFilter extends FilterDefinitionClass {\n  draw(evaluator: Evaluator, _evaluated: ValueObject): VisibleContext {\n    const { context } = evaluator\n    if (!context) throw Errors.invalid.context\n\n    return context\n  }\n\n  input(_evaluator: Evaluator, evaluated: ValueObject): InputFilter {\n    return { filter: this.id, options: { sar: 1, max: 1 } }\n  }\n}\n\nexport { SetSarFilter }\n","import { BlendFilter } from \"./Definitions/BlendFilter\"\nimport { ChromaKeyFilter } from \"./Definitions/ChromaKeyFilter\"\nimport { ColorFilter } from \"./Definitions/ColorFilter\"\nimport { ColorChannelMixerFilter } from \"./Definitions/ColorChannelMixerFilter\"\nimport { ConvolutionFilter } from \"./Definitions/ConvolutionFilter\"\nimport { CropFilter } from \"./Definitions/CropFilter\"\nimport { DrawBoxFilter } from \"./Definitions/DrawBoxFilter\"\nimport { DrawTextFilter } from \"./Definitions/DrawTextFilter\"\nimport { FadeFilter } from \"./Definitions/FadeFilter\"\nimport { OverlayFilter } from \"./Definitions/OverlayFilter\"\nimport { ScaleFilter } from \"./Definitions/ScaleFilter\"\nimport { SetSarFilter } from \"./Definitions/SetSarFilter\"\nimport { Definitions } from \"../../Definitions\"\nimport { Errors } from \"../../Setup/Errors\"\nimport { FilterDefinition, Filter, FilterDefinitionObject } from \"./Filter\"\nimport { Factories } from \"../../Definitions/Factories\"\nimport { Is } from \"../../Utilities/Is\"\nimport { DefinitionType } from \"../../Setup/Enums\"\n\n\nconst filterDefinition = (object : FilterDefinitionObject) : FilterDefinition => {\n  const { id } = object\n  if (!(id && Is.populatedString(id))) throw Errors.id + JSON.stringify(object)\n\n  if (Definitions.installed(id)) return <FilterDefinition> Definitions.fromId(id)\n\n  throw Errors.invalid.definition.id + ' filterDefinition ' + id\n}\n\nconst filterDefinitionFromId = (id : string) : FilterDefinition => {\n  return filterDefinition({ id })\n}\n\nconst filterInstance = (object : FilterDefinitionObject) : Filter => {\n  return filterDefinition(object).instanceFromObject(object)\n}\n\nconst filterFromId = (id : string) : Filter => { return filterInstance({ id }) }\n\nconst filterInitialize = () : void => {\n  new ConvolutionFilter({ id: 'convolution', type: DefinitionType.Filter })\n  new SetSarFilter({ id: 'setsar', type: DefinitionType.Filter })\n  new BlendFilter({ id: 'blend', type: DefinitionType.Filter })\n  new ChromaKeyFilter({ id: 'chromakey', type: DefinitionType.Filter })\n  new ColorFilter({ id: 'color', type: DefinitionType.Filter })\n  new ColorChannelMixerFilter({ id: 'colorchannelmixer', type: DefinitionType.Filter })\n  new CropFilter({ id: 'crop', type: DefinitionType.Filter })\n  new DrawBoxFilter({ id: 'drawbox', type: DefinitionType.Filter })\n  new DrawTextFilter({ id: 'drawtext', type: DefinitionType.Filter })\n  new FadeFilter({ id: 'fade', type: DefinitionType.Filter })\n  new OverlayFilter({ id: 'overlay', type: DefinitionType.Filter })\n  new ScaleFilter({ id: 'scale', type: DefinitionType.Filter })\n}\n\nconst filterDefine = (object : FilterDefinitionObject) : FilterDefinition => {\n  const { id } = object\n  if (!(id && Is.populatedString(id))) throw Errors.invalid.definition.id + 'filterDefine'\n\n  Definitions.uninstall(id)\n  return filterDefinition(object)\n}\n\nconst FilterFactoryImplementation = {\n  define: filterDefine,\n  install: filterDefine,\n  definition: filterDefinition,\n  definitionFromId: filterDefinitionFromId,\n  fromId: filterFromId,\n  initialize: filterInitialize,\n  instance: filterInstance,\n}\n\nFactories[DefinitionType.Filter] = FilterFactoryImplementation\n\nexport {\n  filterDefine,\n  filterDefine as filterInstall,\n  filterDefinition,\n  filterDefinitionFromId,\n  FilterFactoryImplementation,\n  filterFromId,\n  filterInitialize,\n  filterInstance,\n}\n","import { Modular, ModularDefinitionClass, ModularDefinitionObject } from \"./Modular\"\nimport { Property, PropertyObject } from \"../../Setup/Property\"\nimport { Any, InputFilter, JsonObject, ScalarValue, Size } from \"../../declarations\"\nimport { Errors } from \"../../Setup/Errors\"\nimport { TimeRange } from \"../../Utilities/TimeRange\"\nimport { Is } from \"../../Utilities/Is\"\nimport { VisibleContext } from \"../../Playing\"\nimport { DefinitionClass } from \"../../Base/Definition\"\nimport { Filter } from \"../../Mash/Filter/Filter\"\nimport { Evaluator } from \"../../Utilities/Evaluator\"\nimport { filterInstance } from \"../../Mash/Filter\"\n\nfunction ModularDefinitionMixin<T extends DefinitionClass>(Base: T) : ModularDefinitionClass & T {\n  return class extends Base {\n    constructor(...args : Any[]) {\n      super(...args)\n      const [object] = args\n      const { properties, filters } = <ModularDefinitionObject> object\n      if (properties) {\n        const propertyInstances = Object.entries(properties).map(entry => {\n          const [name, propertyObject] = entry\n          if (!Is.object(propertyObject)) throw Errors.invalid.property + \"name \" + name\n\n          const property : PropertyObject = Object.assign(propertyObject, { name, custom: true })\n          return new Property(property)\n        })\n        this.properties.push(...propertyInstances)\n      }\n      if (filters) {\n        const filterInstances = filters.map(filter => {\n          const { id } = filter\n          if (!id) throw Errors.id + JSON.stringify(filter)\n\n          return filterInstance(filter)\n        })\n        this.filters.push(...filterInstances)\n      }\n\n    }\n\n    drawFilters(modular: Modular, range : TimeRange, context : VisibleContext, size : Size, outContext?: VisibleContext) : VisibleContext {\n     // range's frame is offset of draw time in clip = frames is duration\n      let contextFiltered = context\n      this.filters.forEach(filter => {\n        const evaluator = this.evaluator(modular, range, size, contextFiltered, outContext)\n        contextFiltered = filter.drawFilter(evaluator)\n      })\n      return contextFiltered\n    }\n\n    evaluator(modular: Modular, range : TimeRange, size : Size, context? : VisibleContext, mergerContext? : VisibleContext) : Evaluator {\n      const instance = new Evaluator(range, size, context, mergerContext)\n      this.propertiesCustom.forEach(property => {\n        const value = <ScalarValue> modular.value(property.name)\n        instance.set(property.name, value)\n      })\n      return instance\n    }\n\n    filters : Filter[] = []\n\n    inputFilters(modular: Modular, range: TimeRange, size: Size): InputFilter[] {\n      // range's frame is offset of draw time in clip = frames is duration\n      const inputFilters = this.filters.map(filter => {\n        const evaluator = this.evaluator(modular, range, size)\n        return filter.inputFilter(evaluator)\n      })\n\n      // console.log(this.constructor.name, \"inputFilters\", this.id, inputFilters)\n      return inputFilters\n    }\n\n    get propertiesCustom() : Property[] {\n      return this.properties.filter(property => property.custom)\n    }\n\n    retain = true\n\n    toJSON() : JsonObject {\n      const object = super.toJSON()\n      if (this.filters.length) object.filters = this.filters\n      const entries = this.propertiesCustom.map(property => [property.name, property])\n      if (entries.length) object.properties = Object.fromEntries(entries)\n\n      return object\n    }\n  }\n}\n\nexport { ModularDefinitionMixin }\n","import { Any, LoadPromise, Size } from \"../../declarations\"\nimport { Definition } from \"../../Base/Definition\"\nimport { ModularClass, ModularDefinition } from \"./Modular\"\nimport { Definitions } from \"../../Definitions/Definitions\"\nimport { InstanceClass } from \"../../Base/Instance\"\nimport { Time } from \"../../Utilities/Time\"\n\n\nfunction ModularMixin<T extends InstanceClass>(Base: T) : ModularClass & T {\n  return class extends Base {\n    constructor(...args : Any[]) {\n      super(...args)\n      const [object] = args\n      this.constructProperties(object)\n    }\n\n    constructProperties(object : Any = {}) : void {\n      // console.log(this.constructor.name, \"constructProperties\", object, this.propertyNames)\n      this.definition.properties.forEach(property => {\n        const { name } = property\n        if (typeof object[name] !== \"undefined\") this[name] = object[name]\n        else if (typeof this[name] === \"undefined\") this[name] = property.value\n      })\n    }\n\n    declare definition : ModularDefinition\n\n    get definitions() : Definition[] {\n      return [...super.definitions, ...this.modularDefinitions]\n    }\n\n    loadModular(quantize : number, start : Time, end? : Time) : LoadPromise | void {\n      const promises: LoadPromise[] = []\n      const startTime = this.definitionTime(quantize, start)\n      const endTime = end ? this.definitionTime(quantize, end) : end\n      this.modularDefinitions.forEach(definition => {\n        const promise = definition.loadDefinition(quantize, startTime, endTime)\n        if (promise) promises.push(promise)\n      })\n      return Promise.all(promises).then()\n    }\n\n    modularUrls(quantize : number, start : Time, end? : Time) : string[] {\n      const startTime = this.definitionTime(quantize, start)\n      const endTime = end ? this.definitionTime(quantize, end) : end\n      return this.modularDefinitions.flatMap(definition =>\n        definition.definitionUrls(startTime, endTime)\n      )\n    }\n\n    get modularDefinitions() : Definition[] {\n      const modular = this.definition.propertiesModular\n      const ids = modular.map(property => String(this.value(property.name)))\n      return ids.map(id => Definitions.fromId(id))\n    }\n  }\n}\n\nexport { ModularMixin }\n","import { EffectDefinition } from \"./Effect\"\nimport { InstanceBase } from \"../../Base/Instance\"\nimport { ModularMixin } from \"../../Mixin/Modular/ModularMixin\"\nimport { JsonObject } from \"../../declarations\"\n\nconst EffectWithModular = ModularMixin(InstanceBase)\nclass EffectClass extends EffectWithModular {\n  declare definition : EffectDefinition\n\n  // toJSON() : JsonObject {\n  //   const object = super.toJSON()\n  //   object.id = this.id\n  //   return object\n  // }\n}\n\nexport { EffectClass }\n","import { DefinitionBase } from \"../../Base/Definition\"\nimport { Effect, EffectObject } from \"./Effect\"\nimport { ModularDefinitionMixin } from \"../../Mixin/Modular/ModularDefinitionMixin\"\nimport { Any } from \"../../declarations\"\nimport { Definitions } from \"../../Definitions/Definitions\"\nimport { EffectClass } from \"./EffectInstance\"\nimport { DataType, DefinitionType } from \"../../Setup/Enums\"\nimport { Property } from \"../../Setup/Property\"\n\nconst EffectDefinitionWithModular = ModularDefinitionMixin(DefinitionBase)\nclass EffectDefinitionClass extends EffectDefinitionWithModular {\n  constructor(...args : Any[]) {\n    super(...args)\n\n    this.properties.push(new Property({ name: \"label\", type: DataType.String, value: \"\" }))\n\n    Definitions.install(this)\n  }\n\n  get instance() : Effect { return this.instanceFromObject(this.instanceObject) }\n\n  instanceFromObject(object : EffectObject) : Effect {\n    return new EffectClass({ ...this.instanceObject, ...object })\n  }\n\n  type = DefinitionType.Effect\n}\n\nexport { EffectDefinitionClass }\n","import { DefinitionType } from \"../../Setup/Enums\"\nimport { Errors } from \"../../Setup/Errors\"\nimport { EffectDefinitionClass } from \"./EffectDefinition\"\nimport { Definitions } from \"../../Definitions\"\nimport { Factories } from \"../../Definitions/Factories\"\nimport { Is } from \"../../Utilities/Is\"\nimport { Effect, EffectDefinition, EffectObject, EffectDefinitionObject } from \"./Effect\"\n\nimport effectBlurJson from \"../../Definitions/DefinitionObjects/effect/blur.json\"\nimport effectChromaKeyJson from \"../../Definitions/DefinitionObjects/effect/chromakey.json\"\nimport effectEmbossJson from \"../../Definitions/DefinitionObjects/effect/emboss.json\"\nimport effectGrayscaleJson from \"../../Definitions/DefinitionObjects/effect/grayscale.json\"\nimport effectSepiaJson from \"../../Definitions/DefinitionObjects/effect/sepia.json\"\nimport effectSharpenJson from \"../../Definitions/DefinitionObjects/effect/sharpen.json\"\nimport effectTextJson from \"../../Definitions/DefinitionObjects/effect/text.json\"\n\n\nconst effectDefinition = (object : EffectDefinitionObject) : EffectDefinition => {\n  const { id } = object\n  if (!(id && Is.populatedString(id))) throw Errors.id + JSON.stringify(object)\n\n  if (Definitions.installed(id)) return <EffectDefinition> Definitions.fromId(id)\n\n  return new EffectDefinitionClass({...object, type: DefinitionType.Effect })\n}\n\nconst effectDefinitionFromId = (id : string) : EffectDefinition => {\n  return effectDefinition({ id })\n}\n\nconst effectInstance = (object : EffectObject) : Effect => {\n  const definition = effectDefinition(object)\n  const instance = definition.instanceFromObject(object)\n  return instance\n}\n\nconst effectFromId = (id : string) : Effect => {\n  return effectInstance({ id })\n}\n\nconst effectInitialize = () : void => {\n  new EffectDefinitionClass(effectBlurJson)\n  new EffectDefinitionClass(effectChromaKeyJson)\n  new EffectDefinitionClass(effectEmbossJson)\n  new EffectDefinitionClass(effectGrayscaleJson)\n  new EffectDefinitionClass(effectSepiaJson)\n  new EffectDefinitionClass(effectSharpenJson)\n  new EffectDefinitionClass(effectTextJson)\n}\n\nconst effectDefine = (object : EffectDefinitionObject) : EffectDefinition => {\n  const { id } = object\n  if (!(id && Is.populatedString(id))) throw Errors.id\n\n  Definitions.uninstall(id)\n  return effectDefinition(object)\n}\n\nconst EffectFactoryImplementation = {\n  define: effectDefine,\n  definition: effectDefinition,\n  definitionFromId: effectDefinitionFromId,\n  fromId: effectFromId,\n  initialize: effectInitialize,\n  install: effectDefine,\n  instance: effectInstance,\n}\n\nFactories[DefinitionType.Effect] = EffectFactoryImplementation\n\nexport {\n  effectDefine,\n  effectDefinition,\n  effectDefinitionFromId,\n  EffectFactoryImplementation,\n  effectFromId,\n  effectDefine as effectInstall,\n  effectInitialize,\n  effectInstance,\n}\n","import { MergerDefinition } from \"./Merger\"\nimport { InstanceBase } from \"../../Base/Instance\"\nimport { ModularMixin } from \"../../Mixin/Modular/ModularMixin\"\nimport { Factory } from \"../../Definitions/Factory/Factory\"\n\n\nconst MergerWithModular = ModularMixin(InstanceBase)\nclass MergerClass extends MergerWithModular {\n  declare definition : MergerDefinition\n\n  // get id() : string { return this.definition.id }\n\n  // set id(value : string) {\n  //   this.definition = Factory.merger.definitionFromId(value)\n  //   this.constructProperties()\n  // }\n}\n\nexport { MergerClass }\n","import { MergerClass } from \"./MergerInstance\"\nimport { DefinitionBase } from \"../../Base/Definition\"\nimport { Merger, MergerObject } from \"./Merger\"\nimport { ModularDefinitionMixin } from \"../../Mixin/Modular/ModularDefinitionMixin\"\nimport { Any } from \"../../declarations\"\nimport { DefinitionType } from \"../../Setup/Enums\"\n\nimport { Definitions } from \"../../Definitions/Definitions\"\n\nconst MergerDefinitionWithModular = ModularDefinitionMixin(DefinitionBase)\nclass MergerDefinitionClass extends MergerDefinitionWithModular {\n  constructor(...args : Any[]) {\n    super(...args)\n    // this.properties.push(new Property({ name: \"id\", type: DataType.String, value: \"\" }))\n    Definitions.install(this)\n  }\n\n  get instance() : Merger {\n    return this.instanceFromObject(this.instanceObject)\n  }\n\n  instanceFromObject(object : MergerObject) : Merger {\n    const instance = new MergerClass({ ...this.instanceObject, ...object })\n    return instance\n  }\n  retain = true\n\n  type = DefinitionType.Merger\n}\n\nexport { MergerDefinitionClass }\n","import { DefinitionType } from \"../../Setup/Enums\"\nimport { MergerDefinitionClass } from \"../Merger/MergerDefinition\"\nimport { Definitions } from \"../../Definitions\"\nimport mergerBlendJson from \"../../Definitions/DefinitionObjects/merger/blend.json\"\nimport mergerCenterJson from \"../../Definitions/DefinitionObjects/merger/center.json\"\nimport mergerConstrainedJson from \"../../Definitions/DefinitionObjects/merger/constrained.json\"\nimport mergerDefaultJson from \"../../Definitions/DefinitionObjects/merger/default.json\"\nimport mergerOverlayJson from \"../../Definitions/DefinitionObjects/merger/overlay.json\"\nimport {\n  Merger,\n  MergerObject,\n  MergerDefinition,\n  MergerDefinitionObject,\n  MergerFactory\n} from \"../Merger/Merger\"\nimport { Factories } from \"../../Definitions/Factories\"\nimport { Is } from \"../../Utilities/Is\"\n\n\nconst mergerDefaultId = \"com.moviemasher.merger.default\"\n\nconst mergerDefinition = (object : MergerDefinitionObject) : MergerDefinition => {\n  const { id } = object\n  const idString = id && Is.populatedString(id) ? id : mergerDefaultId\n  if (Definitions.installed(idString)) return <MergerDefinition> Definitions.fromId(idString)\n\n  return new MergerDefinitionClass({ ...object, type: DefinitionType.Merger, id: idString })\n}\n\nconst mergerDefinitionFromId = (id : string) : MergerDefinition => {\n  return mergerDefinition({ id })\n}\n\nconst mergerInstance = (object: MergerObject): Merger => {\n  const { definitionId } = object\n\n  const definition = mergerDefinition({ id: definitionId })\n  return definition.instanceFromObject(object)\n}\n\nconst mergerFromId = (definitionId : string) : Merger => {\n  return mergerInstance({ definitionId })\n}\n\nconst mergerInitialize = () : void => {\n  new MergerDefinitionClass(mergerBlendJson)\n  new MergerDefinitionClass(mergerCenterJson)\n  new MergerDefinitionClass(mergerConstrainedJson)\n  new MergerDefinitionClass(mergerDefaultJson)\n  new MergerDefinitionClass(mergerOverlayJson)\n}\n\nconst mergerDefine = (object : MergerDefinitionObject) : MergerDefinition => {\n  const { id } = object\n  const idString = id && Is.populatedString(id) ? id : mergerDefaultId\n  Definitions.uninstall(idString)\n  return mergerDefinition(object)\n}\n\n\nconst MergerFactoryImplementation : MergerFactory = {\n  define: mergerDefine,\n  install: mergerDefine,\n  definition: mergerDefinition,\n  definitionFromId: mergerDefinitionFromId,\n  fromId: mergerFromId,\n  initialize: mergerInitialize,\n  instance: mergerInstance,\n}\n\nFactories[DefinitionType.Merger] = MergerFactoryImplementation\n\nexport {\n  mergerDefine,\n  mergerDefine as mergerInstall,\n  mergerDefaultId,\n  mergerDefinition,\n  mergerDefinitionFromId,\n  MergerFactoryImplementation,\n  mergerFromId,\n  mergerInitialize,\n  mergerInstance,\n}\n","import { ScalerDefinition } from \"./Scaler\"\nimport { InstanceBase } from \"../../Base/Instance\"\nimport { ModularMixin } from \"../../Mixin/Modular/ModularMixin\"\n\nconst ScalerWithModular = ModularMixin(InstanceBase)\nclass ScalerClass extends ScalerWithModular { declare definition : ScalerDefinition }\n\nexport { ScalerClass }\n","import { Scaler, ScalerObject } from \"./Scaler\"\nimport { DefinitionBase } from \"../../Base/Definition\"\nimport { ModularDefinitionMixin } from \"../../Mixin/Modular/ModularDefinitionMixin\"\nimport { DefinitionType } from \"../../Setup/Enums\"\nimport { Definitions } from \"../../Definitions/Definitions\"\nimport { Any } from \"../../declarations\"\nimport { ScalerClass } from \"./ScalerInstance\"\n// import { Property } from \"../../Setup/Property\"\n\nconst ScalerDefinitionWithModular = ModularDefinitionMixin(DefinitionBase)\nclass ScalerDefinitionClass extends ScalerDefinitionWithModular {\n  constructor(...args : Any[]) {\n    super(...args)\n    // this.properties.push(new Property({ name: \"id\", type: DataType.String, value: \"\" }))\n    Definitions.install(this)\n  }\n\n  get instance() : Scaler {\n    return this.instanceFromObject(this.instanceObject)\n  }\n\n  instanceFromObject(object : ScalerObject) : Scaler {\n    const instance = new ScalerClass({ ...this.instanceObject, ...object })\n    return instance\n  }\n\n  retain = true\n\n  type = DefinitionType.Scaler\n}\n\nexport { ScalerDefinitionClass }\n","import { DefinitionType } from \"../../Setup/Enums\"\nimport { Is } from \"../../Utilities/Is\"\nimport { Definitions } from \"../../Definitions\"\nimport { Factories } from \"../../Definitions/Factories\"\nimport { ScalerDefinitionClass } from \"../Scaler/ScalerDefinition\"\nimport {\n  Scaler, ScalerDefinition, ScalerDefinitionObject, ScalerObject\n} from \"../Scaler/Scaler\"\n\nimport scalerDefaultJson from \"../../Definitions/DefinitionObjects/scaler/default.json\"\nimport scalerPanJson from \"../../Definitions/DefinitionObjects/scaler/pan.json\"\nimport scalerScaleJson from \"../../Definitions/DefinitionObjects/scaler/scale.json\"\n\nconst scalerDefaultId = \"com.moviemasher.scaler.default\"\n\nconst scalerDefinition = (object : ScalerDefinitionObject) : ScalerDefinition => {\n  const { id } = object\n  const idString = id && Is.populatedString(id) ? id : scalerDefaultId\n  if (Definitions.installed(idString)) return <ScalerDefinition> Definitions.fromId(idString)\n\n  return new ScalerDefinitionClass({ ...object, type: DefinitionType.Scaler, id: idString })\n}\n\nconst scalerDefinitionFromId = (id : string) : ScalerDefinition => {\n  return scalerDefinition({ id })\n}\n\nconst scalerInstance = (object: ScalerObject): Scaler => {\n  const { definitionId } = object\n\n  const definition = scalerDefinition({ id: definitionId })\n  return definition.instanceFromObject(object)\n}\n\nconst scalerFromId = (definitionId : string) : Scaler => {\n  return scalerInstance({ definitionId })\n}\n\nconst scalerInitialize = () : void => {\n  new ScalerDefinitionClass(scalerDefaultJson)\n  new ScalerDefinitionClass(scalerPanJson)\n  new ScalerDefinitionClass(scalerScaleJson)\n}\n\nconst scalerDefine = (object : ScalerDefinitionObject) : ScalerDefinition => {\n  const { id } = object\n  const idString = id && Is.populatedString(id) ? id : scalerDefaultId\n\n  Definitions.uninstall(idString)\n  return scalerDefinition(object)\n}\n\nconst ScalerFactoryImplementation = {\n  define: scalerDefine,\n  install: scalerDefine,\n  definitionFromId: scalerDefinitionFromId,\n  definition: scalerDefinition,\n  instance: scalerInstance,\n  fromId: scalerFromId,\n  initialize: scalerInitialize,\n}\n\nFactories[DefinitionType.Scaler] = ScalerFactoryImplementation\n\nexport {\n  scalerDefine,\n  scalerDefine as scalerInstall,\n  scalerDefaultId,\n  scalerDefinition,\n  scalerDefinitionFromId,\n  ScalerFactoryImplementation,\n  scalerFromId,\n  scalerInitialize,\n  scalerInstance,\n}\n","import { Any, InputCommand, JsonObject, LoadPromise, Size } from \"../../declarations\"\nimport { Merger } from \"../../Mash/Merger/Merger\"\nimport { Effect } from \"../../Mash/Effect/Effect\"\nimport { Scaler } from \"../../Mash/Scaler/Scaler\"\nimport { VisibleClass } from \"../Visible/Visible\"\nimport { VisibleContext } from \"../../Playing/VisibleContext\"\nimport { Definition } from \"../../Base/Definition\"\nimport { TransformableClass, TransformableObject } from \"./Transformable\"\nimport { mergerInstance } from \"../../Mash/Merger/MergerFactory\"\nimport { Time } from \"../../Utilities/Time\"\nimport { Is } from \"../../Utilities/Is\"\nimport { effectInstance } from \"../../Mash/Effect\"\nimport { scalerInstance } from \"../../Mash/Scaler\"\n\nfunction TransformableMixin<T extends VisibleClass>(Base: T): TransformableClass & T {\n  return class extends Base {\n    constructor(...args: Any[]) {\n      super(...args)\n      const [object] = args\n      // console.log(\"TransformableMixin\", object)\n      const { merger, effects, scaler } = <TransformableObject>object\n\n      this.merger = mergerInstance(merger || {})\n      this.scaler = scalerInstance(scaler || {})\n\n      if (effects) {\n        const effectInstances = effects.map(effect => effectInstance(effect))\n        this.effects.push(...effectInstances)\n      }\n    }\n\n    get definitions(): Definition[] {\n      return [\n        ...super.definitions,\n        ...this.merger.definitions,\n        ...this.scaler.definitions,\n        ...this.effects.flatMap(effect => effect.definitions)\n      ]\n    }\n\n    effectedCommandAtTimeToSize(mashTime: Time, quantize: number, dimensions: Size): InputCommand | undefined {\n      const scaledCommand = this.scaledCommandAtTimeToSize(mashTime, quantize, dimensions)\n      if (!scaledCommand) {\n        // console.log(this.constructor.name, \"effectedCommandAtTimeToSize scaledCommandAtTimeToSize falsey\")\n        return\n      }\n\n      if (!this.effects) return scaledCommand\n\n      const clipTimeRange = this.timeRangeRelative(mashTime, quantize)\n      if (!clipTimeRange) {\n        // console.log(this.constructor.name, \"effectedCommandAtTimeToSize timeRangeRelative falsey\")\n        return\n      }\n\n      this.effects.reverse().every(effect => (\n        scaledCommand.filters.push(...effect.definition.inputFilters(effect, clipTimeRange, dimensions))\n      ))\n      return scaledCommand\n    }\n\n    effectedContextAtTimeToSize(mashTime: Time, quantize: number, dimensions: Size): VisibleContext | undefined {\n      const scaledContext = this.scaledContextAtTimeToSize(mashTime, quantize, dimensions)\n      if (!scaledContext) return\n\n      let context = scaledContext\n      if (!this.effects) return context\n\n      const clipTimeRange = this.timeRangeRelative(mashTime, quantize)\n      if (!clipTimeRange) return\n\n      this.effects.reverse().every(effect => (\n        context = effect.definition.drawFilters(effect, clipTimeRange, context, dimensions)\n      ))\n      return context\n    }\n\n    effects: Effect[] = []\n\n\n    inputCommandAtTimeToSize(mashTime: Time, quantize: number, dimensions: Size): InputCommand | undefined {\n      const effected = this.effectedCommandAtTimeToSize(mashTime, quantize, dimensions)\n      if (!effected) {\n        // console.log(this.constructor.name, \"inputCommandAtTimeToSize effectedCommandAtTimeToSize falsey\")\n        return\n      }\n      const range = this.timeRangeRelative(mashTime, quantize)\n      effected.merger = this.merger.definition.inputFilters(this.merger, range, dimensions)[0]\n\n      // console.log(this.constructor.name, \"inputCommandAtTimeToSize\", effected)\n      return effected\n    }\n\n    loadClip(quantize: number, start: Time, end?: Time): LoadPromise | void {\n      const loads = [\n        super.loadClip(quantize, start, end),\n        this.loadTransformable(quantize, start, end)\n      ]\n      const promises = loads.filter(Boolean)\n      switch (promises.length) {\n        case 0: return\n        case 1: return promises[0]\n        default: return Promise.all(promises).then()\n      }\n    }\n\n    loadTransformable(quantize: number, start: Time, end?: Time): LoadPromise | void {\n      const loads = [\n        this.merger.loadModular(quantize, start, end),\n        this.scaler.loadModular(quantize, start, end),\n        ...this.effects.map(effect => effect.loadModular(quantize, start, end))\n      ]\n      const promises = loads.filter(Boolean)\n      switch (promises.length) {\n        case 0: return\n        case 1: return promises[0]\n        default: return Promise.all(promises).then()\n      }\n    }\n\n    mergeContextAtTime(mashTime: Time, quantize: number, context: VisibleContext): void {\n      const effected = this.effectedContextAtTimeToSize(mashTime, quantize, context.size)\n      if (!effected) return\n\n      const range = this.timeRangeRelative(mashTime, quantize)\n      this.merger.definition.drawFilters(this.merger, range, effected, context.size, context)\n    }\n\n    merger: Merger\n\n    scaledCommandAtTimeToSize(mashTime: Time, quantize: number, dimensions: Size): InputCommand | undefined {\n      const command = this.commandAtTimeToSize(mashTime, quantize, dimensions)\n      if (!command) {\n        // console.log(this.constructor.name, \"scaledCommandAtTimeToSize super falsey\")\n        return\n      }\n\n      // console.log(this.constructor.name, \"scaledCommandAtTimeToSize command\", command)\n      const clipTimeRange = this.timeRangeRelative(mashTime, quantize)\n      if (Is.undefined(clipTimeRange)) {\n        // console.log(this.constructor.name, \"scaledCommandAtTimeToSize timeRangeRelative falsey\")\n        return command\n      }\n      command.filters.push(...this.scaler.definition.inputFilters(this.scaler, clipTimeRange, dimensions))\n\n      // console.log(this.constructor.name, \"scaledCommandAtTimeToSize\", command)\n\n      return command\n    }\n\n    scaledContextAtTimeToSize(mashTime: Time, quantize: number, dimensions: Size): VisibleContext | undefined {\n      const context = this.contextAtTimeToSize(mashTime, quantize, dimensions)\n      if (!context) return\n\n      const clipTimeRange = this.timeRangeRelative(mashTime, quantize)\n      if (Is.undefined(clipTimeRange)) return context\n      // console.log(this.constructor.name, \"scaledContextAtTimeToSize\", clipTimeRange)\n      return this.scaler.definition.drawFilters(this.scaler, clipTimeRange, context, dimensions)\n    }\n\n    scaler: Scaler\n\n    toJSON(): JsonObject {\n      const object = super.toJSON()\n      // console.log(this.constructor.name, \"toJSON\", object)\n      object.merger = this.merger\n      object.scaler = this.scaler\n      object.effects = this.effects\n      return object\n    }\n  }\n}\n\nexport { TransformableMixin }\n","import { ContextFactory } from \"../../Playing/ContextFactory\"\nimport { VisibleContext } from \"../../Playing/VisibleContext\"\nimport { VisibleSource, Size } from \"../../declarations\"\nimport { TrackType } from \"../../Setup/Enums\"\nimport { Time  } from \"../../Utilities/Time\"\nimport { ClipClass } from \"../Clip/Clip\"\nimport { VisibleClass, VisibleDefinition } from \"./Visible\"\n\nfunction VisibleMixin<T extends ClipClass>(Base: T) : VisibleClass & T {\n  return class extends Base {\n\n    contextAtTimeToSize(mashTime : Time, quantize: number, _dimensions : Size) : VisibleContext | undefined {\n      const definitionTime = this.definitionTime(quantize, mashTime)\n      // console.debug(this.constructor.name, \"contextAtTimeToSize\", definitionTime.toString(), mashTime.toString())\n      const image = this.loadedVisible(quantize, definitionTime)\n      if (!image) {\n        console.error(this.constructor.name, \"contextAtTimeToSize not loaded\", this.id)\n        return\n      }\n      const width = Number(image.width)\n      const height = Number(image.height)\n\n      const context = ContextFactory.toSize({ width, height })\n      context.draw(image)\n      return context\n    }\n\n    declare definition: VisibleDefinition\n\n\n    loadedVisible(quantize: number, definitionTime:Time):VisibleSource | undefined {\n      return this.definition.loadedVisible(quantize, definitionTime)\n    }\n\n    mergeContextAtTime(_time : Time, _quantize: number, _context : VisibleContext) : void {}\n\n    trackType = TrackType.Video\n\n    visible = true\n  }\n}\nexport { VisibleMixin }\n","import { InstanceBase } from \"../../Base/Instance\"\nimport { ClipMixin } from \"../../Mixin/Clip/ClipMixin\"\nimport { TransformableMixin } from \"../../Mixin/Transformable/TransformableMixin\"\nimport { VisibleMixin } from \"../../Mixin/Visible/VisibleMixin\"\nimport { ImageDefinition } from \"./Image\"\n\nconst ImageWithClip = ClipMixin(InstanceBase)\nconst ImageWithVisible = VisibleMixin(ImageWithClip)\nconst ImageWithTransformable = TransformableMixin(ImageWithVisible)\nclass ImageClass extends ImageWithTransformable {\n  declare definition : ImageDefinition\n}\n\nexport { ImageClass }\n","import { VisibleSource } from \"../../declarations\"\nimport { TrackType } from \"../../Setup/Enums\"\nimport { ClipDefinitionClass } from \"../Clip/Clip\"\nimport { VisibleDefinitionClass } from \"./Visible\"\n\nfunction VisibleDefinitionMixin<T extends ClipDefinitionClass>(Base: T) : VisibleDefinitionClass & T {\n  return class extends Base {\n    loadedVisible(): VisibleSource | undefined { return }\n\n    trackType = TrackType.Video\n\n    visible = true\n  }\n}\n\nexport { VisibleDefinitionMixin }\n","import { DefinitionBase } from \"../../Base/Definition\"\nimport { Any, VisibleSource, JsonObject, LoadPromise } from \"../../declarations\"\nimport { Errors } from \"../../Setup/Errors\"\nimport { DefinitionType } from \"../../Setup/Enums\"\nimport { Image, ImageDefinitionObject, ImageObject } from \"./Image\"\nimport { ImageClass } from \"./ImageInstance\"\nimport { VisibleDefinitionMixin } from \"../../Mixin/Visible/VisibleDefinitionMixin\"\nimport { ClipDefinitionMixin } from \"../../Mixin/Clip/ClipDefinitionMixin\"\nimport { Definitions } from \"../../Definitions/Definitions\"\nimport { Time, Times } from \"../../Utilities/Time\"\nimport { Cache } from \"../../Loading\"\nimport { LoaderFactory } from \"../../Loading/LoaderFactory\"\nimport { urlAbsolute } from \"../../Utilities/Url\"\n\n\nconst ImageDefinitionWithClip = ClipDefinitionMixin(DefinitionBase)\nconst ImageDefinitionWithVisible = VisibleDefinitionMixin(ImageDefinitionWithClip)\nconst ImageDefinitionWithTransformable = VisibleDefinitionMixin(ImageDefinitionWithVisible)\n\nclass ImageDefinitionClass extends ImageDefinitionWithTransformable {\n  constructor(...args : Any[]) {\n    super(...args)\n    const [object] = args\n    if (!object) throw Errors.unknown.definition\n    // console.log(\"ImageDefinition\", object)\n    const { url, source } = <ImageDefinitionObject> object\n    if (!url) throw Errors.invalid.definition.url\n\n    this.urlVisible = url\n    this.source = source || url\n\n    Definitions.install(this)\n  }\n\n  get absoluteUrl(): string { return urlAbsolute(this.urlVisible) }\n\n  get inputSource(): string { return urlAbsolute(this.source) }\n\n  get instance() : Image {\n    return this.instanceFromObject(this.instanceObject)\n  }\n\n  instanceFromObject(object : ImageObject) : Image {\n    const instance = new ImageClass({ ...this.instanceObject, ...object })\n    return instance\n  }\n\n  loadDefinition(quantize: number, start: Time, end?: Time): LoadPromise | void {\n    const promises: LoadPromise[] = []\n    const definitionPromise = super.loadDefinition(quantize, start, end)\n    if (definitionPromise) promises.push(definitionPromise)\n    const url = this.absoluteUrl\n    if (!Cache.cached(url)) {\n      if (Cache.caching(url)) promises.push(Cache.get(url))\n      else promises.push(LoaderFactory.image().loadUrl(url))\n    }\n    switch (promises.length) {\n      case 0: return\n      case 1: return promises[0]\n      default: return Promise.all(promises).then()\n    }\n  }\n\n  definitionUrls(_start : Time, _end? : Time) : string[] { return [this.absoluteUrl] }\n\n  loadedVisible(): VisibleSource | undefined { return Cache.get(this.absoluteUrl) }\n\n  source = ''\n\n  type = DefinitionType.Image\n\n  toJSON() : JsonObject {\n    const object = super.toJSON()\n    object.url = this.urlVisible\n    if (this.source) object.source = this.source\n    return object\n  }\n\n  unload(times : Times[] = []) : void {\n    super.unload(times)\n    if (times.length) return // don't unload since any times indicate image needed\n\n    if (!Cache.cached(this.urlVisible)) return // we're not loaded\n\n    Cache.remove(this.urlVisible)\n  }\n\n  urlVisible : string\n}\n\nexport { ImageDefinitionClass }\n","import { DefinitionType } from \"../../Setup/Enums\"\nimport { Errors } from \"../../Setup/Errors\"\nimport { Is } from \"../../Utilities/Is\"\nimport { Definitions } from \"../../Definitions\"\nimport { Factories } from \"../../Definitions/Factories\"\nimport { ImageDefinitionClass } from \"../Image/ImageDefinition\"\nimport { Image, ImageDefinition, ImageDefinitionObject, ImageObject } from \"./Image\"\n\nconst imageDefinition = (object : ImageDefinitionObject) : ImageDefinition => {\n  const { id } = object\n  if (!id) throw Errors.id + JSON.stringify(object)\n\n  if (Definitions.installed(id)) return <ImageDefinition> Definitions.fromId(id)\n\n  return new ImageDefinitionClass(object)\n}\n\nconst imageDefinitionFromId = (id : string) : ImageDefinition => {\n  return imageDefinition({ id })\n}\n\nconst imageInstance = (object : ImageObject) : Image => {\n  const definition = imageDefinition(object)\n  const instance = definition.instanceFromObject(object)\n  return instance\n}\n\nconst imageFromId = (id : string) : Image => {\n  return imageInstance({ id })\n}\n\nconst imageInitialize = () : void => {}\n\nconst imageDefine = (object : ImageDefinitionObject) : ImageDefinition => {\n  const { id } = object\n  if (!(id && Is.populatedString(id))) throw Errors.id\n\n  Definitions.uninstall(id)\n  return imageDefinition(object)\n}\n\n\n/**\n * @internal\n */\nconst imageInstall = (object: ImageDefinitionObject): ImageDefinition => {\n  const instance = imageDefine(object)\n  instance.retain = true\n  return instance\n}\n\n\nconst ImageFactoryImplementation = {\n  define: imageDefine,\n  install: imageInstall,\n  definition: imageDefinition,\n  definitionFromId: imageDefinitionFromId,\n  fromId: imageFromId,\n  initialize: imageInitialize,\n  instance: imageInstance,\n}\n\nFactories[DefinitionType.Image] = ImageFactoryImplementation\n\nexport {\n  imageInstall,\n  imageDefine,\n  imageDefinition,\n  imageDefinitionFromId,\n  ImageFactoryImplementation,\n  imageFromId,\n  imageInitialize,\n  imageInstance,\n}\n","import { Errors} from \"../Setup/Errors\"\nimport { Default } from \"../Setup/Default\"\nimport { DefinitionType, EventType } from \"../Setup/Enums\"\nimport { pixelColor } from \"../Utilities/Pixel\"\nimport { sortByTrack } from \"../Utilities/Sort\"\nimport { Is } from \"../Utilities/Is\"\nimport { Time } from \"../Utilities/Time\"\nimport { Audible } from \"../Mixin/Audible/Audible\"\nimport { Visible } from \"../Mixin/Visible/Visible\"\nimport { Transition } from \"../Mash/Transition/Transition\"\nimport { Cache } from \"../Loading/Cache\"\nimport { Emitter } from \"../Utilities/Emitter\"\n\ninterface CompositionObject {\n  buffer? : number\n  gain? : number\n  quantize? : number\n  backcolor?: string\n  emitter?: Emitter\n}\n\nclass Composition {\n  constructor(object : CompositionObject) {\n    const { emitter, backcolor, buffer, gain, quantize } = object\n    if (backcolor) this.backcolor = backcolor\n    if (quantize && Is.aboveZero(quantize)) this.quantize = quantize\n    if (typeof gain !== \"undefined\" && Is.positive(gain)) this._gain = gain\n    if (buffer && Is.aboveZero(buffer)) this.buffer = buffer\n    if (emitter) this.emitter = emitter\n  }\n\n  adjustSourceGain(clip : Audible) : void {\n    const source = Cache.audibleContext.getSource(clip.id)\n    if (!source) {\n      // console.log(this.constructor.name, \"adjustSourceGain no source\", clip.id)\n      return\n    }\n\n    const { gainNode } = source\n    if (this.gain === 0.0) {\n      gainNode.gain.value = 0.0\n      return\n    }\n\n    const gain = clip.gain\n\n    if (Is.positive(gain)) {\n      gainNode.gain.value = this.gain * gain\n      return\n    }\n\n    // position/gain pairs...\n    const timing = clip.startOptions(this.seconds, this.quantize)\n    const { start, duration } = timing\n\n    gainNode.gain.cancelScheduledValues(0)\n    clip.gainPairs.forEach(pair => {\n      const [position, value] = pair\n      gainNode.gain.linearRampToValueAtTime(this.gain * value, start + position * duration)\n    })\n  }\n\n  backcolor? : string\n\n  buffer = Default.mash.buffer\n\n  private bufferSource? : AudioBufferSourceNode\n\n  compositeAudible(clips: Audible[]): boolean {\n    // console.log(this.constructor.name, \"compositeAudible\", clips.length)\n    if (!this.createSources(clips)) {\n      // if (clips.length) console.log(this.constructor.name, \"compositeAudible didn't createSources\")\n      return false\n    }\n\n    this.destroySources(clips)\n    return true\n  }\n\n  compositeVisible(time: Time, clips: Visible[]): void {\n    this.drawBackground() // clear and fill with mash background color if defined\n\n    const clipsByTrack = new Map<number, Visible>()\n    const transitionsByTrack: Record<number, Transition> = {}\n    const transitioningTracks: number[] = []\n\n    const transitionClips: Transition[] = []\n    const visibleTracks: number[] = []\n    clips.sort(sortByTrack).forEach(clip => {\n      const { type } = clip\n      if (type === DefinitionType.Transition) {\n        const transition = <Transition>clip\n        transitionsByTrack[transition.fromTrack] = transition\n        transitionsByTrack[transition.toTrack] = transition\n\n        transitioningTracks.push(transition.fromTrack, transition.toTrack)\n        transitionClips.push(transition)\n      } else {\n        visibleTracks.push(clip.track)\n        clipsByTrack.set(clip.track, clip)\n      }\n    })\n\n    visibleTracks.forEach(track => {\n      if (transitioningTracks.includes(track)) {\n        const transition = transitionsByTrack[track]\n        const { fromTrack, toTrack } = transition\n        const transitioned: Visible[] = []\n        const fromClip = clipsByTrack.get(fromTrack)\n        if (fromClip) transitioned.push(fromClip)\n        const toClip = clipsByTrack.get(toTrack)\n        if (toClip) transitioned.push(toClip)\n\n        if (!transitioned.length) return\n\n        // console.log(\"drawing clips at track\", transitioned.map(clip => clip.track), track)\n        transition.mergeClipsIntoContextAtTime(\n          transitioned, Cache.visibleContext, time, this.quantize, this.backcolor\n        )\n        clipsByTrack.delete(fromTrack)\n        clipsByTrack.delete(toTrack)\n        return\n      }\n      const clip = clipsByTrack.get(track)\n      if (clip) {\n        // console.log(\"drawing clip at track\", clip.track, track)\n        clip.mergeContextAtTime(time, this.quantize, Cache.visibleContext)\n      }\n    })\n\n\n\n\n\n    // const main = clips.filter(clip => clip.track === 0)\n    // if (main.length > 1) {\n    //   const transitionClip = main.find(clip => clip.type === DefinitionType.Transition)\n    //   if (!transitionClip) throw Errors.mainTrackOverlap\n\n    //   const transitioned = main.filter(clip => clip.type !== DefinitionType.Transition)\n    //   const transition = <Transition> transitionClip\n\n    //   transition.mergeClipsIntoContextAtTime(\n    //     transitioned, Cache.visibleContext, time, this.quantize, this.backcolor\n    //   )\n    // } else {\n    //   const [mainClip] = main\n    //   if (mainClip) mainClip.mergeContextAtTime(time, this.quantize, Cache.visibleContext)\n    // }\n    // const tracked = clips.filter(clip => !main.includes(clip)).sort(sortByTrack)\n    // tracked.forEach(clip => {\n    //   clip.mergeContextAtTime(time, this.quantize, Cache.visibleContext)\n    // })\n\n\n    this.emitter?.emit(EventType.Draw)\n  }\n\n  compositeVisibleRequest(time : Time, clips : Visible[]) : void {\n    requestAnimationFrame(() => this.compositeVisible(time, clips))\n  }\n\n\n  private createSources(clips: Audible[], time?:Time): boolean {\n    const filtered = clips.filter(clip => !Cache.audibleContext.hasSource(clip.id))\n    // if (filtered.length) console.log(\"Composition.createSources\", filtered.length, \"of\", clips.length, \"need audio source\")\n    return filtered.every(clip => {\n      const sourceNode = clip.loadedAudible()\n      if (!sourceNode) {\n        console.debug(this.constructor.name, \"createSources loadedAudible undefined\", clip.id)\n        return false\n      }\n      if (!this.playing && !time) return\n\n      const startSeconds = this.playing ? this.seconds : time?.seconds || 0\n      const timing = clip.startOptions(startSeconds, this.quantize)\n      const { start, duration, offset } = timing\n      // console.log(this.constructor.name, \"createSources\", clip.label, timing, this.contextSecondsWhenStarted - this.startedMashAt, this.quantize)\n      if (Is.positive(start) && Is.aboveZero(duration)) {\n        const { definition, id } = clip\n        const { loops } = definition\n        Cache.audibleContext.startAt(id, sourceNode, start, duration, offset, loops)\n        this.playingClips.push(clip)\n        this.adjustSourceGain(clip)\n      }\n      return true\n    })\n  }\n\n  private destroySources(clipsToKeep: Audible[] = []): void {\n    const sourceClips = [...this.playingClips]\n    const clipsToRemove = sourceClips.filter(clip => !clipsToKeep.includes(clip))\n\n    clipsToRemove.forEach(clip => Cache.audibleContext.deleteSource(clip.id))\n    this.playingClips = clipsToKeep\n    // console.log(this.constructor.name, \"destroySources removed\", clipsToRemove.length, \"kept\", this.playingClips.length)\n  }\n\n  private drawBackground() : void {\n    Cache.visibleContext.clear()\n    if (!this.backcolor) return\n\n    Cache.visibleContext.drawFill(pixelColor(this.backcolor))\n  }\n\n  emitter?: Emitter\n\n  private _gain = Default.mash.gain\n\n  get gain() : number { return this._gain }\n\n  set gain(value : number) {\n    if (this._gain === value) return\n\n    this._gain = value\n\n    if (this.playing) {\n      this.playingClips.forEach(clip => this.adjustSourceGain(clip))\n    }\n    this.emitter?.emit(EventType.Volume)\n  }\n\n  private playing = false\n\n  private playingClips: Audible[] = []\n\n  quantize = Default.mash.quantize\n\n  get seconds(): number {\n    const ellapsed = Cache.audibleContext.currentTime - this.contextSecondsWhenStarted\n    const started = ellapsed + this.startedMashAt\n    // console.log(\"seconds\", started, \"=\", this.startedMashAt, \"+\", ellapsed, '=', Cache.audibleContext.currentTime, '-', this.contextSecondsWhenStarted)\n    return started\n  }\n\n  startContext(): void {\n    // console.log(this.constructor.name, \"startContext\")\n    if (this.bufferSource) throw Errors.internal + 'bufferSource startContext'\n    if (this.playing) throw Errors.internal + 'playing'\n\n    const buffer = Cache.audibleContext.createBuffer(this.buffer)\n    this.bufferSource = Cache.audibleContext.createBufferSource(buffer)\n    this.bufferSource.loop = true\n    this.bufferSource.connect(Cache.audibleContext.destination)\n    this.bufferSource.start(0)\n  }\n\n  // called when playhead starts moving\n  startPlaying(time : Time, clips: Audible[]) : boolean {\n    if (!this.bufferSource) throw Errors.internal + 'bufferSource startPlaying'\n    if (this.playing) throw Errors.internal + 'playing'\n\n    const { seconds } = time\n    this.playing = true\n    this.startedMashAt = seconds\n    this.contextSecondsWhenStarted = Cache.audibleContext.currentTime\n    // console.log(this.constructor.name, \"startPlaying\", \"startedMashAt\", this.startedMashAt, \"contextSecondsWhenStarted\", this.contextSecondsWhenStarted)\n\n    if (!this.createSources(clips, time)) {\n      this.stopPlaying()\n      return false\n    }\n    // console.log(this.constructor.name, \"startPlaying\", this.startedMashAt, this.contextSecondsWhenStarted)\n    return true\n  }\n\n  // position of masher (in seconds) when startPlaying called\n  private startedMashAt = 0\n\n  // currentTime of context (in seconds) was created when startPlaying called\n  private contextSecondsWhenStarted = 0\n\n  stopPlaying(): void {\n    // console.log(this.constructor.name, \"stopPlaying\")\n    if (!this.playing) return\n\n    this.playing = false\n    if (this.bufferSource) this.bufferSource.stop()\n\n    this.destroySources()\n    this.startedMashAt = 0\n    this.contextSecondsWhenStarted = 0\n\n    if (!this.bufferSource) return\n\n    this.bufferSource.disconnect(Cache.audibleContext.destination)\n    delete this.bufferSource\n  }\n}\n\nexport { Composition }\n","import {\n  Any, InputCommandsPromise, InputCommands, Interval, JsonObject, LoadPromise, Size,\n  MashState, MashStatePromise, ClipState, InputFilter, UnknownObject\n} from \"../../declarations\"\nimport { CommandType, EventType, TrackType } from \"../../Setup/Enums\"\nimport { Errors } from \"../../Setup/Errors\"\nimport { Default } from \"../../Setup/Default\"\nimport { Is } from \"../../Utilities/Is\"\nimport { TimeRange } from \"../../Utilities/TimeRange\"\nimport { Time } from \"../../Utilities/Time\"\nimport { Track, TrackObject } from \"../Track/Track\"\nimport { Definition, DefinitionTimes } from \"../../Base/Definition\"\nimport { Clip, ClipDefinition } from \"../../Mixin/Clip/Clip\"\nimport { Visible } from \"../../Mixin/Visible/Visible\"\nimport { Audible } from \"../../Mixin/Audible/Audible\"\nimport { Composition } from \"../../Playing/Composition\"\nimport { ChangeAction } from \"../../Editing/Action/ChangeAction\"\nimport { Mash, MashObject } from \"./Mash\"\nimport { idGenerate } from \"../../Utilities/Id\"\nimport { Action } from \"../../Editing/Action/Action\"\nimport { Cache } from \"../../Loading/Cache\"\nimport { Emitter } from \"../../Utilities/Emitter\"\nimport { sortByLayer } from \"../../Utilities/Sort\"\nimport { Job } from \"../../Job/Job\"\nimport { urlRemoteServer } from \"../../Utilities/Url\"\nimport { Factory } from \"../../Definitions/Factory/Factory\"\n\ninterface TimeRangeClips {\n  clips: Clip[]\n  timeRange: TimeRange\n}\n\nclass MashClass implements Mash {\n  constructor(...args: Any[]) {\n    const object = args[0] || {}\n    const {\n      createdAt,\n      tracks,\n      backcolor,\n      id,\n      label,\n      media,\n      quantize,\n      ...rest\n    } = <MashObject>object\n\n    if (id) this._id = id\n    Object.assign(this.data, rest)\n\n    if (quantize && Is.aboveZero(quantize)) this.quantize = quantize\n    if (label && Is.populatedString(label)) this.label = label\n    if (backcolor && Is.populatedString(backcolor)) this._backcolor = backcolor\n    if (createdAt) this.createdAt = createdAt\n\n\n    if (tracks) this.tracks.push(...tracks.map((track, index) => {\n      const instance = Factory.track.instance(this.trackOptions(track, index))\n      this.assureClipsHaveFrames(instance.clips)\n      return instance\n    }))\n    if (!this.trackCount(TrackType.Video)) {\n      this.tracks.push(Factory.track.instance({ trackType: TrackType.Video }))\n    }\n    if (!this.trackCount(TrackType.Audio)) {\n      this.tracks.push(Factory.track.instance({ trackType: TrackType.Audio }))\n    }\n    this.tracks.sort(sortByLayer)\n\n    this.setDrawInterval()\n  }\n\n  addClipsToTrack(clips: Clip[], trackIndex = 0, insertIndex = 0, frames? : number[]): void {\n    // console.log(this.constructor.name, \"addClipsToTrack\", trackIndex, insertIndex)\n    this.assureClipsHaveFrames(clips)\n    const [clip] = clips\n    const newTrack = this.clipTrackAtIndex(clip, trackIndex)\n    if (!newTrack) throw Errors.invalid.track\n    // console.log(this.constructor.name, \"addClipsToTrack\", newTrack)\n\n    const oldTrack = Is.positive(clip.track) && this.clipTrack(clip)\n\n    this.emitIfFramesChange(() => {\n      if (oldTrack && oldTrack !== newTrack) {\n        // console.log(\"addClipsToTrack\", newTrack.index, oldTrack.index)\n        oldTrack.removeClips(clips)\n      }\n      if (frames) clips.forEach((clip, index) => { clip.frame = frames[index] })\n      newTrack.addClips(clips, insertIndex)\n    })\n  }\n\n  addTrack(trackType: TrackType): Track {\n    const options : TrackObject = { trackType: trackType, layer: this.trackCount(trackType) }\n    const track = Factory.track.instance(options)\n    this.tracks.push(track)\n    this.tracks.sort(sortByLayer)\n    this.emitter?.emit(EventType.Track)\n    return track\n  }\n\n  private assureClipsHaveFrames(clips: Clip[]): void {\n    clips.filter(clip => !Is.positive(clip.frames)).forEach(clip => {\n      const definition = <ClipDefinition>clip.definition\n      clip.frames = definition.frames(this.quantize)\n    })\n  }\n\n  private _backcolor = Default.mash.backcolor\n\n  get backcolor(): string { return this._backcolor }\n\n  set backcolor(value: string) {\n    this._backcolor = value\n    if (this._composition) this.composition.backcolor = value\n  }\n\n  private _buffer = Default.mash.buffer\n\n  get buffer(): number { return this._buffer }\n\n  set buffer(value: number) {\n    if (!Is.aboveZero(value)) throw Errors.invalid.argument + 'buffer ' + value\n\n    if (this._buffer !== value) {\n      this._buffer = value\n      if (this._composition) this.composition.buffer = value\n    }\n  }\n\n  get bufferFrames(): number { return this.buffer * this.quantize }\n\n  private bufferStart() {\n    if (this._bufferTimer) return\n\n    this._bufferTimer = setInterval(() => {\n      // console.debug(this.constructor.name, \"bufferTimer calling load\")\n      this.loadPromise\n    }, Math.round((this.buffer * 1000) / 2))\n  }\n\n  private bufferStop() {\n    if (!this._bufferTimer) return\n\n    clearInterval(this._bufferTimer)\n    delete this._bufferTimer\n  }\n\n  private get bufferTime(): Time { return Time.fromSeconds(this.buffer) }\n\n  private _bufferTimer?: Interval\n\n  changeClipFrames(clip: Clip, value: number): void {\n    let limitedValue = Math.max(1, value) // frames value must be > 0\n\n    const max = clip.maxFrames(this.quantize) // only audible returns nonzero\n    if (Is.aboveZero(max)) limitedValue = Math.min(max, limitedValue)\n\n    const track = this.clipTrack(clip)\n    this.emitIfFramesChange(() => {\n      clip.frames = limitedValue\n      track.sortClips(track.clips)\n    })\n  }\n\n  changeClipTrimAndFrames(clip: Audible, value: number, frames: number): void {\n    let limitedValue = Math.max(0, value)\n\n    const max = clip.maxFrames(this.quantize, 1) // do not remove last frame\n    if (Is.aboveZero(max)) limitedValue = Math.min(max, limitedValue)\n\n    const newFrames = frames - limitedValue\n    const track = this.clipTrack(clip)\n    this.emitIfFramesChange(() => {\n      clip.trim = limitedValue\n      clip.frames = newFrames\n      track.sortClips(track.clips)\n    })\n  }\n\n  clearDrawInterval():void {\n    if (this.drawInterval) {\n      clearInterval(this.drawInterval)\n      this.drawInterval = undefined\n    }\n  }\n\n  clipIntersects(clip: Clip, range: TimeRange): boolean {\n    return clip.timeRange(this.quantize).intersects(range)\n  }\n\n  clipTrack(clip: Clip): Track {\n    return this.clipTrackAtIndex(clip, clip.track)\n  }\n\n  clipTrackAtIndex(clip: Clip, index = 0): Track {\n    return this.trackOfTypeAtIndex(clip.trackType, index)\n  }\n\n  get clips(): Clip[] { return this.clipsInTracks() }\n\n  private clipsAtTimes(start: Time, end?: Time): Clip[] {\n    const objects: Clip[] = this.clipsVisible(start, end)\n    if (end) objects.push(...this.clipsAudible(start, end))\n    return [...new Set(objects)]\n  }\n\n  private clipsAudible(start: Time, end?: Time): Audible[] {\n    const range = end && TimeRange.fromTimes(start, end)\n    return this.clipsAudibleInTracks.filter(clip => {\n      const clipRange = clip.timeRange(this.quantize)\n      if (range) return clipRange.intersects(range)\n\n      return clipRange.intersectsTime(start)\n    })\n  }\n\n  private clipsInTracks(tracks?: Track[]): Clip[] {\n    const clipTracks = tracks || this.tracks\n    return clipTracks.map(track => track.clips).flat()\n  }\n\n  private filterIntersecting(clips: Clip[], timeRange: TimeRange): Clip[] {\n    const range = timeRange.scale(this.quantize)\n    return clips.filter(clip => this.clipIntersects(clip, range))\n\n  }\n  private get clipsAudibleInTracks(): Audible[] {\n    return <Audible[]> this.clipsInTracks().filter(clip => clip.audible && !clip.muted)\n  }\n\n  private clipsAudibleInTimeRange(timeRange: TimeRange): Audible[] {\n    return <Audible[]> this.filterIntersecting(this.clipsAudibleInTracks, timeRange)\n  }\n\n  private get clipsVideo(): Visible[] {\n    const tracks = this.tracks.filter(track => track.trackType !== TrackType.Audio)\n    return <Visible[]>tracks.flatMap(track => track.clips)\n  }\n\n  clipsVisible(start: Time, end?: Time): Visible[] {\n    const range = end && TimeRange.fromTimes(start, end)\n    return this.clipsVideo.filter(clip => {\n      const clipRange = clip.timeRange(this.quantize)\n      if (range) return clipRange.intersects(range)\n\n      return clipRange.intersectsTime(start)\n    })\n  }\n\n  private clipsVisibleAtTime(time: Time): Visible[] {\n    return this.clipsVisibleInTimeRange(TimeRange.fromTime(time))\n  }\n\n  private clipsVisibleInTimeRange(timeRange: TimeRange): Visible[] {\n    const range = timeRange.scale(this.quantize)\n    return this.clipsVideo.filter(clip => this.clipIntersects(clip, range))\n  }\n\n  private compositeAudibleClips(clips: Clip[]): void {\n    if (this._paused) return\n\n    const audibleClips = clips.filter(clip => clip.audible && !clip.muted)\n    if (audibleClips.length) {\n      this.composition.compositeAudible(<Audible[]>audibleClips)\n    }\n  }\n\n  private _composition?: Composition\n\n  get composition(): Composition {\n    if (!this._composition) {\n      const options = {\n        backcolor: this.backcolor,\n        buffer: this.buffer,\n        gain: this.gain,\n        quantize: this.quantize,\n        emitter: this.emitter,\n      }\n      this._composition = new Composition(options)\n    }\n    return this._composition\n  }\n\n  compositeVisible(): void {\n    const { time } = this\n    this.composition.compositeVisible(time, this.clipsVisibleAtTime(time))\n  }\n\n  compositeVisibleRequest(): void {\n    const { time, composition } = this\n    composition.compositeVisibleRequest(time, this.clipsVisibleAtTime(time))\n  }\n\n  createdAt = ''\n\n  data: UnknownObject = {}\n\n  get definitions() : Definition[] {\n    return [...new Set(this.clipsInTracks().flatMap(clip => clip.definitions))]\n  }\n\n  destroy(): void {\n    this.paused = true\n    this.clearDrawInterval()\n    delete this._composition\n  }\n\n  private drawInterval?: Interval\n\n  private drawTime(time: Time): void {\n    const timeChange = time !== this.time\n    this.drawnTime = time\n    this.compositeVisibleRequest()\n    this.emitter?.emit(timeChange ? EventType.Time : EventType.Loaded)\n  }\n\n  private drawWhileNotPlaying() {\n    const now = performance.now()\n    const ellapsed = now - this.drawnSeconds\n    if (ellapsed < 1.0 / this.quantize) return\n\n    this.drawnSeconds = now\n    const { time } = this\n    const clips = this.clipsVisible(time)\n    const streamableClips = clips.filter(clip => clip.definition.streamable)\n    if (!streamableClips.length) return\n\n    const loading = clips.some(clip => clip.clipUrls(this.quantize, time).some(url =>\n      !Cache.cached(url)\n    ))\n    if (loading) return\n\n    this.compositeVisibleRequest()\n  }\n\n  private drawWhilePlaying() {\n    // what time does the audio context think it is?\n    const { seconds } = this.composition\n\n    // what time would masher consider to be in next frame?\n    const nextFrameTime = this.time.withFrame(this.time.frame + 1)\n\n    // are we beyond the end of mash?\n    if (seconds >= this.endTime.seconds) {\n\n      // should we loop back to beginning?\n      if (this.loop) this.seekToTime(this.time.withFrame(0))\n      else {\n        this.paused = true\n        this.emitter?.emit(EventType.Ended)\n      }\n    } else {\n\n      // are we at or beyond the next frame?\n      if (seconds >= nextFrameTime.seconds) {\n\n        const compositionTime = Time.fromSeconds(seconds, this.time.fps)\n        // const difference = compositionTime.frame - this.time.frame\n        // if (difference > 1) console.debug(this.constructor.name, \"drawWhilePlaying dropped frames\", difference - 1)\n        // go to where the audio context thinks we are\n        this.drawTime(compositionTime)\n      }\n    }\n  }\n\n  drawnSeconds = 0\n\n  drawnTime?: Time\n\n  get duration(): number { return this.endTime.seconds }\n\n  private emitIfFramesChange(method: () => void): void {\n    const origFrames = this.frames\n    method()\n    const { frames } = this\n    if (origFrames !== frames) {\n      this.emitter?.emit(EventType.Duration)\n      if (this.frame > frames) this.seekToTime(Time.fromArgs(frames, this.quantize))\n    }\n  }\n\n  _emitter?: Emitter\n\n  get emitter(): Emitter | undefined { return this._emitter }\n\n  set emitter(value: Emitter | undefined) {\n    this._emitter = value\n    if (this._composition) this._composition.emitter = value\n  }\n\n  get endTime(): Time { return Time.fromArgs(this.frames, this.quantize) }\n\n  get frame(): number { return this.time.scale(this.quantize, \"floor\").frame }\n\n  get frames(): number {\n    return Math.max(0, ...this.tracks.map(track => track.frames))\n  }\n\n  private _gain = Default.mash.gain\n\n  get gain(): number { return this._gain }\n\n  set gain(value: number) {\n    if (!Is.positive(value)) throw Errors.invalid.argument + 'gain ' + value\n\n    if (this._gain !== value) {\n      this._gain = value\n      if (this._composition) this.composition.gain = value\n    }\n  }\n\n  handleAction(action: Action): void {\n    this.emitter?.emit(EventType.Action)\n\n    if (action instanceof ChangeAction) {\n      const changeAction = <ChangeAction>action\n      const { property } = changeAction\n      if (property === \"gain\") {\n        if (this.playing && Is.aboveZero(this.gain)) {\n          this.composition.adjustSourceGain(<Audible>changeAction.target)\n        }\n        return\n      }\n    }\n    this.stopLoadAndDraw()\n  }\n\n  private handleDrawInterval(): void {\n    if (this._playing) this.drawWhilePlaying()\n    else this.drawWhileNotPlaying()\n  }\n\n  private seqmentsAtTimes(type: CommandType, start: Time, end?: Time): TimeRangeClips[] {\n    const fullRangeClips = this.clipsAtTimes(start, end)\n    const startTime = start.scale(this.quantize)\n    if (!end) return [{ clips: fullRangeClips, timeRange: TimeRange.fromTime(startTime) }]\n\n    const result: TimeRangeClips[] = []\n\n    const endTime = end.scale(this.quantize)\n    const fullRange = TimeRange.fromTimes(startTime, endTime)\n    const { times } = fullRange\n    let identifiers = '~'\n    let timeRangeClips: TimeRangeClips\n\n    times.forEach(time => {\n      const timeRange = TimeRange.fromTime(time)\n      const clips = this.filterIntersecting(fullRangeClips, timeRange)\n      const ids = clips.map(clip => clip.id).join('~')\n      if (identifiers === ids) {\n        timeRangeClips.timeRange = timeRangeClips.timeRange.addFrames(1)\n      } else {\n        identifiers = ids\n        timeRangeClips = { timeRange, clips }\n        result.push(timeRangeClips)\n      }\n    })\n    return result\n  }\n\n  private _id = ''\n\n  get id(): string {\n    // console.trace(this.constructor.name, \"id\")\n    return this._id ||= idGenerate()\n  }\n\n  private inputCommand(type: CommandType, size: Size, start: Time, end?: Time): InputCommands[] {\n    const segments = this.seqmentsAtTimes(type, start, end)\n    return segments.map(({ clips, timeRange }) => {\n      return clips.map(clip => {\n        const inputCommand = clip.inputCommandAtTimeToSize(timeRange.startTime, this.quantize, size)\n        if (!inputCommand) throw Errors.invalid.object\n\n        return inputCommand\n      })\n    })\n  }\n\n  inputCommandPromise(type: CommandType, size: Size, start: Time, end?: Time): InputCommandsPromise {\n    const promise: InputCommandsPromise = new Promise(resolve => {\n      const clips = this.clipsAtTimes(start, end)\n      const loads = clips.map(clip => clip.loadClip(this.quantize, start, end))\n      const promises = loads.filter(Boolean)\n      if (promises.length) Promise.all(promises).then(() => {\n        resolve(this.inputCommand(type, size, start, end))\n      })\n      else resolve(this.inputCommand(type, size, start, end))\n    })\n    return promise\n  }\n\n  get job(): Job {\n    return {\n      definitions: this.definitions,\n      mash: this,\n      remoteServer: urlRemoteServer(),\n      outputs: []\n    }\n  }\n\n  label = ''\n\n  get loadPromise(): LoadPromise | undefined {\n    const [start, end] = this.startAndEnd\n    // console.log(this.constructor.name, \"load\", start, end)\n    const clips = this.clipsAtTimes(start, end)\n    const loads = clips.map(clip => clip.loadClip(this.quantize, start, end))\n    const promises = loads.filter(Boolean)\n\n    if (promises.length) return Promise.all(promises).then(() => {\n      this.compositeAudibleClips(clips)\n    })\n    this.compositeAudibleClips(clips)\n\n    // switch (promises.length) {\n    //   case 0: return\n    //   case 1: return promises[0] || undefined\n    //   default: return Promise.all(promises).then()\n    // }\n  }\n\n  loadPromiseAtTimes(start: Time, end?: Time): LoadPromise | undefined {\n    const clips = this.clipsAtTimes(start, end)\n    const loads = clips.map(clip => clip.loadClip(this.quantize, start, end))\n    const promises = loads.filter(Boolean)\n    switch (promises.length) {\n      case 0: return\n      case 1: return promises[0] || undefined\n      default: return Promise.all(promises).then()\n    }\n  }\n\n  get loadUrls(): string[] {\n    const [start, end] = this.startAndEnd\n    const clips = this.clipsAtTimes(start, end)\n    return clips.flatMap(clip => clip.clipUrls(this.quantize, start, end))\n  }\n\n  get loadedDefinitions(): DefinitionTimes {\n    const map = <DefinitionTimes>new Map()\n    const [start, end] = this.startAndEnd\n    this.clipsAtTimes(start, end).forEach(clip => {\n      const { definitions } = clip\n      const times = [clip.definitionTime(this.quantize, start)]\n      if (end) times.push(clip.definitionTime(this.quantize, end))\n\n      definitions.forEach(definition => {\n        if (!map.has(definition)) map.set(definition, [])\n        const definitionTimes = map.get(definition)\n        if (!definitionTimes) throw Errors.internal\n\n        definitionTimes.push(times)\n      })\n    })\n    return map\n  }\n\n  loop = false\n\n  mashState(time: Time, dimensions: Size): MashState {\n    const state: MashState = []\n    const size = `${dimensions.width}x${dimensions.height}`\n    const colorFilter: InputFilter = { filter: 'color', options: { color: this.backcolor, size }}\n\n    const clipState: ClipState = { filters:[ colorFilter ]}\n    state.push(clipState)\n    state.push(...this.clipsAtTimes(time).map(clip => clip.clipState(this.quantize, time, dimensions)))\n    return state\n  }\n\n  mashStatePromise(time: Time, dimensions: Size): MashStatePromise {\n    const promise = this.loadPromiseAtTimes(time)\n    if (promise) return promise.then(() => this.mashState(time, dimensions))\n    return Promise.resolve(this.mashState(time, dimensions))\n  }\n\n  private _paused = true\n\n  get paused() : boolean { return this._paused }\n\n  set paused(value : boolean) {\n    const forcedValue = value || !this.frames\n    // console.log(this.constructor.name, \"set paused\", forcedValue)\n    if (this._paused === forcedValue) return\n\n    this._paused = forcedValue\n    if (forcedValue) {\n      this.playing = false\n      this.bufferStop()\n      if (this._bufferTimer) {\n        clearInterval(this._bufferTimer)\n        delete this._bufferTimer\n      }\n      this.emitter?.emit(EventType.Pause)\n    } else {\n      this.composition.startContext()\n      this.bufferStart()\n      const promise = this.loadPromise\n      if (promise) promise.then(() => { this.playing = true })\n      else this.playing = true\n      // console.log(\"Mash emit\", EventType.Play)\n      this.emitter?.emit(EventType.Play)\n    }\n  }\n\n  private _playing = false\n\n  get playing() : boolean { return this._playing }\n\n  set playing(value : boolean) {\n    // console.trace(this.constructor.name, \"set playing\", value)\n    if (this._playing !== value) {\n      this._playing = value\n      if (value) {\n        const clips = this.clipsAudibleInTimeRange(this.timeRangeToBuffer)\n        // console.log(\"playing\", value, this.time)\n        if (!this.composition.startPlaying(this.time, clips)) {\n          // console.log(this.constructor.name, \"set playing\", value, \"audio not cached\", this.time, clips.length)\n          // audio was not cached\n\n          this._playing = false\n          return\n        }\n        this.emitter?.emit(EventType.Playing)\n      } else this.composition.stopPlaying()\n    }\n  }\n\n  removeClipsFromTrack(clips : Clip[]) : void {\n    const [clip] = clips\n    const track = this.clipTrack(clip)\n    this.emitIfFramesChange(() => { track.removeClips(clips) })\n  }\n\n  removeTrack(trackType: TrackType): void {\n    const track = this.trackOfTypeAtIndex(trackType, this.trackCount(trackType) - 1)\n    const index = this.tracks.indexOf(track)\n    if (!Is.positive(index)) throw Errors.internal\n\n    this.emitIfFramesChange(() => { this.tracks.splice(index, 1) })\n    this.emitter?.emit(EventType.Track)\n  }\n\n  private restartAfterStop(time:Time, paused:boolean, seeking?: boolean): void {\n     if (time === this.time) { // otherwise we must have gotten a seek call\n        if (seeking) {\n          delete this.seekTime\n          this.emitter?.emit(EventType.Seeked)\n        }\n        this.drawTime(time)\n        if (!paused) {\n          this.composition.startContext()\n          this.playing = true\n        }\n      }\n  }\n\n  quantize = Default.mash.quantize\n\n  private seekTime? : Time\n\n  seekToTime(time: Time): LoadPromise | undefined {\n    // console.debug(this.constructor.name, \"seekToTime\", time)\n    if (this.seekTime !== time) {\n      this.seekTime = time\n      this.emitter?.emit(EventType.Seeking)\n      this.emitter?.emit(EventType.Time)\n    }\n    return this.stopLoadAndDraw(true)\n  }\n\n  setDrawInterval():void {\n    this.clearDrawInterval()\n    this.drawInterval = setInterval(() => { this.handleDrawInterval()}, 500 / this.time.fps)\n  }\n\n  get stalled() : boolean { return !this.paused && !this.playing }\n\n  get startAndEnd(): Time[] {\n    const { time } = this\n    const times = [time]\n    if (!this.paused) times.push(time.add(this.bufferTime))\n    return times\n  }\n\n  private stopLoadAndDraw(seeking? : boolean) : LoadPromise | undefined {\n    const { time, paused, playing } = this\n\n    if (playing) this.playing = false\n    const promise = this.loadPromise\n    if (promise) return promise.then(() => { this.restartAfterStop(time, paused, seeking) })\n    this.restartAfterStop(time, paused, seeking)\n  }\n\n  get time() : Time {\n    return this.seekTime || this.drawnTime || Time.fromArgs(0, this.quantize)\n  }\n\n  get timeRange(): TimeRange {\n    return TimeRange.fromTime(this.time, this.endTime.scale(this.time.fps).frame)\n  }\n\n  get timeRangeToBuffer() : TimeRange {\n    const { time, quantize, buffer, paused } = this\n    if (paused) {\n      const singleFrame = TimeRange.fromArgs(time.scale(quantize, 'floor').frame, quantize, 1)\n      // console.log(this.constructor.name, \"timeRangeToBuffer paused\", singleFrame)\n      return singleFrame\n    }\n\n    const frames = TimeRange.fromTimes(time, Time.fromSeconds(buffer + time.seconds, time.fps))\n    // console.log(this.constructor.name, \"timeRangeToBuffer !PAUSED\", frames)\n\n    return frames\n  }\n\n  toJSON() : JsonObject {\n    return {\n      label: this.label,\n      quantize: this.quantize,\n      backcolor: this.backcolor,\n      id: this.id,\n      tracks: this.tracks,\n      createdAt: this.createdAt,\n      ...this.data,\n    }\n  }\n\n  trackCount(type?: TrackType): number {\n    if (type) return this.tracksOfType(type).length\n\n    return this.tracks.length\n  }\n\n  trackOfTypeAtIndex(type : TrackType, index = 0) : Track {\n    if (!Is.positive(index)) {\n      console.error(Errors.invalid.track, index, index?.constructor.name)\n      throw Errors.invalid.track\n    }\n\n    return this.tracksOfType(type)[index]\n  }\n\n  private trackOptions(object: TrackObject, index: number): TrackObject {\n    return { ...object, layer: index }\n  }\n\n  tracks: Track[] = []\n\n  private tracksOfType(trackType: TrackType): Track[] {\n    return this.tracks.filter(track => track.trackType === trackType)\n  }\n}\n\nexport { MashClass }\n","import { Factory } from \"../../Definitions/Factory/Factory\"\nimport { DefinitionType, DefinitionTypes } from \"../../Setup/Enums\"\nimport { Errors } from \"../../Setup/Errors\"\nimport { isPopulatedString } from \"../../Utilities/Is\"\nimport { DefinitionObject } from \"../../Base/Definition\"\nimport { Mash, MashObject } from \"./Mash\"\nimport { MashClass } from \"./MashInstance\"\n\n\nclass MashFactoryImplementation {\n  instance(object: MashObject = {}, definitions?: DefinitionObject[]): Mash {\n    if (definitions) definitions.forEach(definition => {\n      const { id: definitionId, type } = definition\n      if (!(type && isPopulatedString(type))) throw Errors.type\n\n      const definitionType = <DefinitionType>type\n      if (!DefinitionTypes.includes(definitionType)) throw Errors.type + definitionType\n\n      if (!(definitionId && isPopulatedString(definitionId))) {\n        throw Errors.invalid.definition.id + JSON.stringify(definition)\n      }\n      // installs our definition\n      Factory[definitionType].definition(definition)\n    })\n\n    return new MashClass(object)\n  }\n}\n\nconst MashFactory = new MashFactoryImplementation()\n\nexport { MashFactory }\n","import { InputCommand, Size } from \"../../declarations\"\nimport { Time } from \"../../Utilities/Time\"\nimport { ContextFactory, VisibleContext } from \"../../Playing\"\nimport { ThemeDefinition } from \"./Theme\"\nimport { InstanceBase } from \"../../Base/Instance\"\nimport { ModularMixin } from \"../../Mixin/Modular/ModularMixin\"\nimport { ClipMixin } from \"../../Mixin/Clip/ClipMixin\"\nimport { VisibleMixin } from \"../../Mixin/Visible/VisibleMixin\"\nimport { TransformableMixin } from \"../../Mixin/Transformable/TransformableMixin\"\nimport { LoadPromise } from \"../..\"\n\n\nconst ThemeWithModular = ModularMixin(InstanceBase)\nconst ThemeWithClip = ClipMixin(ThemeWithModular)\nconst ThemeWithVisible = VisibleMixin(ThemeWithClip)\nconst ThemeWithTransformable = TransformableMixin(ThemeWithVisible)\nclass ThemeClass extends ThemeWithTransformable {\n  commandAtTimeToSize(mashTime: Time, quantize: number, dimensions: Size): InputCommand | undefined {\n    const source = this.definition.inputSource\n    const inputCommand: InputCommand = { sources: { source }, filters: []}\n    return inputCommand\n  }\n\n  contextAtTimeToSize(mashTime : Time, quantize: number, dimensions : Size) : VisibleContext | undefined {\n    const context = ContextFactory.toSize(dimensions)\n    const clipTimeRange = this.timeRangeRelative(mashTime, quantize)\n    return this.definition.drawFilters(this, clipTimeRange, context, dimensions)\n  }\n\n  clipUrls(quantize: number, start: Time): string[] {\n    const urls = super.clipUrls(quantize, start) // urls from my effects, etc.\n    urls.push(...this.modularUrls(quantize, start)) // urls from my modular properties\n    return urls\n  }\n\n  declare definition: ThemeDefinition\n\n  inputCommandAtTimeToSize(mashTime: Time, quantize: number, dimensions: Size): InputCommand | undefined {\n    // console.log(this.constructor.name, \"inputCommandAtTimeToSize\", this.id)\n    const inputCommand = super.inputCommandAtTimeToSize(mashTime, quantize, dimensions)\n    if (!inputCommand) return inputCommand\n\n    const clipTimeRange = this.timeRangeRelative(mashTime, quantize)\n\n    inputCommand.filters = this.definition.inputFilters(this, clipTimeRange, dimensions)\n\n    return inputCommand\n  }\n\n  loadClip(quantize: number, start: Time, end?: Time): LoadPromise | void {\n    const promises: LoadPromise[] = []\n    const transformablePromise = super.loadClip(quantize, start, end) // my effects, etc.\n    if (transformablePromise) promises.push(transformablePromise)\n    const modularPromise = this.loadModular(quantize, start, end) // my modular properties\n    if (modularPromise) promises.push(modularPromise)\n    switch (promises.length) {\n      case 0: return\n      case 1: return promises[0]\n      default: return Promise.all(promises).then()\n    }\n  }\n}\n\nexport { ThemeClass }\n","import { Any } from \"../../declarations\"\n// import { DataType } from \"../../../Setup/Enums\"\n// import { Property } from \"../../../Setup/Property\"\nimport { VisibleDefinitionClass } from \"../Visible/Visible\"\nimport { TransformableDefinitionClass } from \"./Transformable\"\n\nfunction TransformableDefinitionMixin<T extends VisibleDefinitionClass>(Base: T): TransformableDefinitionClass & T {\n  return class extends Base {\n    constructor(...args: Any[]) {\n      super(...args)\n      // this.properties.push(new Property({ name: \"scaler\", type: DataType.Object, value: {} }))\n      // this.properties.push(new Property({ name: \"merger\", type: DataType.Object, value: {} }))\n    }\n  }\n}\nexport { TransformableDefinitionMixin }\n","import { Theme, ThemeObject } from \"./Theme\"\nimport { ThemeClass } from \"./ThemeInstance\"\nimport { DefinitionBase } from \"../../Base/Definition\"\nimport { ModularDefinitionMixin } from \"../../Mixin/Modular/ModularDefinitionMixin\"\nimport { ClipDefinitionMixin } from \"../../Mixin/Clip/ClipDefinitionMixin\"\nimport { Any } from \"../../declarations\"\nimport { Definitions } from \"../../Definitions/Definitions\"\nimport { VisibleDefinitionMixin } from \"../../Mixin/Visible/VisibleDefinitionMixin\"\nimport { DefinitionType } from \"../../Setup/Enums\"\nimport { TransformableDefinitionMixin } from \"../../Mixin/Transformable/TransformableDefintiionMixin\"\n\nconst WithModular = ModularDefinitionMixin(DefinitionBase)\nconst WithClip = ClipDefinitionMixin(WithModular)\nconst WithVisible = VisibleDefinitionMixin(WithClip)\nconst WithTransformable = TransformableDefinitionMixin(WithVisible)\n\nclass ThemeDefinitionClass extends WithTransformable {\n  constructor(...args : Any[]) {\n    super(...args)\n    Definitions.install(this)\n  }\n\n  get instance() : Theme {\n    return this.instanceFromObject(this.instanceObject)\n  }\n\n  instanceFromObject(object: ThemeObject): Theme {\n    const { instanceObject } = this\n    const options = { ...instanceObject, ...object }\n    // console.log(this.constructor.name, \"instanceFromObject\", instanceObject, object)\n    const instance = new ThemeClass(options)\n    return instance\n  }\n\n  type = DefinitionType.Theme\n}\n\nexport { ThemeDefinitionClass }\n","import { DefinitionType } from \"../../Setup/Enums\"\nimport { Errors } from \"../../Setup/Errors\"\nimport { Is } from \"../../Utilities/Is\"\nimport { Definitions } from \"../../Definitions/Definitions\"\nimport { Factories } from \"../../Definitions/Factories\"\nimport { ThemeDefinitionClass } from \"./ThemeDefinition\"\nimport { Theme, ThemeDefinition, ThemeDefinitionObject, ThemeObject } from \"./Theme\"\n\nimport themeColorJson from \"../../Definitions/DefinitionObjects/theme/color.json\"\nimport themeTextJson from \"../../Definitions/DefinitionObjects/theme/text.json\"\n\nconst themeDefinition = (object : ThemeDefinitionObject) : ThemeDefinition => {\n  const { id } = object\n  if (!(id && Is.populatedString(id))) throw Errors.id + JSON.stringify(object)\n\n  if (Definitions.installed(id)) return <ThemeDefinition> Definitions.fromId(id)\n\n  return new ThemeDefinitionClass({...object, type: DefinitionType.Theme })\n}\n\nconst themeDefinitionFromId = (id : string) : ThemeDefinition => {\n  return themeDefinition({ id })\n}\n\nconst themeInstance = (object : ThemeObject) : Theme => {\n  const definition = themeDefinition(object)\n  const instance = definition.instanceFromObject(object)\n  return instance\n}\n\nconst themeFromId = (id : string) : Theme => {\n  return themeInstance({ id })\n}\n\nconst themeInitialize = () : void => {\n  new ThemeDefinitionClass(themeColorJson)\n  new ThemeDefinitionClass(themeTextJson)\n}\n\nconst themeDefine = (object : ThemeDefinitionObject) : ThemeDefinition => {\n  const { id } = object\n  if (!(id && Is.populatedString(id))) throw Errors.id + JSON.stringify(object)\n\n  Definitions.uninstall(id)\n  return themeDefinition(object)\n}\n\nconst ThemeFactoryImplementation = {\n  define: themeDefine,\n  install: themeDefine,\n  definition: themeDefinition,\n  definitionFromId: themeDefinitionFromId,\n  fromId: themeFromId,\n  initialize: themeInitialize,\n  instance: themeInstance,\n}\n\nFactories[DefinitionType.Theme] = ThemeFactoryImplementation\n\nexport {\n  themeDefine,\n  themeDefine as themeInstall,\n  themeDefinition,\n  themeDefinitionFromId,\n  ThemeFactoryImplementation,\n  themeFromId,\n  themeInitialize,\n  themeInstance,\n}\n","import { TrackType } from \"../../Setup/Enums\"\nimport { Is, Time } from \"../../Utilities\"\nimport { VisibleContext } from \"../../Playing\"\nimport { Transition, TransitionDefinition, TransitionObject } from \"./Transition\"\nimport { InstanceBase } from \"../../Base/Instance\"\nimport { ModularMixin } from \"../../Mixin/Modular/ModularMixin\"\nimport { Visible } from \"../../Mixin/Visible\"\nimport { VisibleMixin } from \"../../Mixin/Visible/VisibleMixin\"\nimport { ClipMixin } from \"../../Mixin/Clip/ClipMixin\"\nimport { Any, Size } from \"../../declarations\"\n\nconst TransitionWithModular = ModularMixin(InstanceBase)\nconst TransitionWithClip = ClipMixin(TransitionWithModular)\nconst TransitionWithVisible = VisibleMixin(TransitionWithClip)\n\nclass TransitionClass extends TransitionWithVisible implements Transition {\n  constructor(...args: Any[]) {\n    super(...args)\n    const [object] = args\n    const { fromTrack, toTrack } = <TransitionObject>object\n    if (typeof fromTrack !== 'undefined') this.fromTrack = fromTrack\n    if (typeof toTrack !== 'undefined') this.toTrack = toTrack\n  }\n\n  contextAtTimeToSize(_time : Time, _quantize: number, _dimensions : Size) : VisibleContext | undefined {\n    return\n  }\n\n  declare definition : TransitionDefinition\n\n  fromTrack = 0\n\n  mergeClipsIntoContextAtTime(clips : Visible[], context : VisibleContext, time : Time, quantize : number, color? : string) : void {\n    // console.log(this.constructor.name, \"mergeClipsIntoContextAtTime\", clips.length, time, quantize, color)\n    if (!Is.aboveZero(clips.length)) return\n\n    this.definition.drawVisibleFilters(clips, this, time, quantize, context, color)\n  }\n\n  toTrack = 1\n\n  trackType = TrackType.Transition\n}\n\nexport { TransitionClass }\n","import { Any, JsonObject } from \"../../declarations\"\nimport { DataType, DefinitionType } from \"../../Setup/Enums\"\nimport { Time } from \"../../Utilities/Time\"\nimport { sortByFrame } from \"../../Utilities/Sort\"\nimport { ContextFactory, VisibleContext } from \"../../Playing\"\nimport { TransitionClass } from \"./TransitionInstance\"\nimport { Transition, TransitionObject } from \"./Transition\"\nimport { DefinitionBase } from \"../../Base/Definition\"\nimport { Filter } from \"../Filter/Filter\"\nimport { Visible } from \"../../Mixin/Visible/Visible\"\nimport { ModularDefinitionMixin } from \"../../Mixin/Modular/ModularDefinitionMixin\"\nimport { ClipDefinitionMixin } from \"../../Mixin/Clip/ClipDefinitionMixin\"\nimport { VisibleDefinitionMixin } from \"../../Mixin/Visible/VisibleDefinitionMixin\"\nimport { Definitions } from \"../../Definitions/Definitions\"\nimport { TransitionDefinitionObject } from \"./Transition\"\nimport { filterInstance } from \"../Filter\"\nimport { mergerInstance } from \"../Merger/MergerFactory\"\nimport { scalerInstance } from \"../Scaler/ScalerFactory\"\nimport { Property } from \"../../Setup/Property\"\n\nconst TransitionDefinitionWithModular = ModularDefinitionMixin(DefinitionBase)\nconst TransitionDefinitionWithClip = ClipDefinitionMixin(TransitionDefinitionWithModular)\nconst TransitionDefinitionWithVisible = VisibleDefinitionMixin(TransitionDefinitionWithClip)\nclass TransitionDefinitionClass extends TransitionDefinitionWithVisible {\n  constructor(...args : Any[]) {\n    super(...args)\n    const [object] = args\n\n    const { to, from } = <TransitionDefinitionObject> object\n\n    if (to) {\n      const { filters, merger, scaler } = to\n      if (filters) {\n        this.toFilters.push(...filters.map(filter => filterInstance(filter)))\n      }\n      if (merger) this.toMerger = mergerInstance(merger)\n      if (scaler) this.toScaler = scalerInstance(scaler)\n    }\n\n    if (from) {\n      const { filters, merger, scaler } = from\n      if (filters) {\n        this.fromFilters.push(...filters.map(filter => filterInstance(filter)))\n      }\n      if (merger) this.fromMerger = mergerInstance(merger)\n      if (scaler) this.fromScaler = scalerInstance(scaler)\n    }\n    this.properties.push(\n      new Property({ name: \"fromTrack\", type: DataType.Number, value: 0 }),\n      new Property({ name: \"toTrack\", type: DataType.Number, value: 1 }),\n    )\n    Definitions.install(this)\n  }\n\n  drawVisibleFilters(clips : Visible[], transition : Transition, time : Time, quantize: number, context : VisibleContext, color? : string) : void {\n    // console.log(this.constructor.name, \"drawVisibleFilters\", clips.length, transition.id)\n    const { size } = context\n    const sorted = [...clips].sort(sortByFrame)\n    let fromClip : Visible | undefined = sorted[0]\n    let toClip : Visible | undefined = sorted[1]\n\n    if (!toClip && fromClip.frame >= transition.frame) {\n      toClip = fromClip\n      fromClip = undefined\n    }\n\n    let fromDrawing = ContextFactory.toSize(size)\n    let toDrawing = ContextFactory.toSize(size)\n    if (color) {\n      fromDrawing.drawFill(color)\n      toDrawing.drawFill(color)\n    }\n\n    const range = transition.timeRangeRelative(time, quantize)\n\n    if (fromClip) fromClip.mergeContextAtTime(time, quantize, fromDrawing)\n    this.filters = this.fromFilters\n    fromDrawing = this.drawFilters(transition, range, fromDrawing, size)\n\n    if (toClip) toClip.mergeContextAtTime(time, quantize, toDrawing)\n    this.filters = this.toFilters\n    toDrawing = this.drawFilters(transition, range, toDrawing, size)\n\n    fromDrawing = this.fromScaler.definition.drawFilters(this.fromScaler, range, fromDrawing, size)\n    this.fromMerger.definition.drawFilters(this.fromMerger, range, fromDrawing, size, context)\n    toDrawing = this.toScaler.definition.drawFilters(this.toScaler, range, toDrawing, size)\n    this.toMerger.definition.drawFilters(this.toMerger, range, toDrawing, size, context)\n  }\n\n\n\n  private fromFilters : Filter[] = []\n\n  private fromMerger = mergerInstance({})\n\n  private fromScaler = scalerInstance({})\n\n  get instance() : Transition { return this.instanceFromObject(this.instanceObject) }\n\n  instanceFromObject(object : TransitionObject) : Transition {\n    return new TransitionClass({ ...this.instanceObject, ...object })\n  }\n\n  private toFilters : Filter[] = []\n\n  private toMerger = mergerInstance({})\n\n  private toScaler = scalerInstance({})\n\n  toJSON() : JsonObject {\n    return {\n      ...super.toJSON(),\n      to: { filters: this.toFilters },\n      from: { filters: this.fromFilters },\n    }\n  }\n\n  type = DefinitionType.Transition\n}\n\nexport { TransitionDefinitionClass }\n","import { DefinitionType } from \"../../Setup/Enums\"\nimport { Errors } from \"../../Setup/Errors\"\nimport { Is } from \"../../Utilities/Is\"\nimport { Definitions } from \"../../Definitions/Definitions\"\nimport { Factories } from \"../../Definitions/Factories\"\nimport { TransitionDefinitionClass } from \"./TransitionDefinition\"\nimport {\n  Transition, TransitionDefinition, TransitionDefinitionObject, TransitionObject\n} from \"./Transition\"\n\nimport transitionCrossfadeJson from \"../../Definitions/DefinitionObjects/transition/crossfade.json\"\n\nconst transitionDefinition = (object : TransitionDefinitionObject) : TransitionDefinition => {\n  const { id } = object\n  if (!(id && Is.populatedString(id))) throw Errors.id + JSON.stringify(object)\n\n  if (Definitions.installed(id)) return <TransitionDefinition> Definitions.fromId(id)\n\n  return new TransitionDefinitionClass(object)\n}\n\nconst transitionDefinitionFromId = (id : string) : TransitionDefinition => {\n  return transitionDefinition({ id })\n}\n\nconst transitionInstance = (object : TransitionObject) : Transition => {\n  const definition = transitionDefinition(object)\n  const instance = definition.instanceFromObject(object)\n  return instance\n}\n\nconst transitionFromId = (id : string) : Transition => {\n  return transitionInstance({ id })\n}\n\nconst transitionInitialize = () : void => {\n  transitionDefinition(transitionCrossfadeJson)\n}\n\nconst transitionDefine = (object : TransitionDefinitionObject) : TransitionDefinition => {\n  const { id } = object\n  if (!(id && Is.populatedString(id))) throw Errors.id + JSON.stringify(object)\n\n  Definitions.uninstall(id)\n  return transitionDefinition(object)\n}\n\nconst TransitionFactoryImplementation = {\n  define: transitionDefine,\n  install: transitionDefine,\n  definition: transitionDefinition,\n  definitionFromId: transitionDefinitionFromId,\n  fromId: transitionFromId,\n  initialize: transitionInitialize,\n  instance: transitionInstance,\n}\n\nFactories[DefinitionType.Transition] = TransitionFactoryImplementation\n\nexport {\n  transitionDefine,\n  transitionDefine as transitionInstall,\n  transitionDefinition,\n  transitionDefinitionFromId,\n  TransitionFactoryImplementation,\n  transitionFromId,\n  transitionInitialize,\n  transitionInstance,\n}\n","import { Video, VideoClass, VideoDefinition, VideoObject } from \"./Video\"\nimport { InstanceBase } from \"../../Base/Instance\"\nimport { ClipMixin } from \"../../Mixin/Clip/ClipMixin\"\nimport { TransformableMixin } from \"../../Mixin/Transformable/TransformableMixin\"\nimport { AudibleMixin } from \"../../Mixin/Audible/AudibleMixin\"\nimport { Is } from \"../../Utilities/Is\"\nimport { Default } from \"../../Setup/Default\"\nimport { Any, JsonObject } from \"../../declarations\"\nimport { Time } from \"../../Utilities/Time\"\nimport { AudibleFileMixin } from \"../../Mixin/AudibleFile/AudibleFileMixin\"\nimport { VisibleMixin } from \"../../Mixin/Visible/VisibleMixin\"\n// import { Errors } from \"../../Setup/Errors\"\n\nconst WithClip = ClipMixin(InstanceBase)\nconst WithAudible = AudibleMixin(WithClip)\nconst WithAudibleFile = AudibleFileMixin(WithAudible)\nconst WithVisible = VisibleMixin(WithAudibleFile)\nconst WithTransformable = TransformableMixin(WithVisible)\n\nconst VideoClassImplementation: VideoClass = class extends WithTransformable {\n  constructor(...args : Any[]) {\n    super(...args)\n    const [object] = args\n    const { speed } = <VideoObject> object\n    if (speed && Is.aboveZero(speed)) this.speed = speed\n  }\n\n  // private loadedAudio? : LoadedAudio\n\n  get copy() : Video { return <Video> super.copy }\n\n  declare definition : VideoDefinition\n\n  definitionTime(quantize : number, time : Time) : Time {\n    const scaledTime = super.definitionTime(quantize, time)\n    if (this.speed === Default.instance.video.speed) return scaledTime\n\n    return scaledTime.divide(this.speed) //, 'ceil')\n  }\n\n  speed = Default.instance.video.speed\n\n  toJSON() : JsonObject {\n    const object = super.toJSON()\n    if (this.speed !== Default.instance.video.speed) object.speed = this.speed\n    return object\n  }\n}\n\nexport { VideoClassImplementation }\n","import { AudibleSource, VisibleSource, Any, JsonObject, LoadPromise, LoadVideoResult } from \"../../declarations\"\nimport { DefinitionType, TrackType, DataType } from \"../../Setup/Enums\"\nimport { Errors } from \"../../Setup/Errors\"\nimport { Default } from \"../../Setup/Default\"\nimport { Property } from \"../../Setup/Property\"\nimport { Time, Times } from \"../../Utilities/Time\"\nimport { TimeRange } from \"../../Utilities/TimeRange\"\nimport { urlAbsolute } from \"../../Utilities/Url\"\nimport { Cache } from \"../../Loading/Cache\"\nimport { LoaderFactory } from \"../../Loading/LoaderFactory\"\nimport { DefinitionBase } from \"../../Base/Definition\"\nimport { Definitions } from \"../../Definitions/Definitions\"\nimport { VideoClassImplementation } from \"./VideoInstance\"\nimport { Video, VideoDefinitionClass, VideoDefinitionObject, VideoObject } from \"./Video\"\nimport { ClipDefinitionMixin } from \"../../Mixin/Clip/ClipDefinitionMixin\"\nimport { VisibleDefinitionMixin } from \"../../Mixin/Visible/VisibleDefinitionMixin\"\nimport { AudibleDefinitionMixin } from \"../../Mixin/Audible/AudibleDefinitionMixin\"\nimport { AudibleFileDefinitionMixin } from \"../../Mixin/AudibleFile/AudibleFileDefinitionMixin\"\nimport { ContextFactory } from \"../../Playing/ContextFactory\"\n\n\nconst WithClip = ClipDefinitionMixin(DefinitionBase)\nconst WithAudible = AudibleDefinitionMixin(WithClip)\nconst WithAudibleFile = AudibleFileDefinitionMixin(WithAudible)\nconst WithVisible = VisibleDefinitionMixin(WithAudibleFile)\n\nconst VideoDefinitionClassImplementation: VideoDefinitionClass = class extends WithVisible {\n  constructor(...args: Any[]) {\n    super(...args)\n    const [object] = args\n    const { url, fps, source } = <VideoDefinitionObject>object\n    if (!url) throw Errors.invalid.definition.url\n\n    this.url = url\n\n    this.source = source || url\n    if (fps) this.fps = fps\n\n    this.properties.push(new Property({ name: \"speed\", type: DataType.Number, value: 1.0 }))\n\n    Definitions.install(this)\n  }\n\n  get absoluteUrl(): string { return urlAbsolute(this.url) }\n\n  get cachedOrThrow(): LoadVideoResult {\n    const cached = Cache.get(this.absoluteUrl)\n    if (!cached) throw Errors.internal\n\n    return <LoadVideoResult> cached\n  }\n\n  definitionUrls(_start: Time, _end?: Time): string[] { return [this.absoluteUrl] }\n\n  fps = Default.definition.video.fps\n\n  get inputSource(): string { return urlAbsolute(this.source) }\n\n  get instance(): Video { return this.instanceFromObject(this.instanceObject) }\n\n  instanceFromObject(object: VideoObject): Video {\n    return new VideoClassImplementation({ ...this.instanceObject, ...object })\n  }\n\n  framePromise(time: Time, cached: LoadVideoResult): LoadPromise {\n    const { video, sequence } = cached\n    const sourceOrPromise = sequence[time.frame]\n    if (sourceOrPromise instanceof Promise) return sourceOrPromise\n\n    if (sourceOrPromise) return Promise.resolve()\n\n    // console.debug(this.constructor.name, \"framePromise\", time)\n\n    const promise = this.seekPromise(time, video).then(() => {\n      // make sure we don't already have this frame\n      if (sequence[time.frame] && !(sequence[time.frame] instanceof Promise)) {\n        // console.debug(this.constructor.name, \"framePromise already captured\", time.toString())\n        return\n      }\n\n      const context = ContextFactory.toSize(video)\n      context.draw(video)\n      sequence[time.frame] = context.canvas\n      // console.debug(this.constructor.name, \"framePromise capturing\", time.toString())\n    })\n    sequence[time.frame] = promise\n    return promise\n  }\n\n  needTimes(cached: LoadVideoResult, start: Time, end?: Time): Time[] {\n    const { sequence } = cached\n    const times = end ? TimeRange.fromTimes(start, end).times : [start]\n    return times.filter(time =>\n      !sequence[time.frame] || sequence[time.frame] instanceof Promise\n    )\n  }\n\n  framesPromise(start: Time, end?: Time): LoadPromise {\n    const cached = this.cachedOrThrow\n    const timesNeeded = this.needTimes(cached, start, end)\n    return this.timesPromise(timesNeeded)\n  }\n\n\n  timesPromise(timesNeeded: Time[]): LoadPromise {\n    if (!timesNeeded.length) return Promise.resolve()\n\n    const cached = this.cachedOrThrow\n    // const promises:LoadPromise[] = timesNeeded.map(time => this.framePromise(time, cached))\n\n\n    // return Promise.all(promises).then(() => {})\n    const time = timesNeeded.shift()\n    if (!time) throw Errors.internal\n\n    const first = this.framePromise(time, cached)\n    let framePromise = first\n\n    timesNeeded.forEach(time => {\n      framePromise = framePromise.then(() => this.framePromise(time, cached))\n    })\n    return framePromise\n  }\n\n  loadDefinition(quantize: number, startTime: Time, endTime?: Time): LoadPromise | void {\n    const rate = this.fps || quantize\n    const start = startTime.scale(rate)\n    const end = endTime ? endTime.scale(rate) : endTime\n\n    // console.trace(start)\n    const url = this.absoluteUrl\n    if (Cache.cached(url)) {\n      const cached = this.cachedOrThrow\n      const times = this.needTimes(cached, start, end)\n      if (!times.length) {\n        // console.debug(this.constructor.name, \"loadDefinition cached and no times needed\")\n        return\n      }\n      // console.debug(this.constructor.name, \"loadDefinition cached and returning promises\", times.join(', '))\n      return this.timesPromise(times)\n    }\n\n    const promise: LoadPromise = Cache.caching(url) ? Cache.get(url) : LoaderFactory.video().loadUrl(url)\n    // if (Cache.caching(url)) console.debug(this.constructor.name, \"loadDefinition caching and returning framesPromise\", start, end)\n    // else console.debug(this.constructor.name, \"loadDefinition uncached and returning framesPromise\", start, end)\n\n    return promise.then(() => this.framesPromise(start, end))\n  }\n\n  loadedAudible(): AudibleSource | undefined {\n    const cached: LoadVideoResult | undefined = Cache.get(this.absoluteUrl)\n    if (!cached) return\n\n    const { audio } = cached\n    return Cache.audibleContext.createBufferSource(audio)\n  }\n\n  loadedVisible(quantize: number, startTime: Time): VisibleSource | undefined {\n    const rate = this.fps || quantize\n    const time = startTime.scale(rate)\n\n    // console.debug(this.constructor.name, \"loadedVisible\", time.toString(), startTime.toString())\n\n    const cached: LoadVideoResult | undefined = Cache.get(this.absoluteUrl)\n    if (!cached) {\n      // console.debug(this.constructor.name, \"loadedVisible no cached\")\n      return\n    }\n\n    const { sequence } = cached\n    const source = sequence[time.frame]\n    if (!source || source instanceof Promise) {\n      // console.debug(this.constructor.name, \"loadedVisible source issue\", source)\n      return\n    }\n\n    return source\n  }\n\n  pattern = '%.jpg'\n\n  private seek(definitionTime: Time, video:HTMLVideoElement): void {\n    if (!video) throw Errors.internal\n\n    video.currentTime = definitionTime.seconds\n  }\n\n  private seekNeeded(definitionTime: Time, video:HTMLVideoElement): boolean {\n    const { currentTime } = video\n    const videoTime = Time.fromSeconds(currentTime, definitionTime.fps)\n    return !videoTime.equalsTime(definitionTime)\n  }\n\n  private seekPromise(definitionTime: Time, video:HTMLVideoElement): LoadPromise {\n    const promise:LoadPromise = new Promise(resolve => {\n      if (!this.seekNeeded(definitionTime, video)) return resolve()\n\n      video.onseeked = () => {\n        video.onseeked = null\n        resolve()\n      }\n      this.seek(definitionTime, video)\n    })\n    return promise\n  }\n\n  source = ''\n\n  toJSON() : JsonObject {\n    const object = super.toJSON()\n    object.url = this.url\n    if (this.source) object.source = this.source\n    if (this.fps !== Default.definition.video.fps) object.fps = this.fps\n    return object\n  }\n\n  trackType = TrackType.Video\n\n  type = DefinitionType.Video\n\n  unload(times?: Times[]): void {\n    // const zeroTime = Time.fromArgs(0, this.fps)\n    // const allUrls = this.urls(zeroTime, zeroTime.withFrame(this.framesMax))\n    // const deleting = new Set(allUrls.filter(url => Cache.cached(url)))\n    // if (times) {\n    //   times.forEach(maybePair => {\n    //     const [start, end] = maybePair\n    //     const frames = this.framesArray(start, end)\n    //     const urls = frames.map(frame => this.urlForFrame(frame))\n    //     const needed = urls.filter(url => deleting.has(url))\n    //     needed.forEach(url => { deleting.delete(url) })\n    //   })\n    // }\n    // deleting.forEach(url => { Cache.remove(url) })\n  }\n\n  url : string\n\n  // private urlForFrame(frame : number) : string {\n  //   let s = String((frame * this.increment) + this.begin)\n  //   if (this.padding) s = s.padStart(this.padding, '0')\n  //   return (this.url + this.pattern).replaceAll('%', s)\n  // }\n\n  // private urls(start : Time, end? : Time) : string[] {\n  //   return this.framesArray(start, end).map(frame => this.urlForFrame(frame))\n  // }\n\n}\n\nexport { VideoDefinitionClassImplementation }\n","import { DefinitionType } from \"../../Setup/Enums\"\nimport { Errors } from \"../../Setup/Errors\"\nimport { Is } from \"../../Utilities/Is\"\nimport { Definitions } from \"../../Definitions\"\nimport { Factories } from \"../../Definitions/Factories\"\nimport { VideoDefinitionClassImplementation } from \"../Video/VideoDefinition\"\nimport { Video, VideoDefinition, VideoDefinitionObject, VideoObject } from \"./Video\"\n\nconst videoDefinition = (object : VideoDefinitionObject) : VideoDefinition => {\n  const { id } = object\n  if (!(id && Is.populatedString(id))) throw Errors.id + JSON.stringify(object)\n\n  if (Definitions.installed(id)) return <VideoDefinition> Definitions.fromId(id)\n\n  return new VideoDefinitionClassImplementation(object)\n}\n\nconst videoDefinitionFromId = (id : string) : VideoDefinition => {\n  return videoDefinition({ id })\n}\n\nconst videoInstance = (object : VideoObject) : Video => {\n  const definition = videoDefinition(object)\n  const instance = definition.instanceFromObject(object)\n  return instance\n}\n\nconst videoFromId = (id : string) : Video => {\n  return videoInstance({ id })\n}\n\nconst videoInitialize = () : void => {}\n\nconst videoDefine = (object : VideoDefinitionObject) : VideoDefinition => {\n  const { id } = object\n  if (!(id && Is.populatedString(id))) throw Errors.id + JSON.stringify(object)\n\n  Definitions.uninstall(id)\n  return videoDefinition(object)\n}\n\n\n/**\n * @internal\n */\nconst videoInstall = (object: VideoDefinitionObject): VideoDefinition => {\n  const instance = videoDefine(object)\n  instance.retain = true\n  return instance\n}\n\n\n\nconst VideoFactoryImplementation = {\n  define: videoDefine,\n  install: videoInstall,\n  definition: videoDefinition,\n  definitionFromId: videoDefinitionFromId,\n  fromId: videoFromId,\n  initialize: videoInitialize,\n  instance: videoInstance,\n}\n\nFactories[DefinitionType.Video] = VideoFactoryImplementation\n\nexport {\n  videoInstall,\n  videoDefine,\n  videoDefinition,\n  videoDefinitionFromId,\n  VideoFactoryImplementation,\n  videoFromId,\n  videoInitialize,\n  videoInstance,\n}\n","import { Any, JsonObject } from \"../../declarations\"\nimport { AudibleClass } from \"../Audible/Audible\"\nimport { StreamableClass, StreamableDefinition, StreamableObject } from \"./Streamable\"\n\n\nfunction StreamableMixin<T extends AudibleClass>(Base: T): StreamableClass & T {\n  return class extends Base {\n    constructor(...args: Any[]) {\n      super(...args)\n      const [object] = args\n      const { something } = <StreamableObject>object\n\n      if (something) this.something = something\n    }\n\n    declare definition : StreamableDefinition\n\n\n    something?: string\n\n    maxFrames(_quantize : number, _trim? : number) : number { return 0 }\n\n\n    toJSON() : JsonObject {\n      const object = super.toJSON()\n      if (this.something) object.something = this.something\n      return object\n    }\n  }\n}\nexport { StreamableMixin }\n","import { VideoStream, VideoStreamDefinition, VideoStreamObject } from \"./VideoStream\"\nimport { InstanceBase } from \"../../Base/Instance\"\nimport { ClipMixin } from \"../../Mixin/Clip/ClipMixin\"\nimport { TransformableMixin } from \"../../Mixin/Transformable/TransformableMixin\"\nimport { AudibleMixin } from \"../../Mixin/Audible/AudibleMixin\"\nimport { Any, JsonObject } from \"../../declarations\"\nimport { VisibleMixin } from \"../../Mixin/Visible/VisibleMixin\"\nimport { StreamableMixin } from \"../../Mixin/Streamable/StreamableMixin\"\n\nconst WithClip = ClipMixin(InstanceBase)\nconst WithAudible = AudibleMixin(WithClip)\nconst WithStreamable = StreamableMixin(WithAudible)\nconst WithVisible = VisibleMixin(WithStreamable)\nconst WithTransformable = TransformableMixin(WithVisible)\n\nclass VideoStreamClass extends WithTransformable {\n  constructor(...args : Any[]) {\n    super(...args)\n    // const [object] = args\n    // const { speed } = <VideoStreamObject> object\n  }\n\n  get copy() : VideoStream { return <VideoStream> super.copy }\n\n  declare definition : VideoStreamDefinition\n\n  toJSON() : JsonObject {\n    const object = super.toJSON()\n    // if (this.speed !== Default.instance.video.speed) object.speed = this.speed\n    return object\n  }\n}\n\nexport { VideoStreamClass }\n","import { Any, JsonObject } from \"../../declarations\"\nimport { StreamableDefinitionClass, StreamableDefinitionObject } from \"./Streamable\"\nimport { AudibleDefinitionClass } from \"../Audible/Audible\"\n// import { DataType } from \"../../../Setup/Enums\"\n// import { Property } from \"../../../Setup/Property\"\n\nfunction StreamableDefinitionMixin<T extends AudibleDefinitionClass>(Base: T) : StreamableDefinitionClass & T {\n  return class extends Base {\n    constructor(...args : Any[]) {\n      super(...args)\n      const [object] = args\n      const { format } = <StreamableDefinitionObject> object\n      if (format) this.format = format\n\n    //  this.properties.push(new Property({ name: \"something\", type: DataType.String, value: '' }))\n    }\n\n    format = 'hls'\n\n    streamable = true\n\n    toJSON() : JsonObject {\n      const object = super.toJSON()\n      object.format = true\n      return object\n    }\n  }\n}\n\nexport { StreamableDefinitionMixin }\n","import { DefinitionType, TrackType } from \"../../Setup/Enums\"\nimport { Time, Times} from \"../../Utilities/Time\"\nimport { urlAbsolute} from \"../../Utilities/Url\"\nimport { Cache } from \"../../Loading/Cache\"\nimport { DefinitionBase } from \"../../Base/Definition\"\nimport { VideoStreamClass } from \"./VideoStreamInstance\"\nimport { VideoStream, VideoStreamDefinitionObject, VideoStreamObject } from \"./VideoStream\"\nimport { ClipDefinitionMixin } from \"../../Mixin/Clip/ClipDefinitionMixin\"\nimport { VisibleDefinitionMixin } from \"../../Mixin/Visible/VisibleDefinitionMixin\"\nimport { Any, JsonObject, LoadPromise } from \"../../declarations\"\nimport { Errors } from \"../../Setup/Errors\"\nimport { Definitions } from \"../../Definitions/Definitions\"\nimport { AudibleDefinitionMixin } from \"../../Mixin/Audible/AudibleDefinitionMixin\"\nimport { LoaderFactory } from \"../../Loading/LoaderFactory\"\nimport { StreamableDefinitionMixin } from \"../../Mixin/Streamable/StreamableDefinitionMixin\"\nimport { Default } from \"../../Setup/Default\"\n\nconst WithClip = ClipDefinitionMixin(DefinitionBase)\nconst WithAudible = AudibleDefinitionMixin(WithClip)\nconst WithVisible = VisibleDefinitionMixin(WithAudible)\nconst WithStreamable = StreamableDefinitionMixin(WithVisible)\nclass VideoStreamDefinitionClass extends WithStreamable {\n  constructor(...args : Any[]) {\n    super(...args)\n    const [object] = args\n    const { url, source } = <VideoStreamDefinitionObject> object\n    if (!url) throw Errors.invalid.definition.url\n\n    this.url = url\n    this.source = source || url\n\n    // this.properties.push(new Property({ name: \"speed\", type: DataType.Number, value: 1.0 }))\n    Definitions.install(this)\n  }\n\n  get absoluteUrl(): string { return urlAbsolute(this.url) }\n\n  frames(quantize: number): number {\n    return Time.fromSeconds(Default.definition.videostream.duration, quantize, 'floor').frame\n  }\n\n  get inputSource(): string { return urlAbsolute(this.source) }\n\n  get instance() : VideoStream { return this.instanceFromObject(this.instanceObject) }\n\n  instanceFromObject(object : VideoStreamObject) : VideoStream {\n    return new VideoStreamClass({ ...this.instanceObject, ...object })\n  }\n\n  loadDefinition(): LoadPromise | void {\n    const url = this.absoluteUrl\n    if (Cache.cached(url)) return\n\n    if (Cache.caching(url)) return Cache.get(url)\n\n    return LoaderFactory.video().loadUrl(url)\n  }\n\n  definitionUrls(_start: Time, _end?: Time): string[] { return [this.absoluteUrl] }\n\n  loadedVisible() : HTMLVideoElement | undefined { return Cache.get(this.absoluteUrl) }\n\n  source = ''\n\n  trackType = TrackType.Video\n\n  type = DefinitionType.VideoStream\n\n  toJSON() : JsonObject {\n    const object = super.toJSON()\n    object.url = this.url\n    if (this.source) object.source = this.source\n    return object\n  }\n\n  unload(times?: Times[]): void {\n    if (!times && Cache.cached(this.url)) Cache.remove(this.url)\n  }\n\n  url : string\n}\n\nexport { VideoStreamDefinitionClass }\n","import { DefinitionType } from \"../../Setup/Enums\"\nimport { Errors } from \"../../Setup/Errors\"\nimport { Is } from \"../../Utilities/Is\"\nimport { Definitions } from \"../../Definitions\"\nimport { Factories } from \"../../Definitions/Factories\"\nimport { VideoStreamDefinitionClass } from \"../VideoStream/VideoStreamDefinition\"\nimport { VideoStream, VideoStreamDefinition, VideoStreamDefinitionObject, VideoStreamObject } from \"./VideoStream\"\n\nconst videoStreamDefinition = (object : VideoStreamDefinitionObject) : VideoStreamDefinition => {\n  const { id } = object\n  if (!(id && Is.populatedString(id))) throw Errors.id + JSON.stringify(object)\n\n  if (Definitions.installed(id)) return <VideoStreamDefinition> Definitions.fromId(id)\n\n  return new VideoStreamDefinitionClass(object)\n}\n\nconst videoStreamDefinitionFromId = (id : string) : VideoStreamDefinition => {\n  return videoStreamDefinition({ id })\n}\n\nconst videoStreamInstance = (object : VideoStreamObject) : VideoStream => {\n  const definition = videoStreamDefinition(object)\n  const instance = definition.instanceFromObject(object)\n  return instance\n}\n\nconst videoStreamFromId = (id : string) : VideoStream => {\n  return videoStreamInstance({ id })\n}\n\nconst videoStreamInitialize = (): void => {}\n\nconst videoStreamDefine = (object : VideoStreamDefinitionObject) : VideoStreamDefinition => {\n  const { id } = object\n  if (!(id && Is.populatedString(id))) throw Errors.id + JSON.stringify(object)\n\n  Definitions.uninstall(id)\n  return videoStreamDefinition(object)\n}\n\n/**\n * @internal\n */\nconst videoStreamInstall = (object: VideoStreamDefinitionObject): VideoStreamDefinition => {\n  const instance = videoStreamDefine(object)\n  instance.retain = true\n  return instance\n}\n\nconst VideoStreamFactoryImplementation = {\n  define: videoStreamDefine,\n  install: videoStreamInstall,\n  definition: videoStreamDefinition,\n  definitionFromId: videoStreamDefinitionFromId,\n  fromId: videoStreamFromId,\n  initialize: videoStreamInitialize,\n  instance: videoStreamInstance,\n}\n\nFactories[DefinitionType.VideoStream] = VideoStreamFactoryImplementation\n\nexport {\n  videoStreamInstall,\n  videoStreamDefine,\n  videoStreamDefinition,\n  videoStreamDefinitionFromId,\n  VideoStreamFactoryImplementation,\n  videoStreamFromId,\n  videoStreamInitialize,\n  videoStreamInstance,\n}\n","import { VideoSequence, VideoSequenceDefinition, VideoSequenceObject } from \"./VideoSequence\"\nimport { InstanceBase } from \"../../Base/Instance\"\nimport { ClipMixin } from \"../../Mixin/Clip/ClipMixin\"\nimport { TransformableMixin } from \"../../Mixin/Transformable/TransformableMixin\"\nimport { AudibleMixin } from \"../../Mixin/Audible/AudibleMixin\"\nimport { Is } from \"../../Utilities/Is\"\nimport { Default } from \"../../Setup/Default\"\nimport { Any, JsonObject } from \"../../declarations\"\nimport { Time } from \"../../Utilities/Time\"\nimport { AudibleFileMixin } from \"../../Mixin/AudibleFile/AudibleFileMixin\"\nimport { VisibleMixin } from \"../../Mixin/Visible/VisibleMixin\"\n\nconst WithClip = ClipMixin(InstanceBase)\nconst WithAudible = AudibleMixin(WithClip)\nconst WithAudibleFile = AudibleFileMixin(WithAudible)\nconst WithVisible = VisibleMixin(WithAudibleFile)\nconst WithTransformable = TransformableMixin(WithVisible)\n\nclass VideoSequenceClassImplementation extends WithTransformable {\n  constructor(...args : Any[]) {\n    super(...args)\n    const [object] = args\n    const { speed } = <VideoSequenceObject> object\n    if (speed && Is.aboveZero(speed)) this.speed = speed\n  }\n\n  get copy() : VideoSequence { return <VideoSequence> super.copy }\n\n  declare definition : VideoSequenceDefinition\n\n  definitionTime(quantize : number, time : Time) : Time {\n    const scaledTime = super.definitionTime(quantize, time)\n    if (this.speed === Default.instance.video.speed) return scaledTime\n\n    return scaledTime.divide(this.speed) //, 'ceil')\n  }\n\n  speed = Default.instance.video.speed\n\n  toJSON() : JsonObject {\n    const object = super.toJSON()\n    if (this.speed !== Default.instance.video.speed) object.speed = this.speed\n    return object\n  }\n}\n\nexport { VideoSequenceClassImplementation }\n","import { DefinitionType, TrackType, DataType } from \"../../Setup/Enums\"\nimport { Any, VisibleSource, JsonObject, LoadPromise } from \"../../declarations\"\nimport { Time, Times } from \"../../Utilities/Time\"\nimport { urlAbsolute} from \"../../Utilities/Url\"\nimport { Cache } from \"../../Loading/Cache\"\nimport { DefinitionBase } from \"../../Base/Definition\"\nimport { VideoSequenceClassImplementation } from \"./VideoSequenceInstance\"\nimport { VideoSequence, VideoSequenceDefinitionObject, VideoSequenceObject } from \"./VideoSequence\"\nimport { ClipDefinitionMixin } from \"../../Mixin/Clip/ClipDefinitionMixin\"\nimport { VisibleDefinitionMixin } from \"../../Mixin/Visible/VisibleDefinitionMixin\"\nimport { Errors } from \"../../Setup/Errors\"\nimport { Definitions } from \"../../Definitions/Definitions\"\nimport { AudibleDefinitionMixin } from \"../../Mixin/Audible/AudibleDefinitionMixin\"\nimport { Default } from \"../../Setup/Default\"\nimport { Property } from \"../../Setup/Property\"\nimport { LoaderFactory } from \"../../Loading/LoaderFactory\"\nimport { AudibleFileDefinitionMixin } from \"../../Mixin/AudibleFile/AudibleFileDefinitionMixin\"\n\nconst WithClip = ClipDefinitionMixin(DefinitionBase)\nconst WithAudible = AudibleDefinitionMixin(WithClip)\nconst WithAudibleFile = AudibleFileDefinitionMixin(WithAudible)\nconst WithVisible = VisibleDefinitionMixin(WithAudibleFile)\n\nclass VideoSequenceDefinitionClassImplementation extends WithVisible {\n  constructor(...args : Any[]) {\n    super(...args)\n    const [object] = args\n    const {\n      padding, url, begin, fps, increment, pattern, source\n    } = <VideoSequenceDefinitionObject>object\n    if (!url) throw Errors.invalid.definition.url\n    this.url = url\n\n    if (source) this.source = source\n    if (typeof begin !== \"undefined\") this.begin = begin\n    if (fps) this.fps = fps\n    if (increment) this.increment = increment\n    if (pattern) this.pattern = pattern\n    if (padding) this.padding = padding\n    else {\n      const lastFrame = this.begin + (this.increment * this.framesMax - this.begin)\n      this.padding = String(lastFrame).length\n    }\n    this.properties.push(new Property({ name: \"speed\", type: DataType.Number, value: 1.0 }))\n    Definitions.install(this)\n  }\n\n  begin = Default.definition.videosequence.begin\n\n  definitionUrls(start: Time, end?: Time): string[] {\n    return this.framesArray(start, end).map(frame => this.urlForFrame(frame))\n  }\n\n  fps = Default.definition.videosequence.fps\n\n  private framesArray(start : Time, end? : Time) : number[] {\n    const frames : number[] = []\n    const startFrame = Math.min(this.framesMax, start.scale(this.fps, \"floor\").frame)\n    if (end) {\n      const endFrame = Math.min(this.framesMax, end.scale(this.fps, \"ceil\").frame)\n      for (let frame = startFrame; frame <= endFrame; frame += 1) {\n        frames.push(frame)\n      }\n    } else frames.push(startFrame)\n    return frames\n  }\n\n  private get framesMax() : number { return Math.floor(this.fps * this.duration) - 2 }\n\n  increment = Default.definition.videosequence.increment\n\n  get inputSource(): string { return urlAbsolute(this.source) }\n\n  get instance() : VideoSequence { return this.instanceFromObject(this.instanceObject) }\n\n  instanceFromObject(object : VideoSequenceObject) : VideoSequence {\n    return new VideoSequenceClassImplementation({ ...this.instanceObject, ...object })\n  }\n\n  loadDefinition(quantize:number, start: Time, end?: Time): LoadPromise | void {\n    const promises: LoadPromise[] = []\n    const clipDefinitionPromise = end ? super.loadDefinition(quantize, start, end) : null\n    if (clipDefinitionPromise) promises.push(clipDefinitionPromise)\n    const urls = this.definitionUrls(start, end)\n    const uncachedUrls = urls.filter(url => !Cache.cached(url))\n    uncachedUrls.forEach(url => {\n      if (Cache.caching(url)) promises.push(Cache.get(url))\n      else promises.push(LoaderFactory.image().loadUrl(url))\n    })\n    switch (promises.length) {\n      case 0: return\n      case 1: return promises[0]\n      default: return Promise.all(promises).then()\n    }\n  }\n\n  loadedVisible(_quantize: number, time : Time) : VisibleSource | undefined {\n    const [url] = this.urls(time)\n    return Cache.get(url)\n  }\n\n  pattern = '%.jpg'\n\n  source = ''\n\n  toJSON() : JsonObject {\n    const object = super.toJSON()\n    object.url = this.url\n    if (this.source) object.source = this.source\n    if (this.pattern !== Default.definition.videosequence.pattern) object.pattern = this.pattern\n    if (this.increment !== Default.definition.videosequence.increment) object.increment = this.increment\n    if (this.begin !== Default.definition.videosequence.begin) object.begin = this.begin\n    if (this.fps !== Default.definition.videosequence.fps) object.fps = this.fps\n    if (this.padding !== Default.definition.videosequence.padding) object.padding = this.padding\n    return object\n  }\n\n  trackType = TrackType.Video\n\n  type = DefinitionType.VideoSequence\n\n  unload(times?: Times[]): void {\n    const zeroTime = Time.fromArgs(0, this.fps)\n    const allUrls = this.urls(zeroTime, zeroTime.withFrame(this.framesMax))\n    const deleting = new Set(allUrls.filter(url => Cache.cached(url)))\n    if (times) {\n      times.forEach(maybePair => {\n        const [start, end] = maybePair\n        const frames = this.framesArray(start, end)\n        const urls = frames.map(frame => this.urlForFrame(frame))\n        const needed = urls.filter(url => deleting.has(url))\n        needed.forEach(url => { deleting.delete(url) })\n      })\n    }\n    deleting.forEach(url => { Cache.remove(url) })\n  }\n\n  url : string\n\n  private urlForFrame(frame : number) : string {\n    let s = String((frame * this.increment) + this.begin)\n    if (this.padding) s = s.padStart(this.padding, '0')\n    return urlAbsolute((this.url + this.pattern).replaceAll('%', s))\n  }\n\n  private urls(start : Time, end? : Time) : string[] {\n    return this.framesArray(start, end).map(frame => this.urlForFrame(frame))\n  }\n\n  padding : number\n}\n\nexport { VideoSequenceDefinitionClassImplementation }\n","import { DefinitionType } from \"../../Setup/Enums\"\nimport { Errors } from \"../../Setup/Errors\"\nimport { Is } from \"../../Utilities/Is\"\nimport { Definitions } from \"../../Definitions\"\nimport { Factories } from \"../../Definitions/Factories\"\nimport { VideoSequenceDefinitionClassImplementation } from \"../VideoSequence/VideoSequenceDefinition\"\nimport { VideoSequence, VideoSequenceDefinition, VideoSequenceDefinitionObject, VideoSequenceObject } from \"./VideoSequence\"\n\nconst videoSequenceDefinition = (object : VideoSequenceDefinitionObject) : VideoSequenceDefinition => {\n  const { id } = object\n  if (!(id && Is.populatedString(id))) throw Errors.id + JSON.stringify(object)\n\n  if (Definitions.installed(id)) return <VideoSequenceDefinition> Definitions.fromId(id)\n\n  return new VideoSequenceDefinitionClassImplementation(object)\n}\n\nconst videoSequenceDefinitionFromId = (id : string) : VideoSequenceDefinition => {\n  return videoSequenceDefinition({ id })\n}\n\nconst videoSequenceInstance = (object : VideoSequenceObject) : VideoSequence => {\n  const definition = videoSequenceDefinition(object)\n  const instance = definition.instanceFromObject(object)\n  return instance\n}\n\nconst videoSequenceFromId = (id : string) : VideoSequence => {\n  return videoSequenceInstance({ id })\n}\n\nconst videoSequenceInitialize = () : void => {}\n\nconst videoSequenceDefine = (object : VideoSequenceDefinitionObject) : VideoSequenceDefinition => {\n  const { id } = object\n  if (!(id && Is.populatedString(id))) throw Errors.id + JSON.stringify(object)\n\n  Definitions.uninstall(id)\n  return videoSequenceDefinition(object)\n}\n\n\n/**\n * @internal\n */\nconst videoSequenceInstall = (object: VideoSequenceDefinitionObject): VideoSequenceDefinition => {\n  const instance = videoSequenceDefine(object)\n  instance.retain = true\n  return instance\n}\n\nconst VideoSequenceFactoryImplementation = {\n  define: videoSequenceDefine,\n  install: videoSequenceInstall,\n  definition: videoSequenceDefinition,\n  definitionFromId: videoSequenceDefinitionFromId,\n  fromId: videoSequenceFromId,\n  initialize: videoSequenceInitialize,\n  instance: videoSequenceInstance,\n}\n\nFactories[DefinitionType.VideoSequence] = VideoSequenceFactoryImplementation\n\nexport {\n  videoSequenceInstall,\n  videoSequenceDefine,\n  videoSequenceDefinition,\n  videoSequenceDefinitionFromId,\n  VideoSequenceFactoryImplementation,\n  videoSequenceFromId,\n  videoSequenceInitialize,\n  videoSequenceInstance,\n}\n","import {\n  Any,\n  LoadPromise,\n  SelectionValue,\n  ScalarValue,\n  UnknownObject,\n  ContextData,\n  Size,\n} from \"../declarations\"\nimport {\n  ActionType,\n  ClipType,\n  ClipTypes,\n  DefinitionType,\n  EventType,\n  MasherAction,\n  MoveType,\n  TrackType,\n  TransformType,\n  TransformTypes,\n} from \"../Setup/Enums\"\nimport { Errors } from \"../Setup/Errors\"\nimport { Is, isPopulatedObject } from \"../Utilities/Is\"\nimport { sortByFrame } from \"../Utilities/Sort\"\nimport { Time } from \"../Utilities/Time\"\nimport { TimeRange } from \"../Utilities/TimeRange\"\nimport { Action } from \"../Editing/Action/Action\"\nimport { ActionFactory } from \"../Editing/Action/ActionFactory\"\nimport { ChangeAction } from \"../Editing/Action/ChangeAction\"\nimport { Actions } from \"../Editing/Actions\"\nimport { Factory } from \"../Definitions/Factory/Factory\"\nimport { DefinitionObject, DefinitionTimes } from \"../Base/Definition\"\nimport { Definitions } from \"../Definitions\"\nimport { Effect } from \"../Mash/Effect/Effect\"\nimport { EffectClass } from \"../Mash/Effect/EffectInstance\"\nimport { Mash } from \"../Mash/Mash/Mash\"\nimport { AudibleFile } from \"../Mixin/AudibleFile/AudibleFile\"\nimport { Clip } from \"../Mixin/Clip/Clip\"\nimport { Transformable } from \"../Mixin/Transformable/Transformable\"\nimport { Video } from \"../Mash/Video/Video\"\nimport { ClipOrEffect, Masher, MasherAddPromise, MasherObject, Selection } from \"./Masher\"\nimport { Default } from \"../Setup/Default\"\nimport { Cache } from \"../Loading/Cache\"\nimport { Emitter } from \"../Utilities/Emitter\"\nimport { MashFactory } from \"../Mash/Mash/MashFactory\"\nimport { Track } from \"../Mash/Track/Track\"\n\n\nclass MasherClass implements Masher {\n  [index : string] : unknown\n  constructor(...args: Any[]) {\n\n    const [object] = args\n    const {\n      autoplay,\n      precision,\n      loop,\n      fps,\n      volume,\n      buffer,\n      mash,\n    } = <MasherObject> object\n    if (typeof autoplay !== \"undefined\") this.autoplay = autoplay\n    if (typeof precision !== \"undefined\") this.precision = precision\n    if (typeof loop !== \"undefined\") this._loop = loop\n    if (typeof fps !== \"undefined\") this._fps = fps\n    if (typeof volume !== \"undefined\") this._volume = volume\n    if (typeof buffer !== \"undefined\") this._buffer = buffer\n    if (mash) this.mash = mash\n\n\n  }\n\n  private actionCreate(object : UnknownObject) : void {\n    const mash = object.mash || this.mash\n    const actions = object.actions || this.actions\n    const undoSelection = object.undoSelection || { ...this.selection }\n    const redoSelection = object.redoSelection  || { ...this.selection }\n\n    const clone : UnknownObject = {\n      ...object,\n      actions,\n      mash,\n      undoSelection,\n      redoSelection,\n    }\n    const action = ActionFactory.createFromObject(clone)\n    this.actions.add(action)\n    this.handleAction(this.actions.redo())\n  }\n\n  private _actions? : Actions\n\n  private get actions() : Actions {\n    if (!this._actions) {\n      this._actions = new Actions({ mash: this.mash })\n    }\n    return this._actions\n  }\n\n\n  add(object : DefinitionObject, frameOrIndex = 0, trackIndex = 0) : MasherAddPromise {\n    if (!Is.populatedObject(object)) throw Errors.argument + 'add'\n    const { id } = object\n    const definitionFromId = id && Definitions.installed(id) ? Definitions.fromId(id) : false\n    const type = object.type || (definitionFromId && definitionFromId.type)\n    if (!type) throw Errors.type + 'Masher.add ' + id + JSON.stringify(definitionFromId)\n\n    if (type === DefinitionType.Effect) {\n      const effectDefinition = Factory.effect.definition(object)\n      const effect = effectDefinition.instance\n      return this.addEffect(effect, frameOrIndex).then(() => effect)\n    }\n    const clipType = <ClipType> type\n\n    if (!ClipTypes.includes(clipType)) throw Errors.type + type\n\n    const definitionType = <DefinitionType> type\n    const definition = Factory[definitionType].definition(object)\n\n    const clip = <Clip> definition.instance //FromObject(object)\n\n    return this.addClip(clip, frameOrIndex, trackIndex).then(() => clip)\n  }\n\n  addClip(clip : Clip, frameOrIndex = 0, trackIndex = 0) : LoadPromise {\n    const { trackType } = clip\n\n    const clips = [clip]\n    const options : UnknownObject = {\n      clip,\n      type: ActionType.AddClipsToTrack,\n      redoSelection: { clip: clip },\n      trackType,\n    }\n    const tracksOfType = this.mash.tracks.filter(track => track.trackType === trackType)\n    const track = tracksOfType[trackIndex]\n    const trackCount = tracksOfType.length\n    if (track.dense) {\n      options.insertIndex = frameOrIndex\n      options.createTracks = Math.min(1, Math.max(0, 1 - trackCount))\n    } else {\n      options.trackIndex = trackIndex\n      clip.frame = track.frameForClipsNearFrame(clips, frameOrIndex)\n      options.createTracks = Math.max(0, trackIndex + 1 - trackCount)\n    }\n    this.actionCreate(options)\n    return this.loadMashAndDraw()\n  }\n\n  addEffect(effect : Effect, insertIndex = 0) : LoadPromise {\n    // console.log(this.constructor.name, \"addEffect\", object, index)\n    const { clip } = this.selection\n    if (!clip) throw Errors.selection\n\n    const { effects } = <Transformable> clip\n    if (!effects) throw Errors.selection\n\n    const undoEffects = [...effects]\n    const redoEffects = [...effects]\n    const redoSelectedEffects = [effect]\n    redoEffects.splice(insertIndex, 0, effect)\n    const options = {\n      effects,\n      undoEffects,\n      redoEffects,\n      redoSelectedEffects,\n      type: ActionType.MoveEffects\n    }\n    this.actionCreate(options)\n    return this.loadMashAndDraw()\n  }\n\n  addTrack(trackType = TrackType.Video) : void {\n    this.actionCreate({ trackType, type: ActionType.AddTrack })\n  }\n\n  autoplay = Default.masher.autoplay\n\n  private _buffer = Default.masher.buffer\n\n  get buffer() : number { return this._buffer }\n\n  set buffer(value: number) {\n    const number = Number(value)\n    if (this._buffer !== number) {\n      this._buffer = number\n      this.mash.buffer = number\n    }\n  }\n\n  can(method : MasherAction) : boolean {\n    // const z = this._selectedClips.length\n    const { track, clip, effect } = this.selection\n    switch (method) {\n      case MasherAction.Save: return this.actions.canSave\n      case MasherAction.Undo: return this.actions.canUndo\n      case MasherAction.Redo: return this.actions.canRedo\n      case MasherAction.Remove: return !!(\n        effect\n        || clip\n        || (track && this.mash.trackCount(track.trackType) === track.layer + 1)\n      )\n      case MasherAction.Split: return !!clip && this.clipCanBeSplit(clip, this.time, this.mash.quantize)\n      case MasherAction.Freeze: return (\n        !!clip\n        && DefinitionType.Video === clip.type\n        && this.clipCanBeSplit(clip, this.time, this.mash.quantize)\n      )\n      default: throw Errors.argument\n    }\n  }\n\n  change(property: string, value?: SelectionValue): void {\n    if (this.selection.track) {\n      if (this.selection.clip) {\n        if (this.selection.effect) {\n          this.changeEffect(property, value, this.selection.effect)\n        } else this.changeClip(property, value, this.selection.clip)\n      } else this.changeTrack(property, value, this.selection.track)\n    } else throw Errors.selection\n    //else this.changeMash(property, value)\n  }\n\n  changeClip(property : string, value? : SelectionValue, clip? : Clip) : void {\n    // console.log(this.constructor.name, \"changeClip\", property)\n    if (!Is.populatedString(property)) throw Errors.property + \"changeClip \" + property\n\n    const [transform, transformProperty] = property.split(\".\")\n    if (transformProperty) {\n      this.changeTransformer(transform, transformProperty, value)\n      return\n    }\n    const target = clip || this.selection.clip\n    if (!target) throw Errors.selection\n\n    const redoValue = typeof value === \"undefined\" ? target.value(property) : value\n\n    if (this.currentActionReusable(target, property)) {\n      const changeAction = <ChangeAction> this.actions.currentAction\n      changeAction.updateAction(<ScalarValue> redoValue)\n      this.handleAction(changeAction)\n      return\n    }\n    const undoValue = target.value(property) //typeof value === \"undefined\" ? this.pristineOrThrow[property] : target.value(property)\n    const options : UnknownObject = { property, target, redoValue, undoValue }\n\n    switch (options.property) {\n      case 'frames': {\n        options.type = ActionType.ChangeFrames\n        break\n      }\n      case 'trim': {\n        options.type = ActionType.ChangeTrim\n        // TODO: make sure there's a test for this\n        // not sure where this was derived from - using original clip??\n        options.frames = target.frames + <number> options.undoValue\n        break\n      }\n      default: options.type = ActionType.Change\n    }\n    this.actionCreate(options)\n  }\n\n  changeEffect(property : string, value? : SelectionValue, effect? : Effect) : void {\n    // console.log(this.constructor.name, \"changeEffect\", property)\n    if (!Is.populatedString(property)) throw Errors.property\n\n    const target = effect || this.selection.effect\n    if (!target) throw Errors.selection\n\n    const redoValue = typeof value === \"undefined\" ? target.value(property) : value\n\n    if (this.currentActionReusable(target, property)) {\n      const changeAction = <ChangeAction> this.actions.currentAction\n      changeAction.updateAction(redoValue)\n      this.handleAction(changeAction)\n      return\n    }\n    const undoValue = target.value(property) // typeof value === \"undefined\" ? this.pristineEffectOrThrow[property] : target.value(property)\n    const options = {\n      type: ActionType.Change, target, property, redoValue, undoValue\n    }\n    this.actionCreate(options)\n  }\n\n  changeTrack(property: string, value?: SelectionValue, track?: Track): void {\n    if (!Is.populatedString(property)) throw Errors.property\n\n    const target = track || this.selection.track\n    if (!target) throw Errors.selection\n\n    const redoValue = typeof value === \"undefined\" ? target.value(property) : value\n    if (this.currentActionReusable(target, property)) {\n      const changeAction = <ChangeAction> this.actions.currentAction\n      changeAction.updateAction(redoValue)\n      this.handleAction(changeAction)\n      return\n    }\n    const undoValue = target.value(property) // typeof value === \"undefined\" ? this.pristineEffectOrThrow[property] : target.value(property)\n    const options = {\n      type: ActionType.Change, target, property, redoValue, undoValue\n    }\n    this.actionCreate(options)\n  }\n\n  changeTransformer(type : string, property : string, value?: SelectionValue) : void {\n    // console.log(this.constructor.name, \"changeTransformer\", type, property)\n    if (!Is.populatedString(type)) throw Errors.type + \"changeTransformer \" + type\n    if (!Is.populatedString(property)) throw Errors.property + \"changeTransformer \" + property\n    // if (!this._pristine) throw Errors.internal + \"changeTransformer _pristine\"\n\n    const target = this.selection.clip\n    if (!target) throw Errors.selection\n\n    const transformType = <TransformType> type\n\n    const transformable = <Transformable> target\n\n    // make sure first component is merger or scaler\n    if (!TransformTypes.includes(transformType)) throw Errors.property + \"type \" + type\n    const transformTarget = transformable[transformType]\n    const redoValue = typeof value === \"undefined\" ? transformTarget.value(property)  : value\n    // const pristineTarget = this._pristine[transformType] ! replaced with transformTarget\n    if (typeof transformTarget !== \"object\") throw Errors.internal + JSON.stringify(this._pristine)\n\n    const undoValue = transformTarget[property]\n    if (typeof undoValue === \"undefined\") throw Errors.property + 'pristine ' + property + JSON.stringify(transformTarget)\n\n    const options : UnknownObject = { property, target: transformTarget, redoValue, undoValue, type: ActionType.Change }\n\n\n    if (this.currentActionReusable(transformTarget, property)) {\n      const changeAction = <ChangeAction> this.actions.currentAction\n      changeAction.updateAction(redoValue)\n      this.handleAction(changeAction)\n      return\n    }\n    this.actionCreate(options)\n  }\n\n  private clipCanBeSplit(clip : Clip, time : Time, quantize : number) : boolean {\n    if (!Is.object(clip)) return false\n\n    // true if now intersects clip time, but is not start or end frame\n    const range = TimeRange.fromTime(time)\n    const clipRange = clip.timeRange(quantize)\n\n    // ranges must intersect\n    if (!clipRange.intersects(range)) return false\n\n    const scaled = range.scale(clipRange.fps)\n    if (scaled.frame === clipRange.frame) return false\n    if (scaled.end === clipRange.end) return false\n\n    return true\n  }\n\n  get clips(): Clip[] { return this.mash.clips }\n\n  private currentActionReusable(target : unknown, property : string) : boolean {\n    if (!this.actions.currentActionLast) return false\n\n    const action = this.actions.currentAction\n    if (!(action instanceof ChangeAction)) return false\n\n    return action.target === target && action.property === property\n  }\n\n  get currentTime() : number { return this.mash.drawnTime ? this.mash.drawnTime.seconds : 0 }\n\n  get duration() : number { return this.mash.duration }\n\n  private get endTime() : Time { return this.mash.endTime.scale(this.fps, 'floor') }\n\n  eventTarget  = new Emitter()\n\n  private filterClipSelection(value : Clip | Clip[]) : Clip[] {\n    const clips : Clip[] = Array.isArray(value) ? value : [value]\n\n    const [firstClip] = clips\n    if (!firstClip) return []\n\n    const { trackType, track } = firstClip\n\n    //  must all be on same track\n    const trackClips = clips.filter(clip => (\n      clip.track === track && clip.trackType === trackType\n    )).sort(sortByFrame)\n\n    if (track || trackType === TrackType.Audio) return trackClips\n\n    // must be abutting each other on main track\n    let abutting = true\n    return trackClips.filter((clip : Clip, index : number) => {\n      if (!abutting) return false\n\n      if (index === trackClips.length - 1) return true\n\n      abutting = clip.frame + clip.frames === trackClips[index + 1].frame\n      return true\n    })\n  }\n\n  private _fps = Default.masher.fps\n\n  get fps() : number { return this._fps || this.mash.quantize }\n\n  set fps(value: number) {\n    const number = Number(value)\n    // setting to zero means fallback to mash rate\n    if (this._fps !== number) {\n      this._fps = number\n      this.eventTarget.emit(EventType.Fps)\n      this.time = this.time.scale(this.fps)\n    }\n  }\n\n  get frame() : number { return this.time.frame }\n\n  set frame(value : number) { this.goToTime(Time.fromArgs(Number(value), this.fps)) }\n\n  get frames() : number { return this.endTime.frame }\n\n  freeze() : void {\n    const { clip } = this.selection\n    if (!clip) throw Errors.selection\n\n    if (!this.clipCanBeSplit(clip, this.time, this.mash.quantize)) {\n      throw Errors.invalid.action\n    }\n    if (DefinitionType.Video !== clip.type) {\n      throw Errors.invalid.action\n    }\n    const freezeClip = <Video> clip\n    const scaled = this.time.scale(this.mash.quantize)\n    const trackClips = this.mash.clipTrack(freezeClip).clips\n    const insertClip = freezeClip.copy\n    const frozenClip = freezeClip.copy\n\n    const options = {\n      frames: freezeClip.frames - (scaled.frame - freezeClip.frame),\n      freezeClip,\n      frozenClip,\n      insertClip,\n      trackClips,\n      redoSelection: { clip: frozenClip },\n      index: 1 + trackClips.indexOf(freezeClip),\n      type: ActionType.Freeze,\n    }\n\n    frozenClip.frame = scaled.frame\n    frozenClip.frames = 1\n    frozenClip.trim = freezeClip.trim + (scaled.frame - freezeClip.frame)\n    insertClip.frame = scaled.frame + 1\n    insertClip.frames = options.frames - 1\n    insertClip.trim = frozenClip.trim + 1\n\n    this.actionCreate(options)\n  }\n\n  private get gain() : number { return this.muted ? 0.0 : this.volume }\n\n  goToTime(value?: Time): LoadPromise {\n    const { fps } = this\n    const time = value ? value.scaleToFps(fps) : Time.fromArgs(0, fps)\n    const min = time.min(this.endTime)\n    if (value && min.equalsTime(this.time)) return Promise.resolve()\n\n    const promise = this.mash.seekToTime(min)\n    if (promise) return promise\n\n    return Promise.resolve()\n  }\n\n  private handleAction(action: Action): void {\n    this.selection = action.selection\n    this.mash.handleAction(action)\n  }\n\n  get imageData() : ContextData { return Cache.visibleContext.imageData }\n\n  get imageSize() : Size { return Cache.visibleContext.size }\n\n  set imageSize(value : Size) {\n    const { width, height } = value\n    if (!(Is.aboveZero(width) && Is.aboveZero(height))) throw Errors.invalid.size\n\n    Cache.visibleContext.size = value\n    this.loadMashAndDraw()\n  }\n\n  private loadMashAndDraw(): LoadPromise {\n    const promise = this.mash.loadPromise\n    if (promise) return promise.then(() => {\n      this.mash.compositeVisible()\n    })\n\n    this.mash.compositeVisible()\n    return Promise.resolve()\n  }\n\n  get loadedDefinitions() : DefinitionTimes { return this.mash.loadedDefinitions }\n\n  private _loop = Default.masher.loop\n\n  get loop() : boolean { return this._loop }\n\n  set loop(value: boolean) {\n    const boolean = !!value\n    this._loop = boolean\n    if (this._mash) this.mash.loop = boolean\n  }\n\n  private _mash? : Mash\n\n  get mash() : Mash {\n    if (this._mash) return this._mash\n\n    const instance = MashFactory.instance()\n    this.mash =instance\n    return instance\n  }\n\n  set mash(object: Mash) {\n    if (this._mash === object) return\n    this.paused = true\n    if (this._mash) this._mash.destroy()\n\n    this._selectedEffects = []\n    this._mash = object\n    this._mash.buffer = this.buffer\n    this._mash.gain = this.gain\n    this._mash.loop = this.loop\n    this._mash.emitter = this.eventTarget\n    if (this._actions) {\n      this._actions.destroy()\n      this._actions.mash = this._mash\n    }\n\n    this.selectedClips = [] // so mash gets copied into _pristine\n\n    this.eventTarget.emit(EventType.Mash)\n    this.eventTarget.emit(EventType.Track)\n    this.eventTarget.emit(EventType.Duration)\n    this.eventTarget.emit(EventType.Action)\n\n    this.goToTime()\n    if (this.autoplay) this.paused = false\n  }\n\n  move(objectOrArray : ClipOrEffect | ClipOrEffect[], moveType : MoveType, frameOrIndex = 0, trackIndex = 0) : void {\n    if (!Is.object(objectOrArray)) throw Errors.argument + 'move'\n\n    if (moveType === MoveType.Effect) {\n      this.moveEffects(<Effect | Effect[]> objectOrArray, frameOrIndex)\n      return\n    }\n\n    this.moveClips(<Clip | Clip[]>objectOrArray, frameOrIndex, trackIndex)\n  }\n\n  moveClips(clipOrArray : Clip | Clip[], frameOrIndex = 0, trackIndex = 0) : void {\n    // console.log(\"moveClips\", \"frameOrIndex\", frameOrIndex, \"trackIndex\", trackIndex)\n    if (!Is.positive(frameOrIndex)) throw Errors.argument + 'moveClips frameOrIndex'\n    if (!Is.positive(trackIndex)) throw Errors.argument + 'moviClips trackIndex'\n\n    const clips = this.filterClipSelection(clipOrArray)\n    if (!Is.populatedArray(clips)) throw Errors.argument + 'moveClips clips'\n\n    const [firstClip] = clips\n    const { trackType, track: undoTrackIndex } = firstClip\n    const options : Any = {\n      clips,\n      trackType,\n      trackIndex,\n      undoTrackIndex,\n      type: ActionType.MoveClips\n    }\n\n    const redoTrack = this.mash.trackOfTypeAtIndex(trackType, trackIndex)\n    const undoTrack = this.mash.trackOfTypeAtIndex(trackType, undoTrackIndex)\n    const currentIndex = redoTrack.clips.indexOf(firstClip)\n\n    if (redoTrack.dense) options.insertIndex = frameOrIndex\n    if (undoTrack.dense) {\n      options.undoInsertIndex = currentIndex\n      if (frameOrIndex < currentIndex) options.undoInsertIndex += clips.length\n    }\n\n    if (!(redoTrack.dense && undoTrack.dense)) {\n      const frames = clips.map(clip => clip.frame)\n      const insertFrame = redoTrack.frameForClipsNearFrame(clips, frameOrIndex)\n      const offset = insertFrame - firstClip.frame\n      if (!offset) return // because there would be no change\n\n      options.undoFrames = frames\n      options.redoFrames = frames.map(frame => frame + offset)\n    }\n    this.actionCreate(options)\n  }\n\n  moveEffects(effectOrArray : Effect | Effect[], index = 0) : void {\n    // console.log(this.constructor.name, \"moveEffects\", effectOrArray, index)\n    if (!Is.positive(index)) throw Errors.argument\n\n    const array = Array.isArray(effectOrArray) ? effectOrArray : [effectOrArray]\n    const moveEffects = array.filter(effect => effect instanceof EffectClass)\n    if (!Is.populatedArray(moveEffects)) throw Errors.argument\n\n    const { clip } = this.selection\n    if (!clip) throw Errors.selection\n\n\n    const { effects } = <Transformable> clip\n    const undoEffects = [...effects]\n\n    const redoEffects : Effect[] = []\n    undoEffects.forEach((effect, i) => {\n      if (i === index) redoEffects.push(...moveEffects)\n      if (moveEffects.includes(effect)) return\n\n      redoEffects.push(effect)\n    })\n\n    const options = {\n      effects, undoEffects, redoEffects, type: ActionType.MoveEffects\n    }\n    // console.log(this.constructor.name, \"moveEffects\", options)\n    this.actionCreate(options)\n  }\n\n  private _muted = false\n\n  get muted() : boolean { return this._muted }\n\n  set muted(value: boolean) {\n    const boolean = !!value\n    if (this._muted !== boolean) {\n      this._muted = boolean\n      this.mash.gain = this.gain\n    }\n  }\n\n  pause() : void { this.paused = true }\n\n  get paused() : boolean { return this.mash.paused }\n\n  set paused(value : boolean) { if (this._mash) this.mash.paused = !!value }\n\n  play() : void { this.paused = false }\n\n  get position() : number {\n    let per = 0\n    if (this.time.frame) {\n      per = this.time.seconds / this.duration\n      if (per !== 1) per = parseFloat(per.toFixed(this.precision))\n    }\n    return per\n  }\n\n  set position(value : number) {\n    this.goToTime(Time.fromSeconds(this.duration * Number(value), this.fps))\n  }\n\n  get positionStep() : number {\n    return parseFloat(`0.${\"0\".repeat(this.precision - 1)}1`)\n  }\n\n  precision = Default.masher.precision\n\n  redo() : void { if (this.actions.canRedo) this.handleAction(this.actions.redo()) }\n\n  remove(): void {\n    if (this.selection.effect) this.removeEffects(this.selection.effect)\n    else if (this.selection.clip) this.removeClips(this.selection.clip)\n    else if (this.selection.track) this.mash.removeTrack(this.selection.track.trackType)\n    else throw Errors.selection\n  }\n\n  removeClips(clipOrArray : Clip | Clip[]) : void {\n    const clips = this.filterClipSelection(clipOrArray)\n    if (!Is.populatedArray(clips)) throw Errors.argument\n\n    const [firstClip] = clips\n    const track = this.mash.clipTrack(firstClip)\n    const options = {\n      redoSelection: {},\n      clips,\n      track,\n      index: track.clips.indexOf(firstClip),\n      type: ActionType.RemoveClips\n    }\n    this.actionCreate(options)\n  }\n\n  removeEffects(effectOrArray : Effect | Effect[]) : void {\n    const array = Array.isArray(effectOrArray) ? effectOrArray : [effectOrArray]\n    const removeEffects = array.filter(effect => effect instanceof EffectClass)\n    if (!Is.populatedArray(removeEffects)) throw Errors.argument\n\n    const { clip } = this.selection\n    if (!clip) throw Errors.selection\n\n    const { effects } = <Transformable> clip\n    const undoEffects = [...effects]\n    const redoEffects = effects.filter(effect => !removeEffects.includes(effect))\n\n    const options = {\n      redoSelectedEffects: [],\n      effects,\n      undoEffects,\n      redoEffects,\n      type: ActionType.MoveEffects\n    }\n    this.actionCreate(options)\n  }\n\n  save() : void { this.actions.save() }\n\n  selectClip(clip: Clip | undefined): void {\n    const track = clip ? this.mash.clipTrack(clip) : this.selection.track\n    this.selection = { track, clip }\n  }\n\n  selectEffect(effect: Effect | undefined): void {\n    this.selection = { ...this.selection, effect }\n  }\n\n  selectTrack(track: Track | undefined): void {\n    this.selection = { track }\n  }\n\n  private _selection: Selection = {}\n\n  get selection(): Selection { return this._selection }\n\n  set selection(value: Selection) {\n    if (!value) {\n      console.trace(this.constructor.name, \"selection with no value\")\n      throw Errors.internal\n    }\n    const { clip, track, effect } = value\n\n    this.selection.effect = effect\n    this.selection.clip = clip\n    this.selection.track = track || (clip ? this.mash.clipTrack(clip) : undefined)\n    this.eventTarget.emit(EventType.Selection)\n  }\n\n  split() : void {\n    const splitClip = this.selection.clip\n    if (!splitClip) throw Errors.selection\n\n    if (!this.clipCanBeSplit(splitClip, this.time, this.mash.quantize)) {\n      throw Errors.invalid.action\n    }\n\n    const scaled = this.time.scale(this.mash.quantize)\n    const undoFrames = splitClip.frames\n    const redoFrames = scaled.frame - splitClip.frame\n    const insertClip = splitClip.copy\n    insertClip.frames = undoFrames - redoFrames\n    insertClip.frame = scaled.frame\n    if (splitClip.propertyNames.includes(\"trim\")) {\n      (<AudibleFile> insertClip).trim += redoFrames\n    }\n    const trackClips = this.mash.clipTrack(splitClip).clips\n    const options = {\n      type: ActionType.Split,\n      splitClip,\n      insertClip,\n      trackClips,\n      redoFrames,\n      undoFrames,\n      index: 1 + trackClips.indexOf(splitClip),\n      redoSelection: { clip: insertClip },\n      undoSelection: { clip: splitClip },\n    }\n    this.actionCreate(options)\n  }\n\n  get time() : Time { return this.mash.time }\n\n  set time(value: Time) { this.goToTime(value) }\n\n  get timeRange() : TimeRange { return this.mash.timeRange }\n\n  undo() : void { if (this.actions.canUndo) this.handleAction(this.actions.undo()) }\n\n  private _volume = Default.masher.volume\n\n  get volume() : number { return this._volume }\n\n  set volume(value: number) {\n    const number = Number(value)\n    if (this._volume !== number) {\n      if (!Is.positive(number)) throw Errors.invalid.volume\n      this._volume = number\n      if (Is.aboveZero(number)) this.muted = false\n\n      this.mash.gain = this.gain\n    }\n  }\n}\n\nexport { MasherClass }\n","import { Default } from \"../Setup/Default\"\nimport { Definitions } from \"../Definitions/Definitions\"\nimport { Masher, MasherObject } from \"./Masher\"\nimport { MasherClass } from \"./MasherInstance\"\n\nimport { Cache } from \"../Loading/Cache\"\nimport { Interval } from \"../declarations\"\n\nconst MasherFactoryTics = 10 * 1000\nclass MasherFactoryImplementation {\n  private addMasher(masher : Masher): void {\n    if (!this.mashers.length) this.masherStart()\n    this.mashers.push(masher)\n  }\n\n  // call when masher removed\n  destroy(masher : Masher) : void {\n    const index = this.mashers.indexOf(masher)\n    if (index < 0) return\n\n    this.mashers.splice(index, 1)\n    if (!this.mashers.length) this.masherStop()\n  }\n\n  private handleInterval() {\n    const urls = this.mashers.flatMap(masher => masher.mash.loadUrls)\n    Cache.flush(urls)\n\n    const definitions = this.mashers.flatMap(masher => masher.mash.definitions)\n\n    Definitions.map.forEach(definition => {\n      if (definitions.includes(definition) || definition.retain) return\n\n      Definitions.uninstall(definition.id)\n    })\n  }\n\n  instance(object: MasherObject = {}): Masher {\n    object.autoplay ||= Default.masher.autoplay\n    object.precision ||= Default.masher.precision\n    object.loop ||= Default.masher.loop\n    object.fps ||= Default.masher.fps\n    object.volume ||= Default.masher.volume\n    object.buffer ||= Default.masher.buffer\n    const instance = new MasherClass(object)\n    this.addMasher(instance)\n    return instance\n  }\n\n  private interval : Interval | undefined\n\n  private masherStart(): void {\n    if (this.interval) return\n\n    this.interval = setInterval(() => this.handleInterval(), MasherFactoryTics)\n  }\n\n  private masherStop(): void {\n    if (!this.interval) return\n\n    clearInterval(this.interval)\n    this.interval = undefined\n  }\n\n  private mashers : Masher[] = []\n\n}\nconst MasherFactory = new MasherFactoryImplementation()\n\nexport { MasherFactory }\n","import { Factory } from \"../Definitions/Factory\"\nimport { DefinitionTypes } from \"../Setup/Enums\"\n\nDefinitionTypes.forEach(type => { Factory[type].initialize() })\n","\nconst Seconds = (seconds : number, fps : number, duration : number) : string => {\n  let time, pad, do_rest, s = ''\n  if (! duration) duration = seconds\n  time = 60 * 60 // an hour\n  pad = 2\n  if (duration >= time) {\n    if (seconds >= time) {\n      s += String(Math.floor(seconds / time)).padStart(pad, '0')\n      do_rest = true\n      seconds = seconds % time\n    } else s += '00:'\n  }\n  time = 60 // a minute\n  if (do_rest || (duration >= time)) {\n    if (do_rest) s += ':'\n    if (seconds >= time) {\n      s += String(Math.floor(seconds / time)).padStart(pad, '0')\n      do_rest = true\n      seconds = seconds % time\n    } else s += '00:'\n  }\n  time = 1 // a second\n  if (do_rest || (duration >= time)) {\n    if (do_rest) s += ':'\n    if (seconds >= time) {\n      s += String(Math.floor(seconds / time)).padStart(pad, '0')\n      do_rest = true\n      seconds = seconds % time\n    } else s += '00'\n  } else s += '00'\n  if (fps > 1) {\n    if (fps === 10) pad = 1\n    s += '.'\n    if (seconds) {\n      if (pad === 1) seconds = Math.floor(seconds * 10) / 10\n      else seconds = Math.floor(100 * seconds) / 100\n      seconds = Number(String(seconds).substr(2, 2))\n      s += String(seconds).padStart(pad, '0')\n    } else s += '0'.padStart(pad, '0')\n  }\n  return s\n}\n\nexport { Seconds }\n"],"names":["$invalidArgument","$invalidProperty","$internal","Errors","eval","sourceRect","outputSize","conditionTruth","conditionValue","number","get","composition","mashUndefined","audibleContext","mash","action","actions","internal","argument","invalid","canvas","context","definition","duration","audio","url","source","id","object","size","track","trackType","name","value","type","property","factory","volume","selection","unknown","merger","effect","filter","font","scaler","mode","uncached","array","media","frame","frames","fps","seconds","time","timeRange","mainTrackOverlap","unknownMash","unimplemented","wrongClass","objectType","stringType","undefinedType","numberType","booleanType","methodType","isDefined","isNan","Number","isNaN","isInteger","isFloat","isPositive","isAboveZero","isNumber","isArray","Array","length","isPopulatedString","String","isPopulatedObject","Object","keys","isPopulatedArray","Is","aboveZero","boolean","defined","float","integer","method","nan","populatedArray","populatedObject","populatedString","positive","string","undefined","idGenerate","components","idPrefix","push","Date","now","toString","Math","random","substr","join","idPrefixSet","prefix","Id","generate","prefixSet","ActionType","TrackType","TrackTypes","values","ClipType","ClipTypes","DefinitionType","DefinitionTypes","EventType","ModuleType","ModuleTypes","LoadType","MoveType","DataType","DataTypes","TransformType","TransformTypes","MasherAction","MasherActions","CommandType","CommandTypes","OutputFormat","OutputFormats","TypeValue","[object Object]","identifier","label","this","rgbValue","min","max","floor","rgbNumeric","rgb","r","g","b","yuvNumeric","y","u","v","colorYuv2rgb","yuv","floats","colorRgb2hex","colorYuvBlend","yuvs","match","blend","diff","blendYuv","forEach","yuvObject","numericYuv","du","dv","sqrt","colorRgb2yuv","ints","colorStrip","color","toLowerCase","replaceAll","colorValid","colorStripped","style","Option","styleStripped","startsWith","colorTransparent","Color","valid","yuvBlend","rgb2yuv","yuv2rgb","rgb2hex","transparent","strip","DefinitionsMap","Map","DefinitionsByType","definitionsByType","list","definitionsList","set","definitionsClear","clear","definitionsFont","Font","definitionsFromId","definitionsInstalled","console","trace","definitionsInstall","has","definitionsMerger","Merger","definitionsScaler","Scaler","definitionsUninstall","delete","definitions","index","indexOf","splice","Definitions","byType","fromId","install","installed","map","uninstall","Type","modular","JSON","stringify","Boolean","Fontsize","Pixel","Integer","round","Rgb","Rgba","Direction4","Direction8","Mode","find","Types","entries","entry","key","dataType","includes","propertyTypes","instance","propertyType","isObject","dataTypesJson","Property","custom","PropertiedClass","_args","properties","_properties","coerced","coerce","error","constructor","InstanceBase","args","super","definitionId","definitionObject","_id","_label","copy","instanceFromObject","toJSON","quantize","scaleToFps","propertyNames","propertyValues","fromEntries","DefinitionBase","icon","instanceObject","_quantize","_start","_end","propertiesModular","_times","Factories","AudibleContext","sourcesByClipId","_context","Klass","AudioContext","window","webkitAudioContext","createBuffer","buffer","sourceNode","createBufferSource","createGain","currentTime","Promise","resolve","reject","decodeAudioData","audioData","getSource","gainSource","gainNode","disconnect","destination","stop","clipId","start","offset","loops","loop","connect","addSource","Point0","x","VisibleContext","context2d","_context2d","alpha","globalAlpha","getContext","clearSize","clearRect","rect","width","height","composite","globalCompositeOperation","globalThis","document","createElement","dataUrl","toDataURL","drawAtPoint","point","drawImage","fill","drawFillToSize","fillOriginal","fillRect","drawFillInRect","data","drawImageDataAtPoint","putImageData","inRect","fromRect","xIn","yIn","wIn","hIn","w","h","sourceWidth","sourceHeight","drawInRectFromRect","inSize","fromSize","text","drawTextAtPoint","family","shadow","shadowPoint","fontOriginal","shadowOriginal","shadowPointOriginal","fillText","drawInRect","original","result","draw","fillStyle","imageData","imageDataFromSize","imageDataFresh","createImageData","getImageData","imageDataFromRect","drawingSource","shadowColor","shadowOffsetX","shadowOffsetY","ContextTypes","ContextType","ContextFactory","visible","types","sortByFrame","a","sortByLayer","layer","sortByTrack","sortByLabel","Sort","byFrame","byLabel","byTrack","byLayer","TrackClass","Video","clips","dense","clip","clipWithTrack","insertIndex","clipIndex","origIndex","movingClips","spliceClips","moving","sortClips","others","endFrame","startFrame","lastFrame","i","isTransition","Transition","sort","TrackFactory","Factory","static","Audio","Effect","Filter","Image","Theme","VideoSequence","VideoStream","Action","redoSelection","undoSelection","redoAction","done","undoAction","Capitalize","toUpperCase","AddTrackAction","addTrack","removeTrack","AddClipToTrackAction","createTracks","trackIndex","trackOfTypeAtIndex","addClipsToTrack","removeClipsFromTrack","MoveClipsAction","redoFrames","undoFrames","undoInsertIndex","undoTrackIndex","addClips","AddEffectAction","effects","ChangeAction","redoValue","target","undoValue","redoValueNumeric","undoValueNumeric","setValue","redo","ChangeFramesAction","changeClipFrames","ChangeTrimAction","audibleClip","changeClipTrimAndFrames","SplitAction","insertClip","splitClip","trackClips","FreezeAction","freezeClip","frozenClip","MoveEffectsAction","redoEffects","undoEffects","RemoveClipsAction","classes","AddTrack","AddClipsToTrack","MoveClips","AddEffect","Change","ChangeFrames","ChangeTrim","Split","Freeze","MoveEffects","RemoveClips","ActionFactory","ElementScrollProps","elementScrollMetrics","element","getComputedStyle","getPropertyValue","slice","scrollLeft","scrollTop","getBoundingClientRect","Element","scrollMetrics","Emitter","EventTarget","dispatchEvent","CustomEvent","KEYS_SIZED","KEYS_GETTERS","KEYS","$evaluator","conditionalExpression","conditional","condition","is","elements","in","split","arrayFromElements","strings","Evaluator","mergeContext","ceil","setInputSize","conditionals","trueConditional","expression","replaceOperators","evaluateExpression","lengthSeconds","conditionalValue","script","replaceKeys","Function","exception","bind","inputSize","Set","mm_dimensions","mm_width","mm_height","mm_duration","mm_fps","proud","sized","mm_t","position","expressions","RegExp","regExp","vertical","scale","parseFloat","sizedKey","sizedValue","scaled","otherSizedKey","abs","otherValue","other","t","roundMethod","rounding","roundWithMethod","func","Round","withMethod","pixelRgbaAtIndex","pixels","pixelSafe","pixel","offsetPoint","pt","pixelToPoint","pixelFromPoint","pixelNeighboringRgbas","halfSize","depth","pixelNeighboringPixels","p","pixelToIndex","pixelRgba","pixelColor","pixelPerFrame","zoom","widthFrames","pixelFromFrame","perFrame","pixelToFrame","fromFrame","neighboringRgbas","rgbaAtIndex","toFrame","timeEqualizeRates","time1","time2","gcf","fps1","fps2","greatestCommonDenominator","Time","description","scaleToTime","subtracted","rounded","fromArgs","TimeRange","end","endTime","range1","range2","startTime","scaledTime","scaledRange","range","times","from","_","urlRemoteServer","URL","baseURI","protocol","host","pathname","port","urlAbsolute","href","urlForRemoteServer","remoteServer","suffix","bits","Url","absolute","forRemoteServer","Actions","canRedo","instances","canSave","canUndo","currentAction","currentActionLast","remove","undo","Cache","audible","cachedByKey","urlsByKey","getObject","retainUrls","retainKeys","Loader","fetch","then","response","arrayBuffer","blob","reader","FileReader","onload","onerror","readAsArrayBuffer","decode","cached","promiseOrCached","promise","requestUrl","add","processed","_url","AudioLoader","arrayBufferPromiseFromUrl","audioBufferPromiseFromArrayBuffer","catch","FontLoader","FontFace","load","face","fonts","reason","ImageLoader","image","crossOrigin","src","VideoLoader","videoPromiseFromUrl","video","audioBuffer","sequence","videoFromUrl","ondurationchange","videoWidth","videoHeight","LoaderFactory","loader","Default","masher","precision","autoplay","backcolor","gain","output","videoBitrate","audioBitrate","audioCodec","videoCodec","audioChannels","audioFrequency","trim","speed","theme","transition","videosequence","pattern","increment","begin","padding","videostream","AudibleMixin","Base","z","gainPairs","loadedAudible","muted","ClipMixin","dimensions","clipState","inputCommandAtTimeToSize","mashTime","sources","inputSource","filters","definitionTime","withFrame","loadDefinition","definitionUrls","_trim","AudibleFileMixin","trimTime","space","AudioWithAudibleFile","AudioClass","ClipPropertyObjects","ClipDefinitionMixin","_duration","fromSeconds","AudibleDefinitionMixin","stream","waveform","urlAudible","absoluteUrl","caching","loadUrl","unload","some","maybePair","AudibleFileDefinitionMixin","AudioDefinitionWithAudibleFile","AudioDefinitionClass","audioObject","audioDefinition","audioDefinitionFromId","audioInstance","audioFromId","audioInitialize","audioDefine","audioInstall","retain","AudioFactoryImplementation","define","definitionFromId","initialize","Parameter","FilterClass","parameters","parameter","evaluator","scopeSet","evaluated","evaluatedValue","evaluate","input","FilterDefinitionClass","_evaluator","_evaluated","BlendFilter","modes","all_mode","drawWithComposite","ChromaKeyFilter","accurate","similarity","colors","f","pixelsRgb","pixelsYuv","yuvsFromPixelsAccurate","yuvsFromPixels","reverse","matrix","drawImageData","ColorFilter","drawFill","options","ColorChannelMixerFilter","rgbas","first","second","rr","rg","rb","ra","gr","gg","gb","ga","br","bg","bb","ba","ar","ag","ab","aa","RBGA","ConvolutionFilter","bias","rdiv","channel","parseInt","parse","inputData","outputData","area","sum","CropFilter","out_w","out_h","drawing","toSize","drawInRectFromSize","DrawBoxFilter","FontClass","FontDefinitionClass","fontDefaultId","fontDefinition","idString","fontDefinitionFromId","fontInstance","fontFromId","fontInitialize","fontDefaultJson","fontDefine","FontFactoryImplementation","mmFontFile","mmTextFile","mmFontFamily","DrawTextFilter","fontface","fontsize","fontcolor","textfile","shadowcolor","shadowx","shadowy","textStyle","outWidth","outHeight","FadeFilter","typedAlpha","drawWithAlpha","OverlayFilter","ScaleFilter","drawInSizeFromSize","SetSarFilter","sar","filterDefinition","filterDefinitionFromId","filterInstance","filterFromId","filterInitialize","filterDefine","FilterFactoryImplementation","ModularDefinitionMixin","propertyInstances","propertyObject","assign","filterInstances","outContext","contextFiltered","drawFilter","mergerContext","propertiesCustom","inputFilter","ModularMixin","constructProperties","modularDefinitions","promises","all","flatMap","EffectWithModular","EffectClass","EffectDefinitionWithModular","EffectDefinitionClass","effectDefinition","effectDefinitionFromId","effectInstance","effectFromId","effectInitialize","effectBlurJson","effectChromaKeyJson","effectEmbossJson","effectGrayscaleJson","effectSepiaJson","effectSharpenJson","effectTextJson","effectDefine","EffectFactoryImplementation","MergerWithModular","MergerClass","MergerDefinitionWithModular","MergerDefinitionClass","mergerDefaultId","mergerDefinition","mergerDefinitionFromId","mergerInstance","mergerFromId","mergerInitialize","mergerBlendJson","mergerCenterJson","mergerConstrainedJson","mergerDefaultJson","mergerOverlayJson","mergerDefine","MergerFactoryImplementation","ScalerWithModular","ScalerClass","ScalerDefinitionWithModular","ScalerDefinitionClass","scalerDefaultId","scalerDefinition","scalerDefinitionFromId","scalerInstance","scalerFromId","scalerInitialize","scalerDefaultJson","scalerPanJson","scalerScaleJson","scalerDefine","ScalerFactoryImplementation","TransformableMixin","effectInstances","scaledCommand","scaledCommandAtTimeToSize","clipTimeRange","timeRangeRelative","every","inputFilters","scaledContext","scaledContextAtTimeToSize","drawFilters","effected","effectedCommandAtTimeToSize","loadClip","loadTransformable","loadModular","effectedContextAtTimeToSize","command","commandAtTimeToSize","contextAtTimeToSize","VisibleMixin","_dimensions","loadedVisible","_time","ImageWithTransformable","ImageClass","VisibleDefinitionMixin","ImageDefinitionWithVisible","ImageDefinitionWithTransformable","ImageDefinitionClass","urlVisible","definitionPromise","imageDefinition","imageDefinitionFromId","imageInstance","imageFromId","imageInitialize","imageDefine","imageInstall","ImageFactoryImplementation","Composition","emitter","_gain","timing","startOptions","cancelScheduledValues","pair","linearRampToValueAtTime","createSources","destroySources","drawBackground","clipsByTrack","transitionsByTrack","transitioningTracks","visibleTracks","fromTrack","toTrack","transitioned","fromClip","toClip","mergeClipsIntoContextAtTime","visibleContext","mergeContextAtTime","emit","Draw","requestAnimationFrame","compositeVisible","hasSource","debug","playing","startSeconds","startAt","playingClips","adjustSourceGain","clipsToKeep","deleteSource","Volume","contextSecondsWhenStarted","startedMashAt","bufferSource","stopPlaying","MashClass","createdAt","tracks","rest","_backcolor","trackOptions","assureClipsHaveFrames","trackCount","setDrawInterval","newTrack","clipTrackAtIndex","oldTrack","clipTrack","emitIfFramesChange","removeClips","Track","_composition","_buffer","bufferFrames","_bufferTimer","setInterval","loadPromise","clearInterval","bufferTime","limitedValue","maxFrames","newFrames","drawInterval","intersects","clipsInTracks","objects","clipsVisible","clipsAudible","fromTimes","clipsAudibleInTracks","clipRange","intersectsTime","flat","clipIntersects","filterIntersecting","clipsVideo","clipsVisibleInTimeRange","fromTime","_paused","audibleClips","compositeAudible","clipsVisibleAtTime","compositeVisibleRequest","paused","clearDrawInterval","timeChange","drawnTime","Loaded","performance","drawnSeconds","streamable","clipUrls","nextFrameTime","seekToTime","Ended","compositionTime","drawTime","origFrames","Duration","_emitter","changeAction","stopLoadAndDraw","_playing","drawWhilePlaying","drawWhileNotPlaying","fullRangeClips","clipsAtTimes","fullRange","timeRangeClips","identifiers","ids","addFrames","seqmentsAtTimes","inputCommand","job","outputs","startAndEnd","compositeAudibleClips","loadUrls","loadedDefinitions","definitionTimes","state","loadPromiseAtTimes","mashState","forcedValue","bufferStop","Pause","startContext","bufferStart","Play","clipsAudibleInTimeRange","timeRangeToBuffer","startPlaying","Playing","seeking","seekTime","Seeked","Seeking","handleDrawInterval","stalled","restartAfterStop","tracksOfType","MashFactory","definitionType","ThemeWithTransformable","ThemeClass","urls","modularUrls","transformablePromise","modularPromise","TransformableDefinitionMixin","WithTransformable","ThemeDefinitionClass","themeDefinition","themeDefinitionFromId","themeInstance","themeFromId","themeInitialize","themeColorJson","themeTextJson","themeDefine","ThemeFactoryImplementation","TransitionWithVisible","TransitionClass","drawVisibleFilters","TransitionDefinitionWithVisible","TransitionDefinitionClass","to","toFilters","toMerger","toScaler","fromFilters","fromMerger","fromScaler","sorted","fromDrawing","toDrawing","transitionDefinition","transitionDefinitionFromId","transitionInstance","transitionFromId","transitionInitialize","transitionCrossfadeJson","transitionDefine","TransitionFactoryImplementation","VideoClassImplementation","divide","WithVisible","VideoDefinitionClassImplementation","cachedOrThrow","sourceOrPromise","seekPromise","timesNeeded","needTimes","timesPromise","shift","framePromise","rate","framesPromise","equalsTime","seekNeeded","onseeked","seek","videoDefinition","videoDefinitionFromId","videoInstance","videoFromId","videoInitialize","videoDefine","videoInstall","VideoFactoryImplementation","StreamableMixin","something","VideoStreamClass","StreamableDefinitionMixin","format","WithStreamable","VideoStreamDefinitionClass","videoStreamDefinition","videoStreamDefinitionFromId","videoStreamInstance","videoStreamFromId","videoStreamInitialize","videoStreamDefine","videoStreamInstall","VideoStreamFactoryImplementation","VideoSequenceClassImplementation","VideoSequenceDefinitionClassImplementation","framesMax","framesArray","urlForFrame","clipDefinitionPromise","zeroTime","allUrls","deleting","s","padStart","videoSequenceDefinition","videoSequenceDefinitionFromId","videoSequenceInstance","videoSequenceFromId","videoSequenceInitialize","videoSequenceDefine","videoSequenceInstall","VideoSequenceFactoryImplementation","MasherClass","_loop","_fps","_volume","clone","createFromObject","handleAction","_actions","frameOrIndex","addEffect","clipType","addClip","frameForClipsNearFrame","actionCreate","loadMashAndDraw","redoSelectedEffects","Save","Undo","Redo","Remove","clipCanBeSplit","changeEffect","changeClip","changeTrack","transform","transformProperty","changeTransformer","currentActionReusable","updateAction","transformType","transformable","transformTarget","_pristine","firstClip","abutting","eventTarget","Fps","goToTime","imageSize","_mash","destroy","_selectedEffects","selectedClips","Mash","objectOrArray","moveType","moveClips","moveEffects","clipOrArray","filterClipSelection","redoTrack","undoTrack","currentIndex","effectOrArray","_muted","per","toFixed","positionStep","repeat","removeEffects","save","_selection","Selection","MasherFactory","mashers","masherStart","masherStop","flush","addMasher","interval","handleInterval","pad","do_rest"],"mappings":"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"}