{"version":3,"file":"moviemasher.min.js","sources":["../src/Setup/Default.ts","../src/Setup/Errors.ts","../src/Utilities/Sort.js","../src/Setup/Types.ts","../src/Utilities/Is.js","../src/Setup/Module.ts","../src/Setup/Property.ts","../src/Utilities/Colors.js","../src/Utilities/Context.js","../src/Utilities/Id.js","../src/Utilities/Pixel.js","../src/Utilities/Throw.js","../src/Utilities/Time.js","../src/Factory/TimeFactory.ts","../src/Utilities/TimeRange.js","../src/Utilities/Utilities.js","../src/Base/Base.js","../src/Action/Action.js","../src/Action/AddTrackAction.js","../src/Action/ChangeAction.js","../src/Action/FreezeAction.js","../src/Action/ChangeFramesAction.js","../src/Action/ChangeTrimAction.js","../src/Action/AddEffectAction.js","../src/Action/AddClipToTrackAction.js","../src/Action/MoveClipsAction.js","../src/Clip/with/track.js","../src/Action/RemoveClipsAction.js","../src/Action/SplitAction.js","../src/Action/MoveEffectsAction.js","../src/Actions/Actions.js","../node_modules/tslib/tslib.es6.js","../src/Factory/Factory.ts","../src/Base/with/id.js","../src/Base/with/object.js","../src/Media/with/sharedMedia.js","../src/Base/with/toJSONFromObject.js","../src/Media/with/label.js","../src/Loading/Processor.js","../src/Loading/AudioProcessor.js","../src/Loading/Cache.js","../src/Loading/FontProcessor.js","../src/Loading/ImageProcessor.js","../src/Loading/ModuleProcessor.js","../src/Factory/ProcessorFactory.js","../src/Loading/Loader.js","../src/Loading/AudioLoader.js","../src/Loading/FontLoader.js","../src/Loading/ImageLoader.js","../src/Loading/ModuleLoader.js","../src/Factory/LoaderFactory.js","../src/Loading/UrlsByType.js","../src/Media/with/inaudible.js","../src/Media/with/visibleMedia.js","../src/Media/with/propertiesModular.js","../src/Media/with/modular.js","../src/CoreFilter/CoreFilter.js","../src/CoreFilter/BlendFilter.js","../src/CoreFilter/ChromaKeyFilter.js","../src/CoreFilter/ColorFilter.js","../src/CoreFilter/ColorChannelMixerFilter.js","../src/CoreFilter/ConvolutionFilter.js","../src/CoreFilter/CropFilter.js","../src/CoreFilter/DrawBoxFilter.js","../src/CoreFilter/DrawTextFilter.js","../src/CoreFilter/FadeFilter.js","../src/CoreFilter/OverlayFilter.js","../src/CoreFilter/ScaleFilter.js","../src/CoreFilter/SetSarFilter.js","../src/Factory/FilterFactory.js","../src/Media/with/drawFilters.js","../src/Media/Media.ts","../src/Media/FilterMedia.js","../src/Media/with/parameters.js","../src/Media/with/filters.js","../src/Media/with/html.js","../src/Media/with/urlsFromFilters.js","../src/Media/with/transform.js","../src/Media/EffectMedia.js","../src/Media/ScalerMedia.js","../src/Media/MergerMedia.js","../src/Media/with/modularFalse.js","../src/Media/with/invisible.js","../src/Media/with/duration.js","../src/Media/with/propertiesTiming.js","../src/Media/with/audible.js","../src/Media/with/propertiesAudible.js","../src/Media/with/urlsAudible.js","../src/Media/AudioMedia.js","../src/Media/with/urlAudible.js","../src/Media/FontMedia.js","../src/Media/with/urlAudibleMute.js","../src/Media/with/urlsVisibleFrames.js","../src/Media/VideoMedia.js","../src/Media/with/urlVisible.js","../src/Media/with/urlsVisible.js","../src/Media/ImageMedia.js","../src/Media/ThemeMedia.js","../src/Media/with/urlsNone.js","../src/Media/TransitionMedia.js","../src/Factory/MediaFactory.js","../src/Factory/TimeRangeFactory.js","../src/Clip/with/toJSON.js","../src/Clip/with/id.js","../src/Clip/with/labelFromObjectOrMedia.js","../src/Clip/with/media.js","../src/Clip/with/propertyValues.js","../src/Clip/with/propertiesFromMedia.js","../src/Base/with/editable.js","../src/Clip/with/sharedClip.js","../src/Clip/with/copy.js","../src/Clip/with/load.js","../src/Clip/with/inaudible.js","../src/Clip/with/visibleClip.js","../src/Clip/with/urls.js","../src/Base/with/idMutable.js","../src/Clip/with/urlsFromMedia.js","../src/Transform/with/media.js","../src/Clip/Evaluator.js","../src/Clip/with/evaluator.js","../src/Transform/with/sharedTransform.js","../src/Base/with/copy.js","../src/Transform/with/toJSONTransform.js","../src/Transform/Transform.js","../src/Transform/Merger.js","../src/Transform/with/drawMerger.js","../src/Clip/with/drawMediaFilters.js","../src/Transform/Scaler.js","../src/Transform/Effect.js","../src/Clip/with/transform.js","../src/Clip/with/drawImage.js","../src/Clip/Clip.ts","../src/Decorators/MediaUtilized.ts","../src/Clip/with/mediaTime.js","../src/Clip/ImageClip.js","../src/Clip/with/invisible.js","../src/Clip/with/audible.js","../src/Clip/with/mediaTimeFromTrim.js","../src/Clip/AudioClip.js","../src/Clip/VideoClip.js","../src/Clip/ThemeClip.js","../src/Clip/with/speedOne.js","../src/Clip/TransitionClip.js","../src/Clip/FrameClip.js","../src/Factory/ClipFactory.js","../src/Track/Track.js","../src/Factory/TrackFactory.js","../src/Mash/Mash.ts","../src/Events/Events.js","../src/Base/with/contexts.js","../src/Composition/Composition.js","../src/Factory/ActionFactory.js","../src/Masher/with/deprecated.js","../src/Masher/Masher.js","../src/Factory/MasherFactory.js","../src/index.umd.js"],"sourcesContent":["const Default = {\n  buffer: 10,\n  fps: 30,\n  loop: true,\n  volume: 0.75,\n  precision: 3,\n  autoplay: false,\n  mash: {\n    label: \"Untitled Mash\",\n    quantize: 10,\n    backcolor: \"rgb(0,0,0)\",\n  },\n  media: {\n    frame: { duration: 2 },\n    image: { duration: 2 },\n    theme: { duration: 3 },\n    transition: { duration: 1 },\n  }\n}\n\nexport { Default }\n","const $invalid = \"Invalid\"\nconst $unknown = \"Unknown\"\nconst $expected = \"Expected\"\nconst $invalidArgument = `${$invalid} argument`\nconst $invalidProperty = `${$invalid} property`\nconst $deprecated = \"deprecated in 4.1\"\nconst $internal = \"Internal Error \"\nconst Errors = {\n  mash: `${$expected} mash`,\n  action: `${$expected} Action`,\n  actions: `${$expected} Actions`,\n  internal: $internal,\n  argument: `${$invalidArgument} `,\n  invalid: {\n    track: `${$invalid} track `,\n    trackType: `${$invalid} track type `,\n  },\n  type: `${$invalid} type `,\n  selection: `${$invalid} selection `,\n  unknown: {\n    type: `${$unknown} type `,\n    merger: `${$unknown} merger `,\n    effect: `${$unknown} effect `,\n    filter: `${$unknown} filter `,\n    font: `${$unknown} font `,\n    scaler: `${$unknown} scalar `,\n  },\n  uncached: \"Uncached URL \",\n  object: `${$invalidArgument} object `,\n  array: `${$invalidArgument} array `,\n  media: `${$invalidArgument} media `,\n  id: `${$invalidArgument} id `,\n  frame: `${$invalidArgument} frame `,\n  frames: `${$invalidProperty} frames `,\n  fps: `${$invalidArgument} fps `,\n  seconds: `${$invalidArgument} seconds `,\n  url: `${$invalidArgument} url `,\n  time: `${$invalidArgument} Time`,\n  timeRange: `${$invalidArgument} TimeRange`,\n  mainTrackOverlap: `${$internal}: main track clips overlap without transition`,\n  unknownMash: `${$unknown} Mash property `,\n  property: `${$invalidArgument} property `,\n  deprecation: {\n    property_types: `property_types ${$deprecated} - please get MovieMasher.Property.types instead`,\n    addModulesOfType: `addModulesOfType ${$deprecated} for unsupported type `,\n    configure: {\n      get: `configure ${$deprecated} - please get MovieMasher.defaults instead`,\n      set: `configure ${$deprecated} - please supply mash.quantize and media.duration instead`,\n    },\n    canvas_context: {\n      get: `canvas_context ${$deprecated} - please get videoContext instead`,\n      set: `canvas_context ${$deprecated} - please set videoContext instead`,\n    }\n  },\n  wrongClass: `${$expected} instance of `,\n}\n\nexport { Errors }\n","\n\nconst byFrame = (a, b) => a.frame - b.frame\nconst byTrack = (a, b) => a.track - b.track\nconst byLabel = (a, b) => {\n  if (a.label < b.label) return -1\n  if (a.label > b.label) return 1\n  return 0\n}\n\nconst Sort = {\n  byFrame,\n  byLabel,\n  byTrack,\n}\n\nexport { Sort, byFrame, byLabel, byTrack }\n","const $action = \"action\"\nconst $add = \"add\"\nconst $audio = \"audio\"\nconst $frame = \"frame\"\nconst $duration = \"duration\"\nconst $effect = \"effect\"\nconst $filter = \"filter\"\nconst $font = \"font\"\nconst $image = \"image\"\nconst $load = \"load\"\nconst $merger = \"merger\"\nconst $module = \"module\"\nconst $redo = \"redo\"\nconst $scaler = \"scaler\"\nconst $theme = \"theme\"\nconst $transition = \"transition\"\nconst $truncate = \"truncate\"\nconst $undo = \"undo\"\nconst $video = \"video\"\n\nconst map = (type:string) => [type, type]\n\nconst ClipTypes = [$audio, $video, $image, $theme, $transition, $frame]\nconst ClipType = Object.fromEntries(ClipTypes.map(map))\n\nconst EventTypes = [$action, $load, $duration, $truncate, $add, $undo, $redo]\nconst EventType = Object.fromEntries(EventTypes.map(map))\n\nconst MediaTypes = [\n  $audio, $image, $video,\n  $theme, $transition,\n  $scaler, $merger, $effect,\n  $font, $filter\n]\n\nconst MediaType = Object.fromEntries(MediaTypes.map(map))\n\nconst ModuleTypes = [$font, $effect, $scaler, $merger, $theme, $transition]\nconst ModuleType = Object.fromEntries(ModuleTypes.map(map))\n\nconst LoadTypes = [$font, $image, $audio, $module]\nconst LoadType = Object.fromEntries(LoadTypes.map(map))\n\nconst TrackTypes = [$audio, $video]\nconst TrackType = Object.fromEntries(TrackTypes.map(map))\n\nconst MoveTypes = [$effect, ...TrackTypes]\nconst MoveType = Object.fromEntries(MoveTypes.map(map))\n\nconst TransformTypes = [$merger, $scaler]\nconst TransformType = Object.fromEntries(TransformTypes.map(map))\n\nexport {\n  LoadType, LoadTypes,\n  ClipType, ClipTypes,\n  EventType, EventTypes,\n  MediaType, MediaTypes,\n  ModuleType, ModuleTypes,\n  MoveType, MoveTypes,\n  TrackType, TrackTypes,\n  TransformType, TransformTypes,\n}\n","const objectType = value => typeof value === 'object'\nconst stringType = value => typeof value === 'string'\nconst undefinedType = value => typeof value === 'undefined'\nconst numberType = value => typeof value === 'number'\nconst booleanType = value => typeof value === 'boolean'\nconst methodType = value => typeof value === 'function'\n\nconst isDefined = value => !undefinedType(value)\nconst isNil = value => value === null\nconst isNot = value => undefinedType(value) || isNil(value)\n\nconst isNan = value => numberType(value) && Number.isNaN(value)\nconst isNumber = value => numberType(value) && !Number.isNaN(value)\nconst isInt = value => Number.isInteger(value)\nconst isFloat = value => numberType(value) && !isInt(value)\nconst isPositive = value => isNumber(value) && value >= 0\nconst isAboveZero = value => isNumber(value) && value > 0\n\nconst instanceOf = (value, klass) => objectType(value) && value instanceof klass\nconst isArray = value => (\n  isDefined(Array.isArray) ? Array.isArray(value) : instanceOf(value, Array)\n)\n\nconst length = value => !!value.length\n\nconst emptystring = value => isNot(value) || !stringType(value) || !length(value)\nconst emptyarray = value => isNot(value) || !isArray(value) || !length(value)\nconst emptyobject = value => (\n  isNot(value) || !objectType(value) || !length(Object.keys(value))\n)\n\nconst empty = value => {\n  if (isNot(value)) return true\n  if (isArray(value)) return emptyarray(value)\n  if (stringType(value)) return emptystring(value)\n\n  return emptyobject(value)\n}\n\nconst objectStrict = value => objectType(value) && !(isNot(value) || isArray(value))\n\nconst Is = {\n  empty,\n  emptyarray,\n  emptyobject,\n  emptystring,\n  float: isFloat,\n  object: objectType,\n  undefined: undefinedType,\n  boolean: booleanType,\n  number: numberType,\n  integer: isInt,\n  string: stringType,\n  array: isArray,\n  instanceOf,\n  defined: isDefined,\n  method: methodType,\n  nan: isNan,\n  nil: isNil,\n  not: isNot,\n  objectStrict,\n  positive: isPositive,\n  aboveZero: isAboveZero,\n}\n\nexport {\n  Is,\n  objectType,\n  undefinedType,\n  booleanType,\n  numberType,\n  stringType,\n  methodType,\n  empty,\n  emptyarray,\n  emptyobject,\n  emptystring,\n  isFloat,\n  isInt,\n  isArray,\n  instanceOf,\n  isDefined,\n  isNan,\n  isNil,\n  isNot,\n  objectStrict,\n  isPositive,\n  isAboveZero,\n}\n","import { byLabel } from \"../Utilities/Sort\"\nimport { ModuleType, ModuleTypes } from \"./Types\"\nimport { Errors } from \"./Errors\"\n\nimport fontDefaultJson from \"./modules/font/default.json\"\nimport effectBlurJson from \"./modules/effect/blur.json\"\nimport effectChromaKeyJson from \"./modules/effect/chromakey.json\"\nimport effectEmbossJson from \"./modules/effect/emboss.json\"\nimport effectGrayscaleJson from \"./modules/effect/grayscale.json\"\nimport effectSepiaJson from \"./modules/effect/sepia.json\"\nimport effectSharpenJson from \"./modules/effect/sharpen.json\"\nimport effectTextJson from \"./modules/effect/text.json\"\nimport mergerBlendJson from \"./modules/merger/blend.json\"\nimport mergerCenterJson from \"./modules/merger/center.json\"\nimport mergerConstrainedJson from \"./modules/merger/constrained.json\"\nimport mergerDefaultJson from \"./modules/merger/default.json\"\nimport mergerOverlayJson from \"./modules/merger/overlay.json\"\nimport scalerDefaultJson from \"./modules/scaler/default.json\"\nimport scalerPanJson from \"./modules/scaler/pan.json\"\nimport scalerScaleJson from \"./modules/scaler/scale.json\"\nimport themeColorJson from \"./modules/theme/color.json\"\nimport themeTextJson from \"./modules/theme/text.json\"\nimport { Is } from \"../Utilities/Is\"\n\ninterface ModuleInterface {\n\n  label: string\n  id: string\n  type: string\n  source? : string\n}\n\ninterface ModuleDefaults {\n  [index: string]: ModuleInterface\n  font: ModuleInterface\n  merger: ModuleInterface\n  scaler: ModuleInterface\n}\n\ninterface ModuleArray extends Array<ModuleInterface> {}\n\ninterface Modules {\n  [index: string]: ModuleArray\n  effect: ModuleArray\n  font: ModuleArray\n  merger: ModuleArray\n  scaler: ModuleArray\n  theme: ModuleArray\n  transition: ModuleArray\n}\n\nclass ModuleClass {\n  defaults: ModuleDefaults\n\n  modules: Modules\n\n  constructor() {\n    this.defaults = {\n      font: fontDefaultJson,\n      merger: mergerDefaultJson,\n      scaler: scalerDefaultJson,\n    }\n    this.modules = {\n      effect: [],\n      font: [],\n      merger: [],\n      scaler: [],\n      theme: [],\n      transition: [],\n    }\n    this.addModulesOfType([themeColorJson, themeTextJson], ModuleType.theme)\n\n    this.addModulesOfType([\n      effectSharpenJson,\n      effectBlurJson,\n      effectChromaKeyJson,\n      effectEmbossJson,\n      effectGrayscaleJson,\n      effectSepiaJson,\n      effectTextJson\n    ], ModuleType.effect)\n\n    this.addModulesOfType([this.defaults.font], ModuleType.font)\n\n    this.addModulesOfType([\n      mergerBlendJson,\n      mergerCenterJson,\n      mergerConstrainedJson,\n      mergerOverlayJson,\n      this.defaults.merger,\n    ], ModuleType.merger)\n\n    this.addModulesOfType([\n      scalerPanJson,\n      scalerScaleJson,\n      this.defaults.scaler,\n    ], ModuleType.scaler)\n  }\n\n  addModulesOfType(objects : ModuleArray, type : string) : boolean {\n    if (!ModuleTypes.includes(type)) {\n      console.warn(Errors.deprecation.addModulesOfType + type)\n      return false\n    }\n    const modules = this.modulesOfType(type)\n    let changed = false\n    objects.forEach((object) => {\n      const { id } = object\n      // allow existing modules to be redefined, including defaults\n      if (id === `com.moviemasher.${type}.default`) this.defaults[type] = object\n      if (this.ofTypeExists(id, type)) {\n        modules.splice(modules.indexOf(this.ofType(id, type)), 1)\n      }\n      modules.push(object)\n      changed = true\n    })\n    if (changed) modules.sort(byLabel)\n    return changed\n  }\n\n  fontById(id : string) : ModuleInterface {\n    return this.ofType(id, ModuleType.font)\n  }\n\n  scalerById(id : string) : ModuleInterface {\n    return this.ofType(id, ModuleType.scaler)\n  }\n\n  mergerById(id : string) : ModuleInterface {\n    return this.ofType(id, ModuleType.merger)\n  }\n\n  effectById(id : string) : ModuleInterface {\n    return this.ofType(id, ModuleType.effect)\n  }\n\n  themeById(id : string) : ModuleInterface {\n    return this.ofType(id, ModuleType.theme)\n  }\n\n  defaultOfType(type : string) : ModuleInterface {\n    return { ...this.defaults[type], type }\n  }\n\n  modulesOfType(type : string) : ModuleArray {\n    return this.modules[type]\n  }\n\n  objectWithDefaultId(type : string) : ModuleInterface {\n    const module = this.defaultOfType(type)\n    const { id, label } = module\n    return { id, type, label }\n  }\n\n  ofType(id : string, type : string) : ModuleInterface {\n    const module = this.modulesOfType(type).find((object) => object.id === id)\n    if (module) return module\n\n    return this.defaultOfType(type)\n  }\n\n  ofTypeExists(id: string, type: string) : boolean {\n    const module = this.modulesOfType(type).find((object) => object.id === id)\n    return Is.defined(module)\n  }\n\n  setDefault(type:string, object : ModuleInterface) {\n    this.defaults[type] = object\n  }\n}\n\nconst ModuleInstance = new ModuleClass()\nexport { ModuleInstance as Module }\n","import { Errors } from \"./Errors\"\nimport { Is } from \"../Utilities/Is\"\n\nclass Property {}\n\nObject.defineProperties(Property.prototype, {\n  modularPropertyTypeIds: {\n    get() {\n      if (Is.undefined(this.__modularPropertyTypeIds)) {\n        const ids = Object.keys(this.propertyTypes)\n        this.__modularPropertyTypeIds = ids.filter(id => (\n          this.propertyTypes[id].modular\n        ))\n      }\n      return this.__modularPropertyTypeIds\n    }\n  },\n  orDefault: {\n    value(property : { value: string | number, type: string }) : string | number {\n      const { value, type } = property\n      return Is.defined(value) ? value : this.propertyTypeDefault(type)\n    }\n  },\n  property_types: { // deprecated\n    get() {\n      console.warn(Errors.deprecation.property_types)\n      return this.propertyTypes\n    }\n  },\n  propertyType: { value(type : string) { return this.propertyTypes[type] } },\n  propertyTypeDefault: {\n    value(type : string) : string | number {\n      if (!Is.string(type) || Is.empty(type)) return \"\"\n\n      const propertyType = this.propertyType(type)\n      if (!Is.object(propertyType)) return \"\"\n\n      if (Is.defined(propertyType.value)) return propertyType.value\n      const Klass = propertyType.type\n      if (Klass) return new Klass()\n\n      return \"\"\n    }\n  },\n  propertyTypes: {\n    value: {\n      number: {\n        type: Number,\n        value: 0,\n      },\n      integer: {\n        type: Number,\n        value: 0,\n      },\n      rgba: {\n        type: String,\n        value: '#000000FF',\n      },\n      rgb: {\n        type: String,\n        value: '#000000',\n      },\n      font: {\n        type: String,\n        value: 'com.moviemasher.font.default',\n        modular: true,\n      },\n      fontsize: {\n        type: Number,\n        value: 13,\n      },\n      direction4: {\n        type: Number,\n        values: [\n          { id: 0, identifier: 'top', label: 'Top' },\n          { id: 1, identifier: 'right', label: 'Right' },\n          { id: 2, identifier: 'bottom', label: 'Bottom' },\n          { id: 3, identifier: 'left', label: 'Left' },\n        ],\n        value: 0,\n      },\n      direction8: {\n        type: Number,\n        values: [\n          { id: 0, identifier: \"top\", label: \"Top\" },\n          { id: 1, identifier: \"right\", label: \"Right\" },\n          { id: 2, identifier: \"bottom\", label: \"Bottom\" },\n          { id: 3, identifier: \"left\", label: \"Left\" },\n          { id: 4, identifier: \"top_right\", label: \"Top Right\" },\n          { id: 5, identifier: \"bottom_right\", label: \"Bottom Right\" },\n          { id: 6, identifier: \"bottom_left\", label: \"Bottom Left\" },\n          { id: 7, identifier: \"top_left\", label: \"Top Left\" },\n        ],\n        value: 0,\n      },\n      string: {\n        type: String,\n        value: '',\n      },\n      pixel: {\n        type: Number,\n        value: 0.0,\n      },\n      mode: {\n        type: String,\n        value: 'normal',\n        values: [\n          { id: \"burn\", composite: \"color-burn\", label: \"Color Burn\" },\n          { id: \"dodge\", composite: \"color-dodge\", label: \"Color Dodge\" },\n          { id: \"darken\", composite: \"darken\", label: \"Darken\" },\n          { id: \"difference\", composite: \"difference\", label: \"Difference\" },\n          { id: \"exclusion\", composite: \"exclusion\", label: \"Exclusion\" },\n          { id: \"hardlight\", composite: \"hard-light\", label: \"Hard Light\" },\n          { id: \"lighten\", composite: \"lighter\", label: \"Lighten\" },\n          { id: \"multiply\", composite: \"multiply\", label: \"Multiply\" },\n          { id: \"normal\", composite: \"normal\", label: \"Normal\" },\n          { id: \"overlay\", composite: \"overlay\", label: \"Overlay\" },\n          { id: \"screen\", composite: \"screen\", label: \"Screen\" },\n          { id: \"softlight\", composite: \"soft-light\", label: \"Soft Light\" },\n          { id: \"xor\", composite: \"xor\", label: \"Xor\" },\n        ]\n      },\n      text: {\n        type: String,\n        value: '',\n      },\n    },\n  }\n})\n\nconst PropertyInstance = new Property()\nexport { PropertyInstance as Property }\n","\n\nconst Colors = {\n  yuv2rgb: function(yuv) {\n    var k, rgb = {};\n    for(k in yuv) yuv[k] = parseInt(yuv[k]);\n    rgb.r = yuv.y + 1.4075 * (yuv.v - 128);\n    rgb.g = yuv.y - 0.3455 * (yuv.u - 128) - (0.7169 * (yuv.v - 128));\n    rgb.b = yuv.y + 1.7790 * (yuv.u - 128);\n    for (k in rgb) rgb[k] = Math.min(255, Math.max(0, Math.floor(rgb[k])));\n    return rgb;\n  },\n  rgb2hex: function(rgb){\n    var r, g, b;\n    r = rgb.r.toString(16);\n    g = rgb.g.toString(16);\n    b = rgb.b.toString(16);\n    if (r.length < 2) r = \"0\" + r;\n    if (g.length < 2) g = \"0\" + g;\n    if (b.length < 2) b = \"0\" + b;\n    return \"#\" + r + g + b;\n  },\n  yuv_blend: function(yuvs, yuv2, similarity, blend){\n    var du, dv, diff = 0.0, i, z = yuvs.length;\n    for (i = 0; i < z; i++){\n      du = (yuvs[i].u - yuv2.u);\n      dv = (yuvs[i].v - yuv2.v);\n      diff += Math.sqrt((du * du + dv * dv) / (255.0 * 255.0));\n    }\n    diff = (diff / Number(z));\n    if (blend > 0.0001) {\n      return Math.min(1.0, Math.max(0.0, (diff - similarity) / blend)) * 255.0;\n    }\n    return (diff > similarity) ? 255 : 0;\n  },\n  rgb2yuv: function(rgb) {\n    var k, yuv = {};\n    for(k in rgb) rgb[k] = parseInt(rgb[k]);\n    yuv.y = rgb.r * 0.299000 + rgb.g * 0.587000 + rgb.b * 0.114000;\n    yuv.u = rgb.r * -0.168736 + rgb.g * -0.331264 + rgb.b * 0.500000 + 128;\n    yuv.v = rgb.r * 0.500000 + rgb.g * -0.418688 + rgb.b * -0.081312 + 128;\n    for(k in yuv) yuv[k] = Math.floor(yuv[k]);\n    return yuv;\n  },\n}\nexport { Colors }","\nclass Context {\n  createDrawing(width, height) {\n    const context = this.createVideo()\n    if (1 <= width) context.canvas.width = width\n    if (1 <= height) context.canvas.height = height\n    return context\n  }\n\n  createDrawingLike(drawing) {\n    return this.createDrawing(drawing.canvas.width, drawing.canvas.height)\n  }\n\n  createAudio() {\n    const Klass = window.AudioContext\n    if (!Klass) return\n\n    return new Klass\n  }\n\n  createCanvas() {\n    return document && document.createElement(\"canvas\")\n  }\n\n  createVideo(canvas) {\n    const element = canvas || this.createCanvas()\n    return element && element.getContext(\"2d\")\n  }\n}\n\nconst ContextFactoryInstance = new Context\n\nexport { ContextFactoryInstance as Context }\n","function Id() {\n  return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c => {\n    const array = new Uint8Array(1)\n    return  (c ^ crypto.getRandomValues(array)[0] & 15 >> c / 4).toString(16)\n  })\n}\n\nexport { Id }","const fromPoint = (pt, width) => pt.y * width + pt.x\n\nconst toPoint = (index, width) => {\n  return { x: index % width, y: Math.floor(index / width) }\n}\n\nconst toIndex = pixel => pixel * 4\n\nconst rgbAtIndex = (index, pixels) => {\n  if (index < 0) return\n  if (index > pixels.length - 4) return\n\n  return {\n    r: pixels[index], g: pixels[index + 1],\n    b: pixels[index + 2], a: pixels[index + 3],\n  }\n}\n\nconst rgb = (pixel, data) => rgbAtIndex(toIndex(pixel), data)\n\nconst safePixel = (pixel, x_dif, y_dif, width, height) => {\n  const pt = toPoint(pixel, width)\n  pt.x = Math.max(0, Math.min(width - 1, pt.x + x_dif));\n  pt.y = Math.max(0, Math.min(height - 1, pt.y + y_dif));\n  return fromPoint(pt, width)\n}\n\nconst safePixels = (pixel, width, height, size = 3) => {\n  const pixels = []\n  const half_size = Math.floor(size / 2)\n  for (let y = 0; y < size; y++) {\n    for (let x = 0; x < size; x++) {\n      pixels.push(safePixel(pixel, x - half_size, y - half_size, width, height))\n    }\n  }\n  return pixels\n}\n\nconst rgbs = (pixel, data, width, height, size) => {\n  return safePixels(pixel, width, height, size).map(pixel => rgb(pixel, data))\n}\n\nconst color = (value) => {\n  const string = String(value)\n  if (string.slice(0, 2) === \"0x\") return \"#\" + string.slice(2)\n\n  return string\n}\n\nexport const Pixel = {\n  color,\n  rgbAtIndex,\n  rgbs,\n}\n","import { Errors } from \"../Setup\"\nimport { Is } from \"./Is\"\n\nconst unlessInstanceOf = (object, klass, error) => {\n  if (!Is.instanceOf(object, klass)) throw error || Errors.wrongClass + klass.name\n}\n\nconst Throw = {\n  unlessInstanceOf,\n}\n\nexport { Throw }","import { Errors } from \"../Setup\"\nimport { Is } from \"./Is\"\n\nconst greatestCommonDenominator = (a, b) => {\n    var t\n    while (b !== 0) {\n      t = b\n      b = a % b\n      a = t\n    }\n    return a\n}\n  \nconst lowestCommonMultiplier = (a, b) => { return (a * b / greatestCommonDenominator(a, b)) }\n\nclass Time {\n  static get zero() { return new Time }\n\n  static scaleTimes(time1, time2, rounding = \"round\") {\n    if (time1.fps === time2.fps) return [time1, time2]\n\n    var gcf = lowestCommonMultiplier(time1.fps, time2.fps)\n    return [\n      time1.scale(gcf, rounding),\n      time2.scale(gcf, rounding)\n    ]\n  }\n  \n  constructor(frame = 0, fps = 1) {\n    if (!Is.integer(frame) || frame < 0) throw(Errors.frame)\n    if (!Is.integer(fps) || fps < 1) throw(Errors.fps)\n    \n    this.frame = frame\n    this.fps = fps\n  }\n\n  add(time) {\n    const [time1, time2] = Time.scaleTimes(this, time)\n    return new Time(time1.frame + time2.frame, time1.fps)\n  }\n\n  addFrames(frames) {\n    const time = this.copy\n    time.frame += frames\n    return time \n  }\n\n  get copy() { return new Time(this.frame, this.fps) }\n\n  get description() { return `${this.frame}@${this.fps}` }\n\n  divide(number, rounding = \"round\") {\n    if (!Is.number(number)) throw(Errors.argument)\n    return new Time(Math[rounding](Number(this.frame) / number), this.fps)\n  }\n  \n  equalsTime(time) {\n    if (!(time instanceof Time)) throw(Errors.time)\n\n    const [time1, time2] = Time.scaleTimes(this, time)\n    return time1.frame === time2.frame\n  }\n\n  min(time) {\n    if (! time instanceof Time) throw(Errors.time)\n    \n    const [time1, time2] = Time.scaleTimes(this, time)\n    return new Time(Math.min(time1.frame, time2.frame), time1.fps)\n  } \n\n  scale(fps = 1, rounding = \"round\") {\n    if (this.fps === fps) return this\n    //const scale = Number(this.fps) / Number(fps)\n    const frame = Number(this.frame / this.fps) * Number(fps)\n    return new Time(Math[rounding](frame), fps)\n  }\n\n  get seconds() { return Number(this.frame) / Number(this.fps) }\n  \n  subtract(time) {\n    if (! time instanceof Time) throw(Errors.argument)\n    const [time1, time2] = Time.scaleTimes(this, time)\n  \n    var subtracted = time2.frame\n    if (subtracted > time1.frame) {\n      subtracted -= subtracted - time1.frame\n    }\n    return new Time(time1.frame - subtracted, time1.fps)\n  }\n\n  subtractFrames(frames) {\n    const time = this.copy\n    time.frame -= frames\n    return time \n  }\n\n  toString() { return `[${this.description}]` }\n\n  withFrame(frame) { \n    const time = this.copy\n    time.frame = frame\n    return time \n  }\n}\n\nexport { Time }","import { Errors } from \"../Setup\"\nimport { Is } from \"../Utilities/Is\"\nimport { Time } from \"../Utilities/Time\"\n\nclass TimeFactory {\n  static createFromFrame(frame:number, fps:number) : Time {\n    return new Time(frame, fps)\n  }\n\n  static createFromSeconds(seconds = 0, fps = 1, rounding = 'round') : Time {\n    if (!Is.number(seconds) || seconds < 0) throw Errors.seconds\n    if (!Is.integer(fps) || fps < 1) throw Errors.fps\n\n    const rounded = this.roundingFunction(rounding)(seconds * fps)\n    return this.createFromFrame(rounded, fps)\n  }\n\n  static roundingFunction(rounding:string = 'round') : Function {\n    switch (rounding) {\n      case 'ceil': return Math.ceil\n      case 'floor': return Math.floor\n      default: return Math.round\n    }\n  }\n}\n\nexport { TimeFactory }\n","import { Is } from \"./Is\"\nimport { Time } from \"./Time\"\nimport { Errors } from \"../Setup/Errors\"\nimport { TimeFactory } from \"../Factory/TimeFactory\"\n\nclass TimeRange extends Time {\n  constructor(frame = 0, fps = 1, frames = 1) {\n    if (!(Is.integer(frames) && frames >= 0)) {\n      throw(Errors.argument, frames)\n    }\n    super(frame, fps)\n    this.frames = frames\n  }\n\n  get description() { return `${this.frame}-${this.frames}@${this.fps}` }\n  get end() { return this.frame + this.frames }\n  get endTime() { return TimeFactory.createFromFrame(this.end, this.fps) }\n  get lengthSeconds() { return Number(this.frames) / Number(this.fps) }\n  get position() { return  Number(this.frame) / Number(this.frames) }\n  get startTime() { return TimeFactory.createFromFrame(this.frame, this.fps) }\n  get copy() {\n    return new TimeRange(this.frame, this.fps, this.frames)\n  }\n\n  scale(fps = 1, rounding = \"round\") {\n    if (this.fps === fps) return this.copy\n\n    const value = Number(this.frames) / (Number(this.fps) / Number(fps))\n    const time = super.scale(fps, rounding)\n    return new TimeRange(time.frame, time.fps, Math.max(1, Math[rounding](value)))\n  }\n\n  intersects(timeRange) {\n    const [range1, range2] = Time.scaleTimes(this, timeRange)\n\n    if (range1.frame >= range2.end) return false\n\n    return range1.end > range2.frame\n  }\n\n  minEndTime(endTime) {\n    const [range, time] = Time.scaleTimes(this, endTime)\n    range.frames = Math.min(range.frames, time.frame)\n    return range\n  }\n\n  withFrame(frame) {\n    const range = this.copy\n    range.frame = frame\n    return range\n  }\n\n  withFrames(frames) {\n    const range = this.copy\n    range.frames = frames\n    return range\n  }\n\n}\n\nexport { TimeRange }\n","import { Errors } from \"../Setup\"\nimport { Is } from \"./Is\"\n\nconst findBy = (array, object, key = 'id') => {\n  if (! Is.array(array)) throw(Errors.array)\n  if (Is.undefined(key)) throw(Errors.argument)\n\n  const value = Is.object(object) ? object[key] : object\n  if (Is.undefined(value)) throw(Errors.argument)\n  return array.find(item => item[key] === value)\n}\n\nconst deleteFromArray = (array, value) => {\n  const is_array = Is.array(array)\n  const include = is_array && array.includes(value)\n  if (include) array.splice(array.indexOf(value), 1)\n}\n\n\nconst keyShouldBeCopied = (key) => {\n  return key.substr(0,1) !== '$'\n}\nconst deepCopy = (ob1, ob2) => {\n  if (Is.object(ob1)){\n    if (Is.undefined(ob2)) ob2 = {}\n    for (var key in ob1) {\n      if (keyShouldBeCopied(key)){\n        const value1 = ob1[key]\n        if (Is.object(value1)) {\n          if (Is.array(value1)) ob2[key] = [...value1]\n          else ob2[key] = deepCopy(value1, ob2[key])\n        } else ob2[key] = value1\n      }\n    }\n  }\n  return ob2\n}\n\nconst capitalize = value => {\n  const string = Is.string(value) ? value : String(value)\n  if (Is.emptystring(string)) return string\n\n  return `${string[0].toUpperCase()}${string.substr(1)}`\n}\n\nconst Utilities = {\n  findBy,\n  deleteFromArray,\n  keyShouldBeCopied,\n  deepCopy,\n  capitalize,\n}\n\nexport { Utilities }\n","import { Errors } from \"../Setup\"\nimport { Is } from \"../Utilities\"\n\nclass Base {\n  constructor(object = {}) {\n    if (!Is.objectStrict(object)) throw Errors.object\n\n    this.object = object\n  }\n\n  get(property) { return this[property] }\n\n  set(property, value) { this[property] = value }\n\n  toJSON() { return this.object }\n\n  toString() { return `[${this.constructor.name}]` }\n}\n\nexport { Base }\n","import { Errors } from \"../Setup\"\nimport { Is } from \"../Utilities\"\nimport { EventType } from \"../Setup\"\n\nclass Action {\n  constructor(object) {\n    if (!Is.objectStrict(object)) throw Errors.argument + object\n\n    const keys = Object.keys(object)\n    const entries = keys.map(key => [key, { value: object[key] }])\n    Object.defineProperties(this, Object.fromEntries(entries))\n  }\n\n  get events() { return this.mash.events }\n\n  get selectedClips() { \n    if (this.done) return this.redoSelectedClips\n\n    return this.undoSelectedClips\n  }\n\n  get selectedEffects() { \n    if (this.done) return this.redoSelectedEffects\n    \n    return this.undoSelectedEffects\n  }\n  \n  redo() {\n    this.redoAction()\n    this.done = true\n    this.events && this.events.emit(EventType.action, { action: this } )\n  }\n\n  redoAction() {} \n\n  undo() {\n    this.undoAction()\n    this.done = false\n    this.events && this.events.emit(EventType.action, { action: this } )\n  }\n\n  undoAction() {}\n}\n\nexport { Action }\n","import { Action } from \"./Action\"\n\nclass AddTrackAction extends Action {\n  redoAction(){\n    this.mash.addTrack(this.trackType)\n  }\n\n  undoAction() {\n    this.mash.removeTrack(this.trackType)\n  }\n}\n\nexport { AddTrackAction }\n","import { Action } from \"./Action\"\n\nclass ChangeAction extends Action {\n  constructor(object) {\n    const redoValue = object.redoValue\n    delete object.redoValue\n    super(object)\n    this.__redoValue = redoValue\n  }\n\n  get redoValue() { return this.__redoValue }\n\n  redoAction() {\n    this.target[this.property] = this.redoValue\n  }\n\n  undoAction() {\n    this.target[this.property] = this.undoValue\n  }\n\n  updateAction(redoValue) {\n    this.__redoValue = redoValue\n    this.redo()\n  }\n}\n\nexport { ChangeAction }\n","import { Action } from \"./Action\"\n\nclass FreezeAction extends Action {\n  redoAction() {\n    this.trackClips.splice(this.index, 0, this.insertClip, this.frozenClip)\n    this.freezeClip.frames -= this.frames\n  }\n\n  undoAction() {\n    this.freezeClip.frames += this.frames\n    this.trackClips.splice(this.index, 2)\n  }\n}\n\nexport { FreezeAction }\n","import { ChangeAction } from \"./ChangeAction\"\n\nclass ChangeFramesAction extends ChangeAction {\n  redoAction() {\n    this.mash.changeClipFrames(this.target, this.redoValue)\n  }\n\n  undoAction() {\n    this.mash.changeClipFrames(this.target, this.undoValue)\n  }\n}\n\nexport { ChangeFramesAction }\n","import { ChangeAction } from \"./ChangeAction\"\n\nclass ChangeTrimAction extends ChangeAction {\n  redoAction() {\n    this.mash.changeClipTrim(this.target, this.redoValue, this.frames + this.undoValue)\n  }\n\n  undoAction() {\n    this.mash.changeClipTrim(this.target, this.undoValue, this.frames + this.undoValue)\n  }\n}\n\nexport { ChangeTrimAction }\n","\nimport { Action } from \"./Action\"\nimport { Utilities } from \"../Utilities\"\n\nclass AddEffectAction extends Action {\n  redoAction() { this.effects.splice(this.index, 0, this.effect) }\n  \n  undoAction() { Utilities.deleteFromArray(this.effects, this.effect) }\n}\n\nexport { AddEffectAction }","import { AddTrackAction } from \"./AddTrackAction\"\n\nclass AddClipToTrackAction extends AddTrackAction {\n  get clips() { return this.track.clips }\n\n  get track() { return this.mash[this.trackType][this.trackIndex] }\n\n  redoAction() {\n    // create track if needed\n    for (let i = 0; i < this.createTracks; i++) { super.redoAction() } \n    this.mash.addClipsToTrack([this.clip], this.trackIndex, this.insertIndex)\n  }\n\n  undoAction() {\n    this.mash.removeClipsFromTrack([this.clip])\n    for (let i = 0; i < this.createTracks; i++) { super.undoAction() } \n  }\n}\n\nexport { AddClipToTrackAction }\n ","import { Action } from \"./Action\"\n\nclass MoveClipsAction extends Action {\n  addClips(trackIndex, insertIndex) {\n    this.mash.addClipsToTrack(this.clips, trackIndex, insertIndex)\n  }\n\n  redoAction() {\n    if (this.redoFrames) {\n      this.clips.forEach((clip, index) => clip.frame = this.redoFrames[index])\n    }\n    this.addClips(this.trackIndex, this.insertIndex)\n  }\n\n  undoAction() {\n    if (this.undoFrames) {\n      this.clips.forEach((clip, index) => clip.frame = this.undoFrames[index])\n    }\n    this.addClips(this.undoTrackIndex, this.undoInsertIndex)\n  }\n}\nexport { MoveClipsAction }\n","import { Is } from \"../../Utilities/Is\"\n\nexport const track = { \n  track: { \n    get: function() { \n      if (Is.undefined(this.__track)) {\n        const track = this.object.track \n        this.__track = Is.defined(track) ? track : -1\n      }\n      return this.__track \n    },\n    set: function(value) { this.__track = value }\n  }, \n}\n ","import { track } from \"../Clip/with/track\"\nimport { Action } from \"./Action\"\n\nclass RemoveClipsAction extends Action {\n  get trackIndex() { return track.index }\n\n  redoAction() {\n    this.mash.removeClipsFromTrack(this.clips)\n  }\n\n  undoAction() {\n    this.mash.addClipsToTrack(this.clips, this.trackIndex, this.index)\n  }\n}\n\nexport { RemoveClipsAction }\n ","import { Action } from \"./Action\"\n\nclass SplitAction extends Action {\n  redoAction() {\n    this.trackClips.splice(this.index, 0, this.insertClip)\n    this.splitClip.frames = this.redoFrames\n  }\n\n  undoAction() {\n    this.splitClip.frames = this.undoFrames\n    this.trackClips.splice(this.index, 1)\n  }\n}\n\nexport { SplitAction }","import { Action } from \"./Action\"\n\nclass MoveEffectsAction extends Action {\n  redoAction() {\n    this.effects.splice(0, this.effects.length, ...this.redoEffects)\n  }\n\n  undoAction() {\n    this.effects.splice(0, this.effects.length, ...this.undoEffects)\n  }\n}\n\nexport { MoveEffectsAction }","import { Action } from \"../Action\"\nimport { Base } from \"../Base\"\nimport { Errors } from \"../Setup\"\nimport { Is } from \"../Utilities\"\n\nclass Actions extends Base {\n  constructor(object) {\n    super(object)\n    \n    this.actions = []\n    this.index = -1\n  }\n\n  get canRedo() { return this.index < this.actions.length - 1 }\n\n  get canUndo() { return this.index > -1 }\n\n  get currentAction() { return this.actions[this.index] }\n\n  get currentActionLast() { return this.canUndo && !this.canRedo }\n\n  get mash() { return this.object.mash }\n\n  // TODO: remove\n  get masher() { return this.object.masher }\n\n  do(action) {\n    if (!Is.instanceOf(action, Action)) throw(Errors.action)\n\n    action.actions = this\n    const remove = this.actions.length - (this.index + 1)\n    const removed = remove ? this.actions.splice(this.index + 1, remove) : []\n    \n    this.actions.push(action)\n    this.redo()\n    return removed\n  }\n\n  redo() {\n    this.index ++\n    const action = this.currentAction\n    action.redo()\n    return action\n  }\n\n  undo(){\n    const action = this.currentAction\n    this.index--\n    action.undo()\n    return action\n  }\n}\n\nexport { Actions }","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from) {\r\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\r\n        to[j] = from[i];\r\n    return to;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n","/* eslint-disable no-unused-vars */\nimport { Base } from \"../Base\"\nimport { Errors } from \"../Setup\"\nimport { Is } from \"../Utilities/Is\"\n\ninterface FactoryInterface {\n\n}\ninterface TypedObject {\n  type: string\n}\n\ninterface TypedObjectConstructor {\n  new (object : TypedObject) : FactoryInterface\n}\n\nclass Factory implements FactoryInterface {\n  classesByType: Map<string, TypedObjectConstructor>\n\n  baseClass: TypedObjectConstructor\n\n  constructor(baseClass:TypedObjectConstructor) {\n    this.baseClass = baseClass || Base\n    this.classesByType = new Map()\n  }\n\n  typeClass(type:string):TypedObjectConstructor {\n    const typedClass = this.classesByType.get(type)\n    if (!typedClass) return this.baseClass\n\n    return typedClass\n  }\n\n  create(type:string | TypedObject) : object {\n    if (typeof type === \"string\") return this.createFromType(type)\n\n    return this.createFromObject(type)\n  }\n\n  createFromObject(object:TypedObject) : object {\n    if (!Is.object(object)) throw Errors.object\n    const Klass = this.typeClass(object.type)\n    if (Is.instanceOf(object, Klass)) return object\n\n    return new Klass(object)\n  }\n\n  createFromType(type:string) : object {\n    const Klass = this.typeClass(type)\n\n    return new Klass({ type })\n  }\n\n  install(type:string, klass:TypedObjectConstructor) { this.classesByType.set(type, klass) }\n}\n\nexport { Factory }\n","export const id = {\n  id: { get: function() { return this.__id ||= this.initializeId } },\n  initializeId: { get: function() { return this.object.id || 'id' } },\n}\n","// everything that has this.object\nexport const object = {}\n","import { Is } from \"../../Utilities\"\nimport { id } from \"../../Base/with/id\"\nimport { label } from \"./label\"\nimport { object } from \"../../Base/with/object\"\nimport { toJSONFromObject } from \"../../Base/with/toJSONFromObject\"\n\nexport const sharedMedia = {\n  ...object,\n  ...toJSONFromObject,\n  ...id,\n  ...label,\n  properties: {\n    get() {\n      if (Is.undefined(this.__properties)) this.__properties = this.propertiesInitialize\n      return this.__properties\n    }\n  },\n\n  propertiesInitialize: {\n    get() {\n      const object = { label: { type: 'string' } }\n      if (this.propertiesTiming) Object.assign(object, this.propertiesTiming)\n      if (this.propertiesAudible) Object.assign(object, this.propertiesAudible)\n      if (this.propertiesModular) Object.assign(object, this.propertiesModular)\n      return object\n    }\n  },\n  source: { get() { return this.object.source } },\n}\n","export const toJSONFromObject = {\n  toJSON: { value: function() { return this.object } },\n}","export const label = { label: { get: function() { return this.object.label } } }\n","import { Base } from \"../Base\"\n\nclass Processor extends Base {}\n\nexport { Processor }\n","import { Processor } from \"./Processor\"\n\nclass AudioProcessor extends Processor {\n  get audioContext() { return this.object.audioContext }\n\n  process(url, buffer) {\n    return new Promise((resolve, reject) => {\n      return this.audioContext.decodeAudioData(\n        buffer,\n        audioData => resolve(audioData),\n        error => reject(error)\n      )\n    })\n  }\n}\n\nexport { AudioProcessor }\n","import { Errors } from \"../Setup/Errors\"\nimport { Is } from \"../Utilities/Is\"\n\nclass Cache {\n  constructor() {\n    this.__cached_urls = {}\n    this.__urls_by_md5 = {}\n  }\n\n  add(url, value){\n    const key = this.key(url)\n    // console.log(\"Cache.add\", url, key)\n    this.__cached_urls[key] = value\n    this.__urls_by_md5[key] = url\n  }\n\n  cached(url) { return !!this.get(url) }\n\n  get(url) { \n    const key = this.key(url)\n    // console.log(\"Cache.get\", url, key)\n    return this.__cached_urls[key] \n  }\n\n  key(url) {\n    if(!(Is.string(url) && !Is.empty(url))) throw Errors.url + url\n    return url\n  }\n\n  remove(url) {\n    const key = this.key(url)\n    // console.log(\"Cache.get\", url, key)\n    delete this.__cached_urls[key]\n    delete this.__urls_by_md5[key]\n  }\n  urls() { return Object.values(this.__urls_by_md5) }\n}\n\nconst CacheInstance = new Cache\nexport { CacheInstance as Cache }","import { Cache } from \"./Cache\"\nimport { Processor } from \"./Processor\"\n\nclass FontProcessor extends Processor {\n  process(url, buffer) {\n    const family = Cache.key(url)\n    const face = new FontFace(family, buffer)\n    const promise = face.load()\n    promise.then(() => {\n      document.fonts.add(face)\n      return { family }\n    })\n    return promise\n  }\n}\n\nexport { FontProcessor }\n","import { Processor } from \"./Processor\"\n\nclass ImageProcessor extends Processor {\n  process(url, buffer) {\n    console.log(\"ImageProcessor.process\", url)\n  }\n}\n\nexport { ImageProcessor }\n","import { Processor } from \"./Processor\"\n\nclass ModuleProcessor extends Processor {\n  process(url, buffer) {}\n}\n\nexport { ModuleProcessor }\n","import { Factory } from \"./Factory\"\nimport { LoadType } from \"../Setup/Types\"\nimport { Processor } from \"../Loading/Processor\"\nimport { AudioProcessor } from \"../Loading/AudioProcessor\"\nimport { FontProcessor } from \"../Loading/FontProcessor\"\nimport { ImageProcessor } from \"../Loading/ImageProcessor\"\nimport { ModuleProcessor } from \"../Loading/ModuleProcessor\"\n\nclass ProcessorFactory extends Factory {\n  constructor() {\n    super(Processor)\n    this.install(LoadType.audio, AudioProcessor)\n    this.install(LoadType.font, FontProcessor)\n    this.install(LoadType.image, ImageProcessor)\n    this.install(LoadType.module, ModuleProcessor)\n  }\n}\n\nconst ProcessorFactoryInstance = new ProcessorFactory\nexport { ProcessorFactoryInstance as ProcessorFactory }\n","import { Base } from \"../Base\"\nimport { Cache } from \"../Loading/Cache\"\n\nclass Loader extends Base {\n  constructor(object) {\n    super(object)\n    // console.log(\"Loader\", this.object)\n    this.promises = {}\n  }\n\n  get type() { return this.object.type }\n\n  loadedUrl(url) { return Cache.cached(url) }\n\n  loadedUrls(urls) { return urls.every(url => this.loadedUrl(url)) }\n\n  loadUrl(url) {\n    if (this.promises[url]) return this.promises[url]\n    if (Cache.cached(url)) return Promise.resolve(Cache.get(url))\n\n    const promise = this.requestUrl(url)\n    this.promises[url] = promise\n    return promise.then(processed => {\n      // console.log(this.constructor.name, \"loadUrl\", processed.constructor.name)\n      Cache.add(url, processed)\n      delete this.promises[url]\n      return processed\n    })\n  }\n\n  loadUrls(urls) {\n    return Promise.all(urls.map(url => this.loadUrl(url)))\n  }\n}\n\nexport { Loader }\n","\nimport { ProcessorFactory } from \"../Factory/ProcessorFactory\"\nimport { LoadType } from \"../Setup\"\nimport { Loader } from \"./Loader\"\n\nclass AudioLoader extends Loader {\n  constructor(object) {\n    super(object)\n    this.object.type ||= LoadType.audio\n  }\n\n  get audioContext() { return this.object.audioContext }\n  set audioContext(value) { this.object.audioContext = value }\n\n  async requestUrl(url) {\n    return fetch(url).then(response => {\n      console.log(\"AudioLoader.requestUrl fetch\", url, response.constructor.name)\n      return response.arrayBuffer()\n    }).then(loaded => {\n      console.log(\"AudioLoader.requestUrl arrayBuffer\", url, loaded.constructor.name)\n      const options = { type: this.type, audioContext: this.audioContext }\n      const processor = ProcessorFactory.createFromObject(options)\n      return processor.process(url, loaded)\n    })\n  }\n}\n\nexport { AudioLoader }","import { LoadType } from \"../Setup\"\nimport { ProcessorFactory } from \"../Factory/ProcessorFactory\"\nimport { Loader } from \"./Loader\"\n\nclass FontLoader extends Loader {\n  constructor(object) {\n    super(object)\n    this.object.type ||= LoadType.font\n  }\n\n  async requestUrl(url) {\n    // console.log(\"FontLoader.requestUrl\", url)\n    \n    return fetch(url).then(response => {\n      // console.log(\"FontLoader.requestUrl fetch\", url, response.constructor.name)\n      return response.arrayBuffer()\n    }).then(loaded => {\n      // console.log(\"FontLoader.requestUrl arrayBuffer\", url, loaded.constructor.name)\n      const processor = ProcessorFactory.create(this.type)\n      return processor.process(url, loaded)\n    })\n  }\n}\n\nexport { FontLoader }","import { LoadType } from \"../Setup\"\nimport { Loader } from \"./Loader\"\n\nclass ImageLoader extends Loader {\n  constructor(object) {\n    super(object)\n    this.object.type ||= LoadType.image\n  }\n  \n  requestUrl(url) {\n    // console.log(\"ImageLoader.requestUrl\", url)\n    return new Promise((resolve, reject) => {\n      const image = new Image()\n      image.onload = event => resolve(event.target)\n      image.onerror = event => reject(event)\n      image.crossOrigin = \"Anonymous\"\n      image.src = url  \n      return image\n    })\n  }\n}\n\nexport { ImageLoader }","import { LoadType } from \"../Setup\"\nimport { Loader } from \"./Loader\"\n\nclass ModuleLoader extends Loader {\n  constructor(object) {\n    super(object)\n    this.object.type ||= LoadType.module\n  }\n  requestUrl(url) { return import(url) }\n}\n\nexport { ModuleLoader }","import { Factory } from \"./Factory\"\nimport { LoadType } from \"../Setup/Types\"\n\nimport { AudioLoader } from \"../Loading/AudioLoader\"\nimport { FontLoader } from \"../Loading/FontLoader\"\nimport { ImageLoader } from \"../Loading/ImageLoader\"\nimport { ModuleLoader } from \"../Loading/ModuleLoader\"\nimport { Loader } from \"../Loading/Loader\"\n\nclass LoaderFactory extends Factory {\n  constructor() {\n    super(Loader)\n    this.install(LoadType.audio, AudioLoader)\n    this.install(LoadType.font, FontLoader)\n    this.install(LoadType.image, ImageLoader)\n    this.install(LoadType.module, ModuleLoader)\n  }\n}\n\nconst LoaderFactoryInstance = new LoaderFactory()\nexport { LoaderFactoryInstance as LoaderFactory }\n","import { LoadTypes } from \"../Setup\"\nimport { LoaderFactory } from \"../Factory/LoaderFactory\"\nimport { Is } from \"../Utilities/Is\"\nimport { Cache } from \"./Cache\"\n\nclass UrlsByType {\n  static get none() { return UrlsByTypeNone }\n\n  constructor() { this.loaders = {} }\n\n  get loaded() { return this.urls.every(url => Cache.cached(url)) }\n\n  get urls() { return LoadTypes.flatMap(type => this[type]) }\n\n  get urlsUnloaded() { return this.urls.filter(url => !Cache.cached(url)) }\n\n  concat(object) {\n    if (!Is.instanceOf(object, UrlsByType)) {\n      console.warn(this.constructor.name, \"concat\", object)\n      return\n    }\n    LoadTypes.forEach(type => {\n      const urls = this[type]\n      urls.splice(0, urls.length, ...new Set([...urls, ...object[type]]))\n    })\n  }\n\n  load(audioContext) {\n    const promises = LoadTypes.flatMap(type => {\n      const urls = this[type]\n      if (urls.length === 0) return []\n\n      if (Is.undefined(this.loaders[type])) {\n        const options = { type: type, audioContext: audioContext }\n        this.loaders[type] = LoaderFactory.createFromObject(options)\n      }\n      return this.loaders[type].loadUrls(urls)\n    })\n    if (promises.length) {\n      // console.log(this.constructor.name, \"load\", promises.length)\n      return Promise.all(promises)\n    }\n\n    // console.log(this.constructor.name, \"load resolved\")\n\n    return Promise.resolve()\n  }\n\n}\n\nconst definition = Object.fromEntries(LoadTypes.map(type => [type, {\n  get: function() {\n    const key = `__${type}`\n    if (Is.undefined(this[key])) this[key] = []\n    return this[key]\n  }\n}]))\nObject.defineProperties(UrlsByType.prototype, definition)\nconst UrlsByTypeNone = new UrlsByType\nexport { UrlsByType }\n","import { UrlsByType } from \"../../Loading/UrlsByType\"\n\nexport const inaudible = {\n  audible: { value: false },\n  urlsAudibleInTimeRangeForClipByType: {\n    value: function() { return UrlsByType.none }\n  },\n}\n","import { TrackType } from \"../../Setup\"\n\nexport const visibleMedia = { \n  visible: { value: true },\n  trackType: { value: TrackType.video },\n}","import { Is } from \"../../Utilities\"\nimport { Property } from \"../../Setup\"\n\nexport const propertiesModular = { \n  propertiesModular: { \n    get: function() { \n      if (Is.undefined(this.__propertiesModular)) {\n        this.__propertiesModular = this.object.properties || {}\n      }\n      return this.__propertiesModular \n    }\n  }, \n  modularPropertiesByType: {\n    get: function() {\n      if (Is.undefined(this.__modularPropertiesByType)) {\n        this.__modularPropertiesByType = this.initializeModularPropertiesByType\n      }\n      return this.__modularPropertiesByType\n    }\n  },\n  initializeModularPropertiesByType: {\n    get: function() {\n      const object = {}\n      Property.modularPropertyTypeIds.forEach(type => {\n        Object.keys(this.propertiesModular).forEach(property => {\n          if (type === this.propertiesModular[property].type) {\n            object[type] ||= []\n            object[type].push(property)\n          }\n        })\n      })\n      return object\n    }\n  },\n} \n","import { propertiesModular } from \"./propertiesModular\"\n\nexport const modular = { \n  modular: { value: true },\n  ...propertiesModular,\n}\n","class CoreFilter {}\n\nObject.defineProperties(CoreFilter.prototype, {\n  scopeSet: { value() {} },\n  draw: { value(evaluator) { return evaluator.context } },\n})\n\nexport { CoreFilter }\n","import { CoreFilter } from \"./CoreFilter\"\nimport { Property } from \"../Setup\"\nimport { Utilities } from \"../Utilities\"\n\nconst array_key = (array, value, key, id_key) => {\n  return Utilities.findBy(array, value, id_key)[key];\n}\n\nclass BlendFilter extends CoreFilter {\n  draw(evaluator, evaluated, outputContext) {\n    const context = evaluator.context\n    \n    const mode = array_key(Property.propertyTypes.mode.values, evaluated.all_mode, 'composite')\n    outputContext.globalCompositeOperation = mode\n    outputContext.drawImage(context.canvas, 0, 0)\n    outputContext.globalCompositeOperation = 'normal'\n    return outputContext\n  }\n}\nconst BlendFilterInstance = new BlendFilter\nexport { BlendFilterInstance as BlendFilter } \n","import { CoreFilter } from \"./CoreFilter\"\nimport { Colors } from \"../Utilities\"\nimport { Pixel } from \"../Utilities\"\n\nclass ChromaKeyFilter extends CoreFilter {\n  get parameters() { \n    return [\n      { name: \"color\", value: \"color\" },\n      { name: \"similarity\", value: \"similarity\" },\n      { name: \"blend\", value: \"blend\" }\n    ]\n  }\n\n  draw(evaluator, evaluated) {\n    const context = evaluator.context\n    const canvas = context.canvas\n    const { width, height } = canvas\n    const { blend, color, similarity, accurate } = evaluated\n    const components = color.substr(4, color.length - 5).split(',')\n    const colors = components.map(f => Number(f))\n    const rgb = { r: colors[0], g: colors[1], b: colors[2] }\n    const yuv = Colors.rgb2yuv(rgb)\n    const frame = context.getImageData(0, 0, width, height)\n    const pixels = frame.data\n    const yuvs = accurate ? (\n      this.yuvsFromPixelsAccurate(pixels, width, height)\n    ) : this.yuvsFromPixels(pixels)\n    \n    let offset = 0\n    yuvs.forEach(matrix => {\n      pixels[offset + 3] = Colors.yuv_blend(matrix, yuv, similarity, blend)\n      offset += 4\n    })\n    context.putImageData(frame, 0, 0)\n    return context\n  }\n\n  yuvsFromPixelsAccurate(pixels, width, height) {\n    let index = pixels.length / 4\n    const array = []\n    while(index--) {\n      const offset = index * 4\n      const rgbs = Pixel.rgbs(offset, pixels, width, height)\n      array.push(rgbs.map(rgb => Colors.rgb2yuv(rgb)))\n    }\n    return array\n  }\n\n  yuvsFromPixels(pixels) {\n    let index = pixels.length / 4\n    const array = []\n    while(index--) {\n      const offset = index * 4\n      array.push([Colors.rgb2yuv(Pixel.rgbAtIndex(offset, pixels))])\n    }\n    return array\n  }\n}\nconst ChromaKeyFilterInstance = new ChromaKeyFilter\nexport { ChromaKeyFilterInstance as ChromaKeyFilter } ","import { Is } from \"../Utilities\"\nimport { Pixel } from \"../Utilities\"\nimport { CoreFilter } from \"./CoreFilter\"\n\nclass ColorFilter extends CoreFilter {\n  draw(evaluator, evaluated) {\n    const { context } = evaluator\n    const { color } = evaluated\n    if (! Is.string(color)) return context\n\n    const { canvas } = context\n    const { width, height } = canvas\n\n    context.fillStyle = Pixel.color(color)\n    context.fillRect(0, 0, width, height)\n    return context\n  }\n\n  get parameters() { \n    return [\n      { name: \"color\", value: \"color\" },\n      { name: \"size\", value: \"mm_dimensions\" },\n      { name: \"duration\", value: \"mm_duration\" },\n      { name: \"rate\", value: \"mm_fps\" },\n    ]\n  }\n}\nconst ColorFilterInstance = new ColorFilter\nexport { ColorFilterInstance as ColorFilter }","\nimport { CoreFilter } from \"./CoreFilter\"\n\nclass ColorChannelMixerFilter extends CoreFilter {\n  draw(evaluator, evaluated) {\n    const context = evaluator.context\n    const rgbas = 'rgba'.split('');\n    var key, first, second, j, i, z = rgbas.length;\n    for (i = 0; i < z; i++) {\n      first = rgbas[i];\n      for (j = 0; j < z; j++) {\n        second = rgbas[j];\n        key = first + second;\n        if (null === evaluated[key]) evaluated[key] = ( first === second ? 1 : 0);\n      }\n    }\n    var red, green, blue, alpha, width, height, image_data, data;\n    width = context.canvas.width;\n    height = context.canvas.height;\n    image_data = context.getImageData(0, 0, width, height);\n    data = image_data.data;\n    z = data.length;\n    for (i = 0; i < z; i += 4) {\n      red = data[i];\n      green = data[i + 1];\n      blue = data[i + 2];\n      alpha = data[i + 3];\n      data[i] = red*evaluated.rr + green*evaluated.rg + blue*evaluated.rb + alpha*evaluated.ra;\n      data[i + 1] = red*evaluated.gr + green*evaluated.gg + blue*evaluated.gb + alpha*evaluated.ga;\n      data[i + 2] = red*evaluated.br + green*evaluated.bg + blue*evaluated.bb + alpha*evaluated.ba;\n      data[i + 3] = red*evaluated.ar + green*evaluated.ag + blue*evaluated.ab + alpha*evaluated.aa;\n    }\n    context.putImageData(image_data, 0, 0);\n    return context\n  }\n}\nconst ColorChannelMixerFilterInstance = new ColorChannelMixerFilter\nexport { ColorChannelMixerFilterInstance as ColorChannelMixerFilter } \n","import { Pixel } from \"../Utilities\"\nimport { CoreFilter } from \"./CoreFilter\"\n\nconst RBGA = 'rgba'\n\nconst parse = (evaluated) => {\n  const result = { bias: {}, rdiv: {}, matrix: {} }\n  RBGA.split('').forEach((channel, index) => {\n    const matrix = evaluated[`${index}m`].split(' ').map(i => parseInt(i))\n    result.matrix[channel] = matrix\n    result.rdiv[channel] = evaluated[`${index}rdiv`] || 1\n    if (String(result.rdiv[channel]).includes('/')) {\n      const array = result.rdiv[channel].split('/')\n      result.rdiv[channel] = parseFloat(array[0]) / parseFloat(array[1])\n    } else result.rdiv[channel] = parseFloat(result.rdiv[channel])\n    result.bias[channel] = evaluated[`${index}bias`] || 0\n  })\n  // console.log(ConvolutionFilter.name, \"parse\", evaluated, result)\n  return result\n  \n}\n\nconst matrix3 = (options, inputData, outputDdata, width, height) => {\n  const area = width * height;\n  for (let pixel = 0; pixel < area; pixel++) {\n    const rgbs = Pixel.rgbs(pixel, inputData, width, height)\n    RBGA.split('').forEach((channel, index) => {\n      const rdiv = options.rdiv[channel]\n      const matrix = options.matrix[channel]\n      const bias = options.bias[channel]\n      let sum = 0\n      for (let y = 0; y < 9; y++) sum += rgbs[y][channel] * matrix[y]\n      \n      sum = Math.floor(sum * rdiv + bias + 0.5)\n      outputDdata[pixel * 4 + index] = sum\n    })\n  }\n}\n\nclass ConvolutionFilter extends CoreFilter {\n draw(evaluator, evaluated) {\n    const options = parse(evaluated)\n    const context = evaluator.context\n    const canvas = context.canvas\n    const { width, height } = canvas\n    const input = context.getImageData(0, 0, width, height)\n    const output = context.createImageData(width, height)\n    matrix3(options, input.data, output.data, width, height)\n    context.putImageData(output, 0, 0)\n    return context\n  }\n}\n\nconst ConvolutionFilterInstance = new ConvolutionFilter\nexport { ConvolutionFilterInstance as ConvolutionFilter }","import { Is } from \"../Utilities\"\nimport { Context } from \"../Utilities\"\nimport { CoreFilter } from \"./CoreFilter\"\n\nclass CropFilter extends CoreFilter {\n  draw(evaluator, evaluated) {\n    const context = evaluator.context\n    const x = evaluated.x || 0\n    const y = evaluated.y || 0\n    const in_width = evaluator.get(\"mm_input_width\")\n    const in_height = evaluator.get(\"mm_input_height\")\n    let width = evaluated.w || evaluated.out_w\n    let height = evaluated.h || evaluated.out_h\n    if (2 > width + height) throw 'crop.draw invalid output dimensions'\n    if (!(in_width && in_height)) throw 'crop.draw invalid input dimensions'\n    \n    if (-1 === width) width = in_width * (height / in_height)\n    if (-1 === height) height = in_height * (width / in_width)\n\n    const drawing = Context.createDrawing(width, height)\n    drawing.drawImage(context.canvas, x, y, width, height, 0, 0, width, height)\n    return [drawing]\n  }\n  scopeSet(evaluator) {\n    const { width, height } = evaluator.context.canvas\n    evaluator.set(\"in_h\", height)\n    evaluator.set(\"mm_input_height\", height)\n    evaluator.set(\"in_w\", width)\n    evaluator.set(\"mm_input_width\", width)\n    if (Is.not(evaluator.get(\"x\"))) evaluator.set(\"x\", '((in_w - out_w) / 2)')\n    if (Is.not(evaluator.get(\"y\"))) evaluator.set(\"y\", '((in_h - out_h) / 2)')\n  }\n}\n\nconst CropFilterInstance = new CropFilter\nexport { CropFilterInstance as CropFilter }\n","import { Is, Pixel } from \"../Utilities\"\nimport { CoreFilter } from \"./CoreFilter\"\n\nclass DrawBoxFilter extends CoreFilter {\n  draw(evaluator, evaluated) {\n    const { context } = evaluator\n    const color = (Is.undefined(evaluated.color) ? 'black' : evaluated.color)\n    const x = evaluated.x || 0\n    const y = evaluated.y || 0\n    const width = evaluated.width || context.canvas.width\n    const height = evaluated.height || context.canvas.height\n\n    context.fillStyle = Pixel.color(color)\n    context.fillRect(x, y, width, height)\n    return context\n  }\n}\n\nconst DrawBoxFilterInstance = new DrawBoxFilter()\n\nexport { DrawBoxFilterInstance as DrawBoxFilter }\n","import { CoreFilter } from \"./CoreFilter\"\nimport { Cache } from \"../Loading\"\nimport { Module } from \"../Setup\"\nimport { Pixel } from \"../Utilities\"\n\nconst mmFontFile = id => Module.fontById(id).source\nconst mmTextFile = text => text\nconst mmFontFamily = id => Cache.key(mmFontFile(id))\n\nclass DrawTextFilter extends CoreFilter {\n  get parameters() {\n    return [\n      {\n        name: \"fontcolor\",\n        value: \"#000000\"\n      }, {\n        name: \"shadowcolor\",\n        value: \"#FFFFFF\"\n      }, {\n        name: \"fontsize\",\n        value: \"mm_vert(20)\"\n      }, {\n        name: \"x\",\n        value: \"0\"\n      }, {\n        name: \"y\",\n        value: \"0\"\n      }, {\n        name: \"shadowx\",\n        value: \"mm_horz(5)\"\n      }, {\n        name: \"shadowy\",\n        value: \"mm_vert(5)\"\n      }, {\n        name: \"fontfile\",\n        value: \"mmFontFile('com.moviemasher.font.default')\"\n      }, {\n        name: \"textfile\",\n        value: \"Hello World\"\n      }\n    ]\n  }\n\n  draw(evaluator, evaluated) {\n    const { context } = evaluator\n    const family = mmFontFamily(evaluator.get(\"fontface\"))\n    const { x, y, fontsize, fontcolor, text, textfile, shadowcolor } = evaluated\n\n    if (shadowcolor) {\n      context.shadowColor = shadowcolor\n      const { shadowx, shadowy } = evaluated\n      context.shadowOffsetX = shadowx || 0\n      context.shadowOffsetY = shadowy || 0\n    }\n\n    context.font = `${fontsize}px \"${family}\"`\n    context.fillStyle = Pixel.color(fontcolor)\n    context.fillText(text || textfile, x, Number(y) + Number(fontsize))\n\n    if (shadowcolor) {\n      context.shadowColor = null\n      context.shadowOffsetX = 0\n      context.shadowOffsetY = 0\n      // context.shadowBlur = 0\n    }\n    return context\n  }\n\n  scopeSet(evaluator) {\n    evaluator.set(\"text_w\", 0) // width of the text to draw\n    evaluator.set(\"text_h\", 0) // height of the text to draw\n    evaluator.set(\"mmFontFamily\", mmFontFamily)\n    evaluator.set(\"mmTextFile\", mmTextFile)\n    evaluator.set(\"mmFontFile\", mmFontFile)\n\n    // support deprecated snake case\n    evaluator.set(\"mm_fontfamily\", mmFontFamily)\n    evaluator.set(\"mm_textfile\", mmTextFile)\n    evaluator.set(\"mm_fontfile\", mmFontFile)\n  }\n}\n\nconst DrawTextFilterInstance = new DrawTextFilter()\nexport { DrawTextFilterInstance as DrawTextFilter }\n","import { Context } from \"../Utilities\"\nimport { CoreFilter } from \"./CoreFilter\"\n\nclass FadeFilter extends CoreFilter{\n  draw(evaluator) {\n    const context = evaluator.context\n    const drawing = Context.createDrawingLike(context)\n    drawing.globalAlpha = evaluator.get(\"mm_t\")\n    drawing.drawImage(context.canvas, 0, 0)\n    drawing.globalAlpha = 1\n    return drawing\n  }\n}\nconst FadeFilterInstance = new FadeFilter\nexport { FadeFilterInstance as FadeFilter }","import { Errors } from \"../Setup\"\nimport { Is } from \"../Utilities\"\nimport { CoreFilter } from \"./CoreFilter\"\n\nclass OverlayFilter extends CoreFilter {\n  draw(evaluator, evaluated, outputContext) {\n    if (Is.undefined(outputContext)) return\n\n    const { context } = evaluator    \n    const { canvas } = context\n    const { x, y } = evaluated\n    outputContext.drawImage(canvas, x, y)\n    return outputContext\n  }\n  scopeSet(evaluator) {\n    const { context } = evaluator\n    if (Is.undefined(context)) throw Errors.internal + evaluator.constructor.name\n    const { width, height } = context.canvas\n    evaluator.set(\"overlay_w\", width)\n    evaluator.set(\"overlay_h\", height)\n    \n  }\n}\nconst OverlayFilterInstance = new OverlayFilter\nexport { OverlayFilterInstance as OverlayFilter }","import { Context } from \"../Utilities\"\nimport { CoreFilter } from \"./CoreFilter\"\n\nclass ScaleFilter extends CoreFilter {\n  draw(evaluator, evaluated) {\n    const { context } = evaluator\n    let width = evaluated.w || evaluated.width\n    let height = evaluated.h || evaluated.height\n\n    if (width + height < 2) return context\n\n    const inWidth = evaluator.get(\"mm_input_width\")\n    const inHeight = evaluator.get(\"mm_input_height\")\n    if (width === -1) width = inWidth * (height / inHeight)\n    else if (height === -1) height = inHeight * (width / inWidth)\n\n    const drawing = Context.createDrawing(width, height)\n    drawing.drawImage(context.canvas, 0, 0, inWidth, inHeight, 0, 0, width, height)\n    return drawing\n  }\n\n  scopeSet(evaluator) {\n    const { context } = evaluator\n    const { canvas } = context\n\n    const { width, height } = canvas\n    evaluator.set(\"in_h\", height)\n    evaluator.set(\"mm_input_height\", height)\n    evaluator.set(\"in_w\", width)\n    evaluator.set(\"mm_input_width\", width)\n  }\n}\nconst ScaleFilterInstance = new ScaleFilter()\nexport { ScaleFilterInstance as ScaleFilter }\n","import { CoreFilter } from \"./CoreFilter\"\n\nclass SetSarFilter extends CoreFilter {}\nconst SetSarFilterInstance = new SetSarFilter()\nexport { SetSarFilterInstance as SetSarFilter }\n","import { BlendFilter } from \"../CoreFilter/BlendFilter\"\nimport { ChromaKeyFilter } from \"../CoreFilter/ChromaKeyFilter\"\nimport { ColorFilter } from \"../CoreFilter/ColorFilter\"\nimport { ColorChannelMixerFilter } from \"../CoreFilter/ColorChannelMixerFilter\"\nimport { ConvolutionFilter } from \"../CoreFilter/ConvolutionFilter\"\nimport { CropFilter } from \"../CoreFilter/CropFilter\"\nimport { DrawBoxFilter } from \"../CoreFilter/DrawBoxFilter\"\nimport { DrawTextFilter } from \"../CoreFilter/DrawTextFilter\"\nimport { FadeFilter } from \"../CoreFilter/FadeFilter\"\nimport { OverlayFilter } from \"../CoreFilter/OverlayFilter\"\nimport { ScaleFilter } from \"../CoreFilter/ScaleFilter\"\nimport { SetSarFilter } from \"../CoreFilter/SetSarFilter\"\n\nconst Filters = {\n  blend: BlendFilter,\n  chromakey: ChromaKeyFilter,\n  colorchannelmixer: ColorChannelMixerFilter,\n  color: ColorFilter,\n  convolution: ConvolutionFilter,\n  crop: CropFilter,\n  drawbox: DrawBoxFilter,\n  drawtext: DrawTextFilter,\n  fade: FadeFilter,\n  overlay: OverlayFilter,\n  scale: ScaleFilter,\n  setsar: SetSarFilter,\n}\nconst FilterTypes = Object.keys(Filters)\nconst FilterType = Object.fromEntries(FilterTypes.map(type => [type, type]))\n\nconst FilterFactory = {\n  type: FilterType\n}\n\nObject.defineProperties(FilterFactory, {\n  type: { value: FilterType },\n  types: { value: FilterTypes },\n  create: { value(id) { return Filters[id] } },\n  created: { value(id) { return FilterTypes.includes(id) } }\n})\n\nexport { FilterFactory }\n","export const drawFilters = {\n  drawFilters: { value: function(evaluator, context) {\n    // console.log(this.constructor.name, this.id, \"draw\", evaluator)\n    this.coreFilter.scopeSet(evaluator)\n    return this.coreFilter.draw(evaluator, this.evaluateScope(evaluator), context)\n  }}\n}","import { Base } from \"../Base\"\nimport { Is } from \"../Utilities\"\nimport { Property } from \"../Setup\"\n\nclass Media extends Base {\n  id : string\n\n  properties? : object[]\n\n  initializeInstance(clip, object) {\n    const { properties } = this\n    if (!Is.object(properties) || Is.empty(properties)) return\n\n    const names = this.propertyNames.filter(name => !Reflect.has(clip, name))\n    if (!Is.emptyarray(names)) {\n      const entries = names.map(name => [name, {\n        get() {\n          const key = `__${name}`\n          if (Is.undefined(this[key])) {\n            const property = properties[name]\n            this[key] = Property.orDefault(property)\n          }\n          return this[key]\n        },\n        set(value) { this[`__${name}`] = value }\n      }])\n      Object.defineProperties(clip, Object.fromEntries(entries))\n      this.propertyNames.forEach(name => {\n        if (Is.defined(object[name])) clip.set(name, object[name])\n      })\n    }\n  }\n\n  get propertyNames() : string[] {\n    return this.properties ? Object.keys(this.properties) : []\n  }\n}\n\nexport { Media }\n","import { MediaType } from \"../Setup\"\nimport { sharedMedia } from \"./with/sharedMedia\"\nimport { modular } from \"./with/modular\"\nimport { parameters } from \"./with/parameters\"\nimport { Is, Throw } from \"../Utilities\"\nimport { FilterFactory } from \"../Factory/FilterFactory\"\nimport { CoreFilter } from \"../CoreFilter\"\nimport { drawFilters } from \"./with/drawFilters\"\nimport { Media } from \"./Media\"\n\nclass FilterMedia extends Media {}\n\nObject.defineProperties(FilterMedia.prototype, {\n  type: { value: MediaType.filter },\n  ...sharedMedia,\n  ...modular,\n  ...parameters,\n  coreFilter: {\n    get() {\n      if (Is.undefined(this.__coreFilter)) {\n        this.__coreFilter = FilterFactory.create(this.id)\n        Throw.unlessInstanceOf(this.__coreFilter, CoreFilter)\n      }\n      return this.__coreFilter\n    }\n  },\n  evaluateScope: {\n    value(evaluator) {\n      const evaluated = {}\n      const definitions = this.parameters || this.coreFilter.parameters\n      if (Is.not(definitions)) return evaluated\n\n      definitions.forEach(parameter => {\n        const { name } = parameter\n        if (Is.not(name)) return\n\n        evaluated[name] = evaluator.evaluate(parameter.value)\n        evaluator.set(name, evaluated[name])\n      })\n      return evaluated\n    }\n  },\n  ...drawFilters,\n})\n\nexport { FilterMedia }\n","\nexport const parameters = {\n  parameters: { get: function() { return this.object.parameters } },\n}","\nimport { FilterMedia } from \"../FilterMedia\"\n\nexport const filters = { \n  filters: { \n    get: function() { return this.__filters ||= this.filtersInitialize } \n  }, \n  filtersInitialize: { \n    get: function() { \n      const array = this.object.filters || []\n      return array.map(object => new FilterMedia(object))\n    }\n  }\n} \n","\n  export const html = { \n    html: { get: function() { return this.object.html } },\n    inspector: { get: function() { return this.object.inspector } },\n  }","import { Is } from \"../../Utilities\"\nimport { Module, Errors } from \"../../Setup\"\nimport { UrlsByType } from \"../../Loading\"\n\nexport const urlsFromFilters = {\n  urlsVisibleInTimeRangeForClipByType: {\n    value(timeRange, clip) {\n      const urls = new UrlsByType()\n      const propertiesByType = this.modularPropertiesByType\n      Object.keys(propertiesByType).forEach(type => {\n        const modularProperties = propertiesByType[type]\n        modularProperties.forEach(property => {\n          const value = clip.get(property)\n          // console.log(clip)\n          if (Is.defined(value)) {\n            const module = Module.ofType(value, type)\n            if (Is.defined(module)) {\n              urls[type].push(module.source)\n            }\n          } else throw Errors.unknown.type\n        })\n      })\n\n      return urls\n    }\n  }\n}\n","import { filters } from \"./filters\"\nimport { html } from \"./html\"\nimport { modular } from \"./modular\"\nimport { urlsFromFilters } from \"./urlsFromFilters\"\n\nexport const transform = {\n  ...filters,\n  ...urlsFromFilters,\n  ...html,\n  ...modular,\n}","import { MediaType } from \"../Setup\"\nimport { sharedMedia } from \"./with/sharedMedia\"\nimport { inaudible } from \"./with/inaudible\"\nimport { visibleMedia } from \"./with/visibleMedia\"\nimport { transform } from \"./with/transform\"\nimport { Media } from \"./Media\"\n\nclass EffectMedia extends Media {}\n\nObject.defineProperties(EffectMedia.prototype, {\n  type: { value: MediaType.effect },\n  ...sharedMedia,\n  ...transform,\n  ...inaudible,\n  ...visibleMedia,\n})\n\nexport { EffectMedia }\n","import { MediaType } from \"../Setup\"\nimport { Media } from \"./Media\"\nimport { drawFilters } from \"./with/drawFilters\"\nimport { inaudible } from \"./with/inaudible\"\nimport { sharedMedia } from \"./with/sharedMedia\"\nimport { transform } from \"./with/transform\"\n\nclass ScalerMedia extends Media {}\n\nObject.defineProperties(ScalerMedia.prototype, {\n  type: { value: MediaType.scaler },\n  ...sharedMedia,\n  ...transform,\n  ...inaudible,\n  ...drawFilters,\n})\n\nexport { ScalerMedia }\n","\nimport { MediaType } from \"../Setup\"\nimport { sharedMedia } from \"./with/sharedMedia\"\nimport { inaudible } from \"./with/inaudible\"\nimport { transform } from \"./with/transform\"\nimport { drawFilters } from \"./with/drawFilters\"\nimport { Media } from \"./Media\"\n\nclass MergerMedia extends Media {}\n\nObject.defineProperties(MergerMedia.prototype, {\n  type: { value: MediaType.merger },\n  ...sharedMedia,\n  ...transform,\n  ...inaudible,\n  ...drawFilters,\n})\n\nexport { MergerMedia }\n","export const modularFalse = { modular: { value: false } }\n","import { UrlsByType } from \"../../Loading\"\n\nexport const invisible = {\n  visible: { value: false },\n  urlsVisibleInTimeRangeForClipByType: {\n    value: function() { return UrlsByType.none }\n  },\n}\n","import { Default } from \"../../Setup\"\nimport { Is } from \"../../Utilities\"\n\nexport const duration = { \n  duration: { \n    get: function() { \n      if (Is.undefined(this.__duration)) {\n        this.__duration = Number(this.object.duration)\n        this.__duration ||= Default.media[this.type].duration \n      }\n      return this.__duration \n    }\n  }, \n} \n","export const propertiesTiming = {\n  propertiesTiming: { value: {\n    frame: { type: \"number\", value: 0 },\n    frames: { type: \"number\", value: 0 },\n  }}\n}\n","import { propertiesAudible } from \"./propertiesAudible\"\nimport { urlsAudible } from \"./urlsAudible\"\n\nexport const audible = { \n  audible: { value: true },\n  ...propertiesAudible,\n  ...urlsAudible,\n}","export const propertiesAudible = {\n  propertiesAudible: { \n    value: {\n      gain: {\n        type: \"number\", value: 1.0,\n      },\n      trim: {\n        type: \"integer\", value: 0,\n      },\n    } \n  }\n}","import { UrlsByType } from \"../../Loading\"\n\nexport const urlsAudible = {\n  urlsAudibleInTimeRangeForClipByType: {\n    value: function() {\n      const urls = new UrlsByType\n      const url = this.urlAudible\n      if (url) urls.audio.push(url)\n      return urls\n    }\n  },\n}\n","import { MediaType, TrackType } from \"../Setup\"\nimport { modularFalse } from \"./with/modularFalse\"\nimport { invisible } from \"./with/invisible\"\nimport { duration } from \"./with/duration\"\nimport { urlAudible } from \"./with/urlAudible\"\nimport { sharedMedia } from \"./with/sharedMedia\"\nimport { propertiesTiming } from \"./with/propertiesTiming\"\nimport { audible } from \"./with/audible\"\nimport { Media } from \"./Media\"\n\nclass AudioMedia extends Media {}\n\nObject.defineProperties(AudioMedia.prototype, {\n  type: { value: MediaType.audio },\n  trackType: { value: TrackType.audio },\n  ...sharedMedia,\n  ...modularFalse,\n  ...invisible,\n  ...duration,\n  ...urlAudible,\n  ...audible,\n  ...propertiesTiming,\n})\n\nexport { AudioMedia }\n","export const urlAudible = { \n  urlAudible: { \n    get: function() { \n      return this.object.audio || this.object.url || this.object.source \n    } \n  },\n}\n","import { MediaType } from \"../Setup\"\nimport { filters } from \"./with/filters\"\nimport { urlsFromFilters } from \"./with/urlsFromFilters\"\nimport { inaudible } from \"./with/inaudible\"\nimport { sharedMedia } from \"./with/sharedMedia\"\nimport { Media } from \"./Media\"\n\nclass FontMedia extends Media {}\n\nObject.defineProperties(FontMedia.prototype, {\n  type: { value: MediaType.font },\n  ...sharedMedia,\n  ...filters,\n  ...urlsFromFilters,\n  ...inaudible,\n})\n\nexport { FontMedia }\n","export const urlAudibleMute = { \n  urlAudible: { \n    get: function() { \n      switch (this.object.audio) {\n        case undefined: return this.object.source\n        case 0: return\n      }\n      return this.object.audio\n    } \n  },\n}\n","import { LoadType } from \"../../Setup\"\nimport { TimeFactory } from \"../../Factory/TimeFactory\"\nimport { Is } from \"../../Utilities\"\nimport { UrlsByType } from \"../../Loading\"\n\nexport const urlsVisibleFrames = {\n  fps: { get: function() { return this.__fps ||= this.object.fps || 10 } },\n\n  framesMax: {\n    get: function() { return Math.floor(this.fps * this.duration) }\n  },\n\n  begin: { get: function() { return this.__begin ||= this.object.begin || 1 } },\n\n  pattern: {\n    get: function() { return this.__pattern ||= this.object.pattern || '%.jpg' }\n  },\n\n  increment: {\n    get: function() { return this.__increment ||= this.object.increment || 1 }\n  },\n\n  zeropadding: {\n    get: function() {\n      return this.__zeropadding ||= this.zeropaddingInitialize\n    }\n  },\n\n  zeropaddingInitialize: {\n    get: function() {\n      const value = this.object.zeropadding\n      if (Is.defined(value)) return value\n\n      const last_frame = this.begin + (this.increment * this.framesMax)\n      return String(last_frame).length\n    }\n  },\n\n  url: { get: function() { return this.__url ||= this.object.url || \"\" } },\n\n  limitedTimeRange: { value: function(timeRange) {\n    return timeRange.minEndTime(TimeFactory.createFromFrame(this.framesMax, this.fps))\n  } },\n\n  urlsVisibleInTimeRangeForClipByType: {\n    value: function(timeRange, clip) {\n      const urls = new UrlsByType\n      const max_frames = this.framesMax\n      const range = this.limitedTimeRange(timeRange)//.scale(this.fps)\n      //console.log(\"range\", range)\n\n      let last_frame\n      for (let frame = range.frame; frame < range.end; frame++) {\n\n        const time = TimeFactory.createFromFrame(frame, range.fps)\n        const media_time = time.scale(this.fps)\n\n        //console.log(time, media_time)\n        if ((frame !== range.frame) && (last_frame === media_time.frame)) {\n          continue\n        }\n        last_frame = media_time.frame;\n        last_frame = Math.min(last_frame, max_frames - 1)\n        let s = String((Math.min(last_frame, max_frames) * this.increment) + this.begin)\n        if (this.zeropadding) s = s.padStart(this.zeropadding, '0')\n        const url = (this.url + this.pattern).replaceAll('%', s)\n        urls[LoadType.image].push(url)\n      }\n      return urls\n    }\n  }\n}\n","import { MediaType } from \"../Setup\"\nimport { duration } from \"./with/duration\"\nimport { modularFalse } from \"./with/modularFalse\"\nimport { sharedMedia } from \"./with/sharedMedia\"\nimport { visibleMedia } from \"./with/visibleMedia\"\nimport { urlAudibleMute } from \"./with/urlAudibleMute\"\nimport { urlsVisibleFrames } from \"./with/urlsVisibleFrames\"\nimport { propertiesTiming } from \"./with/propertiesTiming\"\nimport { audible } from \"./with/audible\"\nimport { Media } from \"./Media\"\n\nclass VideoMedia extends Media {}\n\nObject.defineProperties(VideoMedia.prototype, {\n  type: { value: MediaType.video },\n  ...sharedMedia,\n  ...modularFalse,\n  ...visibleMedia,\n  ...duration,\n  ...urlAudibleMute,\n  ...urlsVisibleFrames,\n  ...audible,\n  ...propertiesTiming,\n})\n\nexport { VideoMedia }\n","export const urlVisible = { \n  urlVisible: { \n    get: function() { \n      return this.object.url\n    } \n  },\n}\n","import { LoadType } from \"../../Setup\"\nimport { UrlsByType } from \"../../Loading\"\n\nexport const urlsVisible = {\n  urlsVisibleInTimeRange: { value: function() { return [this.urlVisible] } },\n  urlsVisibleInTimeRangeForClipByType: { value: function(timeRange, clip) {\n    const urls = new UrlsByType\n    const url = this.urlVisible\n    if (url) urls[LoadType.image].push(url)\n    return urls\n  }},\n}\n","import { MediaType } from \"../Setup\"\nimport { modularFalse } from \"./with/modularFalse\"\nimport { inaudible } from \"./with/inaudible\"\nimport { visibleMedia } from \"./with/visibleMedia\"\nimport { duration } from \"./with/duration\"\nimport { urlVisible } from \"./with/urlVisible\"\nimport { urlsVisible } from \"./with/urlsVisible\"\nimport { sharedMedia } from \"./with/sharedMedia\"\nimport { propertiesTiming } from \"./with/propertiesTiming\"\nimport { Media } from \"./Media\"\n\nclass ImageMedia extends Media {}\n\nObject.defineProperties(ImageMedia.prototype, {\n  type: { value: MediaType.image },\n  ...sharedMedia,\n  ...modularFalse,\n  ...inaudible,\n  ...visibleMedia,\n  ...duration,\n  ...propertiesTiming,\n  ...urlVisible,\n  ...urlsVisible,\n})\n\nexport { ImageMedia }\n","import { MediaType } from \"../Setup\"\nimport { Media } from \"./Media\"\nimport { duration } from \"./with/duration\"\nimport { filters } from \"./with/filters\"\nimport { html } from \"./with/html\"\nimport { inaudible } from \"./with/inaudible\"\nimport { modular } from \"./with/modular\"\nimport { propertiesModular } from \"./with/propertiesModular\"\nimport { propertiesTiming } from \"./with/propertiesTiming\"\nimport { sharedMedia } from \"./with/sharedMedia\"\nimport { urlsFromFilters } from \"./with/urlsFromFilters\"\nimport { visibleMedia } from \"./with/visibleMedia\"\n\nclass ThemeMedia extends Media {}\n\nObject.defineProperties(ThemeMedia.prototype, {\n  type: { value: MediaType.theme },\n  ...sharedMedia,\n  ...modular,\n  ...inaudible,\n  ...visibleMedia,\n  ...duration,\n  ...filters,\n  ...propertiesModular,\n  ...propertiesTiming,\n  ...html,\n  ...urlsFromFilters,\n})\n\nexport { ThemeMedia }\n","import { UrlsByType } from \"../../Loading\"\n\nexport const urlsNone = {\n  urlsVisibleInTimeRangeForClipByType: {\n    value: function() { return UrlsByType.none }\n  },\n  urlsVisibleInTimeRangeForClipByType: {\n    value: function() { return UrlsByType.none }\n  },\n}\n","import { MediaType } from \"../Setup\"\nimport { Media } from \"./Media\"\nimport { duration } from \"./with/duration\"\nimport { inaudible } from \"./with/inaudible\"\nimport { modular } from \"./with/modular\"\nimport { propertiesTiming } from \"./with/propertiesTiming\"\nimport { sharedMedia } from \"./with/sharedMedia\"\nimport { urlsNone } from \"./with/urlsNone\"\nimport { visibleMedia } from \"./with/visibleMedia\"\n\nclass TransitionMedia extends Media {}\n\nObject.defineProperties(TransitionMedia.prototype, {\n  type: { value: MediaType.transition },\n  ...sharedMedia,\n  ...modular,\n  ...inaudible,\n  ...visibleMedia,\n  ...propertiesTiming,\n  ...duration,\n  ...urlsNone,\n})\n\nexport { TransitionMedia }\n","import { Factory } from \"./Factory\"\nimport { MediaType, Module, ModuleTypes } from \"../Setup\"\nimport { EffectMedia } from \"../Media/EffectMedia\"\nimport { ScalerMedia } from \"../Media/ScalerMedia\"\nimport { MergerMedia } from \"../Media/MergerMedia\"\nimport { AudioMedia } from \"../Media/AudioMedia\"\nimport { FontMedia } from \"../Media/FontMedia\"\nimport { VideoMedia } from \"../Media/VideoMedia\"\nimport { ImageMedia } from \"../Media/ImageMedia\"\nimport { ThemeMedia } from \"../Media/ThemeMedia\"\nimport { TransitionMedia } from \"../Media/TransitionMedia\"\nimport { Is } from \"../Utilities\"\nimport { Media } from \"../Media/Media\"\n\nclass MediaFactory extends Factory {\n  constructor() {\n    super(Media)\n    this.install(MediaType.audio, AudioMedia)\n    this.install(MediaType.video, VideoMedia)\n    this.install(MediaType.image, ImageMedia)\n    this.install(MediaType.theme, ThemeMedia)\n    this.install(MediaType.effect, EffectMedia)\n    this.install(MediaType.scaler, ScalerMedia)\n    this.install(MediaType.merger, MergerMedia)\n    this.install(MediaType.font, FontMedia)\n    this.install(MediaType.transition, TransitionMedia)\n  }\n\n  create(object) {\n    if (Is.instanceOf(object, Media)) return object\n\n    if (ModuleTypes.includes(object.type)) {\n      const module = Module.ofType(object.id, object.type)\n      if (module) return super.create(module)\n    }\n    return super.create(object)\n  }\n}\nconst MediaFactoryInstance = new MediaFactory()\nexport { MediaFactoryInstance as MediaFactory }\n","import { Errors } from \"../Setup\"\nimport { Is } from \"../Utilities\"\nimport { TimeRange } from \"../Utilities\"\nimport { Time } from \"../Utilities\"\n\nconst createFromArgs = (frame, fps, frames) => new TimeRange(frame, fps, frames)\n\nconst createFromSeconds = (start, duration) => createFromArgs(start, 1, duration)\n\nconst createFromTime = (time, frames) => (\n  createFromArgs(time.frame, time.fps, frames)\n)\n\nconst createFromTimes = (startTime, endTime) => {\n  const [time1, time2] = Time.scaleTimes(startTime, endTime)\n  if (time2.frame <= time1.frame) throw Errors.argument\n\n  return createFromArgs(time1.frame, time1.fps, time2.frame - time1.frame)\n}\n\nconst create = (object = {}) => { \n  if (Is.instanceOf(object, TimeRange)) return object\n  if (Is.instanceOf(object, Time)) return createFromTime(object)\n\n  const { frame, fps, frames } = object\n  return createFromArgs(frame, fps, frames) \n}\n\nconst TimeRangeFactory = {\n  create, createFromSeconds, createFromTime, createFromTimes\n}\n\nexport { TimeRangeFactory }\n","import { Is } from \"../../Utilities\"\n\nexport const toJSON = {\n  toJSON: { value: function() {\n    const object = { id: this.id, type: this.type, frame: this.frame  }\n    if (Is.array(this.effects)) object.effects = this.effects\n    return { ...this.propertyValues, ...object } \n  } }\n}\n","export const id = { \n  id: {  get: function() { return this.object.id || this.media.id } }\n}\n","export const labelFromObjectOrMedia = { \n  label: { \n    get: function() { return this.__label ||= this.labelInitialize },\n    set: function(value) { this.__label = value }\n  },\n  labelInitialize: { \n    get: function() { return this.object.label || this.media.label }\n  },\n}\n","import { MediaFactory } from \"../../Factory/MediaFactory\"\nimport { Is } from \"../../Utilities/Is\"\n\nexport const media = { \n  media: { \n    get: function() { \n      if (Is.undefined(this.__media)) {\n        this.__media = MediaFactory.create(this.object.media)\n      }\n      return this.__media \n    }\n  }, \n}\n","import { TransformTypes } from \"../../Setup\"\n\nexport const propertyValues = {\n  propertyValues: { get: function() {\n    // console.log(this.constructor.name, \"propertyValues\", this.properties)\n    return Object.fromEntries(Object.keys(this.properties).map(property => {\n      const valueOrTransform = this[property]\n      const transform = TransformTypes.includes(property)\n      const value = transform ? valueOrTransform.id : valueOrTransform\n      \n      return [property, value]\n    }))\n  }}\n}","export const propertiesFromMedia = { \n  properties: { get: function() { return this.media.properties } } \n}","import { object } from \"./object\"\n\n// clips and transforms\nexport const editable = {\n  ...object,\n  propertyNames: { get: function() { return Object.keys(this.properties)} },\n  properties: {\n    get: function() { return this.__properties ||= this.propertiesInitialize }\n  },\n  propertiesInitialize: {\n    get: function() { \n      const object = { ...this.media.properties }\n      if (this.propertiesTransform) Object.assign(object, this.propertiesTransform)\n      return object\n    }\n  },\n}","import { toJSON } from \"./toJSON\"\nimport { track } from \"./track\"\nimport { id } from \"./id\"\nimport { labelFromObjectOrMedia } from \"./labelFromObjectOrMedia\"\nimport { media } from \"./media\"\nimport { propertyValues } from \"./propertyValues\"\nimport { propertiesFromMedia } from \"./propertiesFromMedia\"\nimport { copy } from \"./copy\"\nimport { load } from \"./load\"\nimport { editable } from \"../../Base/with/editable\"\nimport { TimeFactory } from \"../../Factory/TimeFactory\"\nimport { TimeRangeFactory } from \"../../Factory/TimeRangeFactory\"\n\nexport const sharedClip = {\n  ...editable,\n  ...copy,\n  ...toJSON,\n  ...id,\n  ...labelFromObjectOrMedia,\n  ...track,\n  time: {\n    value: function(quantize) {\n      return TimeFactory.createFromFrame(this.frame, quantize)\n    }\n  },\n  timeRange: {\n    value: function(quantize) {\n      const options = { frame: this.frame, quantize, frames: this.frames }\n      return TimeRangeFactory.create(options)\n    }\n  },\n  timeRangeRelative: {\n    value: function(mashTime) {\n      const range = this.timeRange(mashTime.fps)\n      const frame = mashTime.frame - this.frame\n      if (frame < 0) {\n        console.log(this.constructor.name, \"timeRangeRelative\", mashTime, range)\n        return\n      }\n      return range.withFrame(frame)\n    }\n  },\n  ...media,\n  ...propertyValues,\n  ...propertiesFromMedia,\n  ...load,\n}\n","export const copy = {\n  copy: {\n    get: function() {\n      return new this.constructor({...this.toJSON(), media: this.media })\n    }\n  }\n}","export const load = {\n  load: { value: function(mashTimeRange) {\n    const urls = this.urlsVisibleInTimeRangeByType(mashTimeRange)\n    return urls.load()\n  }}\n}","import { UrlsByType } from \"../../Loading\"\n\nexport const inaudible = {\n  audible: { value: false },\n  urlsAudibleInTimeRangeByType: {\n    value: function() { return UrlsByType.none }\n  },\n}\n","import { Is } from \"../../Utilities\"\nimport { TrackType } from \"../../Setup/Types\"\n\nexport const visibleClip = { \n  visible: { value: true },\n\n  trackType: { value: TrackType.video },\n\n  scaledContextAtTimeForDimensions: {\n    value: function(mashTime, dimensions, ...rest) {\n      const context = this.contextAtTimeForDimensions(mashTime, dimensions, ...rest)\n      // console.log(\"scaledContextAtTimeForDimensions\", context)\n      if (!this.scaler) return context\n\n      const clipTimeRange = this.timeRangeRelative(mashTime)\n      if (Is.undefined(clipTimeRange)) return\n      \n      return this.scaler.drawMediaFilters(clipTimeRange, context, dimensions)\n    }\n  },\n\n  effectedContextAtTimeForDimensions: {\n    value: function(mashTime, dimensions, ...rest) {\n      let context = this.scaledContextAtTimeForDimensions(mashTime, dimensions, ...rest)\n      if (!this.effects) return context\n\n      const clipTimeRange = this.timeRangeRelative(mashTime)\n      if (Is.undefined(clipTimeRange)) return\n      \n      this.effects.reverse().forEach(effect => \n        context = effect.drawMediaFilters(clipTimeRange, context, dimensions)\n      )\n      return context\n    }\n  },\n  \n  mergeContextAtTime: { \n    value: function(mashTime, context, ...rest) { \n      \n      if (!this.merger) return context\n      const effected = this.effectedContextAtTimeForDimensions(mashTime, context.canvas, ...rest)\n      \n      const clipTimeRange = this.timeRangeRelative(mashTime)\n      if (Is.undefined(clipTimeRange)) return\n      \n      return this.merger.drawMerger(clipTimeRange, effected, context)\n    }\n  },\n}","\n\nexport const urls = {\n  urlsVisibleInTimeRangeByType: { \n    value: function(mashTimeRange) { \n      const range = this.mediaTimeRange(mashTimeRange)\n      const urls = this.media.urlsVisibleInTimeRangeForClipByType(range, this) \n      if (this.merger) {\n        urls.concat(this.merger.urlsVisibleInTimeRangeByType(range))\n      }\n      if (this.scaler) {\n        urls.concat(this.scaler.urlsVisibleInTimeRangeByType(range))\n      }\n      if (this.effects) this.effects.forEach(effect => \n        urls.concat(effect.urlsVisibleInTimeRangeByType(range))\n      )\n      return urls\n    }\n  },\n}\n\n\n","export const idMutable = {\n  id: { \n    get: function() { return this.__id ||= this.object.id },\n    set: function(value) { \n      this.__id = value \n      this.__media = null\n    }\n  }\n}","\n\nexport const urlsFromMedia = {\n  urlsVisibleInTimeRangeByType: { \n    value: function(timeRange) { \n      return this.media.urlsVisibleInTimeRangeForClipByType(timeRange, this) \n    }\n  },\n}\n\n\n","import { Errors, Module } from \"../../Setup\"\nimport { MediaFactory } from \"../../Factory/MediaFactory\"\n\nexport const media = {\n  media: { get: function() {\n    return this.__media ||= this.mediaInitialize }\n  },\n  mediaInitialize: {\n    get: function() {\n      if (this.object.media) return MediaFactory.create(this.object.media)\n\n      const module = Module.ofType(this.id, this.type)\n      if (! module) throw Errors.unknown[this.type] + this.type + ' ' + this.id\n\n      return MediaFactory.create(module)\n    }\n  }\n}\n","import { Errors } from \"../Setup\"\nimport { Is } from \"../Utilities/Is\"\nimport { TimeRange } from \"../Utilities/TimeRange\"\n\n\nconst KEYS_SIZED = ['mm_width', 'mm_height']\nconst KEYS_GETTERS = [\n  \"mm_dimensions\",\n  \"mm_duration\",\n  \"mm_fps\",\n  \"mm_height\",\n  \"mm_t\",\n  \"mm_width\",\n  \"t\",\n]\nconst KEYS = [\n  \"ceil\",\n  \"floor\",\n  \"mm_cmp\",\n  \"mm_horz\",\n  \"mm_max\",\n  \"mm_min\",\n  \"mm_vert\",\n  ...KEYS_GETTERS,\n  ...KEYS_SIZED\n] \n\nconst THIS = \"evaluator\"\n\nfunction Evaluator(timeRange, context, dimensions) { \n  if (!Is.instanceOf(timeRange, TimeRange)) throw Errors.argument + timeRange\n  if (!Is.object(timeRange)) throw Errors.argument + context\n  if (!Is.object(dimensions)) throw Errors.argument + dimensions\n\n  this.timeRange = timeRange\n  this.context = context\n  this.dimensions = dimensions \n  this.map = new Map\n}\n\nconst conditionalExpression = (conditional) => {\n  const condition = conditional.condition\n\n  // not strict equality, since we may have strings and numbers\n  if (Is.defined(conditional.is)) return `${condition}==${conditional.is}`\n  \n  const elements = conditional.in\n  if (Is.undefined(elements)) return condition\n\n  // support supplying values as array or comma-delimited string\n  const array = Is.string(elements) ? elements.split(',') : elements\n  const strings =Is.string(array[0])\n  const values = array.map(element => strings ? `\"${element}\"` : element)\n  const type = strings ? 'String' : 'Number'\n  const expression = `([${values.join(',')}].includes(${type}(${condition})))`\n  return expression\n}\n\nconst replaceOperators = (string) => { \n  return string.replaceAll(' or ', ' || ').replaceAll(' and ', ' && ')\n}\n\nObject.defineProperties(Evaluator.prototype, {\n  canvas: { get: function() { return this.context.canvas } },\n\n  ceil: { value: Math.ceil },\n\n  replaceKeys: {\n    value: function(expression) { \n      if (!Is.string(expression)) return expression\n\n      const expressions = Object.fromEntries(this.keys.map(key => ([\n        key, new RegExp(`\\\\b${key}\\\\b`, 'g')\n      ])))\n      Object.entries(expressions).forEach(([key, reg_exp]) => {\n        expression = expression.replaceAll(reg_exp, `${THIS}.get(\"${key}\")`) \n      })\n      return expression\n    }\n  },\n\n  conditionalValue: { \n    value: function(conditionals) {\n      if (!Is.array(conditionals)) return conditionals\n\n      let test_bool = false\n      for (let conditional of conditionals) {\n        const expression = replaceOperators(conditionalExpression(conditional))\n\n        test_bool = this.evaluateExpression(expression)\n        if (test_bool) return conditional.value\n      }\n      throw Errors.internal + 'no conditions were true'\n    }\n  },\n\n  evaluate: {\n    value: function(expressionOrConditions) {\n      const expression = this.conditionalValue(expressionOrConditions)\n      return this.evaluateExpression(expression)\n    }\n  },\n\n  evaluateExpression: {\n    value: function(expression) {\n      const script = `return ${this.replaceKeys(expression)}`\n      // console.log(\"evaluateScope\", script)\n      try {\n        const method = new Function(THIS, script)\n        return method(this) \n      } catch (exception) {\n        // console.warn(`Evaluation failed`, script, this, exception)\n        return expression\n      }\n    }\n  },\n\n  floor: { value: Math.floor },\n\n  get: { value: function(key) { \n    if (this.map.has(key)) return this.map.get(key)\n    const value = this[key]\n    if (KEYS_GETTERS.includes(key)) return value\n\n    if (Is.method(value)) return value.bind(this)\n\n    console.log(\"Evaluator.get\", key, value)\n    return value\n  } },\n  \n  keys: { \n    get: function() { return [...new Set([...this.map.keys(), ...KEYS])] } \n  },\n\n  mm_cmp: { value: function(a, b, x, y) { return ((a > b) ? x : y) } },\n  \n  mm_dimensions: { \n    get: function() { return `${this.mm_width}x${this.mm_height}` } \n  },\n\n  mm_duration: { get: function() { return this.timeRange.lengthSeconds } },\n\n  mm_fps: { get: function() { return this.timeRange.fps } },\n\n  mm_height: { get: function() { return this.dimensions.height } },\n\n  mm_horz: { \n    value: function(size, proud) { return this.sized(0, size, proud) } \n  },\n\n  mm_max: { value: Math.max },\n\n  mm_min: { value: Math.min },\n\n  mm_t: { get: function() { return this.timeRange.position } },\n\n  mm_vert: { \n    value: function(size, proud) { return this.sized(1, size, proud) } \n  },\n\n  mm_width: { get: function() { return this.dimensions.width } },\n\n  set: { value: function(key, value) { this.map.set(key, value) } },\n\n  sized: { value: function(vertical, size, proud) {\n    const scale = Is.float(size) ? size : parseFloat(size)\n    const value = parseFloat(this[KEYS_SIZED[vertical]])\n    const scaled = value * scale\n    if (! proud) return scaled\n\n    const other = parseFloat(this[KEYS_SIZED[Math.abs(vertical - 1)]])\n    if (other <= value) return scaled\n    \n    return value + (scale - 1.0) * other\n  }},\n\n  t: { get: function() { return this.mm_duration } },\n})\n\nexport { Evaluator }\n","import { Errors, Property } from \"../../Setup\"\nimport { Is } from \"../../Utilities/Is\"\nimport { Evaluator } from \"../../Clip/Evaluator\"\n\nexport const evaluator = {\n  evaluator: { \n    value: function(clipRange, context, dimensions){\n      const evaluator = new Evaluator(clipRange, context, dimensions)\n      if (this.media.properties) {\n        Object.keys(this.media.properties).forEach(key => {\n          let value = this[key]\n          if (Is.undefined(value)) {\n            console.log(\"this lacked property\", key, this)\n            const property = this.media.properties[key]\n            value = property.value\n            if (Is.undefined(value)) {\n              console.log(\"Transform.draw media lacked property value\", property)\n            \n              value = Property.propertyTypeDefault(property.type)\n\n              if (Is.undefined(value)) throw Errors.unknown.type + property.type\n            }\n          } \n          evaluator.set(key, value)\n        })\n      }\n      return evaluator\n    }\n  },\n}","\nimport { copy } from \"../../Base/with/copy\"\nimport { propertyValues } from \"../../Clip/with/propertyValues\"\nimport { urlsFromMedia } from \"../../Clip/with/urlsFromMedia\"\nimport { labelFromObjectOrMedia } from \"../../Clip/with/labelFromObjectOrMedia\"\nimport { media } from \"./media\"\nimport { evaluator } from \"../../Clip/with/evaluator\"\nimport { editable } from \"../../Base/with/editable\"\nimport { toJSONTransform } from \"./toJSONTransform\"\nimport { propertiesFromMedia } from \"../../Clip/with/propertiesFromMedia\"\n\nexport const sharedTransform = {\n  ...editable,\n  ...copy,\n  ...media,\n  ...labelFromObjectOrMedia,\n  ...propertyValues,\n  ...urlsFromMedia,\n  ...evaluator,\n  ...toJSONTransform,\n  ...propertiesFromMedia,\n}","export const copy = {\n  copy: { get: function() { return new this.constructor(this.toJSON()) } }\n}\n","export const toJSONTransform = {\n  toJSON: { value: function() {\n    const object = { id: this.id, type: this.type  }\n    return { ...this.propertyValues, ...object } \n  } }\n}\n","import { sharedTransform } from \"./with/sharedTransform\"\n\nclass Transform {\n  constructor(object) {\n    this.object = object\n    this.media.initializeInstance(this, object)\n  }\n}\n\nObject.defineProperties(Transform.prototype, {\n  ...sharedTransform,\n})\n\nexport { Transform }","\nimport { idMutable } from \"../Base/with/idMutable\"\n\nimport { ModuleType } from \"../Setup\"\nimport { drawMerger } from \"./with/drawMerger\"\nimport { Transform } from \"./Transform\"\n\nclass Merger extends Transform {}\n\nObject.defineProperties(Merger.prototype, {\n  type: { value: ModuleType.merger },\n  ...idMutable,\n  ...drawMerger,\n})\n\nexport { Merger }","export const drawMerger = {\n  drawMerger: { value: function(clipTimeRange, inputContext, outputContext) {\n    this.media.filters.forEach(filter => {\n      filter.drawFilters(this.evaluator(clipTimeRange, inputContext, outputContext.canvas), outputContext)\n    })\n    return outputContext\n  }}\n}","\nexport const drawMediaFilters = { \n  drawMediaFilters: { value: function(clipTimeRange, context, dimensions) { \n    // clipTimeRange's frame is offset of draw time within clip = frames is duration\n    this.media.filters.forEach(filter => {\n      context = filter.drawFilters(this.evaluator(clipTimeRange, context, dimensions))\n    })\n    return context\n  }},\n  \n}\n\n\n\n","import { idMutable } from \"../Base/with/idMutable\"\nimport { ModuleType } from \"../Setup\"\nimport { drawMediaFilters } from \"../Clip/with/drawMediaFilters\"\nimport { Transform } from \"./Transform\"\n\nclass Scaler extends Transform {}\n\nObject.defineProperties(Scaler.prototype, {\n  type: { value: ModuleType.scaler },\n  ...idMutable,\n  ...drawMediaFilters,\n})\n\nexport { Scaler }\n","import { id } from \"../Clip/with/id\"\n\nimport { ModuleType } from \"../Setup\"\nimport { drawMediaFilters } from \"../Clip/with/drawMediaFilters\"\nimport { Transform } from \"./Transform\"\n\nclass Effect extends Transform {}\n\nObject.defineProperties(Effect.prototype, {\n  type: { value: ModuleType.effect },\n  ...id,\n  ...drawMediaFilters,\n})\n\nexport { Effect }","import { ModuleType, Module } from \"../../Setup\"\nimport { Merger, Scaler, Effect } from \"../../Transform\"\nimport { Is } from \"../../Utilities\"\n\nexport const transform = {\n  effects: {\n    get: function() { return this.__effects ||= this.effectsInitialize }\n  },\n  effectsInitialize: {\n    get: function() {\n      const array = this.object.effects || []\n      return array.map(object => new Effect(object))\n    }\n  },\n  merger: {\n    get: function() { return this.__merger ||= this.mergerInitialize },\n    set: function(value) { this.__merger = new Merger({ id: value })}\n  },\n  mergerInitialize: {\n    get: function() {\n      const object = this.object.merger || Module.objectWithDefaultId(ModuleType.merger)\n      return new Merger(object)\n    }\n  },\n  scaler: {\n    get: function() { return this.__scaler ||= this.scalerInitialize },\n    set: function(value) { this.__scaler = new Scaler({ id: value })}\n  },\n  scalerInitialize: {\n    get: function() {\n      const object = this.object.scaler || Module.objectWithDefaultId(ModuleType.scaler)\n      return new Scaler(object)\n    }\n  },\n  coreFilters: {\n    get: function() {\n      const filters = []\n      if (Is.defined(this.media.filters)) filters.push(...this.media.filters)\n      if (Is.defined(this.merger)) filters.push(...this.merger.media.filters)\n      if (Is.defined(this.scaler)) filters.push(...this.scaler.media.filters)\n      if (Is.defined(this.effects)) {\n        filters.push(...this.effects.flatMap(effect => effect.media.filters))\n      }\n      return filters\n    }\n  },\n}\n","import { TimeRangeFactory } from \"../../Factory/TimeRangeFactory\"\nimport { Errors } from \"../../Setup\"\nimport { Is, Context } from \"../../Utilities\"\nimport { Cache } from \"../../Loading\"\n\nexport const drawImage = {\n  contextAtTimeForDimensions: {\n    value: function(mashTime, dimensions) {\n      const range = TimeRangeFactory.createFromTime(mashTime)\n      const urls = this.media.urlsVisibleInTimeRangeForClipByType(range, this)\n      const url = urls.image[0]\n\n      const resource = Cache.get(url)\n      if (!Is.object(resource)) throw Errors.uncached + url + \" contextAtTimeForDimensions\"\n\n      const { width, height } = resource\n      let context = Context.createDrawing(width, height)\n      context.drawImage(resource, 0, 0, width, height, 0, 0, width, height)\n      return context\n    }\n  },\n}\n","import { Base } from \"../Base\"\nimport { MediaUtilized } from \"../Decorators/MediaUtilized\"\nimport { Media } from \"../Media/Media\"\n\n@MediaUtilized\nclass Clip extends Base {\n  id : string\n\n  frame : number\n\n  frames : number\n\n  scaler : object\n\n  merger : object\n\n  effects : object[]\n\n  from? : object\n\n  to? : object\n\n  media : Media\n\n  mediaUtilized : Media[]\n\n  constructor(object) {\n    super(object)\n    this.media.initializeInstance(this, object)\n  }\n}\n\nexport { Clip }\n","export function MediaUtilized(klass) {\n  Object.defineProperties(klass.prototype, {\n    mediaUtilized: { get() { return this.mediaUtilizedFunction() } },\n    mediaUtilizedFunction: { get() { return () => [this.media] } }\n  })\n  return klass\n}\n","export const mediaTime = {\n  mediaTime: { value: function(time) { return time } },\n  mediaTimeRange: { value: function(timeRange) { return timeRange } },\n}","import { ClipType } from \"../Setup\"\nimport { sharedClip } from \"./with/sharedClip\"\nimport { inaudible } from \"./with/inaudible\"\nimport { visibleClip } from \"./with/visibleClip\"\nimport { urls } from \"./with/urls\"\nimport { transform } from \"./with/transform\"\nimport { drawImage } from \"./with/drawImage\"\nimport { Clip } from \"./Clip\"\nimport { mediaTime } from \"./with/mediaTime\"\n\nclass ImageClip extends Clip {}\n\nObject.defineProperties(ImageClip.prototype, {\n  type: { value: ClipType.image },\n  ...sharedClip,\n  ...visibleClip,\n  ...inaudible,\n  ...urls,\n  ...transform,\n  ...drawImage,\n  ...mediaTime,\n})\n\nexport { ImageClip }\n","import { TrackType } from \"../../Setup\"\nimport { UrlsByType } from \"../../Loading\"\n\nexport const invisible = {\n  visible: { value: false },\n  trackType: { value: TrackType.audio },\n  urlsVisibleInTimeRangeByType: {\n    value: function() { return UrlsByType.none }\n  },\n}\n","import { TimeRangeFactory } from \"../../Factory/TimeRangeFactory\"\nimport { TimeFactory } from \"../../Factory/TimeFactory\"\n\nexport const audible = {\n  audible: { get: function() {\n    const audible = this.media.audible && !this.muted\n    if (!audible) console.log(this.constructor.name, \"audible false:\", this.media.audible, !this.muted)\n    return audible\n  } },\n  muted: {\n    get: function() {\n      switch(this.gain) {\n          case 0:\n          case '0':\n          case '0,0,1,0': return true\n      }\n      return false\n    }\n  },\n  urlsAudibleInTimeRangeByType: {\n    value: function(timeRange) {\n      const range = this.mediaTimeRange(timeRange)\n      return this.media.urlsAudibleInTimeRangeForClipByType(range)\n    }\n  },\n  mediaTime: {\n    value: function(time, add_one_frame = false) {\n      const end_time = TimeFactory.createFromFrame(this.frame + this.frames, time.quantize)\n      const limited_time = time.min(end_time)\n      const start_time = TimeFactory.createFromFrame(this.frame, time.quantize)\n      let media_time = limited_time.subtract(start_time)\n\n      if (add_one_frame) {\n        const frame_at_speed = this.speed ? Math.ceil(this.speed) : 1\n        media_time = media_time.add(TimeFactory.createFromFrame(frame_at_speed, this.quantize))\n      }\n      if (this.trim) {\n        media_time = media_time.add(TimeFactory.createFromFrame(this.trim, this.quantize))\n      }\n      if (this.speed) {\n        media_time = media_time.divide(this.speed, 'ceil')\n      }\n      return media_time\n    }\n  },\n  mediaTimeRange: {\n    value: function(timeRange) {\n      const add_one_frame = (timeRange.frames > 1)\n      return TimeRangeFactory.createFromTimes(\n        this.mediaTime(timeRange.startTime),\n        this.mediaTime(timeRange.endTime, add_one_frame)\n      )\n    }\n  },\n}\n","import { TimeRangeFactory } from \"../../Factory/TimeRangeFactory\"\nimport { TimeFactory } from \"../../Factory/TimeFactory\"\n\nexport const mediaTimeFromTrim = {\n  mediaTime: {\n    value: function(time, add_one_frame = false) {\n      const end_time = TimeFactory.createFromFrame(this.frame + this.frames, time.quantize)\n      const limited_time = time.min(end_time)\n      const start_time = TimeFactory.createFromFrame(this.frame, time.quantize)\n      let media_time = limited_time.subtract(start_time)\n\n      if (add_one_frame) {\n        const frame_at_speed = this.speed ? Math.ceil(this.speed) : 1\n        media_time = media_time.add(TimeFactory.createFromFrame(frame_at_speed, this.quantize))\n      }\n      if (this.trim) {\n        media_time = media_time.add(TimeFactory.createFromFrame(this.trim, this.quantize))\n      }\n      if (this.speed) {\n        media_time = media_time.divide(this.speed, 'ceil')\n      }\n      return media_time\n    }\n  },\n  mediaTimeRange: {\n    value: function(timeRange) {\n      const add_one_frame = (timeRange.frames > 1)\n      return TimeRangeFactory.createFromTimes(\n        this.mediaTime(timeRange.startTime),\n        this.mediaTime(timeRange.endTime, add_one_frame)\n      )\n    }\n  },\n}\n","import { ClipType } from \"../Setup\"\nimport { sharedClip } from \"./with/sharedClip\"\nimport { invisible } from \"./with/invisible\"\nimport { audible } from \"./with/audible\"\nimport { Clip } from \"./Clip\"\nimport { mediaTimeFromTrim } from \"./with/mediaTimeFromTrim\"\n\nclass AudioClip extends Clip {}\n\nObject.defineProperties(AudioClip.prototype, {\n  type: { value: ClipType.audio },\n  ...sharedClip,\n  ...invisible,\n  ...audible,\n  ...mediaTimeFromTrim,\n})\n\nexport { AudioClip }\n","import { ClipType } from \"../Setup\"\nimport { sharedClip } from \"./with/sharedClip\"\nimport { visibleClip } from \"./with/visibleClip\"\nimport { urls } from \"./with/urls\"\nimport { audible } from \"./with/audible\"\nimport { transform } from \"./with/transform\"\nimport { mediaTimeFromTrim } from \"./with/mediaTimeFromTrim\"\n\nfunction VideoClip(object) { this.object = object }\n\nObject.defineProperties(VideoClip.prototype, {\n  type: { value: ClipType.video },\n  ...sharedClip,\n  ...visibleClip,\n  ...audible,\n  ...urls,\n  ...transform,\n  ...mediaTimeFromTrim,\n})\n\nexport { VideoClip }\n","import { ClipType } from \"../Setup\"\nimport { sharedClip } from \"./with/sharedClip\"\nimport { inaudible } from \"./with/inaudible\"\nimport { visibleClip } from \"./with/visibleClip\"\nimport { speedOne } from \"./with/speedOne\"\nimport { urls } from \"./with/urls\"\nimport { transform } from \"./with/transform\"\nimport { evaluator } from \"./with/evaluator\"\nimport { Context } from \"../Utilities\"\nimport { drawMediaFilters } from \"./with/drawMediaFilters\"\nimport { mediaTime } from \"./with/mediaTime\"\nimport { Clip } from \"./Clip\"\nimport { Is } from \"../Utilities\"\n\nclass ThemeClip extends Clip {}\n\nObject.defineProperties(ThemeClip.prototype, {\n  type: { value: ClipType.theme },\n  ...sharedClip,\n  ...inaudible,\n  ...visibleClip,\n  ...speedOne,\n  ...urls,\n  ...inaudible,\n  ...transform,\n  ...evaluator,\n  ...drawMediaFilters,\n  ...mediaTime,\n  contextAtTimeForDimensions: {\n    value: function(mashTime, dimensions) {\n      const context = Context.createDrawing(dimensions.width, dimensions.height)\n      const clipTimeRange = this.timeRangeRelative(mashTime)\n      if (Is.undefined(clipTimeRange)) return\n      \n      return this.drawMediaFilters(clipTimeRange, context, dimensions)\n    }\n  },\n})\n\nexport { ThemeClip }","export const speedOne = { \n  speed: {  get: function() { return 1.0 } }\n}\n","import { ClipType, TransformType, TransformTypes } from \"../Setup\"\nimport { Merger, Scaler } from \"../Transform\"\nimport { Is, Context, byFrame, Utilities } from \"../Utilities\"\nimport { ColorFilter } from \"../CoreFilter\"\nimport { Clip } from \"./Clip\"\nimport { mediaTime } from \"./with/mediaTime\"\nimport { sharedClip } from \"./with/sharedClip\"\nimport { visibleClip } from \"./with/visibleClip\"\nimport { urlsFromMedia } from \"./with/urlsFromMedia\"\n\nconst ChildTypes = [\"to\", \"from\"]\nconst ChildType = Object.fromEntries(ChildTypes.map(type => [type, type]))\n\nclass TransitionClip extends Clip {\n  constructor(object) {\n    super(object)\n    this.children = Object.fromEntries(ChildTypes.map(type => [type, {}]))\n  }\n}\n\nconst definition = {\n  type: { value: ClipType.transition },\n  ...sharedClip,\n  ...visibleClip,\n  ...urlsFromMedia,\n  ...mediaTime,\n  contextAtTimeForDimensions: {\n    value(mashTime, dimensions, color, clips = []) {\n      const sorted = clips.sort(byFrame)\n\n      const context = Context.createDrawing(dimensions.width, dimensions.height)\n      ColorFilter.draw({ context }, { color })\n\n      const [fromClip, toClip] = sorted\n      const defined = {\n        [ChildType.to]: Is.object(toClip) && toClip,\n        [ChildType.from]: Is.object(fromClip) && fromClip,\n      }\n      ChildTypes.forEach(childType => {\n        const clip = defined[childType]\n        if (!clip) return\n\n        const drawing = Context.createDrawing(dimensions.width, dimensions.height)\n        ColorFilter.draw({ drawing }, { color })\n\n        clip.mergeContextAtTime(mashTime, drawing)\n\n        const merger = this.child(childType, TransformType.merger)\n        const scaler = this.child(childType, TransformType.scaler)\n\n        const clipTimeRange = this.timeRangeRelative(mashTime)\n        if (Is.undefined(clipTimeRange)) return\n\n        const scaled = scaler.drawMediaFilters(clipTimeRange, drawing, dimensions)\n        merger.drawMerger(clipTimeRange, scaled, context)\n      })\n\n      return context\n    }\n  },\n  // urlsVisibleInTimeRangeByType: {\n  //   value: function(timeRange) {\n  //     const urls = new UrlsByType\n\n  //     ChildTypes.forEach(type => {\n  //       urls.concat(this.child())\n  //     })\n\n  //     return this.media.urlsVisibleInTimeRangeForClipByType(timeRange, this)\n  //   }\n  // },\n  initializeChild: {\n    value(childType, transformType) {\n      const Klass = transformType === TransformType.merger ? Merger : Scaler\n      return new Klass(this.object[childType])\n    }\n  },\n  child: {\n    value(childType, transformType) {\n      return this[`${childType}${Utilities.capitalize(transformType)}`]\n    }\n  },\n}\n\nChildTypes.forEach(childType => {\n  definition[childType] = {\n    get() {\n      if (Is.undefined(this.children[childType])) this.children[childType] = {}\n      return this.children[childType]\n    }\n  }\n\n  TransformTypes.forEach(transformType => {\n    definition[`${childType}${Utilities.capitalize(transformType)}`] = {\n      get() {\n        if (Is.undefined(this.children[childType][transformType])) {\n          const child = this.initializeChild(childType, transformType)\n          this.children[childType][transformType] = child\n        }\n        return this.children[childType][transformType]\n      }\n    }\n  })\n})\n\nObject.defineProperties(TransitionClip.prototype, definition)\n\nexport { TransitionClip }\n","import { ClipType } from \"../Setup\"\nimport { sharedClip } from \"./with/sharedClip\"\nimport { visibleClip } from \"./with/visibleClip\"\nimport { urls } from \"./with/urls\"\nimport { mediaTime } from \"./with/mediaTime\"\n\nfunction FrameClip(object) { this.object = object }\n\nObject.defineProperties(FrameClip.prototype, {\n  type: { value: ClipType.frame },\n  ...sharedClip,\n  ...visibleClip,\n  ...urls,\n  ...mediaTime,\n})\n\n\nexport { FrameClip }","import { Factory } from \"./Factory\"\nimport { Errors, ClipType } from \"../Setup\"\nimport { Is } from \"../Utilities\"\nimport {\n  AudioClip,\n  VideoClip,\n  ImageClip,\n  ThemeClip,\n  TransitionClip,\n  FrameClip,\n  Clip\n} from \"../Clip\"\nimport { TimeFactory } from \"./TimeFactory\"\nimport { ClipTypes } from \"../Setup/Types\"\n\nclass ClipFactory extends Factory {\n  constructor() {\n    super(Clip)\n    this.install(ClipType.audio, AudioClip)\n    this.install(ClipType.frame, FrameClip)\n    this.install(ClipType.image, ImageClip)\n    this.install(ClipType.theme, ThemeClip)\n    this.install(ClipType.transition, TransitionClip)\n    this.install(ClipType.video, VideoClip)\n  }\n\n  createFromObjectMedia(object = {}, media = {}, mash = {}) {\n    if (!Is.object(object)) throw Errors.object\n    if (!Is.object(media)) throw Errors.media\n\n    if (!Is.integer(object.frames)) {\n      object.frames = TimeFactory.createFromSeconds(media.duration, mash.quantize, 'floor').frame\n    }\n    object.media ||= media\n    const type = object.type || media.type\n    media.type ||= type\n    object.type ||= type\n    if (!ClipTypes.includes(type)) throw Errors.unknown.type\n\n    return this.createFromObject(object)\n  }\n\n  createFromMedia(media, mash) {\n    const object = { id: media.id, type: media.type }\n    return this.createFromObjectMedia(object, media, mash)\n  }\n}\n\nconst ClipFactoryInstance = new ClipFactory()\nexport { ClipFactoryInstance as ClipFactory }\n","import { Base } from \"../Base\"\nimport { TrackType, Errors } from \"../Setup\"\nimport { ClipFactory } from \"../Factory/ClipFactory\"\nimport { byFrame, Is } from \"../Utilities\"\n\nclass Track extends Base {\n  constructor(object, mash) {\n    super(object)\n    this.mash = mash\n\n    this.object.index ||= 0\n    this.object.type ||= TrackType.video\n  }\n\n  get clips() {\n    if (Is.undefined(this.__clips)) this.__clips = this.initializeClips\n    return this.__clips\n  }\n\n  get initializeClips() {\n    const array = this.object.clips || []\n    return array.map(object => {\n      const media = this.mash.searchMedia(object.id)\n      const clip = ClipFactory.createFromObjectMedia({ track: this.index, ...object }, media)\n\n      return clip\n    })\n  }\n\n  get frames() {\n    if (!this.clips.length) return 0\n\n    const clip = this.clips[this.clips.length - 1]\n    return clip.frame + clip.frames\n  }\n\n  get index() { return this.object.index }\n\n  get isMainVideo() { return !this.index && this.type === TrackType.video }\n\n  get type() { return this.object.type }\n\n  addClips(clips, insertIndex = 0) {\n    let clipIndex = insertIndex || 0\n    if (!this.isMainVideo) clipIndex = 0 // ordered by clip.frame values\n\n    const origIndex = clipIndex // note original, since it may decrease...\n    const movingClips = [] // build array of clips already in this.clips\n    // build array of my clips excluding the clips we're inserting\n    const spliceClips = this.clips.filter((clip, index) => {\n      const moving = clips.includes(clip)\n      if (moving) movingClips.push(clip)\n      // insert index should be decreased when clip is moving and comes before\n      if (origIndex && moving && index < origIndex) clipIndex -= 1\n      return !moving\n    })\n    // insert the clips we're adding at the correct index, then sort properly\n    spliceClips.splice(clipIndex, 0, ...clips)\n    this.sortClips(spliceClips)\n\n    // set the track of clips we aren't moving\n    const newClips = clips.filter(clip => !movingClips.includes(clip))\n    newClips.forEach(clip => { clip.set(\"track\", this.index) })\n\n    // remove all my current clips and replace with new ones in one step\n    this.clips.splice(0, this.clips.length, ...spliceClips)\n  }\n\n  frameForClipsNearFrame(clips, frame = 0) {\n    // TODO: make range that includes all clips\n\n    // find next stretch after frame that fits range\n\n    // const others = this.clips.filter(clip => !clips.includes(clip))\n\n    return frame\n  }\n\n  removeClips(clips) {\n    const spliceClips = this.clips.filter(clip => !clips.includes(clip))\n    if (spliceClips.length === this.clips.length) {\n      console.error(\"removeClips\", this.type, this.index, this.clips)\n      throw Errors.internal\n    }\n    clips.forEach(clip => clip.set(\"track\", -1))\n    this.sortClips(spliceClips)\n    this.clips.splice(0, this.clips.length, ...spliceClips)\n  }\n\n  sortClips(clips) {\n    if (this.isMainVideo) {\n      let frame = 0\n      clips.forEach((clip, i) => {\n        const isTransition = clip.type === TrackType.transition\n        if (i && isTransition) frame -= clip.frames\n        clip.set(\"frame\", frame)\n        if (!isTransition) frame += clip.frames\n      })\n    }\n    clips.sort(byFrame)\n  }\n\n  toJSON() {\n    return { type: this.type, index: this.index, clips: this.clips }\n  }\n}\n\nexport { Track }\n","import { Factory } from \"./Factory\"\nimport { Errors } from \"../Setup\"\nimport { Is } from \"../Utilities\"\nimport { Track } from \"../Track\"\n\nclass TrackFactoryClass extends Factory {\n  create(object, mash) {\n    if (!Is.object(object)) throw(Errors.object)\n    if (object instanceof Track) return object\n\n    //if (!Is.instanceOf(mash, Mash)) throw(Errors.mash)\n\n    return new Track(object, mash)\n  }\n}\n\nconst TrackFactory = new TrackFactoryClass\nexport { TrackFactory }\n","import { Base } from \"../Base\"\nimport { MediaFactory } from \"../Factory/MediaFactory\"\nimport { TimeRangeFactory } from \"../Factory/TimeRangeFactory\"\nimport { Track } from \"../Track\"\nimport { Media } from \"../Media\"\nimport { Events } from \"../Events\"\nimport { TrackFactory } from \"../Factory/TrackFactory\"\nimport { UrlsByType } from \"../Loading\"\nimport { TimeFactory } from \"../Factory/TimeFactory\"\nimport { Clip } from \"../Clip\"\nimport { Is, byFrame, Id, Time } from \"../Utilities\"\nimport {\n  Default,\n  Module,\n  Errors,\n  EventType,\n  TrackType,\n  TrackTypes,\n  ModuleTypes\n} from \"../Setup\"\n\nconst MashProperty = {\n  label: \"label\",\n  backcolor: \"backcolor\",\n}\n\nfunction Idable(target) {\n  Object.defineProperties(target.prototype, {\n    id: {\n      get() {\n        if (Is.undefined(this.__id)) this.__id = this.initializeId\n        return this.__id\n      }\n    },\n    initializeId: { get() { return this.object.id || Id() } },\n  })\n  return target\n}\n\n@Idable\nclass Mash extends Base {\n  id : string\n\n   __label : string\n\n  __audio : Array<Track>\n\n  __video : Array<Track>\n\n  __backcolor : string\n\n  __events? : Events\n\n  __initialMedia : Array<Media>\n\n  __quantize : number\n\n  object : {\n    backcolor? : string\n    events? : Events\n    audio? : Array<Track>\n    video? : Array<Track>\n    media? : Array<Media>\n    label? : string\n    quantize? : number\n  }\n\n  get audio() {\n    if (Is.undefined(this.__audio)) this.__audio = this.initializeAudio\n    return this.__audio\n  }\n\n  get backcolor() {\n    if (Is.undefined(this.__backcolor)) {\n      this.__backcolor = this.object.backcolor || Default.mash.backcolor\n    }\n    return this.__backcolor\n  }\n\n  set backcolor(value) { this.__backcolor = value }\n\n  get clips() { return this.tracks.map(track => track.clips).flat() }\n\n  get clipsAudible() { return this.clips.filter(clip => clip.audible) }\n\n  get clipsAudio() { return this.audio.map(track => track.clips).flat() }\n\n  get clipsVideo() { return this.video.flatMap(track => track.clips) }\n\n  get events() {\n    if (Is.undefined(this.__events)) this.__events = this.object.events || null\n    return this.__events\n  }\n\n  set events(value) { this.__events = value }\n\n  /** mash duration in frames */\n  get frames() {\n    return Math.max(0, ...this.tracks.map(track => track.frames))\n  }\n\n  get initializeAudio() {\n    const array = this.object.audio || [{ type: TrackType.audio }]\n    return array.map(track => TrackFactory.create(track, this))\n  }\n\n  get initializeMedia() {\n    const array = this.object.media || []\n    return array.map(media => MediaFactory.create(media))\n  }\n\n  get initializeVideo() {\n    const array = this.object.video || [{ type: TrackType.video }]\n    return array.map(track => TrackFactory.create(track, this))\n  }\n\n  get initialMedia() {\n    if (Is.undefined(this.__initialMedia)) {\n      this.__initialMedia = this.initializeMedia\n    }\n    return this.__initialMedia\n  }\n\n  get label() {\n    if (Is.undefined(this.__label)) {\n      this.__label = this.object.label || Default.mash.label\n    }\n    return this.__label\n  }\n\n  set label(value) { this.__label = value }\n\n  get media() {\n    // this.mediaForClipOrEffect(clip)\n    return [...new Set(this.clips.flatMap(clip => clip.mediaUtilized))]\n  }\n\n  get propertyValues() {\n    return Object.fromEntries(Mash.properties.map(key => [key, this[key]]))\n  }\n\n  get quantize() {\n    if (Is.undefined(this.__quantize)) {\n      this.__quantize = this.object.quantize || Default.mash.quantize\n    }\n    return this.__quantize\n  }\n\n  /** combined audio and video tracks */\n  get tracks() { return TrackTypes.map(av => this[av]).flat() }\n\n  get type() { return \"mash\" }\n\n  get video() {\n    if (Is.undefined(this.__video)) this.__video = this.initializeVideo\n    return this.__video\n  }\n\n  addClipsToTrack(clips, trackIndex = 0, insertIndex = 0) {\n    // console.log(this.constructor.name, \"addClipsToTrack\", trackIndex)\n    const [clip] = clips\n    const newTrack = this.clipTrackAtIndex(clip, trackIndex)\n    const oldTrack = Is.positive(clip.track) && this.clipTrack(clip)\n\n    this.emitIfFramesChange(() => {\n      if (oldTrack && oldTrack !== newTrack) {\n        // console.log(\"addClipsToTrack\", newTrack.index, oldTrack.index)\n        oldTrack.removeClips(clips)\n      }\n      newTrack.addClips(clips, insertIndex || 0)\n    })\n  }\n\n  addTrack(trackType) {\n    const array = this[trackType]\n    const options = { type: trackType, index: array.length }\n    const track = TrackFactory.create(options, this)\n    array.push(track)\n    return track\n  }\n\n  changeClipFrames(clip, value) {\n    let limitedValue = Math.max(1, value) // frames value must be > 0\n\n    if (TrackTypes.includes(clip.type)) {\n      const max = Math.floor(clip.media.duration * this.quantize) - clip.trim\n      limitedValue = Math.min(max, limitedValue)\n    }\n    const track = this.clipTrack(clip)\n    this.emitIfFramesChange(() => {\n      clip.set(\"frames\", limitedValue)\n      track.sortClips()\n    })\n  }\n\n  changeClipTrim(clip, value, frames) {\n    let limitedValue = Math.max(0, value)\n\n    if (TrackTypes.includes(clip.type)) { // trim not remove last frame\n      const max = Math.floor(clip.media.duration * this.quantize) - 1\n      limitedValue = Math.min(max, limitedValue)\n    }\n    const newFrames = frames - limitedValue\n    const track = this.clipTrack(clip)\n    this.emitIfFramesChange(() => {\n      clip.set(\"trim\", limitedValue)\n      clip.set(\"frames\", newFrames)\n      track.sortClips()\n    })\n  }\n\n  clipIntersects(clip, range) {\n    return clip.timeRange(this.quantize).intersects(range)\n  }\n\n  clipTrack(clip) {\n    return this.clipTrackAtIndex(clip, clip.track)\n  }\n\n  clipTrackAtIndex(clip, index = 0) {\n    return this.trackOfTypeAtIndex(clip.trackType, index)\n  }\n\n  clipsAudibleAtTime(time) { return this.clipsWithin(time, true, false) }\n\n  clipsAudibleInTimeRange(timeRange) {\n    const range = timeRange.scale(this.quantize)\n    return this.clips.filter(clip => (\n      clip.audible && this.clipIntersects(clip, range)\n    ))\n  }\n\n  clipsVisibleAtTime(time) { return this.clipsWithin(time, false) }\n\n  clipsVisibleInTimeRange(timeRange) {\n    const range = timeRange.scale(this.quantize)\n    return this.clipsVideo.filter(clip => this.clipIntersects(clip, range))\n  }\n\n  clipsWithin(time : Time, includeAudible = true, includeVisible = true) {\n    const range = TimeRangeFactory.create(time)\n    if (!includeAudible) return this.clipsVisibleInTimeRange(range)\n    if (!includeVisible) return this.clipsAudibleInTimeRange(range)\n\n    return this.clips.filter(clip => this.clipIntersects(clip, range))\n  }\n\n  emitDuration() {\n    const info = {\n      value: TimeFactory.createFromFrame(this.frames, this.quantize).seconds\n    }\n    // console.log(this.constructor.name, \"emitDuration\", info)\n    this.events.emit(EventType.duration, info)\n  }\n\n  emitIfFramesChange(method : Function) {\n    const frames = this.events ? this.frames : null\n    method()\n    if (this.events && frames !== this.frames) this.emitDuration()\n  }\n\n  findInitialMedia(mediaId : string) : Media | boolean {\n    const media = this.initialMedia.find(object => object.id === mediaId)\n    if (!media) return false\n\n    return media\n  }\n\n  findClipMedia(mediaId : string) : Media | boolean {\n    return this.media.find((media : Media) => media.id === mediaId)\n  }\n\n  findMedia(mediaId : string) : Media | boolean {\n    if (!(Is.string(mediaId) && mediaId.length)) return false\n    const found = this.findInitialMedia(mediaId)\n    if (found) return found\n\n    return this.findClipMedia(mediaId)\n  }\n\n  filterClipSelection(value) {\n    const array = Is.array(value) ? value : [value]\n    const clips = array.filter(clip => Is.instanceOf(clip, Clip))\n    const [firstClip] = clips\n    // console.log(\"filterClipSelection\", clips)\n    if (!firstClip) return []\n\n    const { trackType, track } = firstClip\n\n    // selected clips must all be on same track\n    const trackClips = clips.filter(clip => (\n      clip.track === track && clip.trackType === trackType\n    )).sort(byFrame)\n\n    if (track || trackType === TrackType.audio) return trackClips\n\n    // selected clips on main track must be abutting each other\n    let abutting = true\n    return trackClips.filter((clip : Clip, index : number) => {\n      if (!abutting) return false\n\n      if (index === trackClips.length - 1) return true\n\n      abutting = clip.frame + clip.frames === trackClips[index + 1].frame\n      return true\n    })\n  }\n\n  // mediaForClipOrEffect(clip : Clip | Effect) {\n  //   const medias = []\n  //   const { media } = clip\n  //   if (!Is.object(media)) throw Errors.internal\n\n  //   medias.push(media)\n  //   if (clip.scaler) medias.push(clip.scaler.media)\n  //   if (clip.merger) medias.push(clip.merger.media)\n\n  //   if (media.modular) {\n  //     const propertiesByType = media.modularPropertiesByType\n  //     Object.keys(propertiesByType).forEach(type => {\n  //       const modularProperties = propertiesByType[type]\n  //       modularProperties.forEach(key => {\n  //         const found = this.searchMedia(clip[key], type)\n  //         if (found) medias.push(found)\n  //       })\n  //     })\n  //   }\n  //   switch (media.type) {\n  //     case MediaType.transition: {\n  //       medias.push(...this.mediaForClipTransforms(clip.to))\n  //       medias.push(...this.mediaForClipTransforms(clip.from))\n  //       break\n  //     }\n  //     case MediaType.effect:\n  //     case MediaType.audio: break\n  //     default: {\n  //       medias.push(...this.mediaForClipTransforms(clip))\n  //       const { effects } = clip\n  //       if (!effects) break\n  //       effects.forEach(effect => {\n  //         medias.push(...this.mediaForClipOrEffect(effect))\n  //       })\n  //     }\n  //   }\n  //   return medias\n  // }\n\n  // mediaForClipTransforms(clip : Clip) {\n  //   const medias = []\n  //   if (Is.object(clip)) {\n  //     [MediaType.merger, MediaType.scaler].forEach(key => {\n  //       const mergerOrScaler = clip[key]\n  //       if (Is.object(mergerOrScaler)) {\n  //         const found = this.searchMedia(mergerOrScaler.id, key)\n  //         if (found) medias.push(found)\n  //       }\n  //     })\n  //   }\n  //   return medias\n  // }\n\n  removeClipsFromTrack(clips : Clip[]) {\n    const [clip] = clips\n    const track = this.clipTrack(clip)\n    this.emitIfFramesChange(() => track.removeClips(clips))\n  }\n\n  removeTrack(trackType : string) {\n    const array = this[trackType]\n    this.emitIfFramesChange(() => array.pop())\n  }\n\n  // find media for clips, effects, mergers, scalers or fonts)\n  searchMedia(id : string, type : string) : Media | boolean {\n    const found = this.findInitialMedia(id)\n    if (found) return found\n\n    if (ModuleTypes.includes(type)) return <Media><unknown>Module.ofType(id, type)\n\n    return this.findClipMedia(id)\n  }\n\n  toJSON() {\n    return {\n      label: this.label,\n      quantize: this.quantize,\n      backcolor: this.backcolor,\n      id: this.id,\n      media: this.media,\n      audio: this.audio,\n      video: this.video,\n    }\n  }\n\n  trackOfTypeAtIndex(type : string, index = 0) {\n    if (!Is.positive(index)) {\n      console.error(Errors.invalid.track, index, index?.constructor.name)\n      throw Errors.invalid.track\n    }\n    if (!TrackTypes.includes(type)) throw Errors.invalid.trackType\n\n    return this[type][index]\n  }\n\n  urlsAudibleInTimeRangeForClipsByType(timeRange, clips) {\n    const range = timeRange.scale(this.quantize)\n    const urls = new UrlsByType()\n    clips.forEach(clip => urls.concat(clip.urlsAudibleInTimeRangeByType(range)))\n    return urls\n  }\n\n  urlsForClipsWithin(clips, time, includeAudible = true, includeVisible = true) {\n    const range = TimeRangeFactory.create(time)\n    const urls = new UrlsByType()\n\n    if (!includeAudible) urls.concat(this.urlsVisibleInTimeRangeForClipsByType(range, clips))\n    if (!includeVisible) urls.concat(this.urlsAudibleInTimeRangeForClipsByType(range, clips))\n\n    return urls\n  }\n\n  urlsVisibleInTimeRangeForClipsByType(timeRange, clips) {\n    const range = timeRange.scale(this.quantize)\n    const urls = new UrlsByType()\n    clips.forEach(clip => urls.concat(clip.urlsVisibleInTimeRangeByType(range)))\n    return urls\n  }\n\n  urlsWithin(time, includeAudible = true, includeVisible = true) {\n    const clips = this.clipsWithin(time, includeAudible, includeVisible)\n    return this.urlsForClipsWithin(clips, time, includeAudible, includeVisible)\n  }\n\n  static get properties() { return Object.values(MashProperty) }\n}\n\nexport { Mash }\n","import { Base } from \"../Base\"\nimport { Errors } from \"../Setup\"\nimport { Is } from \"../Utilities\"\n\nclass Events extends Base {\n  constructor(object) {\n    super(object)\n    this.methods = new Set\n  }\n\n  get target() { return this.object.target }\n  set target(value) { \n    if (this.object.target !== value) {\n      if (!Is.instanceOf(value, EventTarget)) throw Errors.object\n\n      const methods = new Set(this.methods)\n\n      methods.forEach(this.removeListener, this)\n      this.object.target = value\n      methods.forEach(this.addListener, this)      \n    }\n  }\n\n  addListener(method) { \n    if (this.methods.add(method)) {\n      this.target && this.target.addEventListener(Events.type, method) \n    }\n  }\n\n  emit(type, info = {}) {\n    const detail = { type, ...info }\n    const event = { detail }\n    this.target && this.target.dispatchEvent(new CustomEvent(Events.type, event))\n  }\n\n  removeListener(method) { \n    if (this.methods.delete(method)) {\n      this.target && this.target.removeEventListener(Events.type, method) \n    }\n  }\n}\n\nObject.defineProperties(Events, { type: { value: \"masher\" } })\n\nexport { Events }","import { Context } from \"../../Utilities\"\n\nexport const contexts = {\n  videoContext: { \n    get: function() { \n      this.__videoContext ||= this.object.videoContext || Context.createVideo()\n      return this.__videoContext\n    },\n    set: function(value) { \n      this.__videoContext = value \n      if (this.composition) this.composition.videoContext = value\n    }\n  },\n  audioContext: { \n    get: function() { \n      this.__audioContext ||= this.object.audioContext || Context.createAudio()\n      return this.__audioContext\n    },\n    set: function(value) { \n      this.__audioContext = value \n      if (this.composition) this.composition.audioContext = value\n    }\n  },\n}\n","import { Base } from \"../Base\"\nimport { Cache } from \"../Loading\"\nimport { contexts } from \"../Base/with/contexts\"\nimport { Default, Errors, ClipType } from \"../Setup\"\nimport { Pixel, byTrack, Is, Time } from \"../Utilities\"\nimport { TimeFactory } from \"../Factory/TimeFactory\"\nimport { TimeRangeFactory } from \"../Factory/TimeRangeFactory\"\n\nconst throwUnlessClipsDrawable = (clips) => {\n  clips.forEach(clip => {\n    if (!clip.frames) throw Errors.frames + JSON.stringify(clip)\n  })\n}\n\nclass Composition extends Base {\n  constructor(object) {\n    // console.log(\"Composition\", object)\n    super(object)\n    this.object.bufferSeconds ||= Default.bufferSeconds\n    this.paused = true\n    this.playing = false\n    this.sourcesByClip = new Map\n    this.__mashSeconds = 0\n    this.__contextSeconds = 0\n  }\n\n  get audible() { return !this.paused && !!this.audioContext }\n\n  get bufferedTime() { return this.urlsAtTime.loaded }\n\n  get bufferedTimeRange() {\n    return this.urlsInTimeRange.loaded\n  }\n\n  get bufferSeconds() { return this.object.bufferSeconds }\n  set bufferSeconds(value) { this.object.bufferSeconds = value }\n\n  get clipsAtTime() {\n    return this.mash.clipsWithin(this.time, this.audible, this.visible)\n  }\n\n  get clipsInTimeRange() {\n    return this.mash.clipsWithin(this.timeRange, this.audible, this.visible)\n  }\n\n  get configured() { return this.time && this.mash && (this.videoContext || this.audioContext) }\n\n  get gain() {\n    if (Is.undefined(this.__gain)) this.__gain = this.__gainInitialize\n    return this.__gain\n  }\n  get __gainInitialize() {\n    return Is.defined(this.object.gain) ? this.object.gain : Default.volume\n  }\n  set gain(value) {\n    if (this.__gain !== value) {\n      this.__gain = value\n      if (!this.playing) return\n\n      this.clipsAtTime.forEach(this.adjustSourceGain)\n    }\n  }\n\n\n  get mash() { return this.object.mash }\n  set mash(value) { this.object.mash = value }\n\n  get quantize() { return this.mash ? this.mash.quantize : 1 }\n\n  get seconds() {\n    const ellapsed = this.audioContext.currentTime - this.__contextSeconds\n    return ellapsed + this.__mashSeconds\n  }\n\n  get time() { return this.__time }\n  set time(value) {\n    if (!Is.instanceOf(value, Time)) throw(Errors.time)\n\n    this.__time = value\n  }\n\n  get timeRange() {\n    const buffer_time = TimeFactory.createFromSeconds(this.bufferSeconds)\n    const end_time = this.time.add(buffer_time)\n    return TimeRangeFactory.createFromTimes(this.time, end_time)\n  }\n\n  get timeRangeAtTime() { return TimeRangeFactory.createFromTime(this.time) }\n\n\n  get urlsAtTime() {\n    return this.urlsInTimeRangeByType(this.timeRangeAtTime)\n  }\n\n  get urlsInTimeRange() {\n    return this.urlsInTimeRangeByType(this.timeRange)\n  }\n\n  get visible() { return !!this.videoContext }\n\n  adjustSourceGain(clip) {\n    const source = this.sourcesByClip.get(clip)\n    if (Is.undefined(source)) return\n\n    const { gainNode } = source\n    if (this.gain === 0.0) return gainNode.gain.value = 0.0\n\n    const { gain } = clip\n    if (!Is.array(gain)) return gainNode.gain.value = gain * this.gain\n\n    // time/gain pairs...\n    const times = this.clipTiming(clip)\n    const { start, duration } = times\n    gainNode.cancelScheduledValues(0)\n    const gains = gain.split(',')\n    const z = gains.length / 2\n    for (let i = 0; i < z; i++) {\n      const position = gains[i * 2]\n      const value = this.gain * gains[i * 2 + 1]\n      const seconds = start + position * duration\n      gainNode.gain.linearRampToValueAtTime(value, seconds)\n    }\n  }\n\n  clipsToDraw(throwIfUncached) {\n    const clips = this.clipsAtTime\n    throwUnlessClipsDrawable(clips)\n    const urls = this.urlsInTimeRangeByType(this.timeRangeAtTime)\n    if (!urls.loaded) {\n      if (!throwIfUncached) return\n\n      throw Errors.uncached + urls.urlsUnloaded[0]\n    }\n    return clips\n  }\n\n  clipTiming(clip) {\n    const result = { offset: 0 }\n    const range = clip.timeRange(this.quantize)\n    const zero_seconds = this.__contextSeconds - this.__mashSeconds\n    result.start = zero_seconds + range.seconds\n\n    result.duration = range.lengthSeconds\n    if (clip.trim) {\n      range.frame = clip.trim\n      result.offset = range.seconds\n    }\n    const now = this.audioContext.currentTime\n    if (now > result.start) {\n      const dif = now - result.start\n      result.start = now\n      result.offset += dif\n      result.duration -= dif\n    }\n    return result\n  }\n\n  createSources() {\n    const clips = this.clipsInTimeRange\n    const filtered_clips = clips.filter(clip => !this.sourcesByClip.has(clip))\n    filtered_clips.forEach(clip => {\n      const media = clip.media\n      const url = media.urlAudible\n      if (url && Cache.cached(url)) {\n        const times = this.clipTiming(clip)\n        const { start, duration, offset } = times\n        if (Is.positive(start) && Is.positive(duration) && duration > 0) {\n          const gainSource = this.audioContext.createBufferSource()\n          gainSource.buffer = Cache.get(url)\n\n          const gainNode = this.audioContext.createGain()\n          gainSource.connect(gainNode)\n          gainNode.connect(this.audioContext.destination)\n          gainSource.start(start, offset, duration)\n\n          this.sourcesByClip.set(clip, { gainSource, gainNode })\n\n          this.adjustSourceGain(clip)\n\n        }\n      }\n    })\n  }\n\n  destroySources(clipsToKeep = []) {\n    this.sourcesByClip.forEach((source, clip) => {\n      if (clipsToKeep.includes(clip)) return\n\n      const { gainSource, gainNode } = source\n      gainNode.disconnect(this.audioContext.destination)\n      gainSource.disconnect(gainNode)\n      this.sourcesByClip.delete(clip)\n    })\n  }\n\n  draw() {\n    // console.log(this.constructor.name, \"draw\")\n    if (!this.configured) return\n\n    this.drawClips(this.time, this.clipsToDraw(true))\n  }\n\n  drawBackground(context) {\n    if (!Is.objectStrict(context)) throw Errors.internal\n\n    context.clearRect(0, 0, context.canvas.width, context.canvas.height)\n    context.fillStyle = Pixel.color(this.mash.backcolor)\n    context.fillRect(0, 0, context.canvas.width, context.canvas.height)\n  }\n\n  drawClips(time, clips) {\n    // console.log(this.constructor.name, \"drawClips\", time, clips)\n    const main = clips.filter(clip => clip.visible && clip.track === 0)\n    this.drawBackground(this.videoContext) // fill canvas with mash background color\n    if (main.length > 1) {\n      const transition = main.find(clip => clip.type === ClipType.transition)\n      if (!transition) throw Errors.mainTrackOverlap\n\n      const transitioned = main.filter(clip => clip.type !== ClipType.transition)\n      transition.mergeContextAtTime(time, this.videoContext, this.mash.backcolor, transitioned)\n    } else {\n      const [mainClip] = main\n      if (mainClip) mainClip.mergeContextAtTime(time, this.videoContext)\n    }\n    const tracked = clips.filter(clip => !main.includes(clip)).sort(byTrack)\n    tracked.forEach(clip => {\n      clip.mergeContextAtTime(time, this.videoContext)\n    })\n  }\n\n  drawFrame() {\n    // console.log(this.constructor.name, \"drawFrame\")\n    if (!this.configured) return\n\n    const clips = this.clipsToDraw()\n    if (Is.undefined(clips)) {\n      this.loadTimeRange()\n      return\n    }\n\n    requestAnimationFrame(() => this.drawClips(this.time, clips))\n    return true\n  }\n\n  loadTimeRange() {\n    if (this.audible) {\n      this.createSources()\n      this.destroySources(this.clipsInTimeRange)\n    }\n    const urls = this.urlsInTimeRangeByType(this.timeRange)\n    return urls.load(this.audioContext)\n  }\n\n  urlsInTimeRangeByType(timeRange) {\n    return this.mash.urlsWithin(timeRange, this.audible, this.visible)\n  }\n\n  loadTime() {\n    const urls = this.urlsInTimeRangeByType(this.time)\n    return urls.load(this.audioContext)\n  }\n\n  startPlaying() {\n    console.log(this.constructor.name, \"startPlaying\")\n    if (this.__bufferSource) throw Errors.internal\n    if (this.playing) throw Errors.internal\n    this.playing = true\n\n    this.__bufferSource = this.audioContext.createBufferSource()\n    this.__bufferSource.loop = true\n    this.__bufferSource.buffer = this.audioContext.createBuffer(2, 44100, 44100)\n    this.__bufferSource.connect(this.audioContext.destination)\n\n    this.__mashSeconds = this.time.seconds\n    this.__contextSeconds = this.audioContext.currentTime\n\n    console.log(\"__mashSeconds\", this.__mashSeconds)\n    console.log(\"__contextSeconds\", this.__contextSeconds)\n\n    this.createSources()\n\n    this.__bufferSource.start(0)\n  }\n\n  stopPlaying() {\n    console.log(this.constructor.name, \"stopPlaying\")\n\n    if (!this.playing) return\n\n    this.playing = false\n    if (this.__bufferSource) this.__bufferSource.stop()\n\n    this.destroySources()\n    this.__mashSeconds = 0\n    this.__contextSeconds = 0\n\n    if (!this.__bufferSource) return\n\n    this.__bufferSource.disconnect(this.audioContext.destination)\n    this.__bufferSource = null\n  }\n\n}\n\nObject.defineProperties(Composition.prototype, {\n  ...contexts,\n})\n\nexport { Composition }\n","import { Factory } from \"./Factory\"\n\nimport {\n  AddTrackAction,\n  MoveClipsAction,\n  AddClipToTrackAction,\n  AddEffectAction,\n  ChangeAction,\n  ChangeFramesAction,\n  ChangeTrimAction,\n  SplitAction,\n  FreezeAction,\n  MoveEffectsAction,\n  RemoveClipsAction,\n  Action,\n} from \"../Action\"\nimport { Is } from \"../Utilities\"\n\nconst ActionTypes = [\n  'addTrack',\n  'addClipsToTrack',\n  'moveClips',\n  'addEffect',\n  'change',\n  'changeFrames',\n  'changeTrim',\n  'changeGain',\n  'moveEffects',\n  'split',\n  'freeze',\n  'removeClips',\n]\nconst ActionType = Object.fromEntries(ActionTypes.map(type => [type, type]))\n\nclass ActionFactory extends Factory {\n  constructor() {\n    super(Action)\n    this.install(ActionType.addTrack, AddTrackAction)\n    this.install(ActionType.addClipsToTrack, AddClipToTrackAction)\n    this.install(ActionType.moveClips, MoveClipsAction)\n    this.install(ActionType.addEffect, AddEffectAction)\n    this.install(ActionType.change, ChangeAction)\n    this.install(ActionType.changeFrames, ChangeFramesAction)\n    this.install(ActionType.changeTrim, ChangeTrimAction)\n    this.install(ActionType.split, SplitAction)\n    this.install(ActionType.freeze, FreezeAction)\n    this.install(ActionType.moveEffects, MoveEffectsAction)\n    this.install(ActionType.removeClips, RemoveClipsAction)\n  }\n\n  createFromObjectMasher(object, masher) {\n    const defaults = {\n      mash: \"\",\n      undoSelectedClips: \"selectedClips\",\n      undoSelectedEffects: \"selectedEffects\",\n      redoSelectedClips: \"selectedClips\",\n      redoSelectedEffects: \"selectedEffects\",\n    }\n    const clone = { ...object }\n    Object.entries(defaults).forEach(entry => {\n      const [key, value] = entry\n      if (Is.defined(object[key])) return\n\n      if (Is.emptystring(value)) clone[key] = masher[key]\n      else clone[key] = [...masher[value]]\n    })\n\n    return this.createFromObject(clone)\n  }\n}\n\nObject.defineProperties(ActionFactory.prototype, {\n  type: { value: ActionType },\n  types: { value: ActionTypes },\n})\n\nconst ActionFactoryInstance = new ActionFactory\nexport { ActionFactoryInstance as ActionFactory }\n","import { Errors } from \"../../Setup/Errors\"\nimport { Id } from \"../../Utilities/Id\"\n\nexport const deprecated = {\n  uuid: { value: function() { return Id() } },\n  canvas_context: {\n    get: function() { \n      console.warn(Errors.deprecation.canvas_context.get)\n      return this.videoContext\n    },\n    set: function(value) { \n      console.warn(Errors.deprecation.canvas_context.set)\n      this.videoContext = value \n    }\n  },\n  buffertime: {\n    get: function() { return this.buffer },\n    set: function(value) { this.buffer = value }\n  },\n  minbuffertime: {\n    get: function() { return this.buffer },\n    set: function(value) { this.buffer = value }\n  },\n}\n","import { Base } from \"../Base\"\nimport { Errors } from \"../Setup\"\nimport { Is } from \"../Utilities\"\nimport { ChangeAction } from \"../Action\"\nimport { Actions } from \"../Actions\"\nimport { Mash } from \"../Mash\"\nimport { ClipFactory } from \"../Factory/ClipFactory\"\nimport { MediaFactory } from \"../Factory/MediaFactory\"\nimport { TimeFactory } from \"../Factory/TimeFactory\"\nimport { TimeRangeFactory } from \"../Factory/TimeRangeFactory\"\nimport { Context } from \"../Utilities\"\nimport { Throw } from \"../Utilities\"\nimport { Events } from \"../Events\"\nimport { Default } from \"../Setup\"\nimport { Composition } from \"../Composition\"\nimport { Clip } from \"../Clip\"\nimport { ActionFactory } from \"../Factory/ActionFactory\"\nimport { Effect } from \"../Transform\"\nimport {\n  TrackType,\n  MediaType,\n  EventType,\n  TransformTypes,\n  MoveType,\n  TrackTypes\n} from \"../Setup\"\n\nimport { deprecated } from \"./with/deprecated\"\nimport { contexts } from \"../Base/with/contexts\"\n\n\nconst MasherProperty = {\n  autoplay: \"autoplay\",\n  precision: \"precision\",\n  loop: \"loop\",\n  fps: \"fps\",\n  volume: \"volume\",\n  buffer: \"buffer\",\n}\n\n\nconst clipCanBeSplit = (clip, time, quantize) => {\n  if (!Is.object(clip)) return\n\n  // true if now intersects clip time, but is not start or end frame\n  let range = TimeRangeFactory.createFromTime(time)\n  const clip_range = clip.timeRange(quantize)\n\n  // ranges must intersect\n  if (!clip_range.intersects(range)) return\n\n  const scaled = range.scale(clip_range.fps)\n  if (scaled.frame === clip_range.frame) return\n  if (scaled.end === clip_range.end) return\n\n  return true\n}\n\n// TODO: support Layers, made up of Rolls (a, b)\nclass Masher extends Base {\n\n  constructor(object = {}) {\n    super(object)\n\n    this.object.canvas ||= Context.createCanvas()\n\n    this.events = new Events({ target: this.canvas })\n    this.events.addListener(this.handleMasher.bind(this))\n\n    // console.log(\"events:\", this.events)\n    this.__load_timer = false\n    this.__moving = false\n    this.__muted = false\n    this.__paused = true\n    this.__mashFrames = 0\n    this.__time = TimeFactory.createFromFrame(0, this.fps)\n    this.__drawnTime = TimeFactory.createFromFrame(0, this.fps)\n\n    const mash = this.object.mash || {}\n    this.object.mash = false\n    this.mash = mash\n  }\n\n  get action_index() { return this.__actions.index }\n\n\n  get autoplay() {\n    if (Is.undefined(this.__autoplay)) {\n      this.__autoplay = this.initializeProperty(MasherProperty.autoplay)\n    }\n    return this.__autoplay\n  }\n  set autoplay(value) { this.__autoplay = value }\n\n  // TODO: move me to Mash\n  get composition() {\n    if (!this.__composition) {\n      const options = {\n        bufferSeconds: this.buffer,\n        gain: this.gain,\n        mash: this.mash,\n        audioContext: this.audioContext,\n        videoContext: this.videoContext,\n      }\n      this.__composition = new Composition(options)\n      this.__composition.time = this.time\n    }\n    return this.__composition\n  }\n\n  get buffer() {\n    if (Is.undefined(this.__buffer)) {\n      // deprecated buffer properties\n      const properties = [MasherProperty.buffer, 'buffertime', 'minbuffertime']\n      this.__buffer = this.initializeProperty(...properties)\n    }\n    return this.__buffer\n  }\n  set buffer(value) {\n    if (this.__buffer !== value) {\n      this.__buffer = value\n      this.composition.bufferSeconds = value\n    }\n  }\n\n  get bufferedTimeRange() { return this.composition.bufferedTimeRange }\n\n  get canvas() { return this.videoContext.canvas }\n  set canvas(value) {\n    this.videoContext = Context.createVideo(value)\n    this.events.target = value\n  }\n\n  get configured() {\n    return this.mash && this.canvas\n  }\n\n  // time, but in seconds\n  get currentTime() { return this.time.seconds }\n  set currentTime(seconds) { this.time = TimeFactory.createFromSeconds(seconds, this.fps) }\n\n  get duration() { return TimeFactory.createFromFrame(this.__mashFrames, this.mash.quantize).seconds }\n\n  get endTime() { return this.mashEndTime.scale(this.fps, 'floor') }\n\n  get fps() {\n    if (Is.undefined(this.__fps)) {\n      this.__fps = this.initializeProperty(MasherProperty.fps)\n    }\n    return this.__fps\n  }\n  set fps(value) {\n    if (!Is.integer(value) || value < 1) throw(Errors.fps)\n\n    if (this.__fps !== value) {\n      this.__fps = value\n      this.__time = this.__time.scale(value)\n      this.__drawnTime = this.__drawnTime.scale(value)\n    }\n  }\n\n  get frame() { return this.time.frame }\n  set frame(value) {\n    // called from ruler to change position\n    //console.log('frame=', value, this.fps)\n\n    this.time = TimeFactory.createFromFrame(value, this.fps)\n    //console.log(\"time\", this.time)\n  }\n  // Math.round(Number(this.__mashFrames) / Number(this.mash.quantize) * Number(this.fps));}\n  get frames() { return this.mashEndTime.scale(this.fps).frame }\n\n  get gain() { return this.muted ? 0.0 : this.volume }\n\n  get loop() {\n    if (Is.undefined(this.__loop)) {\n      this.__loop = this.initializeProperty(MasherProperty.loop)\n    }\n    return this.__loop\n  }\n  set loop(value) { this.__loop = value }\n\n  get mash() { return this.__mash ||= this.object.mash }\n  set mash(object) {\n    // console.log(\"set mash\", object)\n\n    if (this.__mash === object) return\n\n    this.paused = true\n\n    this.__selectedEffects = []\n\n\n    this.__mash = new Mash(object)\n    this.__mash.events = this.events\n\n    this.__actions = new Actions({ mash: this.__mash, masher: this })\n\n    // console.log(\"set mash setting selectedClips\")\n    this.selectedClips = [] // so mash gets copied into __pristine\n\n    this.handleChangeMashFrames()\n\n    this.composition.mash = this.mash\n    this.time = TimeFactory.createFromSeconds(0, this.fps)\n\n    this.rebuffer()\n    this.redraw()\n    if (this.autoplay) this.paused = false\n  }\n\n  get mashEndTime() { return TimeFactory.createFromFrame(this.__mashFrames, this.mash.quantize) }\n\n  get muted() { return this.__muted }\n  set muted(value = false) {\n    this.__muted = value\n    this.handleGainChange()\n  }\n\n  get paused() { return this.__paused }\n  set paused(value) {\n    if (!this.__mashFrames) value = true\n    if (this.__paused !== value) {\n      this.__paused = value\n      this.composition.paused = value\n      if (this.__paused) {\n        this.__set_moving(false)\n        if (this.__buffer_timer) {\n          clearInterval(this.__buffer_timer)\n          this.__buffer_timer = 0\n        }\n      } else {\n        if (! this.__buffer_timer) {\n          this.__buffer_timer = setInterval(this.rebuffer, 2000)\n        }\n        this.rebuffer()\n        this.redraw()\n      }\n    }\n  }\n\n  get position() {\n    let per = 0\n    if (this.__time.frame) {\n      per = this.__time.seconds / this.duration\n      if (per !== 1) per = parseFloat(per.toFixed(this.precision))\n    }\n    return per\n  }\n  set position(value = 0) { this.time = TimeFactory.createFromSeconds(this.duration * value, this.fps) }\n\n  get position_step() {\n    const zeros = \"0\".repeat(this.precision - 1)\n    return parseFloat(`0.${zeros}1`)\n  }\n\n  get precision() {\n    if (Is.undefined(this.__precision)) {\n      this.__precision = this.initializeProperty(MasherProperty.precision)\n    }\n    return this.__precision\n\n  }\n  set precision(value) { this.__precision = value }\n\n  get selectedClip() {\n    if (this.__selectedClips.length === 1) return this.__selectedClips[0]\n  }\n  set selectedClip(value) { this.selectedClips = value }\n\n  get selectedClipOrMash() { return this.selectedClip || this.__mash }\n\n  get selectedClips() { return this.__selectedClips }\n\n  set selectedClips(value) {\n    this.__selectedClips = this.mash.filterClipSelection(value)\n    this.__pristine = this.selectedClipOrMash.propertyValues\n    this.selectedEffects = []\n  }\n\n  get selectedEffect() {\n    if (this.__selectedEffects.length === 1) return this.__selectedEffects[0]\n  }\n  set selectedEffect(value){\n    this.selectedEffects = Is.object(value)  && !Is.empty(value) ? [value] : []\n  }\n\n  get selectedEffects() { return this.__selectedEffects }\n  set selectedEffects(value) {\n    const effects = this.selectedClipOrMash.effects\n    if (!effects) { // mash or multiple clips selected, or no effects\n      this.__selectedEffects = []\n      this.__pristineEffect = {}\n      return\n    }\n\n    const array = Is.array(value) ? value : []\n    this.__selectedEffects = array.filter(effect => effects.includes(effect))\n    this.__pristineEffect = (this.selectedEffect && this.selectedEffect.propertyValues) || {}\n  }\n\n  get silenced() { return this.__paused || this.muted || !this.gain }\n\n  get stalling() { return !this.__moving && !this.paused }\n\n  get time() { return this.__time }\n  set time(value) {\n    const limited_time = this.__limit_time(value)\n    const equal = this.__time.equalsTime(limited_time)\n    this.__time = limited_time\n    this.composition.time = this.__time\n\n    if (!equal) this.handleChangeMash()\n  }\n\n  get urlsCached() { return this.composition.urlsInTimeRange }\n\n  get volume() {\n    if (Is.undefined(this.__volume)) {\n      this.__volume = this.initializeProperty(MasherProperty.volume)\n    }\n    return this.__volume\n  }\n  set volume(value) {\n    if (! Is.number(value)) throw(Errors.argument)\n\n    this.__volume = value\n    this.handleGainChange()\n  }\n\n  /**\n   * type - String audio|video|effect\n   */\n  add(object, addType, frameOrIndex, trackIndex) {\n    // console.log(\"add\", object, addType)\n    if (!Is.object(object)) throw Errors.argument + object\n    const type = Is.defined(addType) ? addType : object.type\n\n    if (type === MoveType.effect) {\n      return this.addEffect(new Effect(object), frameOrIndex)\n    }\n\n    const media = MediaFactory.create({ type, ...object })\n\n    const clip = ClipFactory.createFromObjectMedia(object, media, this.mash)\n    return this.addClip(clip, frameOrIndex, trackIndex)\n  }\n\n  addClip(clip, frameOrIndex, trackIndex) {\n    // console.log(\"addClip frameOrIndex\", clip, frameOrIndex)\n    Throw.unlessInstanceOf(clip, Clip)\n\n    const { trackType } = clip\n\n    const clips = [clip]\n    const options = {\n      clip,\n      type: ActionFactory.type.addClipsToTrack,\n      redoSelectedClips: clips,\n      trackType,\n    }\n    const track = this.mash.trackOfTypeAtIndex(trackType, trackIndex)\n    const trackCount = this.mash[trackType].length\n    if (trackIndex || trackType === TrackType.audio) {\n      options.trackIndex = trackIndex\n      clip.frame = track.frameForClipsNearFrame(clips, frameOrIndex)\n      options.createTracks = Math.max(0, trackIndex + 1 - trackCount)\n    } else {\n      options.insertIndex = frameOrIndex\n      options.createTracks = Math.min(1, Math.max(0, 1 - trackCount))\n    }\n    this.actionCreate(options)\n    return this.loadVisual().then(() => Promise.resolve(clip))\n  }\n\n  addEffect(effect, index) {\n    // console.log(this.constructor.name, \"addEffect\", object, index)\n    Throw.unlessInstanceOf(effect, Effect)\n\n    const effects = this.selectedClipOrMash.effects\n    Throw.unlessInstanceOf(effects, Array, Errors.selection)\n\n    const insertIndex = Is.integer(index) && index > 0 ? index : 0\n    const undoEffects = [...effects]\n    const redoEffects = [...effects]\n    redoEffects.splice(insertIndex, 0, effect)\n    const options = {\n      effects, undoEffects, redoEffects,\n      type: ActionFactory.type.moveEffects\n    }\n    this.actionCreate(options)\n    return this.loadVisual().then(() => Promise.resolve(effect))\n  }\n  /**\n   *\n   * @param {String} type audio or video\n   */\n  addTrack(trackType = TrackType.video) {\n    if (!TrackTypes.includes(trackType)) throw Errors.type + trackType\n\n    return this.actionCreate({ trackType, type: ActionFactory.type.addTrack })\n  }\n\n  can(method){\n    var should_be_enabled = false;\n    var z = this.__selectedClips.length;\n    switch(method){\n      case 'undo':{\n        should_be_enabled = this.__actions.canUndo\n        break;\n      }\n      case 'redo':{\n        should_be_enabled = this.__actions.canRedo\n        break;\n      }\n      case 'adjust':{\n        should_be_enabled = (z > 0);\n        if (should_be_enabled) should_be_enabled = (this.__selectedClips[0].track > 0);\n        break;\n      }\n      case 'copy':{\n        should_be_enabled = (z > 0);\n        break;\n      }\n      case 'cut':\n      case 'remove':{\n        should_be_enabled = (this.__selectedClips.length);\n        if (should_be_enabled) {\n          // TODO: test that removing won't create transition problem\n        }\n        break;\n      }\n      case 'split':{\n        should_be_enabled = clipCanBeSplit(this.selectedClip, this.time, this.mash.quantize)\n        break\n      }\n      case 'freeze':{\n        should_be_enabled = (z === 1)\n        should_be_enabled &&= MediaType.video === this.selectedClip.type\n        should_be_enabled &&= clipCanBeSplit(this.selectedClip, this.time, this.mash.quantize)\n        break;\n      }\n    }\n    return should_be_enabled;\n  }\n\n  currentActionReusable(target, property) {\n    if (!this.__actions.currentActionLast) return\n\n    const action = this.__actions.currentAction\n    if (!Is.instanceOf(action, ChangeAction)) return\n\n    if (!(action.target === target && action.property === property)) return\n\n    return action\n  }\n\n  change(property) {\n    if (!this.selectedClip) return this.changeMash(property)\n\n    return this.changeClip(property)\n  }\n\n  changeClip(property) {\n    if (!Is.string(property) || Is.empty(property)) throw Errors.property + property\n\n    const options = { property, target: this.selectedClip }\n    const [transform, transformProperty] = property.split(\".\")\n\n    if (transformProperty) {\n      // make sure first component is merger or scaler\n      if (!TransformTypes.includes(transform)) throw Errors.property + transform\n\n      if (transformProperty === 'id') {\n        options.property = transform\n        options.redoValue = options.target[options.property].id\n      }\n      else {\n        // we'll call merger/scaler set property\n        options.target = options.target[transform]\n        options.property = transformProperty\n        options.redoValue = options.target[options.property]\n      }\n      console.log(this.constructor.name, \"changeClip\", transform, transformProperty, this.__pristine)\n\n      options.undoValue = this.__pristine[transform][transformProperty]\n    } else {\n      options.undoValue = this.__pristine[property]\n      options.redoValue = options.target[options.property]\n    }\n\n    const action = this.currentActionReusable(options.target, options.property)\n    if (action) return action.updateAction(options.redoValue)\n\n    switch(options.property) {\n      case 'frames': {\n        options.type = ActionFactory.type.changeFrames\n        break\n      }\n      case 'trim': {\n        options.type = ActionFactory.type.changeTrim\n        break\n      }\n      default: options.type = ActionFactory.type.change\n    }\n    return this.actionCreate(options)\n  }\n\n  changeEffect(property) {\n    if (!Is.string(property) || Is.empty(property)) throw Errors.property\n\n    const target = this.selectedEffect\n    if (Is.undefined(target)) throw Errors.selection\n\n    const redoValue = target[property]\n    const action = this.currentActionReusable(target, property)\n    if (action) return action.updateAction(redoValue)\n\n    const undoValue = this.__pristineEffect[property]\n    const options = {\n      type: ActionFactory.type.change,\n      target, property, redoValue, undoValue\n    }\n    return this.actionCreate(options)\n  }\n\n  changeMash(property) {\n    if (!Mash.properties.includes(property)) throw Errors.unknownMash + property\n\n    const target = this.mash\n    const redoValue = this.mash[property]\n    const action = this.currentActionReusable(target, property)\n    if (action) return action.updateAction(redoValue)\n\n    const options = {\n      target,\n      property,\n      redoValue,\n      undoValue: this.__pristine[property],\n      type: ActionFactory.type.change,\n    }\n    // console.log(\"changeMash\", options)\n\n    return this.actionCreate(options)\n  }\n\n  delayedDraw() {\n    // console.log(\"Masher.delayedDraw\")\n    // called when assets are cached\n    if (!this.delayed_timer) {\n      this.delayed_timer = setTimeout(() => {\n        // console.log(this.constructor.name, \"delayedDraw timeout\", )\n        this.delayed_timer = null\n        this.redraw()\n      }, 50)\n    }\n  }\n\n  // call when player removed from DOM\n  destroy() { Mashers.delete(this) }\n\n  handleAction(type, action) {\n    this.events.emit(type, { action: action })\n  }\n\n  handleGainChange() { this.composition.gain = this.gain }\n\n  handleChangeMash(){\n    this.paused = true // make sure we are not playing\n    this.rebuffer()\n    this.redraw()\n  }\n\n  handleChangeMashFrames(){\n    // console.log(\"handleChangeMashFrames\")\n    const mash_frames = this.mash.frames\n    if (this.__mashFrames !== mash_frames) {\n      this.__mashFrames = mash_frames\n      // move back if we were positioned at a time later than new duration\n      const max_frame = Math.max(0, this.endTime.frame - 1)\n      if (max_frame < this.time.frame) this.frame = max_frame\n      else this.delayedDraw()\n    }\n  }\n\n  handleMasher(event) {\n    if (event.type !== Events.type) return console.warn(\"handleMasher\", event)\n    // console.log(\"handleMasher\", event.detail)\n\n    switch(event.detail.type) {\n      case EventType.duration: {\n        this.handleChangeMashFrames()\n        break\n      }\n      case EventType.action: {\n        const action = event.detail.action\n\n        this.selectedClips = action.selectedClips\n        this.selectedEffects = action.selectedEffects\n        switch (action.type) {\n          case ActionFactory.type.changeAction: {\n            if (action.property === \"gain\"){\n              if (this.__moving && !this.silenced) {\n                this.composition.adjustSourceGain(action.target)\n              }\n            }\n            break\n          }\n          default: this.delayedDraw()\n        }\n        break\n      }\n      default: {\n        this.delayedDraw()\n      }\n    }\n  }\n\n  handleRemoveActions(removedActions = []) {\n    const type = removedActions.length ? EventType.truncate : EventType.add\n    this.handleAction(type, this.__actions.currentAction)\n    this.handleChangeMash()\n    // TODO: deprecated - stop calling and remove did method\n    if (removedActions.length) this.did(removedActions.length)\n  }\n\n  initializeProperty(...properties) {\n    for (let property of properties) {\n      if (Is.defined(this.object[property])) return this.object[property]\n    }\n    return Default[properties[0]]\n  }\n\n  loadVisual() {\n    return this.composition.loadTime()\n  }\n  media(clip) { return clip.media }\n\n  move(objectOrArray, moveType, frameOrIndex, trackIndex) {\n    if (!Is.object(objectOrArray)) throw Errors.argument + objectOrArray\n\n    if (moveType === MoveType.effect) {\n      return this.moveEffects(objectOrArray, frameOrIndex)\n    }\n\n    return this.moveClips(objectOrArray, frameOrIndex, trackIndex)\n  }\n\n  moveEffects(effectOrArray, index = 0) {\n    // console.log(this.constructor.name, \"moveEffects\", effectOrArray, index)\n    if (!Is.positive(index)) throw Errors.argument + index\n\n    // Coerce.instanceArray?\n\n    const array = Is.array(effectOrArray) ? effectOrArray : [effectOrArray]\n    const moveEffects = array.filter(effect => Is.instanceOf(effect, Effect))\n    if (Is.emptyarray(moveEffects)) throw Errors.argument + effectOrArray\n\n    const effects = this.selectedClip.effects\n    const undoEffects = [...effects]\n\n    const redoEffects = []\n    undoEffects.forEach((effect, i) => {\n      if (i === index) redoEffects.push(...moveEffects)\n      if (moveEffects.includes(effect)) return\n\n      redoEffects.push(effect)\n    })\n\n    const options = {\n      effects, undoEffects, redoEffects,\n      type: ActionFactory.type.moveEffects\n    }\n    // console.log(this.constructor.name, \"moveEffects\", options)\n    return this.actionCreate(options)\n  }\n\n  moveClips(clipOrArray, frameOrIndex = 0, trackIndex = 0) {\n    // console.log(\"moveClips\", \"frameOrIndex\", frameOrIndex, \"trackIndex\", trackIndex)\n    if (!Is.positive(frameOrIndex)) throw Errors.argument + frameOrIndex\n    if (!Is.positive(trackIndex)) throw Errors.argument + trackIndex\n\n    const clips = this.mash.filterClipSelection(clipOrArray)\n    if (Is.emptyarray(clips)) throw Errors.argument + clipOrArray\n\n    const [firstClip] = clips\n    const { trackType, track: undoTrackIndex } = firstClip\n    const options = {\n      clips, trackType, trackIndex, undoTrackIndex,\n      type: ActionFactory.type.moveClips\n    }\n\n    const redoTrack = this.mash.trackOfTypeAtIndex(trackType, trackIndex)\n    const undoTrack = this.mash.trackOfTypeAtIndex(trackType, undoTrackIndex)\n    const currentIndex = redoTrack.clips.indexOf(firstClip)\n\n    if (redoTrack.isMainVideo) options.insertIndex = frameOrIndex\n    if (undoTrack.isMainVideo) {\n      options.undoInsertIndex = currentIndex\n      if (frameOrIndex < currentIndex) options.undoInsertIndex += clips.length\n    }\n\n    if (!(redoTrack.isMainVideo && undoTrack.isMainVideo)) {\n      const frames = clips.map(clip => clip.frame)\n      const insertFrame =  redoTrack.frameForClipsNearFrame(clips, frameOrIndex)\n      const offset = insertFrame - firstClip.frame\n      if (!offset) return // because there would be no change\n\n      options.undoFrames = frames\n      options.redoFrames = frames.map(frame => frame + offset)\n    }\n    return this.actionCreate(options)\n  }\n\n  pause() {\n    this.paused = true;\n  }\n\n  play() {\n    this.paused = false;\n  }\n\n  rebuffer() {\n    if (this.paused) return this.composition.loadTime()\n\n    return this.composition.loadTimeRange()\n  }\n\n  redo(){\n    if (this.__actions.canRedo) {\n      const action = this.__actions.redo()\n      this.handleChangeMash()\n    }\n  }\n\n  redraw() {\n    if (! this.configured) return\n\n    const video_buffered = this.composition.drawFrame()\n    const no_audio = !this.__moving || this.silenced\n    const audio_buffered = no_audio || this.composition.bufferedTime\n    // console.log(this.constructor.name, \"redraw audio_buffered:\", audio_buffered)\n    const all_buffered = video_buffered && audio_buffered\n\n    if (this.__moving !== all_buffered) {\n      if (this.__moving) this.__set_moving(false)\n      else if (!this.__paused && this.bufferedTimeRange) this.__set_moving(true)\n    }\n  }\n\n  draw() { return this.composition.draw() }\n\n  remove(objectOrArray, moveType) {\n    if (!Is.object(objectOrArray)) throw Errors.argument + objectOrArray\n\n    if (moveType === MoveType.effect) return this.removeEffects(objectOrArray)\n\n    return this.removeClips(objectOrArray)\n  }\n\n  removeClips(clipOrArray) {\n    const clips = this.mash.filterClipSelection(clipOrArray)\n    if (Is.emptyarray(clips)) throw Errors.argument + clipOrArray\n\n    const [firstClip] = clips\n    const track = this.mash.clipTrack(firstClip)\n    const options = {\n      clips, track, index: track.clips.indexOf(firstClip),\n      type: ActionFactory.type.removeClips\n    }\n    return this.actionCreate(options)\n  }\n\n  removeEffects(effectOrArray) {\n    const array = Is.array(effectOrArray) ? effectOrArray : [effectOrArray]\n    const removeEffects = array.filter(effect => Is.instanceOf(effect, Effect))\n    if (Is.emptyarray(removeEffects)) throw Errors.argument + effectOrArray\n\n    const effects = this.selectedClip.effects\n    const undoEffects = [...effects]\n    const redoEffects = effects.filter(effect => !removeEffects.includes(effect))\n\n    const options = {\n      redoSelectedEffects: [],\n      effects, undoEffects, redoEffects,\n      type: ActionFactory.type.moveEffects\n    }\n    return this.actionCreate(options)\n  }\n\n  select(object, toggle_selected) {\n    if (!object) {\n      // console.log(\"Masher.select FALSE\", object, toggle_selected)\n      this.selectedClip = false\n      return\n    }\n    // console.log('Masher.select TRUE', object, toggle_selected);\n    var media, i, array = [], key_array = '__selectedClips', key_prop = 'selectedClips';\n    media = this.mash.findMedia(object.id)\n    if (media){\n      if (MediaType.effect === media.type){\n        key_array = '__selectedEffects';\n        key_prop = 'selectedEffects';\n      }\n      if (toggle_selected) {\n        i = this[key_array].indexOf(object);\n        switch(this[key_array].length){\n          case 0: {\n            array.push(object);\n            break;\n          }\n          case 1: {\n            if (i > -1) break;\n          } // potential intentional fall through to default\n          default: {\n            if (i < 0) {\n              array.push(object);\n              array = array.concat(this[key_array]);\n            } else {\n              if (i) array = array.concat(this[key_array].slice(0, i));\n              if (i < (this[key_array].length - 1)) array = array.concat(this[key_array].slice(i + 1));\n            }\n          }\n\n        }\n      }\n      else {\n        if (-1 < this[key_array].indexOf(object)) return;\n        array.push(object);\n      }\n    }\n    // console.log('select', key_prop, array);\n    this[key_prop] = array;\n  }\n\n  selected(object) {\n    if (Is.instanceOf(object, Effect)) return this.selectedEffects.includes(object)\n\n    return this.selectedClips.includes(object)\n  }\n\n  selectEffect(effect, toggle_selected){\n    if (Is.object(effect)) return this.select(effect, toggle_selected);\n    else if (! toggle_selected) this.selectedEffect = effect;\n  }\n\n  split() {\n    const splitClip = this.selectedClip\n    if (!clipCanBeSplit(splitClip, this.time, this.mash.quantize)) return\n\n    const scaled = this.time.scale(this.mash.quantize)\n    const undoFrames = splitClip.frames\n    const redoFrames = scaled.frame - splitClip.frame\n    const insertClip = splitClip.copy\n    insertClip.frames = undoFrames - redoFrames\n    insertClip.frame = scaled.frame\n    if (splitClip.properties.includes(\"trim\")) insertClip.trim += redoFrames\n\n    const trackClips = this.mash.clipTrack(splitClip).clips\n    const options = {\n      type: ActionFactory.type.split,\n      splitClip,\n      insertClip,\n      trackClips,\n      redoFrames,\n      undoFrames,\n      index: 1 + trackClips.indexOf(splitClip),\n      redoSelectedClips: [insertClip],\n      undoSelectedClips: [splitClip],\n    }\n    return this.actionCreate(options)\n  }\n\n  freeze() {\n    const freezeClip = this.selectedClip\n    if (!clipCanBeSplit(freezeClip, this.time, this.mash.quantize)) return\n    if (MediaType.video !== freezeClip.type) return\n\n    const scaled = this.time.scale(this.mash.quantize)\n    const trackClips = this.mash.clipTrack(freezeClip).clips\n    const insertClip = freezeClip.copy\n    const frozenClip = freezeClip.copy\n\n    const options = {\n      frames: freezeClip.frames - (scaled.frame - freezeClip.frame),\n      freezeClip, frozenClip, insertClip, trackClips,\n      redoSelectedClips: [frozenClip],\n      index: 1 + trackClips.indexOf(freezeClip),\n      type: ActionFactory.type.freeze,\n    }\n\n    frozenClip.frame = scaled.frame\n    frozenClip.frames = 1\n    frozenClip.trim = freezeClip.trim + (scaled.frame - freezeClip.frame)\n    insertClip.frame = scaled.frame + 1\n    insertClip.frames = options.frames - 1\n    insertClip.trim = frozenClip.trim + 1\n\n    return this.actionCreate(options)\n  }\n\n  undo() {\n    if (this.__actions.canUndo) {\n      const action = this.__actions.undo()\n      this.handleChangeMash()\n    }\n  }\n\n\n  __limit_time(time) {\n    const scaled = time.scale(this.fps)\n    const end_time = this.mashEndTime.scale(this.fps)\n    if (scaled.frame > end_time.frame) return end_time\n\n    return scaled\n    // console.log(\"__limit_time\", time)\n    // var start_time = time.copy;\n    // var limit_time = this.mashEndTime\n    // limit_time.frame = Math.max(0, limit_time.frame - 1);\n    // start_time = start_time.min(limit_time);\n    // start_time = start_time.scale(this.fps, 'floor');\n    // return start_time;\n  }\n\n  __load_timed(){\n    // console.log(this.constructor.name, \"__load_timed moving: \", this.__moving)\n    if (this.__moving){\n      // hopefully runs twice a frame\n      var now = TimeFactory.createFromSeconds(this.composition.seconds, this.fps, 'ceil');\n      if (now.frame !== this.__limit_time(now).frame) {\n        // loop back to start or pause\n        if (! this.loop) {\n          this.paused = true;\n        } else {\n          this.frame = 0;\n          this.paused = false;\n        }\n      } else {\n        if (! now.equalsTime(this.__drawnTime)) {\n          this.__time = now.scale(this.fps)\n          this.redraw();\n        }\n      }\n    }\n  }\n\n  __set_moving(tf) {\n    // console.log(\"__set_moving\", tf)\n    if (this.__moving !== tf) {\n      this.__moving = tf;\n      if (this.__moving) {\n        var $this = this;\n        this.__load_timer = setInterval(() => {$this.__load_timed();}, 500 / this.fps);\n        // start up the sound buffer with our current time, rather than displayed\n        this.composition.startPlaying()\n        this.rebuffer() // get sounds buffering now, rather than next timer execution\n      } else {\n        this.composition.stopPlaying()\n        clearInterval(this.__load_timer)\n        this.__load_timer = false\n      }\n    }\n  }\n\n  actionCreate(object) {\n    const action = ActionFactory.createFromObjectMasher(object, this)\n    const removed = this.__actions.do(action)\n    this.handleRemoveActions(removed)\n  }\n}\n\n\n\n\nObject.defineProperties(Masher, {\n  type: { value: \"masher\" },\n  properties: { get: function() { return Object.values(MasherProperty) }}\n\n})\nObject.defineProperties(Masher.prototype, {\n  ...contexts,\n  ...deprecated,\n})\n\nexport { Masher }\n","import { Masher } from \"../Masher\";\nimport { Is } from \"../Utilities\";\nimport { Factory } from \"./Factory\";\nimport { UrlsByType, Cache } from \"../Loading\";\n\nconst MasherTypes = [\"masher\"]\nconst MasherType = Object.fromEntries(MasherTypes.map(type => [type, type]))\nconst INTERVAL_TICS = 10 * 1000\n\nclass MasherFactory extends Factory {\n  constructor() {\n    super()\n    this.install(MasherType.masher, Masher)\n  }\n\n  /**\n   *\n   * @param {Object} object containing options\n   * @returns Masher\n   */\n  create(object = MasherType.masher) {\n    const masher = super.create(object)\n    if (!this.mashers.length) this.start()\n    this.mashers.push(masher)\n    return masher\n  }\n}\n\nObject.defineProperties(MasherFactory.prototype, {\n  destroy: {\n    value: function(masher) {\n      const index = this.mashers.indexOf(masher)\n      if (index < 0) return\n\n      this.mashers.splice(index, 1)\n      if (!this.mashers.length) this.stop()\n    }\n  },\n  handleInterval: {\n    value: function() {\n      // console.log(this.constructor.name, \"handleInterval\")\n      const urls = new UrlsByType\n      this.mashers.forEach(masher => urls.concat(masher.urlsCached))\n      const array = urls.urls\n      Cache.urls().forEach(url => array.includes(url) || Cache.remove(url))\n    }\n  },\n  mashers: {\n    get: function() {\n      if (Is.undefined(this.__mashers)) this.__mashers = []\n      return this.__mashers\n    }\n  },\n\n  start: {\n    value: function() {\n      // console.log(this.constructor.name, \"start\")\n      if (this.interval) return\n\n      this.interval = setInterval(this.handleInterval.bind(this), INTERVAL_TICS)\n    }\n  },\n  stop: {\n    value: function() {\n      // console.log(this.constructor.name, \"stop\")\n      if (!this.interval) return\n\n      clearInterval(this.interval)\n      this.interval = null\n    }\n  },\n  type: { value: MasherType },\n  types: { value: MasherTypes },\n})\n\nconst MasherFactoryInstance = new MasherFactory\n\nexport { MasherFactoryInstance as MasherFactory }\n","import { Module, Property, ModuleType, ModuleTypes } from \"./Setup\"\nimport { MasherFactory } from \"./Factory/MasherFactory\"\n\nexport default {\n  Property,\n  Module,\n  ModuleType,\n  ModuleTypes,\n  MasherFactory,\n}\n"],"names":["Default","buffer","fps","loop","volume","precision","autoplay","mash","label","quantize","backcolor","media","frame","duration","image","theme","transition","$deprecated","$internal","Errors","action","actions","internal","argument","invalid","track","trackType","type","selection","unknown","merger","effect","filter","font","scaler","uncached","object","array","id","frames","seconds","url","time","timeRange","mainTrackOverlap","unknownMash","property","deprecation","property_types","addModulesOfType","configure","get","set","canvas_context","wrongClass","byFrame","a","b","byTrack","byLabel","$audio","$effect","$font","$image","$merger","$scaler","$theme","$transition","$video","map","ClipTypes","ClipType","Object","fromEntries","EventTypes","EventType","MediaTypes","MediaType","ModuleTypes","ModuleType","LoadTypes","LoadType","TrackTypes","TrackType","MoveTypes","MoveType","TransformTypes","TransformType","objectType","value","stringType","undefinedType","numberType","isDefined","isNil","isNot","isNumber","Number","isNaN","isInt","isInteger","instanceOf","klass","isArray","Array","length","emptystring","emptyarray","emptyobject","keys","Is","ModuleInstance","[object Object]","this","defaults","fontDefaultJson","mergerDefaultJson","scalerDefaultJson","modules","themeColorJson","themeTextJson","effectSharpenJson","effectBlurJson","effectChromaKeyJson","effectEmbossJson","effectGrayscaleJson","effectSepiaJson","effectTextJson","mergerBlendJson","mergerCenterJson","mergerConstrainedJson","mergerOverlayJson","scalerPanJson","scalerScaleJson","objects","includes","console","warn","modulesOfType","changed","forEach","ofTypeExists","splice","indexOf","ofType","push","sort","module","defaultOfType","find","Property","defineProperties","prototype","modularPropertyTypeIds","__modularPropertyTypeIds","ids","propertyTypes","orDefault","propertyTypeDefault","propertyType","Klass","number","integer","rgba","String","rgb","modular","fontsize","direction4","values","identifier","direction8","string","pixel","mode","composite","text","PropertyInstance","Colors","yuvs","yuv2","similarity","blend","du","dv","i","diff","z","u","v","Math","sqrt","min","max","k","yuv","parseInt","y","r","g","floor","ContextFactoryInstance","width","height","context","createVideo","canvas","drawing","createDrawing","window","AudioContext","document","createElement","element","createCanvas","getContext","Id","replace","c","Uint8Array","crypto","getRandomValues","toString","rgbAtIndex","index","pixels","safePixel","x_dif","y_dif","pt","x","toPoint","fromPoint","Pixel","slice","data","size","half_size","safePixels","toIndex","Throw","error","name","Time","zero","time1","time2","rounding","gcf","t","greatestCommonDenominator","scale","scaleTimes","copy","description","subtracted","TimeFactory","rounded","roundingFunction","createFromFrame","ceil","round","TimeRange","super","end","endTime","lengthSeconds","position","startTime","range1","range2","range","Utilities","key","item","toUpperCase","substr","Base","constructor","Action","entries","events","selectedClips","done","redoSelectedClips","undoSelectedClips","selectedEffects","redoSelectedEffects","undoSelectedEffects","redoAction","emit","undoAction","AddTrackAction","addTrack","removeTrack","ChangeAction","redoValue","__redoValue","target","undoValue","redo","FreezeAction","trackClips","insertClip","frozenClip","freezeClip","ChangeFramesAction","changeClipFrames","ChangeTrimAction","changeClipTrim","AddEffectAction","effects","AddClipToTrackAction","clips","trackIndex","createTracks","addClipsToTrack","clip","insertIndex","removeClipsFromTrack","MoveClipsAction","redoFrames","addClips","undoFrames","undoTrackIndex","undoInsertIndex","__track","RemoveClipsAction","SplitAction","splitClip","MoveEffectsAction","redoEffects","undoEffects","Actions","canRedo","canUndo","currentAction","currentActionLast","masher","remove","removed","undo","__decorate","decorators","desc","d","arguments","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","Factory","baseClass","classesByType","Map","typedClass","createFromType","createFromObject","typeClass","sharedMedia","toJSON","__id","initializeId","properties","__properties","propertiesInitialize","propertiesTiming","assign","propertiesAudible","propertiesModular","source","Processor","AudioProcessor","audioContext","Promise","resolve","reject","decodeAudioData","audioData","CacheInstance","__cached_urls","__urls_by_md5","FontProcessor","family","Cache","face","FontFace","promise","load","then","fonts","add","ImageProcessor","log","ModuleProcessor","ProcessorFactoryInstance","install","audio","Loader","promises","cached","urls","every","loadedUrl","requestUrl","processed","all","loadUrl","AudioLoader","fetch","response","arrayBuffer","loaded","options","ProcessorFactory","process","FontLoader","create","ImageLoader","Image","onload","event","onerror","crossOrigin","src","ModuleLoader","import","LoaderFactoryInstance","UrlsByType","none","UrlsByTypeNone","loaders","flatMap","urlsUnloaded","Set","LoaderFactory","loadUrls","definition","inaudible","audible","urlsAudibleInTimeRangeForClipByType","visibleMedia","visible","video","__propertiesModular","modularPropertiesByType","__modularPropertiesByType","initializeModularPropertiesByType","CoreFilter","scopeSet","draw","evaluator","BlendFilterInstance","evaluated","outputContext","all_mode","id_key","globalCompositeOperation","drawImage","ChromaKeyFilterInstance","parameters","color","accurate","colors","split","f","getImageData","yuvsFromPixelsAccurate","yuvsFromPixels","offset","matrix","putImageData","rgbs","ColorFilterInstance","fillStyle","fillRect","ColorChannelMixerFilterInstance","rgbas","first","second","j","red","green","blue","alpha","image_data","rr","rg","rb","ra","gr","gg","gb","ga","br","bg","bb","ba","ar","ag","ab","aa","RBGA","ConvolutionFilterInstance","result","bias","rdiv","channel","parseFloat","parse","input","output","createImageData","inputData","outputDdata","area","sum","matrix3","CropFilterInstance","in_width","in_height","w","out_w","h","out_h","Context","DrawBoxFilterInstance","mmFontFile","Module","fontById","mmTextFile","mmFontFamily","DrawTextFilterInstance","fontcolor","textfile","shadowcolor","shadowColor","shadowx","shadowy","shadowOffsetX","shadowOffsetY","fillText","FadeFilterInstance","createDrawingLike","globalAlpha","OverlayFilterInstance","ScaleFilterInstance","inWidth","inHeight","SetSarFilterInstance","Filters","BlendFilter","chromakey","ChromaKeyFilter","colorchannelmixer","ColorChannelMixerFilter","ColorFilter","convolution","ConvolutionFilter","crop","CropFilter","drawbox","DrawBoxFilter","drawtext","DrawTextFilter","fade","FadeFilter","overlay","OverlayFilter","ScaleFilter","setsar","SetSarFilter","FilterTypes","FilterType","FilterFactory","types","created","drawFilters","coreFilter","evaluateScope","Media","names","propertyNames","has","FilterMedia","__coreFilter","definitions","parameter","evaluate","filters","__filters","filtersInitialize","html","inspector","urlsFromFilters","urlsVisibleInTimeRangeForClipByType","propertiesByType","transform","EffectMedia","ScalerMedia","MergerMedia","modularFalse","invisible","__duration","gain","trim","urlAudible","AudioMedia","FontMedia","urlAudibleMute","undefined","urlsVisibleFrames","__fps","framesMax","begin","__begin","pattern","__pattern","increment","__increment","zeropadding","__zeropadding","zeropaddingInitialize","last_frame","__url","limitedTimeRange","minEndTime","max_frames","media_time","s","padStart","replaceAll","VideoMedia","urlsVisible","urlsVisibleInTimeRange","urlVisible","ImageMedia","ThemeMedia","urlsNone","TransitionMedia","MediaFactoryInstance","createFromArgs","createFromTime","TimeRangeFactory","propertyValues","labelFromObjectOrMedia","__label","labelInitialize","__media","MediaFactory","valueOrTransform","propertiesFromMedia","editable","propertiesTransform","sharedClip","timeRangeRelative","mashTime","withFrame","mashTimeRange","urlsVisibleInTimeRangeByType","urlsAudibleInTimeRangeByType","visibleClip","scaledContextAtTimeForDimensions","dimensions","rest","contextAtTimeForDimensions","clipTimeRange","drawMediaFilters","effectedContextAtTimeForDimensions","reverse","mergeContextAtTime","effected","drawMerger","mediaTimeRange","concat","idMutable","urlsFromMedia","mediaInitialize","KEYS_SIZED","KEYS_GETTERS","KEYS","THIS","Evaluator","conditionalExpression","conditional","condition","is","elements","in","strings","join","replaceKeys","expression","expressions","RegExp","reg_exp","conditionalValue","conditionals","test_bool","evaluateExpression","expressionOrConditions","script","Function","method","exception","bind","mm_cmp","mm_dimensions","mm_width","mm_height","mm_duration","mm_fps","mm_horz","proud","sized","mm_max","mm_min","mm_t","mm_vert","vertical","scaled","other","abs","clipRange","sharedTransform","Transform","initializeInstance","Merger","inputContext","Scaler","Effect","__effects","effectsInitialize","__merger","mergerInitialize","objectWithDefaultId","__scaler","scalerInitialize","coreFilters","resource","Clip","mediaUtilized","mediaUtilizedFunction","metadataKey","metadataValue","metadata","mediaTime","ImageClip","muted","add_one_frame","end_time","limited_time","start_time","subtract","frame_at_speed","speed","divide","mediaTimeFromTrim","AudioClip","VideoClip","ThemeClip","ChildTypes","ChildType","TransitionClip","children","sorted","fromClip","toClip","defined","to","from","childType","child","initializeChild","transformType","FrameClip","ClipFactoryInstance","createFromSeconds","createFromObjectMedia","Track","__clips","initializeClips","searchMedia","ClipFactory","isMainVideo","clipIndex","origIndex","movingClips","spliceClips","moving","sortClips","isTransition","TrackFactory","MashProperty","Mash","__audio","initializeAudio","__backcolor","tracks","flat","clipsAudible","clipsAudio","clipsVideo","__events","initializeMedia","initializeVideo","initialMedia","__initialMedia","Mash_1","__quantize","av","__video","newTrack","clipTrackAtIndex","oldTrack","clipTrack","emitIfFramesChange","removeClips","limitedValue","newFrames","intersects","trackOfTypeAtIndex","clipsWithin","clipIntersects","includeAudible","includeVisible","clipsAudibleInTimeRange","clipsVisibleInTimeRange","info","emitDuration","mediaId","found","findInitialMedia","findClipMedia","firstClip","abutting","pop","urlsVisibleInTimeRangeForClipsByType","urlsAudibleInTimeRangeForClipsByType","urlsForClipsWithin","Events","methods","EventTarget","removeListener","addListener","addEventListener","detail","dispatchEvent","CustomEvent","delete","removeEventListener","contexts","videoContext","__videoContext","composition","__audioContext","createAudio","Composition","bufferSeconds","paused","playing","sourcesByClip","__mashSeconds","__contextSeconds","bufferedTime","urlsAtTime","bufferedTimeRange","urlsInTimeRange","clipsAtTime","clipsInTimeRange","configured","__gain","__gainInitialize","adjustSourceGain","currentTime","__time","buffer_time","timeRangeAtTime","urlsInTimeRangeByType","gainNode","times","clipTiming","start","cancelScheduledValues","gains","linearRampToValueAtTime","throwIfUncached","JSON","stringify","throwUnlessClipsDrawable","zero_seconds","now","dif","gainSource","createBufferSource","createGain","connect","destination","clipsToKeep","disconnect","drawClips","clipsToDraw","clearRect","main","drawBackground","transitioned","mainClip","requestAnimationFrame","loadTimeRange","createSources","destroySources","urlsWithin","__bufferSource","createBuffer","stop","ActionTypes","ActionType","ActionFactory","moveClips","addEffect","change","changeFrames","changeTrim","freeze","moveEffects","clone","entry","ActionFactoryInstance","deprecated","uuid","buffertime","minbuffertime","MasherProperty","clipCanBeSplit","clip_range","Masher","handleMasher","__load_timer","__moving","__muted","__paused","__mashFrames","__drawnTime","action_index","__actions","__autoplay","initializeProperty","__composition","__buffer","mashEndTime","__loop","__mash","__selectedEffects","handleChangeMashFrames","rebuffer","redraw","handleGainChange","__set_moving","__buffer_timer","clearInterval","setInterval","per","toFixed","position_step","zeros","repeat","__precision","selectedClip","__selectedClips","selectedClipOrMash","filterClipSelection","__pristine","selectedEffect","__pristineEffect","silenced","stalling","__limit_time","equal","equalsTime","handleChangeMash","urlsCached","__volume","addType","frameOrIndex","addClip","trackCount","frameForClipsNearFrame","actionCreate","loadVisual","should_be_enabled","changeClip","changeMash","transformProperty","currentActionReusable","updateAction","delayed_timer","setTimeout","Mashers","mash_frames","max_frame","delayedDraw","changeAction","removedActions","truncate","handleAction","did","loadTime","objectOrArray","moveType","effectOrArray","clipOrArray","redoTrack","undoTrack","currentIndex","video_buffered","drawFrame","audio_buffered","all_buffered","removeEffects","toggle_selected","key_array","key_prop","findMedia","select","tf","$this","__load_timed","startPlaying","stopPlaying","createFromObjectMasher","do","handleRemoveActions","MasherTypes","MasherType","MasherFactory","mashers","destroy","handleInterval","__mashers","interval","MasherFactoryInstance"],"mappings":"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"}