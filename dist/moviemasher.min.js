!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).MovieMasher={})}(this,(function(e){"use strict";const t="Invalid argument",i="Invalid property",r="Internal Error ",s={eval:{sourceRect:"Invalid evaluation of source rect ",outputSize:"Invalid evaluation of output size ",conditionTruth:"Expected at least one condition to evaluate to true ",conditionValue:"Expected condition to have a value ",number:"Expected evaluated value to be a number ",get:"Expected to get evaluated value "},composition:{mashUndefined:`${r}composition.mash undefined`},audibleContext:"Expected AudioContext",mash:"Expected mash",action:"Expected Action",actions:"Expected Actions",internal:r,argument:"Invalid argument ",invalid:{canvas:"Invalid property canvas ",context:"Invalid property context ",definition:{duration:"Invalid definition property duration",audio:"Invalid definition property audio|url",url:"Invalid definition property url",source:"Invalid definition property source",id:"Invalid definition property id",object:"Invalid property definition"},size:"Invalid size ",track:"Invalid track ",trackType:"Invalid property trackType ",action:"Invalid action ",name:"Invalid property name ",value:"Invalid property value ",type:"Invalid property type ",url:"Invalid property url ",property:i,argument:t,object:"Invalid argument object ",factory:"Invalid factory ",volume:"Invalid argument volume"},type:"Unknown type ",selection:"Invalid selection ",unknown:{type:"Unknown type ",merger:"Unknown merger ",effect:"Unknown effect ",filter:"Unknown filter ",font:"Unknown font ",scaler:"Unknown scalar ",mode:"Unknown mode ",definition:"Unknown definition "},uncached:"Uncached URL ",object:"Invalid argument object ",array:"Invalid argument array ",media:"Invalid argument media ",id:"Invalid argument id ",frame:"Invalid argument frame ",frames:"Invalid property frames ",fps:"Invalid argument fps ",seconds:"Invalid argument seconds ",url:"Invalid argument url ",time:"Invalid argument Time",timeRange:"Invalid argument TimeRange",mainTrackOverlap:`${r}: main track clips overlap without transition`,unknownMash:"Unknown Mash property ",unimplemented:"Expected method to be overridden",property:"Invalid argument property ",wrongClass:"Expected instance of "},n=e=>"object"==typeof e,o=e=>"string"==typeof e,a=e=>void 0===e,c=e=>"number"==typeof e,l=e=>"boolean"==typeof e,h=e=>"function"==typeof e,d=e=>!a(e),u=e=>c(e)&&Number.isNaN(e),m=e=>Number.isInteger(e),f=e=>c(e)&&!m(e),p=e=>c(e)&&Number(e)>=0,g=e=>(e=>c(e)&&!Number.isNaN(e))(e)&&Number(e)>0,v=e=>d(Array.isArray)?Array.isArray(e):e instanceof Array,y=e=>!!e.length,b=e=>o(e)&&y(String(e)),T=e=>n(e)&&y(Object.keys(e)),w=e=>v(e)&&y(e),x={aboveZero:g,array:v,boolean:l,defined:d,float:f,integer:m,method:h,nan:u,number:c,object:n,populatedArray:w,populatedObject:T,populatedString:b,positive:p,string:o,undefined:a};e.idPrefix="";const S=()=>{const t=[];return e.idPrefix&&t.push(e.idPrefix),t.push(Date.now().toString(36)),t.push(Math.random().toString(36).substr(2)),t.join("-")},F=t=>{e.idPrefix=t},_={generate:S,prefix:e.idPrefix,prefixSet:F};var k,A;e.ActionType=void 0,(k=e.ActionType||(e.ActionType={})).AddTrack="addTrack",k.AddClipsToTrack="addClipsToTrack",k.MoveClips="moveClips",k.AddEffect="addEffect",k.Change="change",k.ChangeFrames="changeFrames",k.ChangeTrim="changeTrim",k.ChangeGain="changeGain",k.MoveEffects="moveEffects",k.Split="split",k.Freeze="freeze",k.RemoveClips="removeClips",e.TrackType=void 0,(A=e.TrackType||(e.TrackType={})).Audio="audio",A.Transition="transition",A.Video="video";const I=Object.values(e.TrackType);var C;e.ClipType=void 0,(C=e.ClipType||(e.ClipType={})).Audio="audio",C.Frame="frame",C.Image="image",C.Theme="theme",C.Transition="transition",C.Video="video",C.VideoSequence="videosequence",C.VideoStream="videostream";const D=Object.values(e.ClipType);var z;e.DefinitionType=void 0,(z=e.DefinitionType||(e.DefinitionType={})).Filter="filter",z.Merger="merger",z.Scaler="scaler",z.Effect="effect",z.Font="font",z.Theme="theme",z.Transition="transition",z.Image="image",z.Video="video",z.Audio="audio",z.VideoStream="videostream",z.VideoSequence="videosequence";const O=Object.values(e.DefinitionType);var M,E;e.EventType=void 0,(M=e.EventType||(e.EventType={})).Action="action",M.Duration="durationchange",M.Draw="draw",M.Ended="ended",M.Fps="ratechange",M.Loaded="loadeddata",M.Mash="mashchange",M.Pause="pause",M.Play="play",M.Playing="playing",M.Seeked="seeked",M.Seeking="seeking",M.Selection="selection",M.Time="timeupdate",M.Track="track",M.Volume="volumechange",M.Waiting="waiting",e.ModuleType=void 0,(E=e.ModuleType||(e.ModuleType={})).Effect="effect",E.Font="font",E.Merger="merger",E.Scaler="scaler",E.Theme="theme",E.Transition="transition";const N=Object.values(e.ModuleType);var V,j,P;e.LoadType=void 0,(V=e.LoadType||(e.LoadType={})).Audio="audio",V.Font="font",V.Image="image",V.Module="module",V.Video="video",e.MoveType=void 0,(j=e.MoveType||(e.MoveType={})).Audio="audio",j.Effect="effect",j.Video="video",e.DataType=void 0,(P=e.DataType||(e.DataType={})).Boolean="boolean",P.Direction4="direction4",P.Direction8="direction8",P.Font="font",P.Fontsize="fontsize",P.Integer="integer",P.Mode="mode",P.Number="number",P.Pixel="pixel",P.Rgb="rgb",P.Rgba="rgba",P.String="string",P.Text="text";const R=Object.values(e.DataType);var q;e.TransformType=void 0,(q=e.TransformType||(e.TransformType={})).Merger="merger",q.Scaler="scaler";const U=Object.values(e.TransformType);var B;e.MasherAction=void 0,(B=e.MasherAction||(e.MasherAction={})).Freeze="freeze",B.Redo="redo",B.Remove="remove",B.Save="save",B.Split="split",B.Undo="undo";const J=Object.values(e.MasherAction);var $;e.CommandType=void 0,($=e.CommandType||(e.CommandType={})).File="file",$.Stream="stream";const L=Object.values(e.CommandType);var Z;e.OutputFormat=void 0,(Z=e.OutputFormat||(e.OutputFormat={})).Flv="flv",Z.Hls="hls",Z.Mdash="mdash",Z.Rtmp="rtmp",Z.Rtmps="rtmps";const W=Object.values(e.OutputFormat);class K{constructor(e){const{id:t,identifier:i,label:r}=e;this.id=t,this.identifier=i,this.label=r}}const G=e=>Math.min(255,Math.max(0,Math.floor(Number(e)))),H=e=>({r:G(e.r),g:G(e.g),b:G(e.b)}),X=e=>({y:G(e.y),u:G(e.u),v:G(e.v)}),Y=e=>{const t=X(e);return H({r:t.y+1.4075*(t.v-128),g:t.y-.3455*(t.u-128)-.7169*(t.v-128),b:t.y+1.779*(t.u-128)})},Q=e=>{let t=e.r.toString(16),i=e.g.toString(16),r=e.b.toString(16);return t.length<2&&(t=`0${t}`),i.length<2&&(i=`0${i}`),r.length<2&&(r=`0${r}`),`#${t}${i}${r}`},ee=(e,t,i,r)=>{let s=0;const n=X(t);return e.forEach((e=>{const t=X(e),i=t.u-n.u,r=t.v-n.v;s+=Math.sqrt((i*i+r*r)/65025)})),s/=e.length,r>1e-4?255*Math.min(1,Math.max(0,(s-i)/r)):s>i?255:0},te=e=>{const t=H(e);return{y:.299*t.r+.587*t.g+.114*t.b,u:-.168736*t.r+-.331264*t.g+.5*t.b+128,v:.5*t.r+-.418688*t.g+-.081312*t.b+128}},ie=e=>e.toLowerCase().replaceAll(/[\s]/g,""),re=e=>{const t=ie(e),i=(new Option).style;i.color=e;const r=ie(i.color);return!!r&&(!!r.startsWith("rgb")||r===t)},se="#00000000",ne={valid:re,yuvBlend:ee,rgb2yuv:te,yuv2rgb:Y,rgb2hex:Q,transparent:se,strip:ie},oe=new Map,ae=new Map,ce=e=>{const t=ae.get(e);if(t)return t;const i=[];return ae.set(e,i),i},le=()=>{oe.clear(),ae.clear()},he=ce(e.DefinitionType.Font),de=e=>{if(!me(e))throw console.trace("definitionsFromId !definitionsInstalled",e),s.unknown.definition+e;const t=oe.get(e);if(!t)throw s.internal+e;return t},ue=e=>{const{type:t,id:i}=e;oe.set(i,e),ce(t).push(e)},me=e=>oe.has(e),fe=ce(e.DefinitionType.Merger),pe=ce(e.DefinitionType.Scaler),ge=e=>{if(!me(e))return;const t=de(e);oe.delete(e);const{type:i}=t,r=ce(i),n=r.indexOf(t);if(n<0)throw s.internal;r.splice(n,1)},ve={byType:ce,clear:le,font:he,fromId:de,install:ue,installed:me,map:oe,merger:fe,scaler:pe,uninstall:ge};class ye{constructor(e){this.modular=!1,this.values=[];const{value:t,values:i,modular:r,id:n}=e;if(!n)throw s.id+JSON.stringify(e);if(void 0===t)throw s.invalid.value+JSON.stringify(e);this.value=t,this.id=n,r&&(this.modular=r),i&&this.values.push(...i.map((e=>new K(e))))}coerce(t){const i=String(t),r=Number(t);if(!this.modular||ve.fromId(i)){switch(this.id){case e.DataType.Boolean:return!!t;case e.DataType.Number:case e.DataType.Fontsize:case e.DataType.Pixel:if(u(r))return;return r;case e.DataType.Integer:if(u(r))return;return Math.round(r);case e.DataType.Rgb:case e.DataType.Rgba:if(!re(i))return;break;case e.DataType.Direction4:case e.DataType.Direction8:case e.DataType.Mode:if(!this.values?.find((e=>{e.id})))return}return i}}}var be={boolean:{value:!1},direction4:{values:[{id:0,identifier:"top",label:"Top"},{id:1,identifier:"right",label:"Right"},{id:2,identifier:"bottom",label:"Bottom"},{id:3,identifier:"left",label:"Left"}],value:0},direction8:{values:[{id:0,identifier:"top",label:"Top"},{id:1,identifier:"right",label:"Right"},{id:2,identifier:"bottom",label:"Bottom"},{id:3,identifier:"left",label:"Left"},{id:4,identifier:"top_right",label:"Top Right"},{id:5,identifier:"bottom_right",label:"Bottom Right"},{id:6,identifier:"bottom_left",label:"Bottom Left"},{id:7,identifier:"top_left",label:"Top Left"}],value:0},font:{value:"com.moviemasher.font.default",modular:!0},fontsize:{value:13},integer:{value:0},mode:{value:"normal",values:[{id:"burn",identifier:"color-burn",label:"Color Burn"},{id:"dodge",identifier:"color-dodge",label:"Color Dodge"},{id:"darken",identifier:"darken",label:"Darken"},{id:"difference",identifier:"difference",label:"Difference"},{id:"exclusion",identifier:"exclusion",label:"Exclusion"},{id:"hardlight",identifier:"hard-light",label:"Hard Light"},{id:"lighten",identifier:"lighter",label:"Lighten"},{id:"multiply",identifier:"multiply",label:"Multiply"},{id:"normal",identifier:"normal",label:"Normal"},{id:"overlay",identifier:"overlay",label:"Overlay"},{id:"screen",identifier:"screen",label:"Screen"},{id:"softlight",identifier:"soft-light",label:"Soft Light"},{id:"xor",identifier:"xor",label:"Xor"}]},number:{value:0},pixel:{value:0},rgb:{value:"rgb(0, 0, 0)"},rgba:{value:"rgba(0, 0, 0, 1)"},string:{value:""},text:{value:""}};const Te=new class{constructor(e){this.propertyTypes=new Map,Object.entries(e).forEach((e=>{const[t,i]=e,r=t;if(!R.includes(r))throw s.type+"DataTypes "+t;this.propertyTypes.set(r,new ye({...i,id:r}))}))}propertyType(e){const t=this.propertyTypes.get(e);if(!t)throw s.type+"propertyType "+e;return t}propertyTypeDefault(e){if(!b(e)||!R.includes(e))throw s.type+"propertyTypeDefault "+e;const t=this.propertyType(e);return n(t)?t.value:""}}(be);class we{constructor(e){const{type:t,name:i,value:r,custom:n}=e;if(!t)throw s.invalid.type;if(!i)throw s.invalid.name;if(void 0===r)throw s.invalid.value+JSON.stringify(e);this.type=Te.propertyType(t),this.name=i,this.value=r,this.custom=!!n}toJSON(){return{value:this.value,type:this.type.id}}}class xe{constructor(...e){this._properties=[]}property(e){return this.properties.find((t=>t.name===e))}get properties(){return this._properties}set properties(e){this._properties=e}setValue(e,t){const i=this.property(e);if(!i)throw s.property+e;const{type:r}=i,n=r.coerce(t);return void 0===n?(console.error(this.constructor.name,"setValue",e,t),!1):(this[e]=n,!0)}value(e){const t=this[e];if(void 0===t)throw s.property+e;return t}}class Se extends xe{constructor(...e){super(...e);const[t]=e;if(!x.populatedObject(t))throw s.invalid.object+"InstanceBase";const{definitionId:i="",definition:r,id:n,label:o}=t,a=r||ve.fromId(i);if(!a)throw s.invalid.definition.object;this.definition=a,n&&(this._id=n),o&&o!==this.definition.label&&(this._label=o)}get copy(){return this.definition.instanceFromObject(this.toJSON())}get definitionId(){return this.definition.id}get definitions(){return[this.definition]}definitionTime(e,t){return t.scaleToFps(e)}get id(){return this._id||=S()}get label(){return this._label||this.definition.label||this.id}set label(e){this._label=e}get properties(){return this.definition.properties}property(e){return this.definition.property(e)}get propertyNames(){return this.properties.map((e=>e.name))}get propertyValues(){return Object.fromEntries(this.properties.map((e=>[e.name,this.value(e.name)])))}toJSON(){return{definitionId:this.definitionId,id:this.id,type:this.type,...this.propertyValues}}get type(){return this.definition.type}}class Fe{constructor(...e){this.properties=[],this.retain=!1;const[t]=e,{id:i,label:r,icon:n}=t;if(!i||!x.populatedString(i))throw s.invalid.definition.id+JSON.stringify(t);this.id=i,this.label=r||i,n&&(this.icon=n)}get instance(){return this.instanceFromObject(this.instanceObject)}instanceFromObject(e){return new Se({...this.instanceObject,...e})}get instanceObject(){const e={};return e.definition=this,this.properties.forEach((t=>{e[t.name]=t.value})),e}loadDefinition(e,t,i){}definitionUrls(e,t){return[]}get propertiesModular(){return this.properties.filter((e=>e.type.modular))}property(e){return this.properties.find((t=>t.name===e))}toJSON(){const e={id:this.id,type:this.type};return this.icon&&(e.icon=this.icon),this.label!==this.id&&(e.label=this.label),e}unload(e=[]){}value(e){const t=this.property(e);if(t)return t.value}}const _e={};class ke{constructor(){this.sourcesByClipId=new Map}addSource(e,t){this.sourcesByClipId.set(e,t)}get context(){if(!this._context){const e=AudioContext||window.webkitAudioContext;if(!e)throw s.audibleContext;this._context=new e}return this._context}createBuffer(e){const t=44100*e;return this.context.createBuffer(2,t,44100)}createBufferSource(e){const t=this.context.createBufferSource();return e&&(t.buffer=e),t}createGain(){return this.context.createGain()}get currentTime(){return this.context.currentTime}decode(e){return new Promise(((t,i)=>this.context.decodeAudioData(e,(e=>t(e)),(e=>i(e)))))}deleteSource(e){const t=this.getSource(e);if(!t)return;this.sourcesByClipId.delete(e);const{gainSource:i,gainNode:r}=t;r.disconnect(this.destination),i.disconnect(r),i.stop()}get destination(){return this.context.destination}getSource(e){return this.sourcesByClipId.get(e)}hasSource(e){return this.sourcesByClipId.has(e)}startAt(e,t,i,r,s,n=!1){const o=this.createGain();t.loop=n,t.connect(o),o.connect(this.destination),t.start(this.currentTime+i,s,r),this.addSource(e,{gainSource:t,gainNode:o})}}const Ae={x:0,y:0};class Ie{constructor(e={}){const{context2d:t}=e;t&&(this._context2d=t)}get alpha(){return this.context2d.globalAlpha}set alpha(e){this.context2d.globalAlpha=e}get canvas(){return this.context2d.canvas}set canvas(e){const t=e.getContext("2d");if(!t)throw s.invalid.canvas;this.context2d=t}clear(){return this.clearSize(this.size)}clearSize(e){return this.clearRect({...Ae,...e})}clearRect(e){const{x:t,y:i,width:r,height:s}=e;return this.context2d.clearRect(t,i,r,s),this}get composite(){return this.context2d.globalCompositeOperation}set composite(e){this.context2d.globalCompositeOperation=e}get context2d(){if(!this._context2d){const e=globalThis.document.createElement("canvas").getContext("2d");if(!e)throw s.internal;this._context2d=e}return this._context2d}set context2d(e){this._context2d=e}get dataUrl(){return this.canvas.toDataURL()}draw(e){return this.drawAtPoint(e,Ae)}drawAtPoint(e,t){const{x:i,y:r}=t;return this.context2d.drawImage(e,i,r),this}drawFill(e){return this.drawFillToSize(e,this.size)}drawFillInRect(e,t){const{x:i,y:r,width:s,height:n}=t,o=this.fill;return this.fill=e,this.context2d.fillRect(i,r,s,n),this.fill=o,this}drawFillToSize(e,t){return this.drawFillInRect(e,{...Ae,...t})}drawImageData(e){return this.drawImageDataAtPoint(e,Ae)}drawImageDataAtPoint(e,t){const{x:i,y:r}=t;return this.context2d.putImageData(e,i,r),this}drawInRect(e,t){const{x:i,y:r,width:s,height:n}=t;return this.context2d.drawImage(e,i,r,s,n),this}drawInRectFromRect(e,t,i){const{x:r,y:n,width:o,height:a}=t,{x:c,y:l,width:h,height:d}=i,{width:u,height:m}=e;if(r+o>u||n+a>m)throw s.eval.sourceRect+JSON.stringify(t)+" "+u+"x"+m;return this.context2d.drawImage(e,r,n,o,a,c,l,h,d),this}drawInRectFromSize(e,t,i){return this.drawInRectFromRect(e,t,{...Ae,...i})}drawInSizeFromSize(e,t,i){const r={...Ae,...t},s={...Ae,...i};return this.drawInRectFromRect(e,r,s)}drawText(e,t){return this.drawTextAtPoint(e,t,Ae)}drawTextAtPoint(e,t,i){const{x:r,y:s}=i,{height:n,family:o,color:a,shadow:c,shadowPoint:l}=t,h=this.fill,d=this.font,u=this.shadow,m=this.shadowPoint;return c&&(this.shadow=c,l&&(this.shadowPoint=l)),this.font=`${n}px "${o}"`,this.fill=a,this.context2d.fillText(e,r,s+n),this.font=d,this.fill=h,c&&(this.shadow=u,l&&(this.shadowPoint=m)),this}drawToSize(e,t){return this.drawInRect(e,{...Ae,...t})}drawWithAlpha(e,t){const i=this.alpha;this.alpha=t;const r=this.draw(e);return this.alpha=i,r}drawWithComposite(e,t){const i=this.composite;this.composite=t;const r=this.draw(e);return this.composite=i,r}get fill(){return String(this.context2d.fillStyle)}set fill(e){this.context2d.fillStyle=e}get font(){return this.context2d.font}set font(e){this.context2d.font=e}get imageData(){return this.imageDataFromSize(this.size)}get imageDataFresh(){const{width:e,height:t}=this.size;return this.context2d.createImageData(e,t)}imageDataFromRect(e){const{x:t,y:i,width:r,height:s}=e;return this.context2d.getImageData(t,i,r,s)}imageDataFromSize(e){return this.imageDataFromRect({...Ae,...e})}get drawingSource(){return this.canvas}get shadow(){return this.context2d.shadowColor}set shadow(e){this.context2d.shadowColor=e}get shadowPoint(){return{x:this.context2d.shadowOffsetX,y:this.context2d.shadowOffsetY}}set shadowPoint(e){this.context2d.shadowOffsetX=e.x,this.context2d.shadowOffsetY=e.y}get size(){return{width:this.canvas.width,height:this.canvas.height}}set size(e){const{width:t,height:i}=e;x.aboveZero(t)&&(this.canvas.width=t),x.aboveZero(i)&&(this.canvas.height=i)}}const Ce=["audible","visible"],De=Object.fromEntries(Ce.map((e=>[e,e])));const ze=new class{audible(){return new ke}fromCanvas(e){const t=this.visible();return t.canvas=e,t}fromContext2D(e){return new Ie({context2d:e})}toSize(e){const t=this.visible();return t.size=e,t}get type(){return De}get types(){return Ce}visible(){return new Ie}},Oe=(e,t)=>e.frame-t.frame,Me=(e,t)=>e.layer-t.layer,Ee=(e,t)=>e.track-t.track,Ne=(e,t)=>e.label<t.label?-1:e.label>t.label?1:0,Ve={byFrame:Oe,byLabel:Ne,byTrack:Ee,byLayer:Me};class je extends xe{constructor(...t){super(...t),this.clips=[],this.dense=!1,this.layer=0,this.trackType=e.TrackType.Video;const[i]=t,{id:r,clips:n,layer:o,trackType:a,dense:c}=i;r&&(this._id=r),o&&(this.layer=o),a&&(this.trackType=a),n&&this.clips.push(...n.map((e=>{const{definitionId:t}=e;if(!t)throw s.id+JSON.stringify(e);const i=ve.fromId(t),r={track:this.layer,...e};return i.instanceFromObject(r)}))),this.dense=void 0===c?!this.layer&&this.trackType===e.TrackType.Video:!!c,this.properties.push(new we({name:"dense",type:e.DataType.Boolean,value:!1}))}addClips(e,t=0){let i=t||0;this.dense||(i=0);const r=i,s=[],n=this.clips.filter(((t,n)=>{const o=e.includes(t);return o&&s.push(t),r&&o&&n<r&&(i-=1),!o}));n.splice(i,0,...e),this.sortClips(n);e.filter((e=>!s.includes(e))).forEach((e=>{e.track=this.layer})),this.clips.splice(0,this.clips.length,...n)}frameForClipsNearFrame(e,t=0){if(this.dense)return t;const i=this.clips.filter((i=>!e.includes(i)&&i.endFrame>t));if(!i.length)return t;const r=Math.min(...e.map((e=>e.frame))),s=Math.max(...e.map((e=>e.endFrame)))-r;let n=t;return i.find((e=>{if(e.frame>=n+s)return!0;n=e.endFrame})),n}get frames(){if(!this.clips.length)return 0;const e=this.clips[this.clips.length-1];return e.frame+e.frames}get id(){return this._id||=S()}removeClips(e){const t=this.clips.filter((t=>!e.includes(t)));if(t.length===this.clips.length)throw s.internal+"removeClips";e.forEach((e=>{e.track=-1})),this.sortClips(t),this.clips.splice(0,this.clips.length,...t)}sortClips(t){if(this.dense){let i=0;t.forEach(((t,r)=>{const s=t.type===e.DefinitionType.Transition;r&&s&&(i-=t.frames),t.frame=i,s||(i+=t.frames)}))}t.sort(Oe)}toJSON(){return{id:this.id,dense:this.dense,trackType:this.trackType,layer:this.layer,clips:this.clips}}}const Pe={instance:e=>new je(e)};class Re{static get[e.DefinitionType.Audio](){const t=_e[e.DefinitionType.Audio];if(!t)throw s.invalid.factory+e.DefinitionType.Audio;return t}static get context(){return ze}static get[e.DefinitionType.Effect](){const t=_e[e.DefinitionType.Effect];if(!t)throw s.invalid.factory+e.DefinitionType.Effect;return t}static get[e.DefinitionType.Filter](){const t=_e[e.DefinitionType.Filter];if(!t)throw s.invalid.factory+e.DefinitionType.Filter;return t}static get[e.DefinitionType.Font](){const t=_e[e.DefinitionType.Font];if(!t)throw s.invalid.factory+e.DefinitionType.Font;return t}static get[e.DefinitionType.Image](){const t=_e[e.DefinitionType.Image];if(!t)throw s.invalid.factory+e.DefinitionType.Image;return t}static get[e.DefinitionType.Merger](){const t=_e[e.DefinitionType.Merger];if(!t)throw s.invalid.factory+e.DefinitionType.Merger;return t}static get[e.DefinitionType.Scaler](){const t=_e[e.DefinitionType.Scaler];if(!t)throw s.invalid.factory+e.DefinitionType.Scaler;return t}static get[e.DefinitionType.Theme](){const t=_e[e.DefinitionType.Theme];if(!t)throw s.invalid.factory+e.DefinitionType.Theme;return t}static get[e.DefinitionType.Transition](){const t=_e[e.DefinitionType.Transition];if(!t)throw s.invalid.factory+e.DefinitionType.Transition;return t}static get track(){return Pe}static get[e.DefinitionType.Video](){const t=_e[e.DefinitionType.Video];if(!t)throw s.invalid.factory+e.DefinitionType.Video;return t}static get[e.DefinitionType.VideoSequence](){const t=_e[e.DefinitionType.VideoSequence];if(!t)throw s.invalid.factory+e.DefinitionType.VideoSequence;return t}static get[e.DefinitionType.VideoStream](){const t=_e[e.DefinitionType.VideoStream];if(!t)throw s.invalid.factory+e.DefinitionType.VideoStream;return t}constructor(){}}class qe{constructor(e){this.done=!1;const{actions:t,mash:i,redoSelection:r,type:s,undoSelection:n}=e;this.actions=t,this.mash=i,this.redoSelection=r,this.type=s,this.undoSelection=n}redo(){this.redoAction(),this.done=!0}redoAction(){throw s.unimplemented}get selection(){return this.done?this.redoSelection:this.undoSelection}undo(){this.undoAction(),this.done=!1}undoAction(){throw s.unimplemented}}const Ue=e=>b(e)?`${e[0].toUpperCase()}${e.substr(1)}`:e;class Be extends qe{constructor(e){super(e);const{trackType:t}=e;this.trackType=t}redoAction(){this.mash.addTrack(this.trackType)}undoAction(){this.mash.removeTrack(this.trackType)}}class Je extends Be{constructor(e){super(e);const{clip:t,createTracks:i,insertIndex:r,trackIndex:s}=e;this.clip=t,this.createTracks=i,this.insertIndex=r,this.trackIndex=s}get clips(){return this.track.clips}get track(){return this.mash.trackOfTypeAtIndex(this.trackType,this.trackIndex)}redoAction(){for(let e=0;e<this.createTracks;e+=1)super.redoAction();this.mash.addClipsToTrack([this.clip],this.trackIndex,this.insertIndex)}undoAction(){this.mash.removeClipsFromTrack([this.clip]);for(let e=0;e<this.createTracks;e+=1)super.undoAction()}}class $e extends qe{constructor(e){super(e);const{clips:t,insertIndex:i,redoFrames:r,trackIndex:s,undoFrames:n,undoInsertIndex:o,undoTrackIndex:a}=e;this.clips=t,this.insertIndex=i,this.redoFrames=r,this.trackIndex=s,this.undoFrames=n,this.undoInsertIndex=o,this.undoTrackIndex=a}addClips(e,t,i){this.mash.addClipsToTrack(this.clips,e,t,i)}redoAction(){this.addClips(this.trackIndex,this.insertIndex,this.redoFrames)}undoAction(){this.addClips(this.undoTrackIndex,this.undoInsertIndex,this.undoFrames)}}class Le extends qe{constructor(e){super(e);const{effect:t,effects:i,index:r}=e;this.effect=t,this.effects=i,this.index=r}redoAction(){this.effects.splice(this.index,0,this.effect)}undoAction(){this.effects.splice(this.index,1)}}class Ze extends qe{constructor(e){super(e);const{property:t,redoValue:i,target:r,undoValue:s}=e;this.property=t,this.redoValue=i,this.target=r,this.undoValue=s}get redoValueNumeric(){return Number(this.redoValue)}get undoValueNumeric(){return Number(this.undoValue)}redoAction(){this.target.setValue(this.property,this.redoValue)}undoAction(){this.target.setValue(this.property,this.undoValue)}updateAction(e){this.redoValue=e,this.redo()}}class We extends Ze{constructor(e){super(e),this.clip=this.target}redoAction(){this.mash.changeClipFrames(this.clip,this.redoValueNumeric)}undoAction(){this.mash.changeClipFrames(this.clip,this.undoValueNumeric)}}class Ke extends Ze{constructor(e){super(e);const{frames:t,target:i}=e;this.frames=t,this.audibleClip=i}redoAction(){this.mash.changeClipTrimAndFrames(this.audibleClip,this.redoValueNumeric,this.frames)}undoAction(){this.mash.changeClipTrimAndFrames(this.audibleClip,this.undoValueNumeric,this.frames)}}class Ge extends qe{constructor(e){super(e);const{index:t,insertClip:i,redoFrames:r,splitClip:s,trackClips:n,undoFrames:o}=e;this.index=t,this.insertClip=i,this.redoFrames=r,this.splitClip=s,this.trackClips=n,this.undoFrames=o}redoAction(){this.trackClips.splice(this.index,0,this.insertClip),this.splitClip.frames=this.redoFrames}undoAction(){this.splitClip.frames=this.undoFrames,this.trackClips.splice(this.index,1)}}class He extends qe{constructor(e){super(e);const{frames:t,freezeClip:i,frozenClip:r,index:s,insertClip:n,trackClips:o}=e;this.frames=t,this.freezeClip=i,this.frozenClip=r,this.index=s,this.insertClip=n,this.trackClips=o}redoAction(){this.trackClips.splice(this.index,0,this.insertClip,this.frozenClip),this.freezeClip.frames-=this.frames}undoAction(){this.freezeClip.frames+=this.frames,this.trackClips.splice(this.index,2)}}class Xe extends qe{constructor(e){super(e);const{effects:t,redoEffects:i,undoEffects:r}=e;this.effects=t,this.redoEffects=i,this.undoEffects=r}redoAction(){this.effects.splice(0,this.effects.length,...this.redoEffects)}undoAction(){this.effects.splice(0,this.effects.length,...this.undoEffects)}}class Ye extends qe{constructor(e){super(e);const{clips:t,index:i,track:r}=e;this.clips=t,this.index=i,this.track=r}get trackIndex(){return this.track.layer}redoAction(){this.mash.removeClipsFromTrack(this.clips)}undoAction(){this.mash.addClipsToTrack(this.clips,this.trackIndex,this.index)}}const Qe={AddTrack:Be,AddClipsToTrack:Je,MoveClips:$e,AddEffect:Le,Change:Ze,ChangeFrames:We,ChangeTrim:Ke,Split:Ge,Freeze:He,MoveEffects:Xe,RemoveClips:Ye};const et=new class{createFromObject(e){const{type:t}=e;if("string"!=typeof t)throw s.type+JSON.stringify(e);return new(Qe[Ue(t)])(e)}},tt=["scrollPaddingleft","scrollPaddingRight","scrollPaddingTop","scrollPaddingBottom"],it=e=>{if(!e)return;const t=getComputedStyle(e),i=tt.map((e=>{const i=t.getPropertyValue(e)||"0px",r=Number(i.slice(0,-2));return[e,isNaN(r)?0:r]})),{scrollLeft:r,scrollTop:s}=e,{x:n,y:o,width:a,height:c}=e.getBoundingClientRect();return i.push(["scrollLeft",r]),i.push(["scrollTop",s]),i.push(["x",n]),i.push(["y",o]),i.push(["width",a]),i.push(["height",c]),Object.fromEntries(i)},rt={scrollMetrics:it};class st extends EventTarget{emit(e){this.dispatchEvent(new CustomEvent(e))}}const nt=["mm_width","mm_height"],ot=["mm_dimensions","mm_duration","mm_fps","mm_height","mm_t","mm_width","t"],at=["ceil","floor","mm_cmp","mm_horz","mm_max","mm_min","mm_vert",...ot,...nt],ct="evaluator",lt=e=>{const{condition:t}=e;if(x.defined(e.is))return`${t}==${e.is}`;const i=e.in;if(x.undefined(i))return String(t);const r=(e=>"string"==typeof e?String(e).split(","):e)(i),s=x.string(r[0]),n=r.map((e=>s?`"${e}"`:e)),o=s?"String":"Number";return`([${n.join(",")}].includes(${o}(${t})))`};class ht{constructor(e,t,i,r){this.ceil=Math.ceil,this.floor=Math.floor,this.map=new Map,this.mm_max=Math.max,this.mm_min=Math.min,this.timeRange=e,this.context=i,this.mergeContext=r,this.size=t,this.setInputSize(this.size)}conditionalValue(e){const t=e.find((e=>{const t=(e=>e.replaceAll(" or "," || ").replaceAll(" and "," && "))(lt(e));return this.evaluateExpression(t)}));if(void 0===t)throw s.eval.conditionTruth;const{value:i}=t;if(void 0===i)throw s.eval.conditionValue;return i}get duration(){return this.timeRange.lengthSeconds}evaluate(e){if("number"==typeof e)return e;const t="string"==typeof e?String(e):this.conditionalValue(e);if("number"==typeof t)return t;return this.evaluateExpression(t)}evaluateExpression(e){const t=`return ${this.replaceKeys(e)}`;try{const e=new Function(ct,t);return e(this)}catch(t){return e}}get(e){if(this.map.has(e))return this.map.get(e);if(!at.includes(e))throw s.eval.get+e;const t=this[e];if(ot.includes(e))return t;if("function"==typeof t)return t.bind(this);throw s.eval.get+e}has(e){return at.includes(e)||this.map.has(e)}initialize(e,t){return!this.has(e)&&(this.set(e,t),!0)}get inputSize(){return{width:Number(this.get("mm_input_width")),height:Number(this.get("mm_input_height"))}}get keys(){return[...new Set([...this.map.keys(),...at])]}mm_cmp(e,t,i,r){return e>t?i:r}get mm_dimensions(){return`${this.mm_width}x${this.mm_height}`}get mm_duration(){return this.duration}get mm_fps(){return this.timeRange.fps}get mm_height(){return this.size.height}mm_horz(e,t){return this.sized(0,e,t)}get mm_t(){return this.position}mm_vert(e,t){return this.sized(1,e,t)}get mm_width(){return this.size.width}get position(){return this.timeRange.position}replaceKeys(e){let t=e;const i=Object.fromEntries(this.keys.map((e=>[e,new RegExp(`\\b${e}\\b`,"g")])));return Object.entries(i).forEach((([e,i])=>{t=t.replaceAll(i,`evaluator.get("${e}")`)})),t}set(e,t){this.map.set(e,t)}setInputSize({width:e,height:t}){this.set("in_h",t),this.set("mm_input_height",t),this.set("in_w",e),this.set("mm_input_width",e)}sized(e,t,i){const r=x.float(t)?Number(t):parseFloat(String(t));if(x.nan(r))throw s.eval.number+"scale";const n=nt[e],o=this.get(n),a=parseFloat(String(o));if(x.nan(a))throw s.eval.number+`value ${n}=>${o}`;const c=a*r;if(!i)return c;const l=nt[Math.abs(e-1)],h=this.get(l);if(void 0===h)throw s.internal+"otherValue";const d=parseFloat(String(h));if(x.nan(d))throw s.eval.number+"other";return d<=a?c:a+(r-1)*d}get t(){return this.mm_t}}const dt=(e="")=>{switch(e){case"ceil":return Math.ceil;case"floor":return Math.floor;default:return Math.round}},ut=(e,t="")=>dt(t)(e),mt={method:dt,withMethod:ut},ft=(e,t)=>({r:t[e],g:t[e+1],b:t[e+2],a:t[e+3]}),pt=(e,t,i)=>{const{x:r,y:s}=t,{width:n,height:o}=i,a=((e,t)=>({x:e%t,y:Math.floor(e/t)}))(e,n);return a.x=Math.max(0,Math.min(n-1,a.x+r)),a.y=Math.max(0,Math.min(o-1,a.y+s)),((e,t)=>e.y*t+e.x)(a,n)},gt=(e,t,i)=>((e,t)=>{const i=[],r=Math.floor(1.5);for(let s=0;s<3;s+=1)for(let n=0;n<3;n+=1){const o={x:n-r,y:s-r};i.push(pt(e,o,t))}return i})(e,i).map((e=>((e,t)=>ft((e=>4*e)(e),t))(e,t))),vt=e=>{const t=String(e);return"0x"===t.slice(0,2)?`#${t.slice(2)}`:t},yt=(e,t,i)=>{if(!e||!t)return 0;const r=t/e,s=Math.min(1,r),n=Math.max(1,r);return 1===i?n:i?s+(n-s)*i:s},bt=(e,t,i="ceil")=>{if(!e||!t)return 0;return ut(e*t,i)},Tt=(e,t,i="round")=>e&&t?ut(e/t,i):0,wt={color:vt,fromFrame:bt,neighboringRgbas:gt,perFrame:yt,rgbaAtIndex:ft,toFrame:Tt},xt=(e,t,i="")=>{if(e.fps===t.fps)return[e,t];const r=(s=e.fps,n=t.fps,s*n/((e,t)=>{let i=e,r=t,s=0;for(;0!==r;)s=r,r=i%r,i=s;return i})(s,n));var s,n;return[e.scale(r,i),t.scale(r,i)]};class St{constructor(e=0,t=1){if(!x.integer(e)||e<0)throw s.frame;if(!x.integer(t)||t<1)throw s.fps;this.frame=e,this.fps=t}add(e){const[t,i]=xt(this,e);return new St(t.frame+i.frame,t.fps)}addFrame(e){const t=this.copy;return t.frame+=e,t}get copy(){return new St(this.frame,this.fps)}get description(){return`${this.frame}@${this.fps}`}divide(e,t=""){if(!x.number(e))throw s.argument+"divide";return new St(ut(Number(this.frame)/e,t),this.fps)}equalsTime(e){const[t,i]=xt(this,e);return t.frame===i.frame}min(e){const[t,i]=xt(this,e);return new St(Math.min(t.frame,i.frame),t.fps)}scale(e,t=""){if(this.fps===e)return this;const i=Number(this.frame)/Number(this.fps)*Number(e);return new St(ut(i,t),e)}scaleToFps(e){return this.scaleToTime(new St(0,e))}scaleToTime(e){return xt(this,e)[0]}get seconds(){return Number(this.frame)/Number(this.fps)}subtract(e){const[t,i]=xt(this,e);let r=i.frame;return r>t.frame&&(r-=r-t.frame),new St(t.frame-r,t.fps)}subtractFrames(e){const t=this.copy;return t.frame-=e,t}toString(){return`[${this.description}]`}withFrame(e){const t=this.copy;return t.frame=e,t}static fromArgs(e=0,t=1){return new St(e,t)}static fromSeconds(e=0,t=1,i=""){if(!x.number(e)||e<0)throw s.seconds;if(!x.integer(t)||t<1)throw s.fps;const r=ut(e*t,i);return this.fromArgs(r,t)}}class Ft extends St{constructor(e=0,t=1,i=1){if(!(x.integer(i)&&i>=0))throw console.trace("TimeRange with frames",i,i.constructor.name),s.argument+"frames";super(e,t),this.frames=i}addFrames(e){const t=this.copy;return t.frames+=e,t}get description(){return`${this.frame}-${this.frames}@${this.fps}`}get end(){return this.frame+this.frames}get endTime(){return St.fromArgs(this.end,this.fps)}equalsTimeRange(e){const[t,i]=xt(this,e);return t.frame===i.frame&&t.frames===i.frames}get lengthSeconds(){return Number(this.frames)/Number(this.fps)}get position(){return Number(this.frame)/Number(this.frames)}get startTime(){return St.fromArgs(this.frame,this.fps)}get copy(){return new Ft(this.frame,this.fps,this.frames)}scale(e=1,t=""){if(this.fps===e)return this.copy;const i=Number(this.frames)/(Number(this.fps)/Number(e)),r=super.scale(e,t),s=Math.max(1,ut(i,t));return new Ft(r.frame,r.fps,s)}intersects(e){const[t,i]=xt(this,e);return!(t.frame>=i.end)&&t.end>i.frame}intersectsTime(e){const[t,i]=xt(this,e),r=t;return i.frame>=r.frame&&i.frame<r.end}minEndTime(e){const[t,i]=xt(this,e);return t.frames=Math.min(t.frames,i.frame),t}get times(){const{frames:e,frame:t,fps:i}=this;return Array.from({length:e+1},((e,r)=>St.fromArgs(t+r,i)))}withFrame(e){const t=this.copy;return t.frame=e,t}withFrames(e){const t=this.copy;return t.frames=e,t}static fromArgs(e=0,t=1,i=1){return new Ft(e,t,i)}static fromSeconds(e=0,t=1){return this.fromArgs(e,1,t)}static fromTime(e,t=1){return this.fromArgs(e.frame,e.fps,t)}static fromTimes(e,t){const[i,r]=xt(e,t);if(r.frame<=i.frame)throw s.argument;const n=r.frame-i.frame;return this.fromArgs(i.frame,i.fps,n)}}const _t=()=>{const e=new URL(document.baseURI),{protocol:t,host:i,pathname:r,port:s}=e;return{protocol:t,host:i,prefix:r,port:s}},kt=e=>new URL(e,document.baseURI).href,At=(e,t)=>{const i=[];if(e){const{host:t,port:r,protocol:s,prefix:n}=e;t&&(i.push(s||"http"),i.push("://"),i.push(t),r&&(i.push(":"),i.push(String(r)))),n&&i.push(n)}return t&&i.push(t),kt(i.join(""))},It={absolute:kt,forRemoteServer:At,remoteServer:_t};class Ct{constructor(e){this.index=-1,this.instances=[];const{mash:t}=e;this.mash=t}get canRedo(){return this.index<this.instances.length-1}get canSave(){return this.canUndo}get canUndo(){return this.index>-1}get currentAction(){return this.instances[this.index]}get currentActionLast(){return this.canUndo&&!this.canRedo}destroy(){this.index=-1,this.instances.splice(0,this.instances.length)}add(e){const t=this.instances.length-(this.index+1);x.positive(t)&&this.instances.splice(this.index+1,t),this.instances.push(e)}redo(){this.index+=1;const e=this.currentAction;return e.redo(),e}save(){this.instances.splice(0,this.index+1),this.index=-1}undo(){const e=this.currentAction;return this.index-=1,e.undo(),e}}const Dt=new class{constructor(){this.audibleContext=ze.audible(),this.cachedByKey=new Map,this.urlsByKey=new Map,this.visibleContext=ze.visible()}add(e,t){const i=this.key(e);this.cachedByKey.set(i,t),this.urlsByKey.set(i,e)}cached(e){const t=this.getObject(e);return t&&!(t instanceof Promise)}caching(e){const t=this.getObject(e);return t&&t instanceof Promise}flush(e){const t=[...this.urlsByKey.keys()],i=e.map((e=>this.key(e)));t.filter((e=>!i.includes(e))).forEach((e=>{const t=this.urlsByKey.get(e);t&&this.remove(t)}))}get(e){return this.cachedByKey.get(this.key(e))}getObject(e){if(!x.populatedString(e))throw s.argument+"url";const t=this.key(e);if(this.cachedByKey.has(t))return this.cachedByKey.get(t)}key(e){if(!x.populatedString(e))throw s.argument+"url";return"cachekey"+e.replaceAll(/[^a-z0-9]/gi,"")}remove(e){const t=this.key(e);this.cachedByKey.delete(t),this.urlsByKey.delete(t)}};class zt{arrayBufferPromiseFromUrl(e){return fetch(e).then((e=>e.arrayBuffer()))}arrayBufferPromiseFromBlob(e){return new Promise(((t,i)=>{const r=new FileReader;r.onload=()=>{t(r.result)},r.onerror=i,r.readAsArrayBuffer(e)}))}audioBufferPromiseFromArrayBuffer(e){return Dt.audibleContext.decode(e)}async loadUrl(e){if(Dt.cached(e)){const t=Dt.get(e);return t instanceof Promise?t:Promise.resolve()}const t=this.requestUrl(e);Dt.add(e,t);const i=await t;return Dt.add(e,i),i}requestUrl(e){return Promise.resolve()}}class Ot extends zt{constructor(){super(...arguments),this.type=e.LoadType.Audio}async requestUrl(e){return new Promise(((t,i)=>{this.arrayBufferPromiseFromUrl(e).then((e=>this.audioBufferPromiseFromArrayBuffer(e))).then(t).catch(i)}))}}class Mt extends zt{constructor(){super(...arguments),this.type=e.LoadType.Font}requestUrl(e){return new Promise(((t,i)=>{const r=Dt.key(e);this.arrayBufferPromiseFromUrl(e).then((e=>new FontFace(r,e).load())).then((e=>{document.fonts.add(e),t(e)})).catch((e=>i(e)))}))}}class Et extends zt{constructor(){super(...arguments),this.type=e.LoadType.Image}requestUrl(e){const t=new Image;return t.crossOrigin="Anonymous",t.src=e,t.decode().then((()=>Promise.resolve(t)))}}class Nt extends zt{constructor(){super(...arguments),this.type=e.LoadType.Video}requestUrl(e){return new Promise(((t,i)=>this.videoPromiseFromUrl(e).then((i=>this.arrayBufferPromiseFromUrl(e).then((e=>this.audioBufferPromiseFromArrayBuffer(e).then((e=>{t({video:i,audio:e,sequence:[]})})))))).catch(i)))}videoPromiseFromUrl(e){return new Promise(((t,i)=>{const r=this.videoFromUrl(e);r.ondurationchange=()=>{r.ondurationchange=null,r.width=r.videoWidth,r.height=r.videoHeight,t(r)},r.onerror=i,r.load()}))}videoFromUrl(e){const t=document.createElement("video");return t.crossOrigin="anonymous",t.src=e,t}}const Vt={Audio:Ot,Font:Mt,Image:Et,Video:Nt};const jt=new class{audio(){return new Vt.Audio}font(){return new Vt.Font}image(){return new Vt.Image}install(e,t){Vt[Ue(e)]=t}video(){return new Vt.Video}},Pt={label:"Unlabeled",masher:{buffer:10,fps:0,loop:!0,volume:.75,precision:3,autoplay:!1},mash:{label:"Unlabeled Mash",quantize:10,backcolor:se,gain:.75,buffer:10,output:{width:320,height:240,fps:30,videoBitrate:2e3,audioBitrate:160,audioCodec:"aac",videoCodec:"libx264",audioChannels:2,audioFrequency:44100}},instance:{audio:{gain:1,trim:0,loop:1},video:{speed:1}},definition:{frame:{duration:2},image:{duration:2},theme:{duration:3},transition:{duration:1},video:{fps:0},videosequence:{pattern:"%.jpg",fps:10,increment:1,begin:1,padding:0},videostream:{duration:10}}};function Rt(e){return class extends e{constructor(...e){super(...e),this.audible=!0,this.gain=Pt.instance.audio.gain,this.gainPairs=[];const[t]=e,{gain:i}=t;if(void 0!==i)if("string"==typeof i)if(i.includes(",")){const e=i.split(",").map((e=>parseFloat(e))),t=e.length/2;for(let i=0;i<t;i+=1)this.gainPairs.push([e[2*i],e[2*i+1]]);this.gain=-1}else this.gain=Number(i);else this.gain=i}loadedAudible(){return this.definition.loadedAudible()}get muted(){return 0===this.gain||!x.positive(this.gain)&&this.gainPairs===[[0,0],[1,0]]}startOptions(e,t){const i=this.timeRange(t);let r=0,s=i.seconds-e,n=i.lengthSeconds;return s<0&&(r-=s,n+=s,s=0),{start:s,offset:r,duration:n}}toJSON(){const e=super.toJSON();return this.gain!==Pt.instance.audio.gain&&(e.gain=this.gain),e}}}function qt(t){return class extends t{constructor(...t){super(...t),this.audible=!1,this.frame=0,this.frames=-1,this.track=-1,this.trackType=e.TrackType.Video,this.visible=!1;const[i]=t,{frame:r,frames:s,track:n}=i;void 0!==r&&x.positive(r)&&(this.frame=r),s&&x.aboveZero(s)&&(this.frames=s),void 0!==n&&(this.track=n)}clipState(e,t,i){const r=this.inputCommandAtTimeToSize(t,e,i);if(!r)throw s.internal;return r}commandAtTimeToSize(e,t,i){return{sources:{source:this.definition.inputSource},filters:[]}}definitionTime(e,t){const i=super.definitionTime(e,t),r=this.time(e).scale(i.fps),s=this.endTime(e).scale(i.fps),n=Math.max(Math.min(i.frame,s.frame),r.frame);return i.withFrame(n-r.frame)}get endFrame(){return this.frame+this.frames}endTime(e){return St.fromArgs(this.endFrame,e)}inputCommandAtTimeToSize(e,t,i){}loadClip(e,t,i){const r=this.definitionTime(e,t),s=i?this.definitionTime(e,i):i;return this.definition.loadDefinition(e,r,s)}clipUrls(e,t,i){const r=this.definitionTime(e,t),s=i?this.definitionTime(e,i):i;return this.definition.definitionUrls(r,s)}maxFrames(e,t){return 0}time(e){return St.fromArgs(this.frame,e)}timeRange(e){return Ft.fromArgs(this.frame,e,this.frames)}timeRangeRelative(e,t){const i=this.timeRange(t).scale(e.fps),r=Math.max(0,e.frame-i.frame);return i.withFrame(r)}}}function Ut(e){return class extends e{constructor(...e){super(...e),this.loop=Pt.instance.audio.loop,this.trim=Pt.instance.audio.trim;const[t]=e,{loop:i,trim:r}=t;void 0!==r&&x.integer(r)&&(this.trim=r),void 0!==i&&x.integer(i)&&(this.loop=i)}definitionTime(e,t){const i=super.definitionTime(e,t);if(!x.aboveZero(this.trim))return i;const r=this.trimTime(e).scale(i.fps);return i.withFrame(i.frame+r.frame)}maxFrames(e,t){const i=t||this.trim;return Math.floor(this.definition.duration*e)-i}startOptions(e,t){const i=this.timeRange(t);let r=0,s=i.seconds-e,n=i.lengthSeconds;this.trim&&(r=St.fromArgs(this.trim,t).seconds),s<0&&(r-=s,n+=s,s=0);return{start:s,offset:r,duration:n}}trimTime(e){return St.fromArgs(this.trim,e)}toJSON(){const e=super.toJSON();return this.trim!==Pt.instance.audio.trim&&(e.trim=this.trim),this.loop!==Pt.instance.audio.loop&&(e.loop=this.loop),e}}}const Bt=Ut(Rt(qt(Se)));class Jt extends Bt{constructor(){super(...arguments),this.trackType=e.TrackType.Audio}}const $t=[{name:"frame",type:e.DataType.Integer,value:0},{name:"frames",type:e.DataType.Integer,value:-1},{name:"label",type:e.DataType.String,value:""}];function Lt(e){return class extends e{constructor(...e){super(...e),this.audible=!1,this.streamable=!1,this.visible=!1;const t=$t.map((e=>new we(e)));this.properties.push(...t)}get duration(){if(!this._duration){const e=Pt.definition;this._duration=Number(e[this.type].duration)}return this._duration}set duration(e){this._duration=e}frames(e){return St.fromSeconds(this.duration,e,"floor").frame}get inputSource(){return""}}}function Zt(t){return class extends t{constructor(...t){super(...t),this.audible=!0,this.loops=!1,this.stream=!1;const[i]=t,{stream:r,url:n,audio:o,source:a,waveform:c}=i,l=o||n||a||"";if(!l)throw s.invalid.definition.audio;this.urlAudible=l,r&&(this.stream=!0),this.source=a||l,c&&(this.waveform=c),this.properties.push(new we({name:"gain",type:e.DataType.Number,value:1}))}get absoluteUrl(){return kt(this.urlAudible)}get inputSource(){return kt(this.source)}loadDefinition(e,t,i){if(!i)return;const r=this.absoluteUrl;return Dt.cached(r)?void 0:Dt.caching(r)?Dt.get(r):jt.audio().loadUrl(r)}definitionUrls(){return[this.absoluteUrl]}loadedAudible(){const e=Dt.get(this.absoluteUrl);if(e&&!(e instanceof Promise))return Dt.audibleContext.createBufferSource(e)}toJSON(){const e=super.toJSON();return e.audio=this.urlAudible,this.source&&(e.source=this.source),this.waveform&&(e.waveform=this.waveform),e}unload(e=[]){super.unload(e),e.length&&e.some((e=>2===e.length))||Dt.cached(this.absoluteUrl)&&Dt.remove(this.absoluteUrl)}}}function Wt(t){return class extends t{constructor(...t){super(...t),this.loops=!1;const[i]=t,{loops:r,duration:n}=i;if(!n)throw s.invalid.definition.duration;this.duration=Number(n),r&&(this.properties.push(new we({name:"loop",type:e.DataType.Integer,value:1})),this.loops=!0),this.properties.push(new we({name:"trim",type:e.DataType.Integer,value:0}))}toJSON(){const e=super.toJSON();return e.duration=this.duration,this.loops&&(e.loops=!0),e}}}const Kt=Wt(Zt(Lt(Fe)));class Gt extends Kt{constructor(...t){super(...t),this.trackType=e.TrackType.Audio,this.type=e.DefinitionType.Audio,ve.install(this)}get instance(){return this.instanceFromObject(this.instanceObject)}instanceFromObject(e){const t={...this.instanceObject,...e};return new Jt(t)}}const Ht=e=>{const{id:t}=e;if(!t)throw s.id;return ve.installed(t)?ve.fromId(t):new Gt(e)},Xt=e=>Ht({id:e}),Yt=e=>Ht(e).instanceFromObject(e),Qt=e=>Yt({id:e}),ei=()=>{},ti=e=>{const{id:t}=e;if(!t||!x.populatedString(t))throw s.id;return ve.uninstall(t),Ht(e)},ii=e=>{const t=ti(e);return t.retain=!0,t},ri={define:ti,definition:Ht,definitionFromId:Xt,fromId:Qt,initialize:ei,install:ii,instance:Yt};_e[e.DefinitionType.Audio]=ri;class si{constructor({name:e,value:t}){if(!e)throw s.invalid.name;if(void 0===t)throw s.invalid.value;this.name=String(e),this.value=t}toJSON(){return{name:this.name,value:this.value}}}class ni extends Se{constructor(...e){super(...e),this.parameters=[];const[t]=e;if(!x.populatedObject(t))throw s.invalid.object+"filter";const{parameters:i}=t;i&&this.parameters.push(...i.map((e=>new si(e))))}drawFilter(e){this.definition.scopeSet(e);const t=this.evaluated(e);return this.definition.draw(e,t)}evaluated(e){const t={},i=[...this.parameters];return this.definition.parameters.forEach((e=>{i.find((t=>t.name===e.name))||i.push(e)})),x.populatedArray(i)?(i.forEach((i=>{const{name:r,value:s}=i;if(!x.populatedString(r))return;const n=e.evaluate(s);return t[r]=n,e.set(r,n),`${r}=>${n}`})),t):t}inputFilter(e){this.definition.scopeSet(e);const t=this.evaluated(e);return this.definition.input(e,t)}toJSON(){const e={id:this.id};return this.parameters.length&&(e.parameters=this.parameters),e}}class oi extends Fe{constructor(...t){super(...t),this.parameters=[],this.retain=!0,this.type=e.DefinitionType.Filter,ve.install(this)}draw(e,t){throw s.unimplemented+this.id}input(e,t){throw s.unimplemented+this.id}get instance(){return this.instanceFromObject(this.instanceObject)}instanceFromObject(e){return new ni({...this.instanceObject,...e})}scopeSet(e){}}class ai extends oi{draw(t,i){const{context:r,mergeContext:n}=t;if(!r||!n)throw s.invalid.context;const o=Te.propertyType(e.DataType.Mode).values;if(void 0===o)throw s.unknown.mode;const a=o.find((e=>e.id===i.all_mode));if(void 0===a)throw s.unknown.mode;const{identifier:c}=a;return n.drawWithComposite(r.drawingSource,c),n}}class ci extends oi{constructor(){super(...arguments),this.parameters=[new si({name:"color",value:"color"}),new si({name:"similarity",value:"similarity"}),new si({name:"blend",value:"blend"})]}draw(e,t){const{context:i}=e;if(!i)throw s.invalid.context;const{width:r,height:n}=i.size,{accurate:o}=t,a=Number(t.similarity),c=Number(t.blend),l=String(t.color),h=l.substr(4,l.length-5).split(",").map((e=>Number(e))),d={r:h[0],g:h[1],b:h[2]},u=ne.rgb2yuv(d),m=i.imageData,f=m.data,p=o?this.yuvsFromPixelsAccurate(f,r,n):this.yuvsFromPixels(f);let g=0;return p.reverse().forEach((e=>{f[g+3]=ne.yuvBlend(e,u,a,c),g+=4})),i.drawImageData(m),i}yuvsFromPixels(e){const t=[];for(let i=e.length/4-1;i>0;i-=1)t.push([ne.rgb2yuv(wt.rgbaAtIndex(4*i,e))]);return t}yuvsFromPixelsAccurate(e,t,i){const r=[];for(let s=e.length/4-1;s>0;s-=1){const n={width:t,height:i};r.push(wt.neighboringRgbas(4*s,e,n).map((e=>ne.rgb2yuv(e))))}return r}}class li extends oi{constructor(){super(...arguments),this.parameters=[new si({name:"color",value:"color"}),new si({name:"size",value:"mm_dimensions"}),new si({name:"rate",value:"mm_fps"})]}draw(e,t){const{context:i}=e;if(!i)throw s.invalid.context;const{color:r}=t;return b(r)?(i.drawFill(vt(r)),i):i}input(e,t){return{filter:this.id,options:Object.fromEntries(this.parameters.map((i=>[i.name,t[i.name]||String(e.get(i.name)||"")])))}}}class hi extends oi{draw(e,t){const i=Object.fromEntries(Object.entries(t).map((e=>{const[t,i]=e;return[t,Number(i)]}))),{context:r}=e;if(!r)throw s.invalid.context;const n="rgba".split("");n.forEach((e=>{n.forEach((t=>{const r=`${e}${t}`;null===i[r]&&(i[r]=e===t?1:0)}))}));const{imageData:o}=r,{data:a}=o;return a.forEach(((e,t)=>{const r=a[t+1],s=a[t+2],n=a[t+3];a[t]=e*i.rr+r*i.rg+s*i.rb+n*i.ra,a[t+1]=e*i.gr+r*i.gg+s*i.gb+n*i.ga,a[t+2]=e*i.br+r*i.bg+s*i.bb+n*i.ba,a[t+3]=e*i.ar+r*i.ag+s*i.ab+n*i.aa})),r.drawImageData(o),r}}const di="rgba";class ui extends oi{draw(e,t){const i=(e=>{const t={bias:{},rdiv:{},matrix:{}};return di.split("").forEach(((i,r)=>{const s=e[`${r}m`].split(" ").map((e=>parseInt(e)));if(t.matrix[i]=s,t.rdiv[i]=e[`${r}rdiv`]||1,String(t.rdiv[i]).includes("/")){const e=String(t.rdiv[i]).split("/");t.rdiv[i]=parseFloat(e[0])/parseFloat(e[1])}else t.rdiv[i]=parseFloat(String(t.rdiv[i]));t.bias[i]=e[`${r}bias`]||0})),t})(t),{context:r}=e;if(!r)throw s.invalid.context;const{size:n}=r,{width:o,height:a}=n,c=r.imageData,l=r.imageDataFresh,h=c.data,d=l.data,u=o*a;for(let e=0;e<u;e+=1){const t=gt(e,h,n);di.split("").forEach(((r,s)=>{const n=i.rdiv[r],o=i.matrix[r],a=i.bias[r];let c=0;for(let e=0;e<9;e+=1)c+=t[e][r]*o[e];c=Math.floor(c*n+a+.5),d[4*e+s]=c}))}return r.drawImageData(l),r}}class mi extends oi{draw(e,t){const{context:i}=e;if(!i)throw s.invalid.context;const r=t.x||0,n=t.y||0,o=e.inputSize;let a=t.w||t.out_w||0,c=t.h||t.out_h||0;if(a+c<2)throw s.eval.outputSize;-1===a&&(a=o.width*(c/o.height)),-1===c&&(c=o.height*(a/o.width));const l={width:a,height:c},h={x:r,y:n,...l},d=ze.toSize(l);return d.drawInRectFromSize(i.drawingSource,h,l),d}scopeSet(e){const{context:t}=e;t&&(e.setInputSize(t.size),e.initialize("x","((in_w - out_w) / 2)"),e.initialize("y","((in_h - out_h) / 2)"))}}class fi extends oi{draw(e,t){const{context:i}=e;if(!i)throw s.invalid.context;const r=b(t.color)?t.color:"black",n=t.x||0,o=t.y||0,a=t.width||i.size.width,c=t.height||i.size.height;return i.drawFillInRect(vt(r),{x:n,y:o,width:a,height:c}),i}}class pi extends Se{}class gi extends Fe{constructor(...t){super(...t),this.retain=!0,this.type=e.DefinitionType.Font;const[i]=t,{source:r,url:n}=i;if(!r&&!n)throw s.invalid.definition.source;this.source=r||n||"",ve.install(this)}get absoluteUrl(){return kt(this.source)}get instance(){return this.instanceFromObject(this.instanceObject)}instanceFromObject(e){return new pi({...this.instanceObject,...e})}loadDefinition(){const e=this.absoluteUrl;if(!Dt.cached(e))return Dt.caching(e)?Dt.get(e):jt.font().loadUrl(e)}definitionUrls(e,t){return[kt(this.source)]}loadedVisible(){return Dt.get(kt(this.source))}toJSON(){return{...super.toJSON(),source:this.source}}}var vi={label:"Lobster",id:"com.moviemasher.font.default",type:"font",source:"https://fonts.gstatic.com/s/lobster/v23/neILzCirqoswsqX9zoKmM4MwWJU.woff2"};const yi="com.moviemasher.font.default",bi=t=>{const{id:i}=t,r=i&&x.populatedString(i)?i:yi;return ve.installed(r)||new gi({...t,type:e.DefinitionType.Font,id:r}),ve.fromId(r)},Ti=e=>bi({id:e}),wi=e=>bi(e).instanceFromObject(e),xi=e=>wi({id:e}),Si=()=>{bi(vi)},Fi=e=>{const{id:t}=e,i=t&&x.populatedString(t)?t:yi;return ve.uninstall(i),bi(e)},_i={define:Fi,install:Fi,definition:bi,definitionFromId:Ti,fromId:xi,initialize:Si,instance:wi};_e[e.DefinitionType.Font]=_i;const ki=e=>{if(!x.populatedString(e))throw s.id+e;return Ti(e).absoluteUrl},Ai=e=>String(e),Ii=e=>Dt.key(ki(e));class Ci extends oi{constructor(){super(...arguments),this.parameters=[new si({name:"fontcolor",value:"#000000"}),new si({name:"shadowcolor",value:"#FFFFFF"}),new si({name:"fontsize",value:"mm_vert(20)"}),new si({name:"x",value:"0"}),new si({name:"y",value:"0"}),new si({name:"shadowx",value:"mm_horz(5)"}),new si({name:"shadowy",value:"mm_vert(5)"}),new si({name:"fontfile",value:"mmFontFile('com.moviemasher.font.default')"}),new si({name:"textfile",value:"Hello World"})]}draw(e,t){const{context:i}=e;if(!i)throw s.invalid.context;const r=String(e.get("fontface")),n=Ii(r),{x:o,y:a,fontsize:c,fontcolor:l,text:h,textfile:d,shadowcolor:u,shadowx:m,shadowy:f}=t;if(!c||!x.aboveZero(c))throw s.eval.number+" fontsize";const p={height:Number(c),family:n,color:String(l||"black"),shadow:String(u||""),shadowPoint:{x:Number(m||0),y:Number(f||0)}},g={x:Number(o||0),y:Number(a||0)},v=String(h||d);return i.drawTextAtPoint(v,p,g),i}input(e,t){const i=t.w||t.width||0,r=t.h||t.height||0;return{filter:this.id,options:{width:i,height:r}}}scopeSet(e){e.set("text_w",0),e.set("text_h",0),e.set("mmFontFamily",Ii),e.set("mmTextFile",Ai),e.set("mmFontFile",ki),e.set("mm_fontfamily",Ii),e.set("mm_textfile",Ai),e.set("mm_fontfile",ki)}}class Di extends oi{draw(e){const{context:t}=e;if(!t)throw s.invalid.context;const i=ze.toSize(t.size),r=Number(e.get("alpha")||e.position),n="in"===String(e.get("type")||"in")?r:1-r;return i.drawWithAlpha(t.drawingSource,n),i}}class zi extends oi{draw(e,t){const{x:i,y:r}=t,{context:n,mergeContext:o}=e;if(!n||!o)throw s.invalid.context;return o.drawAtPoint(n.drawingSource,{x:i||0,y:r||0}),o}input(e,t){const{x:i,y:r}=t;return{filter:this.id,options:{x:i,y:r}}}scopeSet(e){const{context:t}=e;if(!t)return;const{width:i,height:r}=t.size;e.set("overlay_w",i),e.set("overlay_h",r)}}class Oi extends oi{draw(e,t){const{context:i}=e;if(!i)throw s.invalid.context;let r=t.w||t.width||0,n=t.h||t.height||0;if(r+n<2)return i;const o={width:Number(e.get("mm_in_w")),height:Number(e.get("mm_in_h"))};-1===r?r=o.width*(n/o.height):-1===n&&(n=o.height*(r/o.width));const a={width:r,height:n},c=ze.toSize(a);return c.drawInSizeFromSize(i.drawingSource,o,a),c}input(e,t){const i=t.w||t.width||0,r=t.h||t.height||0;return{filter:this.id,options:{width:i,height:r}}}scopeSet(e){const{context:t}=e;if(!t)return;const{width:i,height:r}=t.size;e.set("in_h",r),e.set("mm_in_h",r),e.set("in_w",i),e.set("mm_in_w",i)}}class Mi extends oi{draw(e,t){const{context:i}=e;if(!i)throw s.invalid.context;return i}input(e,t){return{filter:this.id,options:{sar:1,max:1}}}}const Ei=e=>{const{id:t}=e;if(!t||!x.populatedString(t))throw s.id+JSON.stringify(e);if(ve.installed(t))return ve.fromId(t);throw s.invalid.definition.id+" filterDefinition "+t},Ni=e=>Ei({id:e}),Vi=e=>Ei(e).instanceFromObject(e),ji=e=>Vi({id:e}),Pi=()=>{new ui({id:"convolution",type:e.DefinitionType.Filter}),new Mi({id:"setsar",type:e.DefinitionType.Filter}),new ai({id:"blend",type:e.DefinitionType.Filter}),new ci({id:"chromakey",type:e.DefinitionType.Filter}),new li({id:"color",type:e.DefinitionType.Filter}),new hi({id:"colorchannelmixer",type:e.DefinitionType.Filter}),new mi({id:"crop",type:e.DefinitionType.Filter}),new fi({id:"drawbox",type:e.DefinitionType.Filter}),new Ci({id:"drawtext",type:e.DefinitionType.Filter}),new Di({id:"fade",type:e.DefinitionType.Filter}),new zi({id:"overlay",type:e.DefinitionType.Filter}),new Oi({id:"scale",type:e.DefinitionType.Filter})},Ri=e=>{const{id:t}=e;if(!t||!x.populatedString(t))throw s.invalid.definition.id+"filterDefine";return ve.uninstall(t),Ei(e)},qi={define:Ri,install:Ri,definition:Ei,definitionFromId:Ni,fromId:ji,initialize:Pi,instance:Vi};function Ui(e){return class extends e{constructor(...e){super(...e),this.filters=[],this.retain=!0;const[t]=e,{properties:i,filters:r}=t;if(i){const e=Object.entries(i).map((e=>{const[t,i]=e;if(!x.object(i))throw s.invalid.property+"name "+t;const r=Object.assign(i,{name:t,custom:!0});return new we(r)}));this.properties.push(...e)}if(r){const e=r.map((e=>{const{id:t}=e;if(!t)throw s.id+JSON.stringify(e);return Vi(e)}));this.filters.push(...e)}}drawFilters(e,t,i,r,s){let n=i;return this.filters.forEach((i=>{const o=this.evaluator(e,t,r,n,s);n=i.drawFilter(o)})),n}evaluator(e,t,i,r,s){const n=new ht(t,i,r,s);return this.propertiesCustom.forEach((t=>{const i=e.value(t.name);n.set(t.name,i)})),n}inputFilters(e,t,i){return this.filters.map((r=>{const s=this.evaluator(e,t,i);return r.inputFilter(s)}))}get propertiesCustom(){return this.properties.filter((e=>e.custom))}toJSON(){const e=super.toJSON();this.filters.length&&(e.filters=this.filters);const t=this.propertiesCustom.map((e=>[e.name,e]));return t.length&&(e.properties=Object.fromEntries(t)),e}}}function Bi(e){return class extends e{constructor(...e){super(...e);const[t]=e;this.constructProperties(t)}constructProperties(e={}){this.definition.properties.forEach((t=>{const{name:i}=t;void 0!==e[i]?this[i]=e[i]:void 0===this[i]&&(this[i]=t.value)}))}get definitions(){return[...super.definitions,...this.modularDefinitions]}loadModular(e,t,i){const r=[],s=this.definitionTime(e,t),n=i?this.definitionTime(e,i):i;return this.modularDefinitions.forEach((t=>{const i=t.loadDefinition(e,s,n);i&&r.push(i)})),Promise.all(r).then()}modularUrls(e,t,i){const r=this.definitionTime(e,t),s=i?this.definitionTime(e,i):i;return this.modularDefinitions.flatMap((e=>e.definitionUrls(r,s)))}get modularDefinitions(){return this.definition.propertiesModular.map((e=>String(this.value(e.name)))).map((e=>ve.fromId(e)))}}}_e[e.DefinitionType.Filter]=qi;const Ji=Bi(Se);class $i extends Ji{}const Li=Ui(Fe);class Zi extends Li{constructor(...t){super(...t),this.type=e.DefinitionType.Effect,this.properties.push(new we({name:"label",type:e.DataType.String,value:""})),ve.install(this)}get instance(){return this.instanceFromObject(this.instanceObject)}instanceFromObject(e){return new $i({...this.instanceObject,...e})}}var Wi={label:"Blur",type:"effect",id:"com.moviemasher.effect.blur",properties:{},filters:[{id:"convolution",parameters:[{name:"0m",value:"1 1 1 1 1 1 1 1 1"},{name:"1m",value:"1 1 1 1 1 1 1 1 1"},{name:"2m",value:"1 1 1 1 1 1 1 1 1"},{name:"3m",value:"1 1 1 1 1 1 1 1 1"},{name:"0rdiv",value:"1/9"},{name:"1rdiv",value:"1/9"},{name:"2rdiv",value:"1/9"},{name:"3rdiv",value:"1/9"}]}]};var Ki={label:"Chromakey",type:"effect",id:"com.moviemasher.effect.chromakey",properties:{accurate:{type:"number",value:0},chroma_blend:{type:"number",value:.01},chroma_similarity:{type:"number",value:.5},chroma_color:{type:"rgb",value:"rgb(0,255,0)"}},filters:[{id:"chromakey",parameters:[{name:"color",value:"chroma_color"},{name:"blend",value:"chroma_blend"},{name:"similarity",value:"chroma_similarity"}]}]};var Gi={label:"Emboss",type:"effect",id:"com.moviemasher.effect.emboss",properties:{},filters:[{id:"convolution",parameters:[{name:"0m",value:"-2 -1 0 -1 1 1 0 1 2"},{name:"1m",value:"-2 -1 0 -1 1 1 0 1 2"},{name:"2m",value:"-2 -1 0 -1 1 1 0 1 2"},{name:"3m",value:"-2 -1 0 -1 1 1 0 1 2"}]}]};var Hi={label:"Grayscale",type:"effect",id:"com.moviemasher.effect.grayscale",properties:{},filters:[{id:"colorchannelmixer",parameters:[{name:"rr",value:.3},{name:"rg",value:.4},{name:"rb",value:.3},{name:"ra",value:0},{name:"gr",value:.3},{name:"gg",value:.4},{name:"gb",value:.3},{name:"ga",value:0},{name:"br",value:.3},{name:"bg",value:.4},{name:"bb",value:.3},{name:"ba",value:0},{name:"ar",value:0},{name:"ag",value:0},{name:"ab",value:0},{name:"aa",value:1}]}]};var Xi={label:"Sepia",type:"effect",id:"com.moviemasher.effect.sepia",properties:{},filters:[{id:"colorchannelmixer",parameters:[{name:"rr",value:.393},{name:"rg",value:.769},{name:"rb",value:.189},{name:"ra",value:0},{name:"gr",value:.349},{name:"gg",value:.686},{name:"gb",value:.168},{name:"ga",value:0},{name:"br",value:.272},{name:"bg",value:.534},{name:"bb",value:.131},{name:"ba",value:0},{name:"ar",value:0},{name:"ag",value:0},{name:"ab",value:0},{name:"aa",value:1}]}]};var Yi={label:"Sharpen",type:"effect",id:"com.moviemasher.effect.sharpen",properties:{},filters:[{id:"convolution",parameters:[{name:"0m",value:"0 -1 0 -1 5 -1 0 -1 0"},{name:"1m",value:"0 -1 0 -1 5 -1 0 -1 0"},{name:"2m",value:"0 -1 0 -1 5 -1 0 -1 0"},{name:"3m",value:"0 -1 0 -1 5 -1 0 -1 0"}]}]};var Qi={label:"Text Box",type:"effect",id:"com.moviemasher.effect.text",properties:{string:{type:"string",value:"Text Box"},size:{type:"fontsize",value:.2},color:{type:"rgba",value:"rgba(255,0,0,1)"},fontface:{type:"font",value:"com.moviemasher.font.default"},shadowcolor:{type:"rgba",value:"rgba(0,0,0,0)"},shadowx:{type:"number",value:.015},shadowy:{type:"number",value:.015},x:{type:"number",value:0},y:{type:"number",value:0}},filters:[{id:"drawtext",parameters:[{name:"fontcolor",value:"color"},{name:"shadowcolor",value:"shadowcolor"},{name:"fontsize",value:"mm_vert(size)"},{name:"x",value:"mm_horz(x)"},{name:"y",value:"mm_vert(y)"},{name:"shadowx",value:"mm_horz(shadowx)"},{name:"shadowy",value:"mm_vert(shadowy)"},{name:"fontfile",value:"mm_fontfile(fontface)"},{name:"textfile",value:"mm_textfile(string)"}]}]};const er=t=>{const{id:i}=t;if(!i||!x.populatedString(i))throw s.id+JSON.stringify(t);return ve.installed(i)?ve.fromId(i):new Zi({...t,type:e.DefinitionType.Effect})},tr=e=>er({id:e}),ir=e=>er(e).instanceFromObject(e),rr=e=>ir({id:e}),sr=()=>{new Zi(Wi),new Zi(Ki),new Zi(Gi),new Zi(Hi),new Zi(Xi),new Zi(Yi),new Zi(Qi)},nr=e=>{const{id:t}=e;if(!t||!x.populatedString(t))throw s.id;return ve.uninstall(t),er(e)},or={define:nr,definition:er,definitionFromId:tr,fromId:rr,initialize:sr,install:nr,instance:ir};_e[e.DefinitionType.Effect]=or;const ar=Bi(Se);class cr extends ar{}const lr=Ui(Fe);class hr extends lr{constructor(...t){super(...t),this.retain=!0,this.type=e.DefinitionType.Merger,ve.install(this)}get instance(){return this.instanceFromObject(this.instanceObject)}instanceFromObject(e){return new cr({...this.instanceObject,...e})}}var dr={label:"Blend",id:"com.moviemasher.merger.blend",type:"merger",properties:{mode:{type:"mode",value:"normal"}},filters:[{id:"blend",parameters:[{name:"all_mode",value:"mode"},{name:"repeatlast",value:"0"}]}]};var ur={label:"Center",id:"com.moviemasher.merger.center",type:"merger",filters:[{id:"overlay",parameters:[{name:"x",value:"floor((mm_width - overlay_w) / 2)"},{name:"y",value:"floor((mm_height - overlay_h) / 2)"}]}]};var mr={label:"Constrained",type:"merger",id:"com.moviemasher.merger.constrained",properties:{left:{type:"pixel",value:0},top:{type:"pixel",value:0}},filters:[{id:"overlay",parameters:[{name:"x",value:"left*(mm_width-overlay_w)"},{name:"y",value:"top*(mm_height-overlay_h)"}]}]};var fr={label:"Top Left",id:"com.moviemasher.merger.default",type:"merger",filters:[{id:"overlay",parameters:[{name:"x",value:"0"},{name:"y",value:"0"}]}]};var pr={label:"Overlay",id:"com.moviemasher.merger.overlay",type:"merger",properties:{left:{type:"pixel",value:.5},top:{type:"pixel",value:.5}},filters:[{id:"overlay",parameters:[{name:"x",value:"((mm_width + overlay_w) * left) - overlay_w"},{name:"y",value:"((mm_height + overlay_h) * top) - overlay_h"}]}]};const gr="com.moviemasher.merger.default",vr=t=>{const{id:i}=t,r=i&&x.populatedString(i)?i:gr;return ve.installed(r)?ve.fromId(r):new hr({...t,type:e.DefinitionType.Merger,id:r})},yr=e=>vr({id:e}),br=e=>{const{definitionId:t}=e;return vr({id:t}).instanceFromObject(e)},Tr=e=>br({definitionId:e}),wr=()=>{new hr(dr),new hr(ur),new hr(mr),new hr(fr),new hr(pr)},xr=e=>{const{id:t}=e,i=t&&x.populatedString(t)?t:gr;return ve.uninstall(i),vr(e)},Sr={define:xr,install:xr,definition:vr,definitionFromId:yr,fromId:Tr,initialize:wr,instance:br};_e[e.DefinitionType.Merger]=Sr;const Fr=Bi(Se);class _r extends Fr{}const kr=Ui(Fe);class Ar extends kr{constructor(...t){super(...t),this.retain=!0,this.type=e.DefinitionType.Scaler,ve.install(this)}get instance(){return this.instanceFromObject(this.instanceObject)}instanceFromObject(e){return new _r({...this.instanceObject,...e})}}var Ir={label:"Stretch",id:"com.moviemasher.scaler.default",type:"scaler",filters:[{id:"scale",parameters:[{name:"width",value:"mm_width"},{name:"height",value:"mm_height"}]},{id:"setsar",parameters:[{name:"sar",value:"1"},{name:"max",value:"1"}]}]};var Cr={label:"Pan",type:"scaler",id:"com.moviemasher.scaler.pan",properties:{scale:{type:"number",value:1.25},direction:{type:"direction8",value:1}},filters:[{id:"crop",description:"crop down diagonals and center",parameters:[{name:"out_w",value:[{condition:"direction < 4",value:"mm_input_width"},{condition:"true",value:"mm_horz(scale, true) / mm_max(mm_horz(scale, true) / mm_input_width, mm_vert(scale, true) / mm_input_height)"}]},{name:"out_h",value:[{condition:"direction < 4",value:"mm_input_height"},{condition:"true",value:"mm_vert(scale, true) / mm_max(mm_horz(scale, true) / mm_input_width, mm_vert(scale, true) / mm_input_height)"}]},{name:"x",value:"(mm_input_width-out_w)/2"},{name:"y",value:"(mm_input_height-out_h)/2"}]},{id:"scale",description:"scale (proudly for diagonals)",parameters:[{name:"w",value:[{condition:"direction < 4",value:"mm_input_width * mm_max(mm_horz(scale) / mm_input_width, mm_vert(scale) / mm_input_height)"},{condition:"true",value:"mm_horz(scale, true)"}]},{name:"h",value:[{condition:"direction < 4",value:"mm_input_height * mm_max(mm_horz(scale) / mm_input_width, mm_vert(scale) / mm_input_height)"},{condition:"true",value:"mm_vert(scale, true)"}]}]},{id:"crop",description:"crop down and position over time",parameters:[{name:"w",value:"mm_width"},{name:"h",value:"mm_height"},{name:"x",value:[{condition:"direction",in:[0,2],value:"(in_w-mm_width)/2"},{condition:"direction",in:[1,5],value:"(in_w-mm_width)*mm_t"},{condition:"direction",is:4,value:"(in_w-mm_width)*mm_t"},{condition:"direction",in:[3,7],value:"(in_w-mm_width)-((in_w-mm_width)*mm_t)"},{condition:"direction",is:6,value:"floor(((in_w-mm_width)*(1.0-mm_t)))"}]},{name:"y",value:[{condition:"direction",in:[1,3],value:"(in_h-mm_height)/2"},{condition:"direction",in:[2,5],value:"(in_h-mm_height)*mm_t"},{condition:"direction",is:6,value:"ceil((in_h-mm_height)*mm_t)"},{condition:"direction",in:[0,7],value:"(in_h-mm_height)-((in_h-mm_height)*mm_t)"},{condition:"direction",is:4,value:"(in_h-mm_height)-((in_h-mm_height) * mm_t)"}]}]},{id:"setsar",parameters:[{name:"sar",value:"1"},{name:"max",value:"1"}]}]};var Dr={label:"Scale",type:"scaler",id:"com.moviemasher.scaler.scale",properties:{scale:{type:"number",value:1}},filters:[{id:"scale",parameters:[{name:"width",value:"scale * mm_input_width * mm_max(mm_width / mm_input_width, mm_height / mm_input_height)"},{name:"height",value:"scale * mm_input_height * mm_max(mm_width / mm_input_width, mm_height / mm_input_height)"}]},{id:"setsar",parameters:[{name:"sar",value:"1"},{name:"max",value:"1"}]}]};const zr="com.moviemasher.scaler.default",Or=t=>{const{id:i}=t,r=i&&x.populatedString(i)?i:zr;return ve.installed(r)?ve.fromId(r):new Ar({...t,type:e.DefinitionType.Scaler,id:r})},Mr=e=>Or({id:e}),Er=e=>{const{definitionId:t}=e;return Or({id:t}).instanceFromObject(e)},Nr=e=>Er({definitionId:e}),Vr=()=>{new Ar(Ir),new Ar(Cr),new Ar(Dr)},jr=e=>{const{id:t}=e,i=t&&x.populatedString(t)?t:zr;return ve.uninstall(i),Or(e)},Pr={define:jr,install:jr,definitionFromId:Mr,definition:Or,instance:Er,fromId:Nr,initialize:Vr};function Rr(e){return class extends e{constructor(...e){super(...e),this.effects=[];const[t]=e,{merger:i,effects:r,scaler:s}=t;if(this.merger=br(i||{}),this.scaler=Er(s||{}),r){const e=r.map((e=>ir(e)));this.effects.push(...e)}}get definitions(){return[...super.definitions,...this.merger.definitions,...this.scaler.definitions,...this.effects.flatMap((e=>e.definitions))]}effectedCommandAtTimeToSize(e,t,i){const r=this.scaledCommandAtTimeToSize(e,t,i);if(!r)return;if(!this.effects)return r;const s=this.timeRangeRelative(e,t);return s?(this.effects.reverse().every((e=>r.filters.push(...e.definition.inputFilters(e,s,i)))),r):void 0}effectedContextAtTimeToSize(e,t,i){const r=this.scaledContextAtTimeToSize(e,t,i);if(!r)return;let s=r;if(!this.effects)return s;const n=this.timeRangeRelative(e,t);return n?(this.effects.reverse().every((e=>s=e.definition.drawFilters(e,n,s,i))),s):void 0}inputCommandAtTimeToSize(e,t,i){const r=this.effectedCommandAtTimeToSize(e,t,i);if(!r)return;const s=this.timeRangeRelative(e,t);return r.merger=this.merger.definition.inputFilters(this.merger,s,i)[0],r}loadClip(e,t,i){const r=[super.loadClip(e,t,i),this.loadTransformable(e,t,i)].filter(Boolean);switch(r.length){case 0:return;case 1:return r[0];default:return Promise.all(r).then()}}loadTransformable(e,t,i){const r=[this.merger.loadModular(e,t,i),this.scaler.loadModular(e,t,i),...this.effects.map((r=>r.loadModular(e,t,i)))].filter(Boolean);switch(r.length){case 0:return;case 1:return r[0];default:return Promise.all(r).then()}}mergeContextAtTime(e,t,i){const r=this.effectedContextAtTimeToSize(e,t,i.size);if(!r)return;const s=this.timeRangeRelative(e,t);this.merger.definition.drawFilters(this.merger,s,r,i.size,i)}scaledCommandAtTimeToSize(e,t,i){const r=this.commandAtTimeToSize(e,t,i);if(!r)return;const s=this.timeRangeRelative(e,t);return x.undefined(s)||r.filters.push(...this.scaler.definition.inputFilters(this.scaler,s,i)),r}scaledContextAtTimeToSize(e,t,i){const r=this.contextAtTimeToSize(e,t,i);if(!r)return;const s=this.timeRangeRelative(e,t);return x.undefined(s)?r:this.scaler.definition.drawFilters(this.scaler,s,r,i)}toJSON(){const e=super.toJSON();return e.merger=this.merger,e.scaler=this.scaler,e.effects=this.effects,e}}}function qr(t){return class extends t{constructor(){super(...arguments),this.trackType=e.TrackType.Video,this.visible=!0}contextAtTimeToSize(e,t,i){const r=this.definitionTime(t,e),s=this.loadedVisible(t,r);if(!s)return void console.error(this.constructor.name,"contextAtTimeToSize not loaded",this.id);const n=Number(s.width),o=Number(s.height),a=ze.toSize({width:n,height:o});return a.draw(s),a}loadedVisible(e,t){return this.definition.loadedVisible(e,t)}mergeContextAtTime(e,t,i){}}}_e[e.DefinitionType.Scaler]=Pr;const Ur=Rr(qr(qt(Se)));class Br extends Ur{}function Jr(t){return class extends t{constructor(){super(...arguments),this.trackType=e.TrackType.Video,this.visible=!0}loadedVisible(){}}}const $r=Jr(Lt(Fe)),Lr=Jr($r);class Zr extends Lr{constructor(...t){super(...t),this.source="",this.type=e.DefinitionType.Image;const[i]=t;if(!i)throw s.unknown.definition;const{url:r,source:n}=i;if(!r)throw s.invalid.definition.url;this.urlVisible=r,this.source=n||r,ve.install(this)}get absoluteUrl(){return kt(this.urlVisible)}get inputSource(){return kt(this.source)}get instance(){return this.instanceFromObject(this.instanceObject)}instanceFromObject(e){return new Br({...this.instanceObject,...e})}loadDefinition(e,t,i){const r=[],s=super.loadDefinition(e,t,i);s&&r.push(s);const n=this.absoluteUrl;switch(Dt.cached(n)||(Dt.caching(n)?r.push(Dt.get(n)):r.push(jt.image().loadUrl(n))),r.length){case 0:return;case 1:return r[0];default:return Promise.all(r).then()}}definitionUrls(e,t){return[this.absoluteUrl]}loadedVisible(){return Dt.get(this.absoluteUrl)}toJSON(){const e=super.toJSON();return e.url=this.urlVisible,this.source&&(e.source=this.source),e}unload(e=[]){super.unload(e),e.length||Dt.cached(this.urlVisible)&&Dt.remove(this.urlVisible)}}const Wr=e=>{const{id:t}=e;if(!t)throw s.id+JSON.stringify(e);return ve.installed(t)?ve.fromId(t):new Zr(e)},Kr=e=>Wr({id:e}),Gr=e=>Wr(e).instanceFromObject(e),Hr=e=>Gr({id:e}),Xr=()=>{},Yr=e=>{const{id:t}=e;if(!t||!x.populatedString(t))throw s.id;return ve.uninstall(t),Wr(e)},Qr=e=>{const t=Yr(e);return t.retain=!0,t},es={define:Yr,install:Qr,definition:Wr,definitionFromId:Kr,fromId:Hr,initialize:Xr,instance:Gr};_e[e.DefinitionType.Image]=es;class ts{constructor(e){this.buffer=Pt.mash.buffer,this._gain=Pt.mash.gain,this.playing=!1,this.playingClips=[],this.quantize=Pt.mash.quantize,this.startedMashAt=0,this.contextSecondsWhenStarted=0;const{emitter:t,backcolor:i,buffer:r,gain:s,quantize:n}=e;i&&(this.backcolor=i),n&&x.aboveZero(n)&&(this.quantize=n),void 0!==s&&x.positive(s)&&(this._gain=s),r&&x.aboveZero(r)&&(this.buffer=r),t&&(this.emitter=t)}adjustSourceGain(e){const t=Dt.audibleContext.getSource(e.id);if(!t)return;const{gainNode:i}=t;if(0===this.gain)return void(i.gain.value=0);const r=e.gain;if(x.positive(r))return void(i.gain.value=this.gain*r);const s=e.startOptions(this.seconds,this.quantize),{start:n,duration:o}=s;i.gain.cancelScheduledValues(0),e.gainPairs.forEach((e=>{const[t,r]=e;i.gain.linearRampToValueAtTime(this.gain*r,n+t*o)}))}compositeAudible(e){return!!this.createSources(e)&&(this.destroySources(e),!0)}compositeVisible(t,i){this.drawBackground();const r=new Map,s={},n=[],o=[];i.sort(Ee).forEach((t=>{const{type:i}=t;if(i===e.DefinitionType.Transition){const e=t;s[e.fromTrack]=e,s[e.toTrack]=e,n.push(e.fromTrack,e.toTrack)}else o.push(t.track),r.set(t.track,t)})),o.forEach((e=>{if(n.includes(e)){const i=s[e],{fromTrack:n,toTrack:o}=i,a=[],c=r.get(n);c&&a.push(c);const l=r.get(o);if(l&&a.push(l),!a.length)return;return i.mergeClipsIntoContextAtTime(a,Dt.visibleContext,t,this.quantize,this.backcolor),r.delete(n),void r.delete(o)}const i=r.get(e);i&&i.mergeContextAtTime(t,this.quantize,Dt.visibleContext)})),this.emitter?.emit(e.EventType.Draw)}compositeVisibleRequest(e,t){requestAnimationFrame((()=>this.compositeVisible(e,t)))}createSources(e,t){return e.filter((e=>!Dt.audibleContext.hasSource(e.id))).every((e=>{const i=e.loadedAudible();if(!i)return console.debug(this.constructor.name,"createSources loadedAudible undefined",e.id),!1;if(!this.playing&&!t)return;const r=this.playing?this.seconds:t?.seconds||0,s=e.startOptions(r,this.quantize),{start:n,duration:o,offset:a}=s;if(x.positive(n)&&x.aboveZero(o)){const{definition:t,id:r}=e,{loops:s}=t;Dt.audibleContext.startAt(r,i,n,o,a,s),this.playingClips.push(e),this.adjustSourceGain(e)}return!0}))}destroySources(e=[]){[...this.playingClips].filter((t=>!e.includes(t))).forEach((e=>Dt.audibleContext.deleteSource(e.id))),this.playingClips=e}drawBackground(){Dt.visibleContext.clear(),this.backcolor&&Dt.visibleContext.drawFill(vt(this.backcolor))}get gain(){return this._gain}set gain(t){this._gain!==t&&(this._gain=t,this.playing&&this.playingClips.forEach((e=>this.adjustSourceGain(e))),this.emitter?.emit(e.EventType.Volume))}get seconds(){return Dt.audibleContext.currentTime-this.contextSecondsWhenStarted+this.startedMashAt}startContext(){if(this.bufferSource)throw s.internal+"bufferSource startContext";if(this.playing)throw s.internal+"playing";const e=Dt.audibleContext.createBuffer(this.buffer);this.bufferSource=Dt.audibleContext.createBufferSource(e),this.bufferSource.loop=!0,this.bufferSource.connect(Dt.audibleContext.destination),this.bufferSource.start(0)}startPlaying(e,t){if(!this.bufferSource)throw s.internal+"bufferSource startPlaying";if(this.playing)throw s.internal+"playing";const{seconds:i}=e;return this.playing=!0,this.startedMashAt=i,this.contextSecondsWhenStarted=Dt.audibleContext.currentTime,!!this.createSources(t,e)||(this.stopPlaying(),!1)}stopPlaying(){this.playing&&(this.playing=!1,this.bufferSource&&this.bufferSource.stop(),this.destroySources(),this.startedMashAt=0,this.contextSecondsWhenStarted=0,this.bufferSource&&(this.bufferSource.disconnect(Dt.audibleContext.destination),delete this.bufferSource))}}class is{constructor(...t){this._backcolor=Pt.mash.backcolor,this._buffer=Pt.mash.buffer,this.createdAt="",this.data={},this.drawnSeconds=0,this._gain=Pt.mash.gain,this._id="",this.label="",this.loop=!1,this._paused=!0,this._playing=!1,this.quantize=Pt.mash.quantize,this.tracks=[];const i=t[0]||{},{createdAt:r,tracks:s,backcolor:n,id:o,label:a,media:c,quantize:l,...h}=i;o&&(this._id=o),Object.assign(this.data,h),l&&x.aboveZero(l)&&(this.quantize=l),a&&x.populatedString(a)&&(this.label=a),n&&x.populatedString(n)&&(this._backcolor=n),r&&(this.createdAt=r),s&&this.tracks.push(...s.map(((e,t)=>{const i=Re.track.instance(this.trackOptions(e,t));return this.assureClipsHaveFrames(i.clips),i}))),this.trackCount(e.TrackType.Video)||this.tracks.push(Re.track.instance({trackType:e.TrackType.Video})),this.trackCount(e.TrackType.Audio)||this.tracks.push(Re.track.instance({trackType:e.TrackType.Audio})),this.tracks.sort(Me),this.setDrawInterval()}addClipsToTrack(e,t=0,i=0,r){this.assureClipsHaveFrames(e);const[n]=e,o=this.clipTrackAtIndex(n,t);if(!o)throw s.invalid.track;const a=x.positive(n.track)&&this.clipTrack(n);this.emitIfFramesChange((()=>{a&&a!==o&&a.removeClips(e),r&&e.forEach(((e,t)=>{e.frame=r[t]})),o.addClips(e,i)}))}addTrack(t){const i={trackType:t,layer:this.trackCount(t)},r=Re.track.instance(i);return this.tracks.push(r),this.tracks.sort(Me),this.emitter?.emit(e.EventType.Track),r}assureClipsHaveFrames(e){e.filter((e=>!x.positive(e.frames))).forEach((e=>{const t=e.definition;e.frames=t.frames(this.quantize)}))}get backcolor(){return this._backcolor}set backcolor(e){this._backcolor=e,this._composition&&(this.composition.backcolor=e)}get buffer(){return this._buffer}set buffer(e){if(!x.aboveZero(e))throw s.invalid.argument+"buffer "+e;this._buffer!==e&&(this._buffer=e,this._composition&&(this.composition.buffer=e))}get bufferFrames(){return this.buffer*this.quantize}bufferStart(){this._bufferTimer||(this._bufferTimer=setInterval((()=>{this.loadPromise}),Math.round(1e3*this.buffer/2)))}bufferStop(){this._bufferTimer&&(clearInterval(this._bufferTimer),delete this._bufferTimer)}get bufferTime(){return St.fromSeconds(this.buffer)}changeClipFrames(e,t){let i=Math.max(1,t);const r=e.maxFrames(this.quantize);x.aboveZero(r)&&(i=Math.min(r,i));const s=this.clipTrack(e);this.emitIfFramesChange((()=>{e.frames=i,s.sortClips(s.clips)}))}changeClipTrimAndFrames(e,t,i){let r=Math.max(0,t);const s=e.maxFrames(this.quantize,1);x.aboveZero(s)&&(r=Math.min(s,r));const n=i-r,o=this.clipTrack(e);this.emitIfFramesChange((()=>{e.trim=r,e.frames=n,o.sortClips(o.clips)}))}clearDrawInterval(){this.drawInterval&&(clearInterval(this.drawInterval),this.drawInterval=void 0)}clipIntersects(e,t){return e.timeRange(this.quantize).intersects(t)}clipTrack(e){return this.clipTrackAtIndex(e,e.track)}clipTrackAtIndex(e,t=0){return this.trackOfTypeAtIndex(e.trackType,t)}get clips(){return this.clipsInTracks()}clipsAtTimes(e,t){const i=this.clipsVisible(e,t);return t&&i.push(...this.clipsAudible(e,t)),[...new Set(i)]}clipsAudible(e,t){const i=t&&Ft.fromTimes(e,t);return this.clipsAudibleInTracks.filter((t=>{const r=t.timeRange(this.quantize);return i?r.intersects(i):r.intersectsTime(e)}))}clipsInTracks(e){return(e||this.tracks).map((e=>e.clips)).flat()}filterIntersecting(e,t){const i=t.scale(this.quantize);return e.filter((e=>this.clipIntersects(e,i)))}get clipsAudibleInTracks(){return this.clipsInTracks().filter((e=>e.audible&&!e.muted))}clipsAudibleInTimeRange(e){return this.filterIntersecting(this.clipsAudibleInTracks,e)}get clipsVideo(){return this.tracks.filter((t=>t.trackType!==e.TrackType.Audio)).flatMap((e=>e.clips))}clipsVisible(e,t){const i=t&&Ft.fromTimes(e,t);return this.clipsVideo.filter((t=>{const r=t.timeRange(this.quantize);return i?r.intersects(i):r.intersectsTime(e)}))}clipsVisibleAtTime(e){return this.clipsVisibleInTimeRange(Ft.fromTime(e))}clipsVisibleInTimeRange(e){const t=e.scale(this.quantize);return this.clipsVideo.filter((e=>this.clipIntersects(e,t)))}compositeAudibleClips(e){if(this._paused)return;const t=e.filter((e=>e.audible&&!e.muted));t.length&&this.composition.compositeAudible(t)}get composition(){if(!this._composition){const e={backcolor:this.backcolor,buffer:this.buffer,gain:this.gain,quantize:this.quantize,emitter:this.emitter};this._composition=new ts(e)}return this._composition}compositeVisible(){const{time:e}=this;this.composition.compositeVisible(e,this.clipsVisibleAtTime(e))}compositeVisibleRequest(){const{time:e,composition:t}=this;t.compositeVisibleRequest(e,this.clipsVisibleAtTime(e))}get definitions(){return[...new Set(this.clipsInTracks().flatMap((e=>e.definitions)))]}destroy(){this.paused=!0,this.clearDrawInterval(),delete this._composition}drawTime(t){const i=t!==this.time;this.drawnTime=t,this.compositeVisibleRequest(),this.emitter?.emit(i?e.EventType.Time:e.EventType.Loaded)}drawWhileNotPlaying(){const e=performance.now();if(e-this.drawnSeconds<1/this.quantize)return;this.drawnSeconds=e;const{time:t}=this,i=this.clipsVisible(t);if(!i.filter((e=>e.definition.streamable)).length)return;i.some((e=>e.clipUrls(this.quantize,t).some((e=>!Dt.cached(e)))))||this.compositeVisibleRequest()}drawWhilePlaying(){const{seconds:t}=this.composition,i=this.time.withFrame(this.time.frame+1);if(t>=this.endTime.seconds)this.loop?this.seekToTime(this.time.withFrame(0)):(this.paused=!0,this.emitter?.emit(e.EventType.Ended));else if(t>=i.seconds){const e=St.fromSeconds(t,this.time.fps);this.drawTime(e)}}get duration(){return this.endTime.seconds}emitIfFramesChange(t){const i=this.frames;t();const{frames:r}=this;i!==r&&(this.emitter?.emit(e.EventType.Duration),this.frame>r&&this.seekToTime(St.fromArgs(r,this.quantize)))}get emitter(){return this._emitter}set emitter(e){this._emitter=e,this._composition&&(this._composition.emitter=e)}get endTime(){return St.fromArgs(this.frames,this.quantize)}get frame(){return this.time.scale(this.quantize,"floor").frame}get frames(){return Math.max(0,...this.tracks.map((e=>e.frames)))}get gain(){return this._gain}set gain(e){if(!x.positive(e))throw s.invalid.argument+"gain "+e;this._gain!==e&&(this._gain=e,this._composition&&(this.composition.gain=e))}handleAction(t){if(this.emitter?.emit(e.EventType.Action),t instanceof Ze){const e=t,{property:i}=e;if("gain"===i)return void(this.playing&&x.aboveZero(this.gain)&&this.composition.adjustSourceGain(e.target))}this.stopLoadAndDraw()}handleDrawInterval(){this._playing?this.drawWhilePlaying():this.drawWhileNotPlaying()}seqmentsAtTimes(e,t,i){const r=this.clipsAtTimes(t,i),s=t.scale(this.quantize);if(!i)return[{clips:r,timeRange:Ft.fromTime(s)}];const n=[],o=i.scale(this.quantize),a=Ft.fromTimes(s,o),{times:c}=a;let l,h="~";return c.forEach((e=>{const t=Ft.fromTime(e),i=this.filterIntersecting(r,t),s=i.map((e=>e.id)).join("~");h===s?l.timeRange=l.timeRange.addFrames(1):(h=s,l={timeRange:t,clips:i},n.push(l))})),n}get id(){return this._id||=S()}inputCommand(e,t,i,r){return this.seqmentsAtTimes(e,i,r).map((({clips:e,timeRange:i})=>e.map((e=>{const r=e.inputCommandAtTimeToSize(i.startTime,this.quantize,t);if(!r)throw s.invalid.object;return r}))))}inputCommandPromise(e,t,i,r){return new Promise((s=>{const n=this.clipsAtTimes(i,r).map((e=>e.loadClip(this.quantize,i,r))).filter(Boolean);n.length?Promise.all(n).then((()=>{s(this.inputCommand(e,t,i,r))})):s(this.inputCommand(e,t,i,r))}))}get job(){return{definitions:this.definitions,mash:this,remoteServer:_t(),outputs:[]}}get loadPromise(){const[e,t]=this.startAndEnd,i=this.clipsAtTimes(e,t),r=i.map((i=>i.loadClip(this.quantize,e,t))).filter(Boolean);if(r.length)return Promise.all(r).then((()=>{this.compositeAudibleClips(i)}));this.compositeAudibleClips(i)}loadPromiseAtTimes(e,t){const i=this.clipsAtTimes(e,t).map((i=>i.loadClip(this.quantize,e,t))).filter(Boolean);switch(i.length){case 0:return;case 1:return i[0]||void 0;default:return Promise.all(i).then()}}get loadUrls(){const[e,t]=this.startAndEnd;return this.clipsAtTimes(e,t).flatMap((i=>i.clipUrls(this.quantize,e,t)))}get loadedDefinitions(){const e=new Map,[t,i]=this.startAndEnd;return this.clipsAtTimes(t,i).forEach((r=>{const{definitions:n}=r,o=[r.definitionTime(this.quantize,t)];i&&o.push(r.definitionTime(this.quantize,i)),n.forEach((t=>{e.has(t)||e.set(t,[]);const i=e.get(t);if(!i)throw s.internal;i.push(o)}))})),e}mashState(e,t){const i=[],r=`${t.width}x${t.height}`,s={filters:[{filter:"color",options:{color:this.backcolor,size:r}}]};return i.push(s),i.push(...this.clipsAtTimes(e).map((i=>i.clipState(this.quantize,e,t)))),i}mashStatePromise(e,t){const i=this.loadPromiseAtTimes(e);return i?i.then((()=>this.mashState(e,t))):Promise.resolve(this.mashState(e,t))}get paused(){return this._paused}set paused(t){const i=t||!this.frames;if(this._paused!==i)if(this._paused=i,i)this.playing=!1,this.bufferStop(),this._bufferTimer&&(clearInterval(this._bufferTimer),delete this._bufferTimer),this.emitter?.emit(e.EventType.Pause);else{this.composition.startContext(),this.bufferStart();const t=this.loadPromise;t?t.then((()=>{this.playing=!0})):this.playing=!0,this.emitter?.emit(e.EventType.Play)}}get playing(){return this._playing}set playing(t){if(this._playing!==t)if(this._playing=t,t){const t=this.clipsAudibleInTimeRange(this.timeRangeToBuffer);if(!this.composition.startPlaying(this.time,t))return void(this._playing=!1);this.emitter?.emit(e.EventType.Playing)}else this.composition.stopPlaying()}removeClipsFromTrack(e){const[t]=e,i=this.clipTrack(t);this.emitIfFramesChange((()=>{i.removeClips(e)}))}removeTrack(t){const i=this.trackOfTypeAtIndex(t,this.trackCount(t)-1),r=this.tracks.indexOf(i);if(!x.positive(r))throw s.internal;this.emitIfFramesChange((()=>{this.tracks.splice(r,1)})),this.emitter?.emit(e.EventType.Track)}restartAfterStop(t,i,r){t===this.time&&(r&&(delete this.seekTime,this.emitter?.emit(e.EventType.Seeked)),this.drawTime(t),i||(this.composition.startContext(),this.playing=!0))}seekToTime(t){return this.seekTime!==t&&(this.seekTime=t,this.emitter?.emit(e.EventType.Seeking),this.emitter?.emit(e.EventType.Time)),this.stopLoadAndDraw(!0)}setDrawInterval(){this.clearDrawInterval(),this.drawInterval=setInterval((()=>{this.handleDrawInterval()}),500/this.time.fps)}get stalled(){return!this.paused&&!this.playing}get startAndEnd(){const{time:e}=this,t=[e];return this.paused||t.push(e.add(this.bufferTime)),t}stopLoadAndDraw(e){const{time:t,paused:i,playing:r}=this;r&&(this.playing=!1);const s=this.loadPromise;if(s)return s.then((()=>{this.restartAfterStop(t,i,e)}));this.restartAfterStop(t,i,e)}get time(){return this.seekTime||this.drawnTime||St.fromArgs(0,this.quantize)}get timeRange(){return Ft.fromTime(this.time,this.endTime.scale(this.time.fps).frame)}get timeRangeToBuffer(){const{time:e,quantize:t,buffer:i,paused:r}=this;if(r){return Ft.fromArgs(e.scale(t,"floor").frame,t,1)}return Ft.fromTimes(e,St.fromSeconds(i+e.seconds,e.fps))}toJSON(){return{label:this.label,quantize:this.quantize,backcolor:this.backcolor,id:this.id,tracks:this.tracks,createdAt:this.createdAt,...this.data}}trackCount(e){return e?this.tracksOfType(e).length:this.tracks.length}trackOfTypeAtIndex(e,t=0){if(!x.positive(t))throw console.error(s.invalid.track,t,t?.constructor.name),s.invalid.track;return this.tracksOfType(e)[t]}trackOptions(e,t){return{...e,layer:t}}tracksOfType(e){return this.tracks.filter((t=>t.trackType===e))}}const rs=new class{instance(e={},t){return t&&t.forEach((e=>{const{id:t,type:i}=e;if(!i||!b(i))throw s.type;const r=i;if(!O.includes(r))throw s.type+r;if(!t||!b(t))throw s.invalid.definition.id+JSON.stringify(e);Re[r].definition(e)})),new is(e)}},ss=Rr(qr(qt(Bi(Se))));class ns extends ss{commandAtTimeToSize(e,t,i){return{sources:{source:this.definition.inputSource},filters:[]}}contextAtTimeToSize(e,t,i){const r=ze.toSize(i),s=this.timeRangeRelative(e,t);return this.definition.drawFilters(this,s,r,i)}clipUrls(e,t){const i=super.clipUrls(e,t);return i.push(...this.modularUrls(e,t)),i}inputCommandAtTimeToSize(e,t,i){const r=super.inputCommandAtTimeToSize(e,t,i);if(!r)return r;const s=this.timeRangeRelative(e,t);return r.filters=this.definition.inputFilters(this,s,i),r}loadClip(e,t,i){const r=[],s=super.loadClip(e,t,i);s&&r.push(s);const n=this.loadModular(e,t,i);switch(n&&r.push(n),r.length){case 0:return;case 1:return r[0];default:return Promise.all(r).then()}}}function os(e){return class extends e{constructor(...e){super(...e)}}}const as=os(Jr(Lt(Ui(Fe))));class cs extends as{constructor(...t){super(...t),this.type=e.DefinitionType.Theme,ve.install(this)}get instance(){return this.instanceFromObject(this.instanceObject)}instanceFromObject(e){const{instanceObject:t}=this,i={...t,...e};return new ns(i)}}var ls={label:"Color",type:"theme",id:"com.moviemasher.theme.color",properties:{color:{type:"rgb",value:"#FFFF00"}},filters:[{id:"color"}]};var hs={label:"Text",type:"theme",id:"com.moviemasher.theme.text",properties:{string:{type:"string",value:"Text"},size:{type:"fontsize",value:.3},x:{type:"number",value:0},y:{type:"number",value:0},color:{type:"rgba",value:"rgba(255,0,0,1)"},shadowcolor:{type:"rgba",value:"rgba(0,0,0,0)"},shadowx:{type:"number",value:.015},shadowy:{type:"number",value:.015},background:{type:"rgba",value:"rgba(0,0,0,0)"},fontface:{type:"font",value:"com.moviemasher.font.default"}},filters:[{id:"color",parameters:[{name:"color",value:"background"},{name:"size",value:"mm_dimensions"},{name:"duration",value:"mm_duration"},{name:"rate",value:"mm_fps"}]},{id:"drawtext",parameters:[{name:"fontcolor",value:"color"},{name:"shadowcolor",value:"shadowcolor"},{name:"fontsize",value:"mm_vert(size)"},{name:"x",value:"mm_horz(x)"},{name:"y",value:"mm_vert(y)"},{name:"shadowx",value:"mm_horz(shadowx)"},{name:"shadowy",value:"mm_vert(shadowy)"},{name:"fontfile",value:"mm_fontfile(fontface)"},{name:"textfile",value:"mm_textfile(string)"}]}]};const ds=t=>{const{id:i}=t;if(!i||!x.populatedString(i))throw s.id+JSON.stringify(t);return ve.installed(i)?ve.fromId(i):new cs({...t,type:e.DefinitionType.Theme})},us=e=>ds({id:e}),ms=e=>ds(e).instanceFromObject(e),fs=e=>ms({id:e}),ps=()=>{new cs(ls),new cs(hs)},gs=e=>{const{id:t}=e;if(!t||!x.populatedString(t))throw s.id+JSON.stringify(e);return ve.uninstall(t),ds(e)},vs={define:gs,install:gs,definition:ds,definitionFromId:us,fromId:fs,initialize:ps,instance:ms};_e[e.DefinitionType.Theme]=vs;const ys=qr(qt(Bi(Se)));class bs extends ys{constructor(...t){super(...t),this.fromTrack=0,this.toTrack=1,this.trackType=e.TrackType.Transition;const[i]=t,{fromTrack:r,toTrack:s}=i;void 0!==r&&(this.fromTrack=r),void 0!==s&&(this.toTrack=s)}contextAtTimeToSize(e,t,i){}mergeClipsIntoContextAtTime(e,t,i,r,s){x.aboveZero(e.length)&&this.definition.drawVisibleFilters(e,this,i,r,t,s)}}const Ts=Jr(Lt(Ui(Fe)));class ws extends Ts{constructor(...t){super(...t),this.fromFilters=[],this.fromMerger=br({}),this.fromScaler=Er({}),this.toFilters=[],this.toMerger=br({}),this.toScaler=Er({}),this.type=e.DefinitionType.Transition;const[i]=t,{to:r,from:s}=i;if(r){const{filters:e,merger:t,scaler:i}=r;e&&this.toFilters.push(...e.map((e=>Vi(e)))),t&&(this.toMerger=br(t)),i&&(this.toScaler=Er(i))}if(s){const{filters:e,merger:t,scaler:i}=s;e&&this.fromFilters.push(...e.map((e=>Vi(e)))),t&&(this.fromMerger=br(t)),i&&(this.fromScaler=Er(i))}this.properties.push(new we({name:"fromTrack",type:e.DataType.Number,value:0}),new we({name:"toTrack",type:e.DataType.Number,value:1})),ve.install(this)}drawVisibleFilters(e,t,i,r,s,n){const{size:o}=s,a=[...e].sort(Oe);let c=a[0],l=a[1];!l&&c.frame>=t.frame&&(l=c,c=void 0);let h=ze.toSize(o),d=ze.toSize(o);n&&(h.drawFill(n),d.drawFill(n));const u=t.timeRangeRelative(i,r);c&&c.mergeContextAtTime(i,r,h),this.filters=this.fromFilters,h=this.drawFilters(t,u,h,o),l&&l.mergeContextAtTime(i,r,d),this.filters=this.toFilters,d=this.drawFilters(t,u,d,o),h=this.fromScaler.definition.drawFilters(this.fromScaler,u,h,o),this.fromMerger.definition.drawFilters(this.fromMerger,u,h,o,s),d=this.toScaler.definition.drawFilters(this.toScaler,u,d,o),this.toMerger.definition.drawFilters(this.toMerger,u,d,o,s)}get instance(){return this.instanceFromObject(this.instanceObject)}instanceFromObject(e){return new bs({...this.instanceObject,...e})}toJSON(){return{...super.toJSON(),to:{filters:this.toFilters},from:{filters:this.fromFilters}}}}var xs={label:"Crossfade",type:"transition",id:"com.moviemasher.transition.crossfade",to:{filters:[{id:"fade",parameters:[{name:"alpha",value:"t"},{name:"type",value:"in"},{name:"duration",value:"mm_duration"}]}]}};const Ss=e=>{const{id:t}=e;if(!t||!x.populatedString(t))throw s.id+JSON.stringify(e);return ve.installed(t)?ve.fromId(t):new ws(e)},Fs=e=>Ss({id:e}),_s=e=>Ss(e).instanceFromObject(e),ks=e=>_s({id:e}),As=()=>{Ss(xs)},Is=e=>{const{id:t}=e;if(!t||!x.populatedString(t))throw s.id+JSON.stringify(e);return ve.uninstall(t),Ss(e)},Cs={define:Is,install:Is,definition:Ss,definitionFromId:Fs,fromId:ks,initialize:As,instance:_s};_e[e.DefinitionType.Transition]=Cs;const Ds=Rr(qr(Ut(Rt(qt(Se))))),zs=class extends Ds{constructor(...e){super(...e),this.speed=Pt.instance.video.speed;const[t]=e,{speed:i}=t;i&&x.aboveZero(i)&&(this.speed=i)}get copy(){return super.copy}definitionTime(e,t){const i=super.definitionTime(e,t);return this.speed===Pt.instance.video.speed?i:i.divide(this.speed)}toJSON(){const e=super.toJSON();return this.speed!==Pt.instance.video.speed&&(e.speed=this.speed),e}},Os=Jr(Wt(Zt(Lt(Fe)))),Ms=class extends Os{constructor(...t){super(...t),this.fps=Pt.definition.video.fps,this.pattern="%.jpg",this.source="",this.trackType=e.TrackType.Video,this.type=e.DefinitionType.Video;const[i]=t,{url:r,fps:n,source:o}=i;if(!r)throw s.invalid.definition.url;this.url=r,this.source=o||r,n&&(this.fps=n),this.properties.push(new we({name:"speed",type:e.DataType.Number,value:1})),ve.install(this)}get absoluteUrl(){return kt(this.url)}get cachedOrThrow(){const e=Dt.get(this.absoluteUrl);if(!e)throw s.internal;return e}definitionUrls(e,t){return[this.absoluteUrl]}get inputSource(){return kt(this.source)}get instance(){return this.instanceFromObject(this.instanceObject)}instanceFromObject(e){return new zs({...this.instanceObject,...e})}framePromise(e,t){const{video:i,sequence:r}=t,s=r[e.frame];if(s instanceof Promise)return s;if(s)return Promise.resolve();const n=this.seekPromise(e,i).then((()=>{if(r[e.frame]&&!(r[e.frame]instanceof Promise))return;const t=ze.toSize(i);t.draw(i),r[e.frame]=t.canvas}));return r[e.frame]=n,n}needTimes(e,t,i){const{sequence:r}=e;return(i?Ft.fromTimes(t,i).times:[t]).filter((e=>!r[e.frame]||r[e.frame]instanceof Promise))}framesPromise(e,t){const i=this.cachedOrThrow,r=this.needTimes(i,e,t);return this.timesPromise(r)}timesPromise(e){if(!e.length)return Promise.resolve();const t=this.cachedOrThrow,i=e.shift();if(!i)throw s.internal;let r=this.framePromise(i,t);return e.forEach((e=>{r=r.then((()=>this.framePromise(e,t)))})),r}loadDefinition(e,t,i){const r=this.fps||e,s=t.scale(r),n=i?i.scale(r):i,o=this.absoluteUrl;if(Dt.cached(o)){const e=this.cachedOrThrow,t=this.needTimes(e,s,n);if(!t.length)return;return this.timesPromise(t)}return(Dt.caching(o)?Dt.get(o):jt.video().loadUrl(o)).then((()=>this.framesPromise(s,n)))}loadedAudible(){const e=Dt.get(this.absoluteUrl);if(!e)return;const{audio:t}=e;return Dt.audibleContext.createBufferSource(t)}loadedVisible(e,t){const i=this.fps||e,r=t.scale(i),s=Dt.get(this.absoluteUrl);if(!s)return;const{sequence:n}=s,o=n[r.frame];return!o||o instanceof Promise?void 0:o}seek(e,t){if(!t)throw s.internal;t.currentTime=e.seconds}seekNeeded(e,t){const{currentTime:i}=t;return!St.fromSeconds(i,e.fps).equalsTime(e)}seekPromise(e,t){return new Promise((i=>{if(!this.seekNeeded(e,t))return i();t.onseeked=()=>{t.onseeked=null,i()},this.seek(e,t)}))}toJSON(){const e=super.toJSON();return e.url=this.url,this.source&&(e.source=this.source),this.fps!==Pt.definition.video.fps&&(e.fps=this.fps),e}unload(e){}},Es=e=>{const{id:t}=e;if(!t||!x.populatedString(t))throw s.id+JSON.stringify(e);return ve.installed(t)?ve.fromId(t):new Ms(e)},Ns=e=>Es({id:e}),Vs=e=>Es(e).instanceFromObject(e),js=e=>Vs({id:e}),Ps=()=>{},Rs=e=>{const{id:t}=e;if(!t||!x.populatedString(t))throw s.id+JSON.stringify(e);return ve.uninstall(t),Es(e)},qs=e=>{const t=Rs(e);return t.retain=!0,t},Us={define:Rs,install:qs,definition:Es,definitionFromId:Ns,fromId:js,initialize:Ps,instance:Vs};function Bs(e){return class extends e{constructor(...e){super(...e);const[t]=e,{something:i}=t;i&&(this.something=i)}maxFrames(e,t){return 0}toJSON(){const e=super.toJSON();return this.something&&(e.something=this.something),e}}}_e[e.DefinitionType.Video]=Us;const Js=Rr(qr(Bs(Rt(qt(Se)))));class $s extends Js{constructor(...e){super(...e)}get copy(){return super.copy}toJSON(){return super.toJSON()}}function Ls(e){return class extends e{constructor(...e){super(...e),this.format="hls",this.streamable=!0;const[t]=e,{format:i}=t;i&&(this.format=i)}toJSON(){const e=super.toJSON();return e.format=!0,e}}}const Zs=Ls(Jr(Zt(Lt(Fe))));class Ws extends Zs{constructor(...t){super(...t),this.source="",this.trackType=e.TrackType.Video,this.type=e.DefinitionType.VideoStream;const[i]=t,{url:r,source:n}=i;if(!r)throw s.invalid.definition.url;this.url=r,this.source=n||r,ve.install(this)}get absoluteUrl(){return kt(this.url)}frames(e){return St.fromSeconds(Pt.definition.videostream.duration,e,"floor").frame}get inputSource(){return kt(this.source)}get instance(){return this.instanceFromObject(this.instanceObject)}instanceFromObject(e){return new $s({...this.instanceObject,...e})}loadDefinition(){const e=this.absoluteUrl;if(!Dt.cached(e))return Dt.caching(e)?Dt.get(e):jt.video().loadUrl(e)}definitionUrls(e,t){return[this.absoluteUrl]}loadedVisible(){return Dt.get(this.absoluteUrl)}toJSON(){const e=super.toJSON();return e.url=this.url,this.source&&(e.source=this.source),e}unload(e){!e&&Dt.cached(this.url)&&Dt.remove(this.url)}}const Ks=e=>{const{id:t}=e;if(!t||!x.populatedString(t))throw s.id+JSON.stringify(e);return ve.installed(t)?ve.fromId(t):new Ws(e)},Gs=e=>Ks({id:e}),Hs=e=>Ks(e).instanceFromObject(e),Xs=e=>Hs({id:e}),Ys=()=>{},Qs=e=>{const{id:t}=e;if(!t||!x.populatedString(t))throw s.id+JSON.stringify(e);return ve.uninstall(t),Ks(e)},en=e=>{const t=Qs(e);return t.retain=!0,t},tn={define:Qs,install:en,definition:Ks,definitionFromId:Gs,fromId:Xs,initialize:Ys,instance:Hs};_e[e.DefinitionType.VideoStream]=tn;const rn=Rr(qr(Ut(Rt(qt(Se)))));class sn extends rn{constructor(...e){super(...e),this.speed=Pt.instance.video.speed;const[t]=e,{speed:i}=t;i&&x.aboveZero(i)&&(this.speed=i)}get copy(){return super.copy}definitionTime(e,t){const i=super.definitionTime(e,t);return this.speed===Pt.instance.video.speed?i:i.divide(this.speed)}toJSON(){const e=super.toJSON();return this.speed!==Pt.instance.video.speed&&(e.speed=this.speed),e}}const nn=Jr(Wt(Zt(Lt(Fe))));class on extends nn{constructor(...t){super(...t),this.begin=Pt.definition.videosequence.begin,this.fps=Pt.definition.videosequence.fps,this.increment=Pt.definition.videosequence.increment,this.pattern="%.jpg",this.source="",this.trackType=e.TrackType.Video,this.type=e.DefinitionType.VideoSequence;const[i]=t,{padding:r,url:n,begin:o,fps:a,increment:c,pattern:l,source:h}=i;if(!n)throw s.invalid.definition.url;if(this.url=n,h&&(this.source=h),void 0!==o&&(this.begin=o),a&&(this.fps=a),c&&(this.increment=c),l&&(this.pattern=l),r)this.padding=r;else{const e=this.begin+(this.increment*this.framesMax-this.begin);this.padding=String(e).length}this.properties.push(new we({name:"speed",type:e.DataType.Number,value:1})),ve.install(this)}definitionUrls(e,t){return this.framesArray(e,t).map((e=>this.urlForFrame(e)))}framesArray(e,t){const i=[],r=Math.min(this.framesMax,e.scale(this.fps,"floor").frame);if(t){const e=Math.min(this.framesMax,t.scale(this.fps,"ceil").frame);for(let t=r;t<=e;t+=1)i.push(t)}else i.push(r);return i}get framesMax(){return Math.floor(this.fps*this.duration)-2}get inputSource(){return kt(this.source)}get instance(){return this.instanceFromObject(this.instanceObject)}instanceFromObject(e){return new sn({...this.instanceObject,...e})}loadDefinition(e,t,i){const r=[],s=i?super.loadDefinition(e,t,i):null;s&&r.push(s);switch(this.definitionUrls(t,i).filter((e=>!Dt.cached(e))).forEach((e=>{Dt.caching(e)?r.push(Dt.get(e)):r.push(jt.image().loadUrl(e))})),r.length){case 0:return;case 1:return r[0];default:return Promise.all(r).then()}}loadedVisible(e,t){const[i]=this.urls(t);return Dt.get(i)}toJSON(){const e=super.toJSON();return e.url=this.url,this.source&&(e.source=this.source),this.pattern!==Pt.definition.videosequence.pattern&&(e.pattern=this.pattern),this.increment!==Pt.definition.videosequence.increment&&(e.increment=this.increment),this.begin!==Pt.definition.videosequence.begin&&(e.begin=this.begin),this.fps!==Pt.definition.videosequence.fps&&(e.fps=this.fps),this.padding!==Pt.definition.videosequence.padding&&(e.padding=this.padding),e}unload(e){const t=St.fromArgs(0,this.fps),i=this.urls(t,t.withFrame(this.framesMax)),r=new Set(i.filter((e=>Dt.cached(e))));e&&e.forEach((e=>{const[t,i]=e;this.framesArray(t,i).map((e=>this.urlForFrame(e))).filter((e=>r.has(e))).forEach((e=>{r.delete(e)}))})),r.forEach((e=>{Dt.remove(e)}))}urlForFrame(e){let t=String(e*this.increment+this.begin);return this.padding&&(t=t.padStart(this.padding,"0")),kt((this.url+this.pattern).replaceAll("%",t))}urls(e,t){return this.framesArray(e,t).map((e=>this.urlForFrame(e)))}}const an=e=>{const{id:t}=e;if(!t||!x.populatedString(t))throw s.id+JSON.stringify(e);return ve.installed(t)?ve.fromId(t):new on(e)},cn=e=>an({id:e}),ln=e=>an(e).instanceFromObject(e),hn=e=>ln({id:e}),dn=()=>{},un=e=>{const{id:t}=e;if(!t||!x.populatedString(t))throw s.id+JSON.stringify(e);return ve.uninstall(t),an(e)},mn=e=>{const t=un(e);return t.retain=!0,t},fn={define:un,install:mn,definition:an,definitionFromId:cn,fromId:hn,initialize:dn,instance:ln};_e[e.DefinitionType.VideoSequence]=fn;class pn{constructor(...e){this.autoplay=Pt.masher.autoplay,this._buffer=Pt.masher.buffer,this.eventTarget=new st,this._fps=Pt.masher.fps,this._loop=Pt.masher.loop,this._muted=!1,this.precision=Pt.masher.precision,this._selection={},this._volume=Pt.masher.volume;const[t]=e,{autoplay:i,precision:r,loop:s,fps:n,volume:o,buffer:a,mash:c}=t;void 0!==i&&(this.autoplay=i),void 0!==r&&(this.precision=r),void 0!==s&&(this._loop=s),void 0!==n&&(this._fps=n),void 0!==o&&(this._volume=o),void 0!==a&&(this._buffer=a),c&&(this.mash=c)}actionCreate(e){const t=e.mash||this.mash,i=e.actions||this.actions,r=e.undoSelection||{...this.selection},s=e.redoSelection||{...this.selection},n={...e,actions:i,mash:t,undoSelection:r,redoSelection:s},o=et.createFromObject(n);this.actions.add(o),this.handleAction(this.actions.redo())}get actions(){return this._actions||(this._actions=new Ct({mash:this.mash})),this._actions}add(t,i=0,r=0){if(!x.populatedObject(t))throw s.argument+"add";const{id:n}=t,o=!(!n||!ve.installed(n))&&ve.fromId(n),a=t.type||o&&o.type;if(!a)throw s.type+"Masher.add "+n+JSON.stringify(o);if(a===e.DefinitionType.Effect){const e=Re.effect.definition(t).instance;return this.addEffect(e,i).then((()=>e))}const c=a;if(!D.includes(c))throw s.type+a;const l=Re[a].definition(t).instance;return this.addClip(l,i,r).then((()=>l))}addClip(t,i=0,r=0){const{trackType:s}=t,n=[t],o={clip:t,type:e.ActionType.AddClipsToTrack,redoSelection:{clip:t},trackType:s},a=this.mash.tracks.filter((e=>e.trackType===s)),c=a[r],l=a.length;return c.dense?(o.insertIndex=i,o.createTracks=Math.min(1,Math.max(0,1-l))):(o.trackIndex=r,t.frame=c.frameForClipsNearFrame(n,i),o.createTracks=Math.max(0,r+1-l)),this.actionCreate(o),this.loadMashAndDraw()}addEffect(t,i=0){const{clip:r}=this.selection;if(!r)throw s.selection;const{effects:n}=r;if(!n)throw s.selection;const o=[...n],a=[...n],c=[t];a.splice(i,0,t);const l={effects:n,undoEffects:o,redoEffects:a,redoSelectedEffects:c,type:e.ActionType.MoveEffects};return this.actionCreate(l),this.loadMashAndDraw()}addTrack(t=e.TrackType.Video){this.actionCreate({trackType:t,type:e.ActionType.AddTrack})}get buffer(){return this._buffer}set buffer(e){const t=Number(e);this._buffer!==t&&(this._buffer=t,this.mash.buffer=t)}can(t){const{track:i,clip:r,effect:n}=this.selection;switch(t){case e.MasherAction.Save:return this.actions.canSave;case e.MasherAction.Undo:return this.actions.canUndo;case e.MasherAction.Redo:return this.actions.canRedo;case e.MasherAction.Remove:return!!(n||r||i&&this.mash.trackCount(i.trackType)===i.layer+1);case e.MasherAction.Split:return!!r&&this.clipCanBeSplit(r,this.time,this.mash.quantize);case e.MasherAction.Freeze:return!!r&&e.DefinitionType.Video===r.type&&this.clipCanBeSplit(r,this.time,this.mash.quantize);default:throw s.argument}}change(e,t){if(!this.selection.track)throw s.selection;this.selection.clip?this.selection.effect?this.changeEffect(e,t,this.selection.effect):this.changeClip(e,t,this.selection.clip):this.changeTrack(e,t,this.selection.track)}changeClip(t,i,r){if(!x.populatedString(t))throw s.property+"changeClip "+t;const[n,o]=t.split(".");if(o)return void this.changeTransformer(n,o,i);const a=r||this.selection.clip;if(!a)throw s.selection;const c=void 0===i?a.value(t):i;if(this.currentActionReusable(a,t)){const e=this.actions.currentAction;return e.updateAction(c),void this.handleAction(e)}const l=a.value(t),h={property:t,target:a,redoValue:c,undoValue:l};switch(h.property){case"frames":h.type=e.ActionType.ChangeFrames;break;case"trim":h.type=e.ActionType.ChangeTrim,h.frames=a.frames+h.undoValue;break;default:h.type=e.ActionType.Change}this.actionCreate(h)}changeEffect(t,i,r){if(!x.populatedString(t))throw s.property;const n=r||this.selection.effect;if(!n)throw s.selection;const o=void 0===i?n.value(t):i;if(this.currentActionReusable(n,t)){const e=this.actions.currentAction;return e.updateAction(o),void this.handleAction(e)}const a=n.value(t),c={type:e.ActionType.Change,target:n,property:t,redoValue:o,undoValue:a};this.actionCreate(c)}changeTrack(t,i,r){if(!x.populatedString(t))throw s.property;const n=r||this.selection.track;if(!n)throw s.selection;const o=void 0===i?n.value(t):i;if(this.currentActionReusable(n,t)){const e=this.actions.currentAction;return e.updateAction(o),void this.handleAction(e)}const a=n.value(t),c={type:e.ActionType.Change,target:n,property:t,redoValue:o,undoValue:a};this.actionCreate(c)}changeTransformer(t,i,r){if(!x.populatedString(t))throw s.type+"changeTransformer "+t;if(!x.populatedString(i))throw s.property+"changeTransformer "+i;const n=this.selection.clip;if(!n)throw s.selection;const o=t,a=n;if(!U.includes(o))throw s.property+"type "+t;const c=a[o],l=void 0===r?c.value(i):r;if("object"!=typeof c)throw s.internal+JSON.stringify(this._pristine);const h=c[i];if(void 0===h)throw s.property+"pristine "+i+JSON.stringify(c);const d={property:i,target:c,redoValue:l,undoValue:h,type:e.ActionType.Change};if(this.currentActionReusable(c,i)){const e=this.actions.currentAction;return e.updateAction(l),void this.handleAction(e)}this.actionCreate(d)}clipCanBeSplit(e,t,i){if(!x.object(e))return!1;const r=Ft.fromTime(t),s=e.timeRange(i);if(!s.intersects(r))return!1;const n=r.scale(s.fps);return n.frame!==s.frame&&n.end!==s.end}get clips(){return this.mash.clips}currentActionReusable(e,t){if(!this.actions.currentActionLast)return!1;const i=this.actions.currentAction;return i instanceof Ze&&(i.target===e&&i.property===t)}get currentTime(){return this.mash.drawnTime?this.mash.drawnTime.seconds:0}get duration(){return this.mash.duration}get endTime(){return this.mash.endTime.scale(this.fps,"floor")}filterClipSelection(t){const i=Array.isArray(t)?t:[t],[r]=i;if(!r)return[];const{trackType:s,track:n}=r,o=i.filter((e=>e.track===n&&e.trackType===s)).sort(Oe);if(n||s===e.TrackType.Audio)return o;let a=!0;return o.filter(((e,t)=>!!a&&(t===o.length-1||(a=e.frame+e.frames===o[t+1].frame),!0)))}get fps(){return this._fps||this.mash.quantize}set fps(t){const i=Number(t);this._fps!==i&&(this._fps=i,this.eventTarget.emit(e.EventType.Fps),this.time=this.time.scale(this.fps))}get frame(){return this.time.frame}set frame(e){this.goToTime(St.fromArgs(Number(e),this.fps))}get frames(){return this.endTime.frame}freeze(){const{clip:t}=this.selection;if(!t)throw s.selection;if(!this.clipCanBeSplit(t,this.time,this.mash.quantize))throw s.invalid.action;if(e.DefinitionType.Video!==t.type)throw s.invalid.action;const i=t,r=this.time.scale(this.mash.quantize),n=this.mash.clipTrack(i).clips,o=i.copy,a=i.copy,c={frames:i.frames-(r.frame-i.frame),freezeClip:i,frozenClip:a,insertClip:o,trackClips:n,redoSelection:{clip:a},index:1+n.indexOf(i),type:e.ActionType.Freeze};a.frame=r.frame,a.frames=1,a.trim=i.trim+(r.frame-i.frame),o.frame=r.frame+1,o.frames=c.frames-1,o.trim=a.trim+1,this.actionCreate(c)}get gain(){return this.muted?0:this.volume}goToTime(e){const{fps:t}=this,i=(e?e.scaleToFps(t):St.fromArgs(0,t)).min(this.endTime);if(e&&i.equalsTime(this.time))return Promise.resolve();const r=this.mash.seekToTime(i);return r||Promise.resolve()}handleAction(e){this.selection=e.selection,this.mash.handleAction(e)}get imageData(){return Dt.visibleContext.imageData}get imageSize(){return Dt.visibleContext.size}set imageSize(e){const{width:t,height:i}=e;if(!x.aboveZero(t)||!x.aboveZero(i))throw s.invalid.size;Dt.visibleContext.size=e,this.loadMashAndDraw()}loadMashAndDraw(){const e=this.mash.loadPromise;return e?e.then((()=>{this.mash.compositeVisible()})):(this.mash.compositeVisible(),Promise.resolve())}get loadedDefinitions(){return this.mash.loadedDefinitions}get loop(){return this._loop}set loop(e){const t=!!e;this._loop=t,this._mash&&(this.mash.loop=t)}get mash(){if(this._mash)return this._mash;const e=rs.instance();return this.mash=e,e}set mash(t){this._mash!==t&&(this.paused=!0,this._mash&&this._mash.destroy(),this._selectedEffects=[],this._mash=t,this._mash.buffer=this.buffer,this._mash.gain=this.gain,this._mash.loop=this.loop,this._mash.emitter=this.eventTarget,this._actions&&(this._actions.destroy(),this._actions.mash=this._mash),this.selectedClips=[],this.eventTarget.emit(e.EventType.Mash),this.eventTarget.emit(e.EventType.Track),this.eventTarget.emit(e.EventType.Duration),this.eventTarget.emit(e.EventType.Action),this.goToTime(),this.autoplay&&(this.paused=!1))}move(t,i,r=0,n=0){if(!x.object(t))throw s.argument+"move";i!==e.MoveType.Effect?this.moveClips(t,r,n):this.moveEffects(t,r)}moveClips(t,i=0,r=0){if(!x.positive(i))throw s.argument+"moveClips frameOrIndex";if(!x.positive(r))throw s.argument+"moviClips trackIndex";const n=this.filterClipSelection(t);if(!x.populatedArray(n))throw s.argument+"moveClips clips";const[o]=n,{trackType:a,track:c}=o,l={clips:n,trackType:a,trackIndex:r,undoTrackIndex:c,type:e.ActionType.MoveClips},h=this.mash.trackOfTypeAtIndex(a,r),d=this.mash.trackOfTypeAtIndex(a,c),u=h.clips.indexOf(o);if(h.dense&&(l.insertIndex=i),d.dense&&(l.undoInsertIndex=u,i<u&&(l.undoInsertIndex+=n.length)),!h.dense||!d.dense){const e=n.map((e=>e.frame)),t=h.frameForClipsNearFrame(n,i)-o.frame;if(!t)return;l.undoFrames=e,l.redoFrames=e.map((e=>e+t))}this.actionCreate(l)}moveEffects(t,i=0){if(!x.positive(i))throw s.argument;const r=(Array.isArray(t)?t:[t]).filter((e=>e instanceof $i));if(!x.populatedArray(r))throw s.argument;const{clip:n}=this.selection;if(!n)throw s.selection;const{effects:o}=n,a=[...o],c=[];a.forEach(((e,t)=>{t===i&&c.push(...r),r.includes(e)||c.push(e)}));const l={effects:o,undoEffects:a,redoEffects:c,type:e.ActionType.MoveEffects};this.actionCreate(l)}get muted(){return this._muted}set muted(e){const t=!!e;this._muted!==t&&(this._muted=t,this.mash.gain=this.gain)}pause(){this.paused=!0}get paused(){return this.mash.paused}set paused(e){this._mash&&(this.mash.paused=!!e)}play(){this.paused=!1}get position(){let e=0;return this.time.frame&&(e=this.time.seconds/this.duration,1!==e&&(e=parseFloat(e.toFixed(this.precision)))),e}set position(e){this.goToTime(St.fromSeconds(this.duration*Number(e),this.fps))}get positionStep(){return parseFloat(`0.${"0".repeat(this.precision-1)}1`)}redo(){this.actions.canRedo&&this.handleAction(this.actions.redo())}remove(){if(this.selection.effect)this.removeEffects(this.selection.effect);else if(this.selection.clip)this.removeClips(this.selection.clip);else{if(!this.selection.track)throw s.selection;this.mash.removeTrack(this.selection.track.trackType)}}removeClips(t){const i=this.filterClipSelection(t);if(!x.populatedArray(i))throw s.argument;const[r]=i,n=this.mash.clipTrack(r),o={redoSelection:{},clips:i,track:n,index:n.clips.indexOf(r),type:e.ActionType.RemoveClips};this.actionCreate(o)}removeEffects(t){const i=(Array.isArray(t)?t:[t]).filter((e=>e instanceof $i));if(!x.populatedArray(i))throw s.argument;const{clip:r}=this.selection;if(!r)throw s.selection;const{effects:n}=r,o=[...n],a=n.filter((e=>!i.includes(e))),c={redoSelectedEffects:[],effects:n,undoEffects:o,redoEffects:a,type:e.ActionType.MoveEffects};this.actionCreate(c)}save(){this.actions.save()}selectClip(e){const t=e?this.mash.clipTrack(e):this.selection.track;this.selection={track:t,clip:e}}selectEffect(e){this.selection={...this.selection,effect:e}}selectTrack(e){this.selection={track:e}}get selection(){return this._selection}set selection(t){if(!t)throw console.trace(this.constructor.name,"selection with no value"),s.internal;const{clip:i,track:r,effect:n}=t;this.selection.effect=n,this.selection.clip=i,this.selection.track=r||(i?this.mash.clipTrack(i):void 0),this.eventTarget.emit(e.EventType.Selection)}split(){const t=this.selection.clip;if(!t)throw s.selection;if(!this.clipCanBeSplit(t,this.time,this.mash.quantize))throw s.invalid.action;const i=this.time.scale(this.mash.quantize),r=t.frames,n=i.frame-t.frame,o=t.copy;o.frames=r-n,o.frame=i.frame,t.propertyNames.includes("trim")&&(o.trim+=n);const a=this.mash.clipTrack(t).clips,c={type:e.ActionType.Split,splitClip:t,insertClip:o,trackClips:a,redoFrames:n,undoFrames:r,index:1+a.indexOf(t),redoSelection:{clip:o},undoSelection:{clip:t}};this.actionCreate(c)}get time(){return this.mash.time}set time(e){this.goToTime(e)}get timeRange(){return this.mash.timeRange}undo(){this.actions.canUndo&&this.handleAction(this.actions.undo())}get volume(){return this._volume}set volume(e){const t=Number(e);if(this._volume!==t){if(!x.positive(t))throw s.invalid.volume;this._volume=t,x.aboveZero(t)&&(this.muted=!1),this.mash.gain=this.gain}}}const gn=new class{constructor(){this.mashers=[]}addMasher(e){this.mashers.length||this.masherStart(),this.mashers.push(e)}destroy(e){const t=this.mashers.indexOf(e);t<0||(this.mashers.splice(t,1),this.mashers.length||this.masherStop())}handleInterval(){const e=this.mashers.flatMap((e=>e.mash.loadUrls));Dt.flush(e);const t=this.mashers.flatMap((e=>e.mash.definitions));ve.map.forEach((e=>{t.includes(e)||e.retain||ve.uninstall(e.id)}))}instance(e={}){e.autoplay||=Pt.masher.autoplay,e.precision||=Pt.masher.precision,e.loop||=Pt.masher.loop,e.fps||=Pt.masher.fps,e.volume||=Pt.masher.volume,e.buffer||=Pt.masher.buffer;const t=new pn(e);return this.addMasher(t),t}masherStart(){this.interval||(this.interval=setInterval((()=>this.handleInterval()),1e4))}masherStop(){this.interval&&(clearInterval(this.interval),this.interval=void 0)}};O.forEach((e=>{Re[e].initialize()})),e.Action=qe,e.ActionFactory=et,e.Actions=Ct,e.AddClipToTrackAction=Je,e.AddEffectAction=Le,e.AddTrackAction=Be,e.AudibleContext=ke,e.AudibleDefinitionMixin=Zt,e.AudibleFileDefinitionMixin=Wt,e.AudibleFileMixin=Ut,e.AudibleMixin=Rt,e.AudioClass=Jt,e.AudioDefinitionClass=Gt,e.AudioFactoryImplementation=ri,e.AudioLoader=Ot,e.Cache=Dt,e.Capitalize=Ue,e.ChangeAction=Ze,e.ChangeFramesAction=We,e.ChangeTrimAction=Ke,e.ClipDefinitionMixin=Lt,e.ClipMixin=qt,e.ClipTypes=D,e.Color=ne,e.CommandTypes=L,e.Composition=ts,e.ContextFactory=ze,e.DataTypes=R,e.Default=Pt,e.DefinitionBase=Fe,e.DefinitionTypes=O,e.Definitions=ve,e.DefinitionsMap=oe,e.EffectClass=$i,e.EffectDefinitionClass=Zi,e.EffectFactoryImplementation=or,e.Element=rt,e.Emitter=st,e.Errors=s,e.Evaluator=ht,e.Factories=_e,e.Factory=Re,e.FilterClass=ni,e.FilterDefinitionClass=oi,e.FilterFactoryImplementation=qi,e.FontClass=pi,e.FontDefinitionClass=gi,e.FontFactoryImplementation=_i,e.FontLoader=Mt,e.FreezeAction=He,e.Id=_,e.ImageClass=Br,e.ImageDefinitionClass=Zr,e.ImageFactoryImplementation=es,e.ImageLoader=Et,e.InstanceBase=Se,e.Is=x,e.Loader=zt,e.LoaderFactory=jt,e.MashClass=is,e.MashFactory=rs,e.MasherActions=J,e.MasherClass=pn,e.MasherFactory=gn,e.MergerClass=cr,e.MergerDefinitionClass=hr,e.MergerFactoryImplementation=Sr,e.ModularDefinitionMixin=Ui,e.ModularMixin=Bi,e.ModuleTypes=N,e.MoveClipsAction=$e,e.MoveEffectsAction=Xe,e.OutputFormats=W,e.Parameter=si,e.Pixel=wt,e.PropertiedClass=xe,e.Property=we,e.RemoveClipsAction=Ye,e.Round=mt,e.ScalerClass=_r,e.ScalerDefinitionClass=Ar,e.ScalerFactoryImplementation=Pr,e.Seconds=(e,t,i)=>{let r,s,n,o="";return i||(i=e),r=3600,s=2,i>=r&&(e>=r?(o+=String(Math.floor(e/r)).padStart(s,"0"),n=!0,e%=r):o+="00:"),r=60,(n||i>=r)&&(n&&(o+=":"),e>=r?(o+=String(Math.floor(e/r)).padStart(s,"0"),n=!0,e%=r):o+="00:"),r=1,n||i>=r?(n&&(o+=":"),e>=r?(o+=String(Math.floor(e/r)).padStart(s,"0"),n=!0,e%=r):o+="00"):o+="00",t>1&&(10===t&&(s=1),o+=".",e?(e=1===s?Math.floor(10*e)/10:Math.floor(100*e)/100,e=Number(String(e).substr(2,2)),o+=String(e).padStart(s,"0")):o+="0".padStart(s,"0")),o},e.Sort=Ve,e.SplitAction=Ge,e.StreamableDefinitionMixin=Ls,e.StreamableMixin=Bs,e.ThemeClass=ns,e.ThemeDefinitionClass=cs,e.ThemeFactoryImplementation=vs,e.Time=St,e.TimeRange=Ft,e.TrackClass=je,e.TrackFactory=Pe,e.TrackTypes=I,e.TransformTypes=U,e.TransformableDefinitionMixin=os,e.TransformableMixin=Rr,e.TransitionClass=bs,e.TransitionDefinitionClass=ws,e.TransitionFactoryImplementation=Cs,e.Type=ye,e.TypeValue=K,e.Types=Te,e.Url=It,e.VideoClassImplementation=zs,e.VideoDefinitionClassImplementation=Ms,e.VideoFactoryImplementation=Us,e.VideoLoader=Nt,e.VideoSequenceClassImplementation=sn,e.VideoSequenceDefinitionClassImplementation=on,e.VideoSequenceFactoryImplementation=fn,e.VideoStreamClass=$s,e.VideoStreamDefinitionClass=Ws,e.VideoStreamFactoryImplementation=tn,e.VisibleContext=Ie,e.VisibleDefinitionMixin=Jr,e.VisibleMixin=qr,e.audioDefine=ti,e.audioDefinition=Ht,e.audioDefinitionFromId=Xt,e.audioFromId=Qt,e.audioInitialize=ei,e.audioInstall=ii,e.audioInstance=Yt,e.colorRgb2hex=Q,e.colorRgb2yuv=te,e.colorStrip=ie,e.colorTransparent=se,e.colorValid=re,e.colorYuv2rgb=Y,e.colorYuvBlend=ee,e.definitionsByType=ce,e.definitionsClear=le,e.definitionsFont=he,e.definitionsFromId=de,e.definitionsInstall=ue,e.definitionsInstalled=me,e.definitionsMerger=fe,e.definitionsScaler=pe,e.definitionsUninstall=ge,e.effectDefine=nr,e.effectDefinition=er,e.effectDefinitionFromId=tr,e.effectFromId=rr,e.effectInitialize=sr,e.effectInstall=nr,e.effectInstance=ir,e.elementScrollMetrics=it,e.filterDefine=Ri,e.filterDefinition=Ei,e.filterDefinitionFromId=Ni,e.filterFromId=ji,e.filterInitialize=Pi,e.filterInstall=Ri,e.filterInstance=Vi,e.fontDefine=Fi,e.fontDefinition=bi,e.fontDefinitionFromId=Ti,e.fontFromId=xi,e.fontInitialize=Si,e.fontInstall=Fi,e.fontInstance=wi,e.idGenerate=S,e.idPrefixSet=F,e.imageDefine=Yr,e.imageDefinition=Wr,e.imageDefinitionFromId=Kr,e.imageFromId=Hr,e.imageInitialize=Xr,e.imageInstall=Qr,e.imageInstance=Gr,e.isAboveZero=g,e.isArray=v,e.isBoolean=l,e.isDefined=d,e.isFloat=f,e.isInteger=m,e.isMethod=h,e.isNan=u,e.isNumber=c,e.isObject=n,e.isPopulatedArray=w,e.isPopulatedObject=T,e.isPopulatedString=b,e.isPositive=p,e.isString=o,e.isUndefined=a,e.mergerDefaultId=gr,e.mergerDefine=xr,e.mergerDefinition=vr,e.mergerDefinitionFromId=yr,e.mergerFromId=Tr,e.mergerInitialize=wr,e.mergerInstall=xr,e.mergerInstance=br,e.pixelColor=vt,e.pixelFromFrame=bt,e.pixelNeighboringRgbas=gt,e.pixelPerFrame=yt,e.pixelRgbaAtIndex=ft,e.pixelToFrame=Tt,e.roundMethod=dt,e.roundWithMethod=ut,e.scalerDefaultId=zr,e.scalerDefine=jr,e.scalerDefinition=Or,e.scalerDefinitionFromId=Mr,e.scalerFromId=Nr,e.scalerInitialize=Vr,e.scalerInstall=jr,e.scalerInstance=Er,e.sortByFrame=Oe,e.sortByLabel=Ne,e.sortByLayer=Me,e.sortByTrack=Ee,e.themeDefine=gs,e.themeDefinition=ds,e.themeDefinitionFromId=us,e.themeFromId=fs,e.themeInitialize=ps,e.themeInstall=gs,e.themeInstance=ms,e.timeEqualizeRates=xt,e.transitionDefine=Is,e.transitionDefinition=Ss,e.transitionDefinitionFromId=Fs,e.transitionFromId=ks,e.transitionInitialize=As,e.transitionInstall=Is,e.transitionInstance=_s,e.urlAbsolute=kt,e.urlForRemoteServer=At,e.urlRemoteServer=_t,e.videoDefine=Rs,e.videoDefinition=Es,e.videoDefinitionFromId=Ns,e.videoFromId=js,e.videoInitialize=Ps,e.videoInstall=qs,e.videoInstance=Vs,e.videoSequenceDefine=un,e.videoSequenceDefinition=an,e.videoSequenceDefinitionFromId=cn,e.videoSequenceFromId=hn,e.videoSequenceInitialize=dn,e.videoSequenceInstall=mn,e.videoSequenceInstance=ln,e.videoStreamDefine=Qs,e.videoStreamDefinition=Ks,e.videoStreamDefinitionFromId=Gs,e.videoStreamFromId=Xs,e.videoStreamInitialize=Ys,e.videoStreamInstall=en,e.videoStreamInstance=Hs}));
//# sourceMappingURL=moviemasher.min.js.map
